<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="600" Id="form" Left="8" OnLoadCompleted="POLFPO00300_OnLoadCompleted" PidAttrib="7" Title="운영모델단가표&#32;등록" Top="8" Ver="1.0" Width="1024" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_aply_dtm">
				<Contents>DIS_CMP_OBJ_YN</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_pol_uplst_aply_mdl" OnColumnChanged="ds_pol_uplst_aply_mdl_OnColumnChanged">
				<Contents>
					<colinfo id="UPLST_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="MFACT_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="DEAL_CO_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="PROD_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="PROD_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="PROD_CL" size="256" summ="default" type="STRING"/>
					<colinfo id="PROD_CHRTIC_1" size="256" summ="default" type="STRING"/>
					<colinfo id="PROD_CHRTIC_2" size="256" summ="default" type="STRING"/>
					<colinfo id="POL_YM" size="256" summ="default" type="STRING"/>
					<colinfo id="POL_TS" size="256" summ="default" type="STRING"/>
					<colinfo id="EXIT_CASH_PRCHS_PRC" size="256" summ="default" type="STRING"/>
					<colinfo id="EXIT_CRDT_PRCHS_PRC" size="256" summ="default" type="STRING"/>
					<colinfo id="EXIT_STRD_SALE_PRC" size="256" summ="default" type="STRING"/>
					<colinfo id="FIX_CASH_PRCHS_PRC" size="256" summ="default" type="STRING"/>
					<colinfo id="FIX_CRDT_PRCHS_PRC" size="256" summ="default" type="STRING"/>
					<colinfo id="FIX_STRD_SALE_PRC" size="256" summ="default" type="STRING"/>
					<colinfo id="RMKS" size="256" summ="default" type="STRING"/>
					<colinfo id="EDIT_FLAG" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_condition">
				<Contents>
					<colinfo id="UPLST_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="POL_YM" size="256" summ="default" type="STRING"/>
					<colinfo id="POL_TS" size="256" summ="default" type="STRING"/>
					<colinfo id="APLY_STA_DTM" size="256" summ="default" type="STRING"/>
					<colinfo id="APLY_END_DTM" size="256" summ="default" type="STRING"/>
					<colinfo id="HOUR" size="256" summ="default" type="STRING"/>
					<colinfo id="MIN" size="256" summ="default" type="STRING"/>
					<colinfo id="END_HOUR" size="256" summ="default" type="STRING"/>
					<colinfo id="END_MIN" size="256" summ="default" type="STRING"/>
					<colinfo id="RMKS" size="256" summ="default" type="STRING"/>
					<colinfo id="DIS_CMP_OBJ_YN" size="256" summ="default" type="STRING"/>
					<record>
						<APLY_END_DTM></APLY_END_DTM>
						<APLY_STA_DTM></APLY_STA_DTM>
						<DIS_CMP_OBJ_YN></DIS_CMP_OBJ_YN>
						<END_HOUR></END_HOUR>
						<END_MIN></END_MIN>
						<HOUR></HOUR>
						<MIN></MIN>
						<POL_TS></POL_TS>
						<POL_YM></POL_YM>
						<RMKS></RMKS>
						<UPLST_ID></UPLST_ID>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cp_prod_mgmt">
				<Contents>
					<colinfo id="PROD_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="USE_YN" size="256" summ="default" type="STRING"/>
					<colinfo id="MOD_RSN" size="256" summ="default" type="STRING"/>
					<colinfo id="MKTG_DT" size="256" summ="default" type="STRING"/>
					<colinfo id="END_DT" size="256" summ="default" type="STRING"/>
					<colinfo id="USE_STOP_DT" size="256" summ="default" type="STRING"/>
					<colinfo id="PROD_CL" size="256" summ="default" type="STRING"/>
					<colinfo id="MFACT_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="DEAL_CO_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="PROD_CHRTIC_1" size="256" summ="default" type="STRING"/>
					<colinfo id="PROD_CHRTIC_2" size="256" summ="default" type="STRING"/>
					<colinfo id="EDIT_FLAG" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_uplst_cnt">
				<Contents>
					<colinfo id="uplst_id_cnt" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Div Border="Raised" Height="71" Id="div_search" Left="10" Style="sty_div_input" TabOrder="1" Text="질의내용" Top="8" Width="1004">
			<Contents>
				<Static Align="Right" Height="20" Id="Static2" Left="362" Style="sty_lb_Basic" TabOrder="1" Text="판매가추가" Top="38" VAlign="Middle" Width="68"></Static>
				<Static Align="Right" Height="20" Id="Static3" Left="360" Style="sty_lb_Basic" TabOrder="3" Text="적용기간" Top="7" VAlign="Middle" Width="68"></Static>
				<Calendar BindDataset="ds_condition" Border="Flat" ButtonImageID="btn_i_calendar" Column="APLY_STA_DTM" DayFont="Default,-1" Enable="FALSE" HeaderBorder="NONE" HeaderFont="Default,-1" HeadStyle="sty_calendar_head" Height="20" Id="cal_aply_sta_dtm" Left="432" LeftMargin="2" MonthPopupBorder="RAISED" NullValue="&#32;" OnChanged="div_search_cal_aply_sta_dtm_OnChanged" RightMargin="2" SaturdayTextColor="user28" Style="sty_calendar" SundayTextColor="user27" TabOrder="2" TodayColor="user26" Top="7" WeeksFont="Default,-1" WeekStyle="sty_calendar_week" Width="113"></Calendar>
				<Static Align="Center" Height="20" Id="Static4" Left="608" TabOrder="5" Text="~" Top="7" VAlign="Middle" Width="20"></Static>
				<Calendar BindDataset="ds_condition" Border="Flat" ButtonImageID="btn_i_calendar" Column="APLY_END_DTM" DayFont="Default,-1" Enable="FALSE" HeaderBorder="NONE" HeaderFont="Default,-1" HeadStyle="sty_calendar_head" Height="20" Id="cal_aply_end_dtm" Left="624" LeftMargin="2" MonthPopupBorder="RAISED" NullValue="&#32;" RightMargin="2" SaturdayTextColor="user28" Style="sty_calendar" SundayTextColor="user27" TabOrder="5" TodayColor="user26" Top="7" WeeksFont="Default,-1" WeekStyle="sty_calendar_week" Width="113"></Calendar>
				<Static Align="Right" Height="20" Id="Static5" Left="22" Style="sty_lb_Basic" TabOrder="2" Text="적용년월" Top="7" VAlign="Middle" Width="76"></Static>
				<Shape Bottom="33" Height="1" Id="Shape0" Left="-1" LineColor="user9" Right="1005" TabOrder="7" Top="32" Width="1006"></Shape>
				<Static Align="Center" Height="20" Id="Static0" Left="547" TabOrder="8" Text="원" Top="39" VAlign="Middle" Width="20"></Static>
				<Static Align="Right" Height="20" Id="Static1" Left="22" Style="sty_lb_Basic" TabOrder="9" Text="적용상품" Top="38" VAlign="Middle" Width="76"></Static>
				<Checkbox Height="20" Id="chk_term" Left="101" LeftMargin="5" OnClick="div_search_chk_term_OnClick" Style="sty_opt_input" TabOrder="8" Text="단말기" Top="38" Value="FALSE" Width="73"></Checkbox>
				<Checkbox Height="20" Id="chk_usim" Left="169" LeftMargin="5" OnClick="div_search_chk_term_OnClick" Style="sty_opt_input" TabOrder="9" Text="USIM" Top="38" Value="FALSE" Width="73"></Checkbox>
				<Checkbox Height="20" Id="chk_etc" Left="225" LeftMargin="5" OnClick="div_search_chk_term_OnClick" Style="sty_opt_input" TabOrder="10" Text="기타재고" Top="38" Value="FALSE" Width="89"></Checkbox>
				<Edit Align="CENTER" BindDataset="ds_condition" Border="Flat" Column="HOUR" Enable="FALSE" Font="굴림,-1" Height="20" Id="ed_hour" Left="548" MaxLength="2" Number="TRUE" OnChanged="div_search_ed_hour_OnChanged" Style="sty_ipt_search" TabOrder="3" Top="7" Width="30"></Edit>
				<Edit Align="CENTER" BindDataset="ds_condition" Border="Flat" Column="MIN" Enable="FALSE" Font="굴림,-1" Height="20" Id="ed_min" Left="580" MaxLength="2" Number="TRUE" OnChanged="div_search_ed_min_OnChanged" Style="sty_ipt_search" TabOrder="4" Top="7" Width="30"></Edit>
				<Edit Align="CENTER" BindDataset="ds_condition" Border="Flat" Column="END_HOUR" Enable="FALSE" Font="굴림,-1" Height="20" Id="ed_end_hour" Left="739" Style="sty_ipt_search" TabOrder="6" Top="7" Width="30"></Edit>
				<Edit Align="CENTER" BindDataset="ds_condition" Border="Flat" Column="END_MIN" Enable="FALSE" Font="굴림,-1" Height="20" Id="ed_end_min" Left="771" Style="sty_ipt_search" TabOrder="7" Top="7" Width="30"></Edit>
				<MaskEdit Border="Flat" DecimalLen="0" Height="20" Id="edt_fix_strd_sale_prc" Left="432" LeftMargin="1" MaxLength="7" OnFocus="div_search_edt_fix_strd_sale_prc_OnFocus" OnKillFocus="div_search_edt_fix_strd_sale_prc_OnKillFocus" RightMargin="1" Style="edit_normal" TabOrder="11" Top="39" Value="0" Width="114"></MaskEdit>
				<MaskEdit BindDataset="ds_condition" Border="Flat" Column="POL_YM" Height="20" Id="cal_polYm" Left="101" LeftMargin="2" Mask="@@@@-@@" MaxLength="6" Readonly="TRUE" RightMargin="2" Style="sty_ipt_form" TabOrder="1" Top="7" Type="STRING" Width="77"></MaskEdit>
				<Button Cursor="HAND" Height="20" Id="btn_monthCalendar" ImageID="btn_i_calendar" Left="178" OnClick="btn_monthCalendar_OnClick" TabOrder="12" TabStop="FALSE" Text="Button3" Top="7" Width="17"></Button>
			</Contents>
		</Div>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="25" Id="btn_save" ImageID="btn_c_2" Left="891" LeftMargin="5" OnClick="df_save" Style="sty_btn_c" TabOrder="6" Text="저장" Top="565" Visible="FALSE" Width="60"></Button>
		<Div Border="Raised" Height="71" Id="div_process" Left="10" Style="sty_div_input" TabOrder="4" Text="Div0" Top="484" Width="1004">
			<Contents>
				<TextArea BindDataset="ds_condition" Border="Flat" CheckLength="Byte" Column="RMKS" Height="51" Id="txt_rmks" Left="88" MaxLength="90" Style="sty_ipt_form" TabOrder="1" Top="7" VScroll="TRUE" Width="903"></TextArea>
				<Static Align="Right" Height="20" Id="Static8" Left="24" Style="sty_lb_Basic" TabOrder="2" Text="비고" Top="7" VAlign="Middle" Width="60"></Static>
			</Contents>
		</Div>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" BindDataset="ds_pol_uplst_aply_mdl" BkColor2="user32" BoldHead="true" Border="Flat" Bottom="474" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" FillArea="TRUE" FillAreaType="Control" HeadBorder="Flat" HeadHeight="22" Height="360" Id="grd_pol_uplst" InputPanel="FALSE" Left="10" LineColor="user33" MinWidth="100" Right="1014" RowHeight="21" Style="sty_Grid" TabOrder="3" TabStop="true" Top="114" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="user33" WheelScrollRow="1" Width="1004">
			<contents>
				<format id="Default">
					<columns>
						<col width="30"/>
						<col width="60"/>
						<col width="80"/>
						<col width="60"/>
						<col width="65"/>
						<col width="65"/>
						<col width="75"/>
						<col width="75"/>
						<col width="75"/>
						<col width="75"/>
						<col width="75"/>
						<col width="75"/>
					</columns>
					<head>
						<cell bkcolor="user34" col="0" color="user35" display="text" rowspan="2" text="번호"/>
						<cell bkcolor="user34" col="1" color="user35" display="text" rowspan="2" text="상품구분"/>
						<cell bkcolor="user34" col="2" color="user35" display="text" rowspan="2" text="제조사"/>
						<cell bkcolor="user34" col="3" color="user35" display="text" rowspan="2" text="모델"/>
						<cell bkcolor="user34" col="4" color="user35" display="text" rowspan="2" text="상품&#10;특성1" wordwrap="exchar"/>
						<cell bkcolor="user34" col="5" color="user35" display="text" rowspan="2" text="상품&#10;특성2" wordwrap="exchar"/>
						<cell bkcolor="user34" col="6" color="user35" colspan="3" display="text" text="기존정보"/>
						<cell bkcolor="user34" col="9" color="user35" colspan="3" display="text" text="확정정보"/>
						<cell bkcolor="user34" col="6" color="user35" display="text" row="1" text="현금매입가"/>
						<cell bkcolor="user34" col="7" color="user35" display="text" row="1" text="여신매입가"/>
						<cell bkcolor="user34" col="8" color="user35" display="text" row="1" text="기준판매가"/>
						<cell bkcolor="user34" col="9" color="user35" display="text" row="1" text="현금매입가"/>
						<cell bkcolor="user34" col="10" color="user35" display="text" row="1" text="여신매입가"/>
						<cell bkcolor="user34" col="11" color="user35" display="text" row="1" text="기준판매가"/>
					</head>
					<body>
						<cell align="right" col="0" display="text" expr="row+1"/>
						<cell align="center" col="1" colid="PROD_CL" combocol="code" combotext="name" display="combo"/>
						<cell col="2" colid="DEAL_CO_NM" combocol="code" combotext="name" display="text"/>
						<cell align="left" col="3" colid="PROD_NM" combotext="name" display="text"/>
						<cell align="center" col="4" colid="PROD_CHRTIC_1" combocol="code" combodataset="ds_prodchrtrc_1" combotext="name" display="combo"/>
						<cell align="center" col="5" colid="PROD_CHRTIC_2" combocol="code" combodataset="ds_prodchrtrc_2" combotext="name" display="combo"/>
						<cell align="right" bkcolor="expr:decode(ds_pol_uplst_aply_mdl.getColumn(row,&apos;EXIT_CASH_PRCHS_PRC&apos;),ds_pol_uplst_aply_mdl.getColumn(row,&apos;FIX_CASH_PRCHS_PRC&apos;),&apos;&apos;,&apos;user25&apos;)" col="6" colid="EXIT_CASH_PRCHS_PRC" display="number" edit='expr:iif(EDIT_FLAG&#32;==&quot;Y&quot;,&quot;number&quot;,&quot;none&quot;)' limit="7"/>
						<cell align="right" bkcolor="expr:decode(ds_pol_uplst_aply_mdl.getColumn(row,&apos;EXIT_CRDT_PRCHS_PRC&apos;),ds_pol_uplst_aply_mdl.getColumn(row,&apos;FIX_CRDT_PRCHS_PRC&apos;),&apos;&apos;,&apos;user25&apos;)" col="7" colid="EXIT_CRDT_PRCHS_PRC" display="number" edit='expr:iif(EDIT_FLAG&#32;==&quot;Y&quot;,&quot;number&quot;,&quot;none&quot;)' limit="7"/>
						<cell align="right" bkcolor="expr:decode(ds_pol_uplst_aply_mdl.getColumn(row,&apos;EXIT_STRD_SALE_PRC&apos;),ds_pol_uplst_aply_mdl.getColumn(row,&apos;FIX_STRD_SALE_PRC&apos;),&apos;&apos;,&apos;user25&apos;)" col="8" colid="EXIT_STRD_SALE_PRC" display="number" edit='expr:iif(EDIT_FLAG&#32;==&quot;Y&quot;,&quot;number&quot;,&quot;none&quot;)' limit="7"/>
						<cell align="right" bkcolor="expr:decode(ds_pol_uplst_aply_mdl.getColumn(row,&apos;EXIT_CASH_PRCHS_PRC&apos;),ds_pol_uplst_aply_mdl.getColumn(row,&apos;FIX_CASH_PRCHS_PRC&apos;),&apos;&apos;,&apos;user25&apos;)" col="9" colid="FIX_CASH_PRCHS_PRC" display="number" edit="number" limit="7"/>
						<cell align="right" bkcolor="expr:decode(ds_pol_uplst_aply_mdl.getColumn(row,&apos;EXIT_CRDT_PRCHS_PRC&apos;),ds_pol_uplst_aply_mdl.getColumn(row,&apos;FIX_CRDT_PRCHS_PRC&apos;),&apos;&apos;,&apos;user25&apos;)" col="10" colid="FIX_CRDT_PRCHS_PRC" display="number" edit="number" limit="7"/>
						<cell align="right" bkcolor="expr:decode(ds_pol_uplst_aply_mdl.getColumn(row,&apos;EXIT_STRD_SALE_PRC&apos;),ds_pol_uplst_aply_mdl.getColumn(row,&apos;FIX_STRD_SALE_PRC&apos;),&apos;&apos;,&apos;user25&apos;)" col="11" colid="FIX_STRD_SALE_PRC" display="number" edit="number" limit="7"/>
					</body>
				</format>
				<format id="HstPolUplst">
					<columns>
						<col width="30"/>
						<col width="60"/>
						<col width="80"/>
						<col width="60"/>
						<col width="65"/>
						<col width="65"/>
						<col width="75"/>
						<col width="75"/>
						<col width="75"/>
						<col width="75"/>
						<col width="75"/>
						<col width="75"/>
					</columns>
					<head>
						<cell bkcolor="user34" col="0" color="user35" display="text" rowspan="2" text="번호"/>
						<cell bkcolor="user34" col="1" color="user35" display="text" rowspan="2" text="상품구분"/>
						<cell bkcolor="user34" col="2" color="user35" display="text" rowspan="2" text="제조사"/>
						<cell bkcolor="user34" col="3" color="user35" display="text" rowspan="2" text="모델"/>
						<cell bkcolor="user34" col="4" color="user35" display="text" rowspan="2" text="상품&#32;특성1" wordwrap="exchar"/>
						<cell bkcolor="user34" col="5" color="user35" display="text" rowspan="2" text="상품&#32;특성2" wordwrap="exchar"/>
						<cell bkcolor="user34" col="6" color="user35" colspan="3" display="text" text="기존정보"/>
						<cell bkcolor="user34" col="9" color="user35" colspan="3" display="text" text="확정정보"/>
						<cell bkcolor="user34" col="6" color="user35" display="text" row="1" text="현금매입가"/>
						<cell bkcolor="user34" col="7" color="user35" display="text" row="1" text="여신매입가"/>
						<cell bkcolor="user34" col="8" color="user35" display="text" row="1" text="기준판매가"/>
						<cell bkcolor="user34" col="9" color="user35" display="text" row="1" text="현금매입가"/>
						<cell bkcolor="user34" col="10" color="user35" display="text" row="1" text="여신매입가"/>
						<cell bkcolor="user34" col="11" color="user35" display="text" row="1" text="기준판매가"/>
					</head>
					<body>
						<cell align="center" col="0" display="text" expr="row+1"/>
						<cell align="center" col="1" colid="PROD_CL" combocol="code" combotext="name" display="combo"/>
						<cell align="left" col="2" colid="DEAL_CO_NM" combocol="code" combotext="name" display="text"/>
						<cell align="left" col="3" colid="PROD_NM" combotext="name" display="text"/>
						<cell align="center" col="4" colid="PROD_CHRTIC_1" combocol="code" combodataset="ds_prodchrtrc_1" combotext="name" display="combo"/>
						<cell align="center" col="5" colid="PROD_CHRTIC_2" combocol="code" combodataset="ds_prodchrtrc_2" combotext="name" display="combo"/>
						<cell align="right" bkcolor="expr:decode(ds_pol_uplst_aply_mdl.getColumn(row,&apos;EXIT_CASH_PRCHS_PRC&apos;),ds_pol_uplst_aply_mdl.getColumn(row,&apos;FIX_CASH_PRCHS_PRC&apos;),&apos;&apos;,&apos;user25&apos;)" col="6" colid="EXIT_CASH_PRCHS_PRC" display="number"/>
						<cell align="right" bkcolor="expr:decode(ds_pol_uplst_aply_mdl.getColumn(row,&apos;EXIT_CRDT_PRCHS_PRC&apos;),ds_pol_uplst_aply_mdl.getColumn(row,&apos;FIX_CRDT_PRCHS_PRC&apos;),&apos;&apos;,&apos;user25&apos;)" col="7" colid="EXIT_CRDT_PRCHS_PRC" display="number"/>
						<cell align="right" bkcolor="expr:decode(ds_pol_uplst_aply_mdl.getColumn(row,&apos;EXIT_STRD_SALE_PRC&apos;),ds_pol_uplst_aply_mdl.getColumn(row,&apos;FIX_STRD_SALE_PRC&apos;),&apos;&apos;,&apos;user25&apos;)" col="8" colid="EXIT_STRD_SALE_PRC" display="number"/>
						<cell align="right" bkcolor="expr:decode(ds_pol_uplst_aply_mdl.getColumn(row,&apos;EXIT_CASH_PRCHS_PRC&apos;),ds_pol_uplst_aply_mdl.getColumn(row,&apos;FIX_CASH_PRCHS_PRC&apos;),&apos;&apos;,&apos;user25&apos;)" col="9" colid="FIX_CASH_PRCHS_PRC" display="number"/>
						<cell align="right" bkcolor="expr:decode(ds_pol_uplst_aply_mdl.getColumn(row,&apos;EXIT_CRDT_PRCHS_PRC&apos;),ds_pol_uplst_aply_mdl.getColumn(row,&apos;FIX_CRDT_PRCHS_PRC&apos;),&apos;&apos;,&apos;user25&apos;)" col="10" colid="FIX_CRDT_PRCHS_PRC" display="number"/>
						<cell align="right" bkcolor="expr:decode(ds_pol_uplst_aply_mdl.getColumn(row,&apos;EXIT_STRD_SALE_PRC&apos;),ds_pol_uplst_aply_mdl.getColumn(row,&apos;FIX_STRD_SALE_PRC&apos;),&apos;&apos;,&apos;user25&apos;)" col="11" colid="FIX_STRD_SALE_PRC" display="number"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Button Cursor="HAND" Height="21" Id="Button5" ImageID="btn_i_exceldown_w" Left="995" OnClick="btn_export_OnClick" TabOrder="2" Text="Button1" ToolTipText="Excel&#32;Download" Top="88" Width="19"></Button>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="25" Id="btn_delete" ImageID="btn_d_2" Left="953" LeftMargin="5" OnClick="df_delete" Style="sty_btn_d" TabOrder="7" Text="삭제" Top="565" Visible="FALSE" Width="60"></Button>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="25" Id="btn_mod" ImageID="btn_c_4" Left="13" LeftMargin="5" OnClick="btn_mod_OnClick" Style="sty_btn_c" TabOrder="5" Text="정책변경" Top="565" Width="85"></Button>
	</Form>
	<Script><![CDATA[/*******************************************************************************
* 프로그램ID : POLFPO00300
* 업무명      : 정책관리
* 프로그램명  : 운영모델단가표 등록
--------------------------------------------------------------------------------
* 작성자      : 전승호
* 작성일      : 2009.01.14
--------------------------------------------------------------------------------
* 1. 변경이력
수정자    :
수정일    :
수정 내역 :
*******************************************************************************/

/*******************************************************************************
// 1. 전 처리기
*******************************************************************************/
#include "lib::lib_commF.js"
#include "lib::lib_util.js"

/*******************************************************************************
// 2. 폼 변수 정의
*******************************************************************************/
var FV_STR_NAME; // 사용자 이름
var PRE_FIX_STRD_SALE_PRC = 0;
var PRE_APLY_STA_DTM = ""; 
var SAVE_FLAG = "N";

/*******************************************************************************
* 함수명 : POLFPO00100_OnLoadCompleted
* 기능명 : OnLoadCompleted 이벤트
*******************************************************************************/
function POLFPO00300_OnLoadCompleted(obj)
{
	cf_setGrdChecknSortEvent(grd_pol_uplst);	// 그리드 정렬
	
	// 권한 설정
	cf_setAuth(pFrmNum);
	
	ds_condition.SetColumn(0,"RMKS",RMKS);

	if(HST_FLAG == "Y"){  //신규버튼 및 진행중인 운영모델 단가표 리스트  클릭시
		
		grd_pol_uplst.Format = "Default";
		
		div_search.edt_fix_strd_sale_prc.Enable = true;
		div_search.cal_polYm.Enable = false;
		div_search.btn_monthCalendar.Enable = false;
		
		btn_save.Enable = true;
		btn_mod.Enable = true;
		
		if(CRUD_FLAG == "Y"){
			btn_delete.Enable = true;
		}else{
			btn_delete.Enable = false;
		}
		
		if(CRUD_FLAG == "Y" && POP_FLAG == "N"){
			btn_mod.Enable = true;
		}else{
			btn_mod.Enable = false;	
		}
		
		div_search.chk_term.Enable = true;
		div_search.chk_usim.Enable = true;
		div_search.chk_etc.Enable = true;		
				
	}else{
		
		grd_pol_uplst.Format = "HstPolUplst";
		
		uf_ObjComponentEnable(div_search,false);
				
		btn_save.Enable = false;
		btn_mod.Enable = false;
		btn_delete.Enable = false;
		
	}
	
	// 공통 코드를 위한 데이타셋 설정
	cf_setCommonCodeDsEnv();
	
	cf_setCommonCode("grd_pol_uplst", "ZBAS_C_00010", null, 1);
	
	cf_setCommonCode("grd_pol_uplst", "ZBAS_C_00020", null, 4);
	
	cf_setCommonCode("grd_pol_uplst", "ZBAS_C_00030", null, 5);
	
	cf_checkCommonCode();
	
	if(uf_isNull(UPLST_ID) == false){ //상품팝업 변경대상 OR 리스트 에서 올경우
		
		f_set_uplst_id();
		
		df_search();
		
	}else{ //신규 작성시
		
		f_set_init();
		
		f_init_search();
		
		btn_delete.Enable = false;
		
	}
	
	if(uf_isNull(POL_YM) == false){ 
		div_search.cal_polYm.Value = POL_YM;
	}else{
		div_search.cal_polYm.Value = substr(TODAY(),0,6);
	}
	
}

/*******************************************************************************
* 함수명 : df_reSet
* 기능명 : 화면 초기화
*******************************************************************************/
function df_reSet(sArg)
{
	// 권한 설정
	cf_setAuth(pFrmNum);
	
	cf_setArg2Param(sArg);
	
	if(HST_FLAG == "Y"){  //신규버튼 및 진행중인 운영모델 단가표 리스트  클릭시
		
		grd_pol_uplst.Format = "Default";
		
		div_search.edt_fix_strd_sale_prc.Enable = true;
		div_search.cal_polYm.Enable = false;
		div_search.btn_monthCalendar.Enable = false;
		
		btn_save.Enable = true;
		btn_mod.Enable = true;
		
		if(CRUD_FLAG == "Y"){
			btn_delete.Enable = true;
		}else{
			btn_delete.Enable = false;
		}
		
		if(CRUD_FLAG == "Y" && POP_FLAG == "N"){
			btn_mod.Enable = true;
		}else{
			btn_mod.Enable = false;	
		}
		
		div_search.chk_term.Enable = true;
		div_search.chk_usim.Enable = true;
		div_search.chk_etc.Enable = true;
		
	}else{
		
		grd_pol_uplst.Format = "HstPolUplst";
		
		uf_ObjComponentEnable(div_search,false);
				
		btn_save.Enable = false;
		btn_mod.Enable = false;
		btn_delete.Enable = false;
		
	}
	
	// 공통 코드를 위한 데이타셋 설정
	cf_setCommonCodeDsEnv();
	
	cf_setCommonCode("grd_pol_uplst", "ZBAS_C_00010", null, 1);
	
	cf_setCommonCode("grd_pol_uplst", "ZBAS_C_00020", null, 4);
	
	cf_setCommonCode("grd_pol_uplst", "ZBAS_C_00030", null, 5);
	
	cf_checkCommonCode();
	
	if(uf_isNull(UPLST_ID) == false){ //상품팝업 변경대상 OR 리스트 에서 올경우
		
		f_set_uplst_id();
		
		df_search();
		
	}else{ //신규 작성시
		
		f_set_init();
		
		f_init_search();
		
		btn_delete.Enable = false;
		
	}
	
	if(uf_isNull(POL_YM) == false){ 
		div_search.cal_polYm.Value = POL_YM;
	}else{
		div_search.cal_polYm.Value = substr(TODAY(),0,6);
	}
	
}

/*******************************************************************************
* 함수명 : f_callBack 
* 기능명 : 트랜잭션 콜백 
* 파라미터
1. sSvcID  : 서비스 아이디
*******************************************************************************/
function f_callBack(sSvcID)
{
	if(sSvcID == "svcSearchMaxAplyDtmm")
	{
		if(uf_isNull(UPLST_ID) == true){ //신규일경우
			if(ds_aply_dtm.rowcount == 0){
			
				//var yearMm = substr(TODAY(),0,6)+"01";
				//ds_condition.SetColumn(0,"APLY_STA_DTM",yearMm);
				ds_condition.SetColumn(0,"APLY_STA_DTM",POL_YM+"01");
				ds_condition.SetColumn(0,"HOUR","00");
				ds_condition.SetColumn(0,"MIN","00");
				
				
			}//else{
				//cal_aply_sta_dtm.Value =  substr(ds_aply_dtm.GetColumn(0,"APLY_STA_DTM"),0,8);
				//ed_hour.Text =  substr(ds_aply_dtm.GetColumn(0,"APLY_STA_DTM"),8,2);
				//ed_min.Text = substr(ds_aply_dtm.GetColumn(0,"APLY_STA_DTM"),10,2);
			//}
		}
		
	}
	
		
	if(sSvcID == "svcSearch")
	{
		ds_pol_uplst_aply_mdl.AddColumn("CUD_FLAG");
		
		f_add_pol_uplst_aply_mdl();
		
		f_getMaxAplyDtm();
		
		cf_setOrgDs(ds_pol_uplst_aply_mdl); // 창 닫기 이벤트시 변경여부 채크

	}
	
	if(sSvcID == "svcInitSearch")
	{ //신규버튼 클릭시
		ds_pol_uplst_aply_mdl.AddColumn("CUD_FLAG");
		
		for( var idx=0 ; idx<ds_pol_uplst_aply_mdl.rowcount; idx++ ){
			
			ds_pol_uplst_aply_mdl.SetColumn(idx,"CUD_FLAG","I");
			/*
			if(length(ds_pol_uplst_aply_mdl.GetColumn(idx,"EXIT_STRD_SALE_PRC")) == 0){
				ds_pol_uplst_aply_mdl.SetColumn(idx,"EDIT_FLAG","Y");
			}else{
				ds_pol_uplst_aply_mdl.SetColumn(idx,"EDIT_FLAG","N");
			}*/
		}
		
		f_getMaxAplyDtm();

	}	
	
	if(sSvcID == "svcUpdate")
	{
	
		gf_movenCall("100000057","df_search");
		df_close();
		
	}else if(sSvcID == "svcDelete"){
	
		gf_movenCall("100000057","df_search");
		df_close();
		
	}
	
}

/*******************************************************************************
* 함수명 : f_getMaxAplyDtm
* 기능명 : 적용년월의 최대 적용기간 조회
* 파라미터
1. sButtonID  : 버튼 아이디
*******************************************************************************/
function f_getMaxAplyDtm()
{
	var sSvcID = "svcSearchMaxAplyDtmm";
	var sInDs = "nc_input_fieldDs=ds_condition";
	var sOutDs = "ds_aply_dtm=ds_aply_dtm";
	var sArg = "sktst.pol.FPO#getMaxAplyDtmByPolYm";
	
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}

/*******************************************************************************
* 함수명 : df_search
* 기능명 : 공통 조회 버튼 클릭
* 파라미터
1. sButtonID  : 버튼 아이디
*******************************************************************************/
function df_search(sButtonID)
{	
	ds_pol_uplst_aply_mdl.ClearData();
	ds_condition.SetColumn(0,"POL_YM",POL_YM);
	
	var sSvcID = "svcSearch";
	var sInDs = "nc_input_fieldDs=ds_condition";
	var sOutDs = "ds_pol_uplst_aply_mdl=ds_pol_uplst_aply_mdl";
	var sArg = "sktst.pol.FPO#getPolUpLstAplyMdlList";
	
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}

/*******************************************************************************
* 함수명 : f_init_search
* 기능명 : 초기 운영모델 단가표 조회.
* 파라미터
1. sButtonID  : 버튼 아이디
*******************************************************************************/
function f_init_search()
{
	ds_condition.SetColumn(0,"UPLST_ID","");
	
	var sSvcID = "svcInitSearch";
	var sInDs = "nc_input_fieldDs=ds_condition";
	var sOutDs = "ds_pol_uplst_aply_mdl=ds_pol_uplst_aply_mdl";
	var sArg = "sktst.pol.FPO#getPolUpLstAplyMdlList";
	
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
	
}

/*******************************************************************************
* 함수명 : df_insert
* 기능명 : 공통 신규 버튼 클릭
* 파라미터
1. sButtonID  : 버튼 아이디
*******************************************************************************/
function df_insert(sButtonID)
{
	
}

/*******************************************************************************
* 함수명 : df_update
* 기능명 : 공통 수정 버튼 클릭
* 파라미터
1. sButtonID  : 버튼 아이디
*******************************************************************************/
function df_update(sButtonID)
{

}

/*******************************************************************************
* 함수명 : df_close
* 기능명 : 화면 종료
*******************************************************************************/
function df_close(sButtonID)
{
	this.close();
}

/*******************************************************************************
* 함수명 : f_set_uplst_id
* 기능명 : 운영모델단가표 상품관리변경대상에서 온경우 초기값 세팅
*******************************************************************************/
function f_set_uplst_id()
{
		
	ds_cp_prod_mgmt.Copy(gds_temp);

	//상품변경대상 팝업 MOD_RSN 컬럼이 존재, 운영모델단가표 관리 일때 없어서 추가.
	var colIndex = ds_cp_prod_mgmt.GetColIndex("MOD_RSN");
	
	if( colIndex == -1 ){
		ds_cp_prod_mgmt.AddColumn("MOD_RSN");
	}
	
	gds_temp.Clear();
	
	ds_condition.SetColumn(0,"UPLST_ID",UPLST_ID);
	ds_condition.SetColumn(0,"POL_YM",POL_YM+"01");
	ds_condition.SetColumn(0,"POL_TS",POL_TS);
	ds_condition.SetColumn(0,"APLY_STA_DTM",substr(APLY_STA_DTM,0,8));
	ds_condition.SetColumn(0,"HOUR",substr(APLY_STA_DTM,8,2));
	ds_condition.SetColumn(0,"MIN",substr(APLY_STA_DTM,10,2));
	ds_condition.SetColumn(0,"APLY_END_DTM",substr(APLY_END_DTM,0,8));
	ds_condition.SetColumn(0,"END_HOUR",substr(APLY_END_DTM,8,2));
	ds_condition.SetColumn(0,"END_MIN",substr(APLY_END_DTM,10,2));
	
	PRE_APLY_STA_DTM = replace(div_search.cal_aply_sta_dtm.Text,'-','')+div_search.ed_hour.Text+div_search.ed_min.Text;

}

/*******************************************************************************
* 함수명 : f_set_init
* 기능명 : 운영모델단가표 조회에서 신규버튼 클릭시 초기세팅
*******************************************************************************/
function f_set_init()
{
	ds_condition.SetColumn(0,"APLY_STA_DTM",POL_YM+"01");
	ds_condition.SetColumn(0,"HOUR","00");
	ds_condition.SetColumn(0,"MIN","00");
	
	var lastDay = uf_MonthLastDay(POL_YM+"01");
	div_search.cal_aply_end_dtm.Value = substr(div_search.cal_aply_sta_dtm.Value,0,6)+lastDay;
	div_search.ed_end_hour.Text = "23";
	div_search.ed_end_min.Text = "59";
	PRE_APLY_STA_DTM = "";
}

/*******************************************************************************
* 함수명 : f_add_pol_uplst_aply_mdl
* 기능명 : 팝업에서 선택된 단말기 추가 및 중지 일경우 삭제
*******************************************************************************/
function f_add_pol_uplst_aply_mdl()
{

	ds_pol_uplst_aply_mdl.FireEvent = false;
	grd_pol_uplst.Redraw = false;
	
	
	for( var idx=0 ; idx<ds_pol_uplst_aply_mdl.rowcount; idx++ ){
		ds_pol_uplst_aply_mdl.SetColumn(idx,"CUD_FLAG","I");
	}
	
	if(ds_cp_prod_mgmt.rowcount == 0){
		for( var idx=0 ; idx<ds_pol_uplst_aply_mdl.rowcount; idx++ ){
			//ds_pol_uplst_aply_mdl.SetColumn(idx,"CUD_FLAG","I");
			ds_pol_uplst_aply_mdl.SetColumn(idx,"EDIT_FLAG","N");
		}
		
	}else{ 
		ds_cp_prod_mgmt.Filter("MOD_RSN='S'");
		//기등록된 운영모델 단가표에서 사용중지 상품 삭제
		for( var i=0; i<ds_cp_prod_mgmt.rowcount ; i++){ 
			
			for( var j=ds_pol_uplst_aply_mdl.rowcount; j>0; j--){	
	
				if( ds_cp_prod_mgmt.GetColumn(i,"PROD_CD") == ds_pol_uplst_aply_mdl.GetColumn(j-1, "PROD_CD") ){					
					//ds_pol_uplst_aply_mdl.DeleteRow(j-1);
					ds_pol_uplst_aply_mdl.SetColumn(j-1,"CUD_FLAG","D");
				}else{
					//ds_pol_uplst_aply_mdl.SetColumn(j-1,"CUD_FLAG","I");
					if(ds_pol_uplst_aply_mdl.GetColumn(j-1,"EXIT_STRD_SALE_PRC") <= 0){
						ds_pol_uplst_aply_mdl.SetColumn(j-1,"EDIT_FLAG","Y");
					}
				}
			}
		}
		
		ds_cp_prod_mgmt.UnFilter();
		
		ds_cp_prod_mgmt.Filter("MOD_RSN='C'");
		
		//기등록된 운영모델 단가표에서  신규 skt 운영 상품 등록
		for( var idx =0 ; idx < ds_cp_prod_mgmt.RowCount(); idx++ ){
			
			ds_pol_uplst_aply_mdl.InsertRow(ds_pol_uplst_aply_mdl.lastrow + 1);
			
			ds_pol_uplst_aply_mdl.SetColumn(ds_pol_uplst_aply_mdl.lastrow,"CUD_FLAG","I");
			ds_pol_uplst_aply_mdl.SetColumn(ds_pol_uplst_aply_mdl.lastrow,"EDIT_FLAG","Y");
			
			ds_pol_uplst_aply_mdl.SetColumn(ds_pol_uplst_aply_mdl.lastrow,"PROD_CL",
											ds_cp_prod_mgmt.GetColumn(idx,"PROD_CL"));
			ds_pol_uplst_aply_mdl.SetColumn(ds_pol_uplst_aply_mdl.lastrow,"MFACT_ID",
											ds_cp_prod_mgmt.GetColumn(idx,"MFACT_ID"));
			ds_pol_uplst_aply_mdl.SetColumn(ds_pol_uplst_aply_mdl.lastrow,"DEAL_CO_NM",
											ds_cp_prod_mgmt.GetColumn(idx,"DEAL_CO_NM"));											
			ds_pol_uplst_aply_mdl.SetColumn(ds_pol_uplst_aply_mdl.lastrow,"PROD_CD",
											ds_cp_prod_mgmt.GetColumn(idx,"PROD_CD"));
			ds_pol_uplst_aply_mdl.SetColumn(ds_pol_uplst_aply_mdl.lastrow,"PROD_NM",
											ds_cp_prod_mgmt.GetColumn(idx,"PROD_NM"));											
			ds_pol_uplst_aply_mdl.SetColumn(ds_pol_uplst_aply_mdl.lastrow,"PROD_CHRTIC_1",
											ds_cp_prod_mgmt.GetColumn(idx,"PROD_CHRTIC_1"));
			ds_pol_uplst_aply_mdl.SetColumn(ds_pol_uplst_aply_mdl.lastrow,"PROD_CHRTIC_2",
											ds_cp_prod_mgmt.GetColumn(idx,"PROD_CHRTIC_2"));
			ds_pol_uplst_aply_mdl.SetColumn(ds_pol_uplst_aply_mdl.lastrow,"UPLST_ID",UPLST_ID);
			ds_pol_uplst_aply_mdl.SetColumn(ds_pol_uplst_aply_mdl.lastrow,"POL_YM",POL_YM);
			ds_pol_uplst_aply_mdl.SetColumn(ds_pol_uplst_aply_mdl.lastrow,"POL_TS",POL_TS);
	
		}
		
	}
	
	ds_pol_uplst_aply_mdl.Filter("CUD_FLAG!='D'");
	grd_pol_uplst.Redraw = true;
	ds_pol_uplst_aply_mdl.FireEvent = true;
	
	/* 
	ds_pol_uplst_aply_mdl.UpdateControl = false;
	
	for( var nRow=0 ; nRow<ds_pol_uplst_aply_mdl.rowcount; nRow++ ){
		ds_pol_uplst_aply_mdl.SetRowType(nRow,"normal");
	}
	
	ds_pol_uplst_aply_mdl.UpdateControl = true;
	*/
		
}

/*******************************************************************************
* 함수명 : div_search_chk_term_OnClick
* 기능명 : 적용상품 CheckBox Event 발생시 처리
*******************************************************************************/
function div_search_chk_term_OnClick(obj,strValue)
{
	
	PRE_FIX_STRD_SALE_PRC = div_search.edt_fix_strd_sale_prc.Value;
	
	var FIX_STRD_SALE_PRC = 0;
	
	ds_pol_uplst_aply_mdl.FireEvent = false;
	
	for( var idx=0 ; idx<ds_pol_uplst_aply_mdl.rowcount; idx++ ){
		if(obj.id == "chk_term"){
			if(ds_pol_uplst_aply_mdl.getColumn(idx,"PROD_CL") == "1"){
				SAVE_FLAG = "Y";
				if(strValue == 1){
					FIX_STRD_SALE_PRC = toNumber(ds_pol_uplst_aply_mdl.getColumn(idx,"FIX_STRD_SALE_PRC")) + toNumber(div_search.edt_fix_strd_sale_prc.Value);
				}else{
					FIX_STRD_SALE_PRC = toNumber(ds_pol_uplst_aply_mdl.getColumn(idx,"FIX_STRD_SALE_PRC")) - toNumber(div_search.edt_fix_strd_sale_prc.Value);
				}
				
				ds_pol_uplst_aply_mdl.SetColumn(idx,"FIX_STRD_SALE_PRC",FIX_STRD_SALE_PRC);
				
			}	
		}else if(obj.id == "chk_usim"){
			if(ds_pol_uplst_aply_mdl.getColumn(idx,"PROD_CL") == "2"){
				SAVE_FLAG = "Y";
				if(strValue == 1){
					FIX_STRD_SALE_PRC = toNumber(ds_pol_uplst_aply_mdl.getColumn(idx,"FIX_STRD_SALE_PRC")) + toNumber(div_search.edt_fix_strd_sale_prc.Value);
				}else{
					FIX_STRD_SALE_PRC = toNumber(ds_pol_uplst_aply_mdl.getColumn(idx,"FIX_STRD_SALE_PRC")) - toNumber(div_search.edt_fix_strd_sale_prc.Value);
				}
				
				ds_pol_uplst_aply_mdl.SetColumn(idx,"FIX_STRD_SALE_PRC",FIX_STRD_SALE_PRC);
									
			}	
		}else if(obj.id == "chk_etc"){
			if(ds_pol_uplst_aply_mdl.getColumn(idx,"PROD_CL") == "9"){
				SAVE_FLAG = "Y";
				if(strValue == 1){
					FIX_STRD_SALE_PRC = toNumber(ds_pol_uplst_aply_mdl.getColumn(idx,"FIX_STRD_SALE_PRC")) + toNumber(div_search.edt_fix_strd_sale_prc.Value);
				}else{
					FIX_STRD_SALE_PRC = toNumber(ds_pol_uplst_aply_mdl.getColumn(idx,"FIX_STRD_SALE_PRC")) - toNumber(div_search.edt_fix_strd_sale_prc.Value);
				}
				
				ds_pol_uplst_aply_mdl.SetColumn(idx,"FIX_STRD_SALE_PRC",FIX_STRD_SALE_PRC);
									
			}	
		}
		
		if(ds_pol_uplst_aply_mdl.GetColumn(idx,"CUD_FLAG") == "I" && ds_pol_uplst_aply_mdl.GetColumn(idx,"EDIT_FLAG") == "Y"){				
			ds_pol_uplst_aply_mdl.SetColumn(idx,"EXIT_STRD_SALE_PRC",
									        ds_pol_uplst_aply_mdl.GetColumn(idx,"FIX_STRD_SALE_PRC"));
		}
	}
	
	ds_pol_uplst_aply_mdl.FireEvent = true;
	
}

/*******************************************************************************
* 함수명 : div_search_edt_fix_strd_sale_prc_OnFocus
* 기능명 : 판매가 추가 OnFocus Event 발생시 처리
*******************************************************************************/
function div_search_edt_fix_strd_sale_prc_OnFocus(obj,strText)
{
	PRE_FIX_STRD_SALE_PRC = div_search.edt_fix_strd_sale_prc.Value;
	
	var FIX_STRD_SALE_PRC = 0;
	
	div_search.edt_fix_strd_sale_prc.Value = "";
	
	ds_pol_uplst_aply_mdl.FireEvent = false;
	
	for( var idx=0 ; idx<ds_pol_uplst_aply_mdl.rowcount; idx++ ){
		
		if(div_search.chk_term.Value == 1){
			SAVE_FLAG = "Y";
			if(ds_pol_uplst_aply_mdl.getColumn(idx,"PROD_CL") == "1"){
				FIX_STRD_SALE_PRC = toNumber(ds_pol_uplst_aply_mdl.getColumn(idx,"FIX_STRD_SALE_PRC")) - toNumber(PRE_FIX_STRD_SALE_PRC);
				ds_pol_uplst_aply_mdl.SetColumn(idx,"FIX_STRD_SALE_PRC",FIX_STRD_SALE_PRC);
			}
		}
		if(div_search.chk_usim.Value == 1){
			SAVE_FLAG = "Y";
			if(ds_pol_uplst_aply_mdl.getColumn(idx,"PROD_CL") == "2"){
				FIX_STRD_SALE_PRC = toNumber(ds_pol_uplst_aply_mdl.getColumn(idx,"FIX_STRD_SALE_PRC")) - toNumber(PRE_FIX_STRD_SALE_PRC);
				ds_pol_uplst_aply_mdl.SetColumn(idx,"FIX_STRD_SALE_PRC",FIX_STRD_SALE_PRC);
			}
		}
		if(div_search.chk_etc.Value == 1){
			SAVE_FLAG = "Y";
			if(ds_pol_uplst_aply_mdl.getColumn(idx,"PROD_CL") == "9"){
				FIX_STRD_SALE_PRC = toNumber(ds_pol_uplst_aply_mdl.getColumn(idx,"FIX_STRD_SALE_PRC")) - toNumber(PRE_FIX_STRD_SALE_PRC);
				ds_pol_uplst_aply_mdl.SetColumn(idx,"FIX_STRD_SALE_PRC",FIX_STRD_SALE_PRC);
			}
		}
			
		if(ds_pol_uplst_aply_mdl.GetColumn(idx,"CUD_FLAG") == "I" && ds_pol_uplst_aply_mdl.GetColumn(idx,"EDIT_FLAG") == "Y"){				
			ds_pol_uplst_aply_mdl.SetColumn(idx,"EXIT_STRD_SALE_PRC",
									        ds_pol_uplst_aply_mdl.GetColumn(idx,"FIX_STRD_SALE_PRC"));
		}
			
	}
	
	ds_pol_uplst_aply_mdl.FireEvent = true;
}

/*******************************************************************************
* 함수명 : div_search_edt_fix_strd_sale_prc_OnKillFocus
* 기능명 : 판매가 추가 OnKillFocus Event 발생시 처리
*******************************************************************************/
function div_search_edt_fix_strd_sale_prc_OnKillFocus(obj)
{
	ds_pol_uplst_aply_mdl.FireEvent = false;
	
	for( var idx=0 ; idx<ds_pol_uplst_aply_mdl.rowcount; idx++ ){
		
		if(div_search.chk_term.Value == 1){
			SAVE_FLAG = "Y";
			if(ds_pol_uplst_aply_mdl.getColumn(idx,"PROD_CL") == "1"){
				FIX_STRD_SALE_PRC = toNumber(ds_pol_uplst_aply_mdl.getColumn(idx,"FIX_CRDT_PRCHS_PRC")) + toNumber(div_search.edt_fix_strd_sale_prc.Value);
				ds_pol_uplst_aply_mdl.SetColumn(idx,"FIX_STRD_SALE_PRC",FIX_STRD_SALE_PRC);
			}
		}
		if(div_search.chk_usim.Value == 1){
			SAVE_FLAG = "Y";
			if(ds_pol_uplst_aply_mdl.getColumn(idx,"PROD_CL") == "2"){
				FIX_STRD_SALE_PRC = toNumber(ds_pol_uplst_aply_mdl.getColumn(idx,"FIX_CRDT_PRCHS_PRC")) + toNumber(div_search.edt_fix_strd_sale_prc.Value);
				ds_pol_uplst_aply_mdl.SetColumn(idx,"FIX_STRD_SALE_PRC",FIX_STRD_SALE_PRC);
			}
		}
		if(div_search.chk_etc.Value == 1){
			SAVE_FLAG = "Y";
			if(ds_pol_uplst_aply_mdl.getColumn(idx,"PROD_CL") == "9"){
				FIX_STRD_SALE_PRC = toNumber(ds_pol_uplst_aply_mdl.getColumn(idx,"FIX_CRDT_PRCHS_PRC")) + toNumber(div_search.edt_fix_strd_sale_prc.Value);
				ds_pol_uplst_aply_mdl.SetColumn(idx,"FIX_STRD_SALE_PRC",FIX_STRD_SALE_PRC);
			}
		}
		
		if(ds_pol_uplst_aply_mdl.GetColumn(idx,"CUD_FLAG") == "I" && ds_pol_uplst_aply_mdl.GetColumn(idx,"EDIT_FLAG") == "Y"){				
			ds_pol_uplst_aply_mdl.SetColumn(idx,"EXIT_STRD_SALE_PRC",
									        ds_pol_uplst_aply_mdl.GetColumn(idx,"FIX_STRD_SALE_PRC"));
		}		
				
	}
	
	ds_pol_uplst_aply_mdl.FireEvent = true;
}

/*******************************************************************************
* 함수명 : ds_pol_uplst_aply_mdl_OnColumnChanged
* 기능명 : 운영모델단가표 DataSet OnColumnChanged Event 발생시
*******************************************************************************/
function ds_pol_uplst_aply_mdl_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
	if(strColumnID == "EXIT_CASH_PRCHS_PRC"){
		SAVE_FLAG = "Y";
		if(varNewValue < 0){
			ds_pol_uplst_aply_mdl.SetColumn(nRow,"EXIT_CASH_PRCHS_PRC",varOldValue);
			alert(cf_getMessage(MSG_00132, "현금매입가;0"));
			f_set_gridFocus(grd_pol_uplst, nRow, 6);
			return false;
		}
		if(ds_pol_uplst_aply_mdl.GetColumn(nRow,"CUD_FLAG") == "I" && ds_pol_uplst_aply_mdl.GetColumn(nRow,"EDIT_FLAG") == "Y"){
			ds_pol_uplst_aply_mdl.SetColumn(nRow,"FIX_CASH_PRCHS_PRC",
											ds_pol_uplst_aply_mdl.GetColumn(nRow,"EXIT_CASH_PRCHS_PRC"));
		}                      
	}else if(strColumnID == "EXIT_CRDT_PRCHS_PRC"){
		SAVE_FLAG = "Y";
		if(varNewValue < 0){
			ds_pol_uplst_aply_mdl.SetColumn(nRow,"EXIT_CRDT_PRCHS_PRC",varOldValue);
			alert(cf_getMessage(MSG_00132, "여신매입가;0"));
			f_set_gridFocus(grd_pol_uplst, nRow, 7);
			return false;
		}
		if(ds_pol_uplst_aply_mdl.GetColumn(nRow,"CUD_FLAG") == "I" && ds_pol_uplst_aply_mdl.GetColumn(nRow,"EDIT_FLAG") == "Y"){			
			ds_pol_uplst_aply_mdl.SetColumn(nRow,"FIX_CRDT_PRCHS_PRC",
											ds_pol_uplst_aply_mdl.GetColumn(nRow,"EXIT_CRDT_PRCHS_PRC"));
		}								
	}else if(strColumnID == "EXIT_STRD_SALE_PRC"){
		SAVE_FLAG = "Y";
		if(varNewValue < 0){
			ds_pol_uplst_aply_mdl.SetColumn(nRow,"EXIT_STRD_SALE_PRC",varOldValue);
			alert(cf_getMessage(MSG_00132, "기존매입가;0"));
			f_set_gridFocus(grd_pol_uplst, nRow, 8);
			return false;
		}
		if(ds_pol_uplst_aply_mdl.GetColumn(nRow,"CUD_FLAG") == "I" && ds_pol_uplst_aply_mdl.GetColumn(nRow,"EDIT_FLAG") == "Y"){
			ds_pol_uplst_aply_mdl.SetColumn(nRow,"FIX_STRD_SALE_PRC",
											ds_pol_uplst_aply_mdl.GetColumn(nRow,"EXIT_STRD_SALE_PRC"));
		}							
	}else if(strColumnID == "FIX_CASH_PRCHS_PRC"){
		SAVE_FLAG = "Y";
		if(varNewValue < 0){
			ds_pol_uplst_aply_mdl.SetColumn(nRow,"FIX_CASH_PRCHS_PRC",varOldValue);
			alert(cf_getMessage(MSG_00132, "현금매입가;0"));
			f_set_gridFocus(grd_pol_uplst, nRow, 9);
			return false;
		}
		if(ds_pol_uplst_aply_mdl.GetColumn(nRow,"CUD_FLAG") == "I" && ds_pol_uplst_aply_mdl.GetColumn(nRow,"EDIT_FLAG") == "Y"){
			ds_pol_uplst_aply_mdl.SetColumn(nRow,"EXIT_CASH_PRCHS_PRC",
											ds_pol_uplst_aply_mdl.GetColumn(nRow,"FIX_CASH_PRCHS_PRC"));
		}									
	}else if(strColumnID == "FIX_CRDT_PRCHS_PRC"){
		SAVE_FLAG = "Y";
		if(varNewValue < 0){
			ds_pol_uplst_aply_mdl.SetColumn(nRow,"FIX_CRDT_PRCHS_PRC",varOldValue);
			alert(cf_getMessage(MSG_00132, "여신매입가;0"));
			f_set_gridFocus(grd_pol_uplst, nRow, 10);
			return false;
		}
		if(ds_pol_uplst_aply_mdl.GetColumn(nRow,"CUD_FLAG") == "I" && ds_pol_uplst_aply_mdl.GetColumn(nRow,"EDIT_FLAG") == "Y"){
			ds_pol_uplst_aply_mdl.SetColumn(nRow,"EXIT_CRDT_PRCHS_PRC",
											ds_pol_uplst_aply_mdl.GetColumn(nRow,"FIX_CRDT_PRCHS_PRC"));
		}									
	}else if(strColumnID == "FIX_STRD_SALE_PRC"){
		SAVE_FLAG = "Y";
		if(varNewValue < 0){
			ds_pol_uplst_aply_mdl.SetColumn(nRow,"FIX_STRD_SALE_PRC",varOldValue);
			alert(cf_getMessage(MSG_00132, "기존매입가;0"));
			f_set_gridFocus(grd_pol_uplst, nRow, 11);
			return false;
		}
		if(ds_pol_uplst_aply_mdl.GetColumn(nRow,"CUD_FLAG") == "I" && ds_pol_uplst_aply_mdl.GetColumn(nRow,"EDIT_FLAG") == "Y"){				
			ds_pol_uplst_aply_mdl.SetColumn(nRow,"EXIT_STRD_SALE_PRC",
											ds_pol_uplst_aply_mdl.GetColumn(nRow,"FIX_STRD_SALE_PRC"));
		}									
	}
}

/*******************************************************************************
* 함수명 : f_pre_save
* 기능명 : 저장버튼 전 체크함수 
*******************************************************************************/
function f_pre_save()
{
	if(DIS_CMP_FNSH_YN == "Y"){
		alert(cf_getMessage(MSG_00010, "재고보상 완료된 운영모델 단가표는 저장"));
		return;
	}
	
	if(HST_FLAG != "Y"){ //신규시 변경사항 없어도 저장가능
		if(SAVE_FLAG == "N"){
			alert(MSG_00133); //변경사항이 없습니다.
			return;
		}
	}
	
	if(ds_pol_uplst_aply_mdl.rowcount < 1){
		alert(cf_getMessage(MSG_00134, "단말기")); //선택된 단말기가 없습니다.
		return;
	}
	
	if(length(div_search.ed_hour.Text) !=2 || div_search.ed_hour.Text > 24){
		alert(cf_getMessage(MSG_00135, "적용기간 시작시간")); //적용기간 시작시간 은(는) 필수 입력 항목입니다.
		div_search.ed_hour.SetFocus();
		return;
	}
	
	if(length(div_search.ed_min.Text) !=2 || div_search.ed_min.Text > 59){
		alert(cf_getMessage(MSG_00135, "적용기간 시작분")); //적용기간 시작분 은(는) 필수 입력 항목입니다.
		div_search.ed_min.SetFocus();
		return;
	}
	
	for( var nRow=0; nRow<ds_pol_uplst_aply_mdl.rowcount; nRow++ ){

		if(uf_isNull(ds_pol_uplst_aply_mdl.GetColumn(nRow,"FIX_CASH_PRCHS_PRC")) == true
						|| ds_pol_uplst_aply_mdl.GetColumn(nRow,"FIX_CASH_PRCHS_PRC") == 0){
			alert(cf_getMessage(MSG_00132, "현금매입가;0"));
			f_set_gridFocus(grd_pol_uplst, nRow, 9);
			return false;
		}else if(uf_isNull(ds_pol_uplst_aply_mdl.GetColumn(nRow,"FIX_CRDT_PRCHS_PRC")) == true
						|| ds_pol_uplst_aply_mdl.GetColumn(nRow,"FIX_CRDT_PRCHS_PRC") == 0){
			alert(cf_getMessage(MSG_00132, "여신매입가;0"));
			f_set_gridFocus(grd_pol_uplst, nRow, 10);
			return false;
		}else if(uf_isNull(ds_pol_uplst_aply_mdl.GetColumn(nRow,"FIX_STRD_SALE_PRC")) == true
						|| ds_pol_uplst_aply_mdl.GetColumn(nRow,"FIX_STRD_SALE_PRC") == 0){
			alert(cf_getMessage(MSG_00132, "기준판매가;0"));
			f_set_gridFocus(grd_pol_uplst, nRow, 11);
			return false;
		}
	}
	
    return true;
}

/*******************************************************************************
 * @description    : 공통 저장 함수
*******************************************************************************/
function df_save()
{

	cf_CheckCloseMnth('04',ds_condition.getColumn(0,"APLY_STA_DTM"),'적용기간');
	if(FV_BOOLEAN_CLOSE) return;
	
	if (!(f_pre_save())) return;
	
	if(f_disCmpObjYn()){
		ds_condition.SetColumn(0,"DIS_CMP_OBJ_YN","Y");
	}else{
		ds_condition.SetColumn(0,"DIS_CMP_OBJ_YN","N");
	}

	var sSvcID = "";
	var sInDs = "";
	var sOutDs = "";
	var sArg = "";
	
	//날짜 변경이 없고 && 상품변경발생 팝업에서 온경우가 아닌경우
	if(POP_FLAG == "N"  && PRE_APLY_STA_DTM == replace(div_search.cal_aply_sta_dtm.Text,'-','')+div_search.ed_hour.Text+div_search.ed_min.Text)
	//if(PRE_APLY_STA_DTM == replace(div_search.cal_aply_sta_dtm.Text,'-','')+div_search.ed_hour.Text+div_search.ed_min.Text)
	{
		if(confirm(cf_getMessage(MSG_00136, "소급변경")) == 1){ //소급변경하시겠습니까?
			 sSvcID = "svcUpdate";
			 sInDs = "ds_condition=ds_condition ds_pol_uplst_aply_mdl=ds_pol_uplst_aply_mdl";
			 sOutDs = "";
			 sArg = "sktst.pol.FPO#savePolUpLstAplyMdl";
			 cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
		}
		
	}else{

		if(confirm(cf_getMessage(MSG_00136, "새로운 적용년월에 운영모델 단가표가 변경")) == 1){ //새로운 적용년월에 운영모델 단가표가 변경하시겠습니까?
			
			 sSvcID = "svcUpdate";
			 sInDs = "ds_condition=ds_condition ds_pol_uplst_aply_mdl=ds_pol_uplst_aply_mdl";
			 sOutDs = "";
			 sArg = "sktst.pol.FPO#addPolUpLst";
			 cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
		}
	}

	
	
}


/*******************************************************************************
* 함수명 : f_pre_delete
* 기능명 : 삭제버튼 전 체크함수 
*******************************************************************************/
function f_pre_delete()
{	
	if(DIS_CMP_FNSH_YN == "Y"){
		alert(cf_getMessage(MSG_00010, "재고보상 완료된 운영모델 단가표는 삭제"));
		return;
	}
	
    return true;
}

/*******************************************************************************
* 함수명 : df_delete
* 기능명 : 공통 삭제 버튼 클릭
* 파라미터
1. sButtonID  : 버튼 아이디
*******************************************************************************/
function df_delete(sButtonID)
{

	cf_CheckCloseMnth('04',ds_condition.getColumn(0,"APLY_STA_DTM"),'적용기간');
	if(FV_BOOLEAN_CLOSE) return;
	
	if (!(f_pre_delete())) return;
	
	var sSvcID = "";
	var sInDs = "";
	var sOutDs = "";
	var sArg = "";
	
	if(confirm(cf_getMessage(MSG_00136, "운영모델 단가표를 삭제")) == 1){ //운영모델 단가표를 삭제 하시겠습니까?
	 
		sSvcID = "svcDelete";
		sInDs = "nc_input_fieldDs=ds_condition";
		sOutDs = "";
		sArg = "sktst.pol.FPO#deletePolUpLst";
		cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
	}
	
}

/*******************************************************************************
* 함수명 : f_set_gridFocus
* 기능명 : 그리드 포커스 이동
*******************************************************************************/
function f_set_gridFocus(gridObj, nRow, nCellIdx) 
{	
	var dataSetObj = object(gridObj.bindDataset);
	dataSetObj.row = nRow;
	gridObj.SetCellPos(nCellIdx);
	gridObj.SetFocus();
}

/*******************************************************************************
* 함수명 : div_search_cal_aply_sta_dtm_OnChanged
* 기능명 :  적용기간 시작일 OnChanged 발생시
*******************************************************************************/
function div_search_cal_aply_sta_dtm_OnChanged(obj,strOldText,strNewText)
{
	if(uf_isNull(strOldText) == false){ 

		var MOD_YMD = strNewText+div_search.ed_hour.Text+div_search.ed_min.Text;

		if(MOD_YMD <= APLY_STA_DTM || MOD_YMD >= APLY_END_DTM){
			ds_condition.SetColumn(0,"APLY_STA_DTM",strOldText);
			div_search.cal_aply_sta_dtm.SetFocus();
			alert(cf_getMessage(MSG_00131, "적용기간;적용시작일자;적용종료일자"));
			return false;
			
		}
	}
	
}

/*******************************************************************************
* 함수명 : div_search_ed_hour_OnChanged
* 기능명 :  적용기간 시간 변경시 
*******************************************************************************/
function div_search_ed_hour_OnChanged(obj,strText)
{
	if(uf_isNull(strText) == false){
		
		if(length(strText) !=2) {
			
			strText = Lpad(strText,"0",2);
			ds_condition.SetColumn(0,"HOUR",strText);
		}
		
		if(strText > 23){
			ds_condition.SetColumn(0,"HOUR","00");
			div_search.ed_hour.SetFocus();
			alert(cf_getMessage(MSG_00034, "23시"));
			return false;
		}
		
		var MOD_YMD = div_search.cal_aply_sta_dtm.Value+strText+div_search.ed_min.Text;
	
		if(MOD_YMD <= APLY_STA_DTM || MOD_YMD >= APLY_END_DTM){
			ds_condition.SetColumn(0,"HOUR","00");
			div_search.ed_hour.SetFocus();
			alert(cf_getMessage(MSG_00131, "적용기간;적용시작일자;적용종료일자"));
			return false;
			
		}
	}

}

/*******************************************************************************
* 함수명 : div_search_ed_min_OnChanged
* 기능명 :  적용기간 분 변경시 
*******************************************************************************/
function div_search_ed_min_OnChanged(obj,strText)
{
	if(uf_isNull(strText) == false){
	
		if(length(strText) !=2) {
			
			strText = Lpad(strText,"0",2);
			ds_condition.SetColumn(0,"MIN",strText);
		}
		
		if(strText > 59){
			ds_condition.SetColumn(0,"MIN","00");
			div_search.ed_min.SetFocus();
			alert(cf_getMessage(MSG_00034, "59분"));
			return false;
		}
		
		var MOD_YMD = div_search.cal_aply_sta_dtm.Value+div_search.ed_hour.Text+strText;
	
		if(MOD_YMD <= APLY_STA_DTM || MOD_YMD >= APLY_END_DTM){
			ds_condition.SetColumn(0,"MIN","00");
			div_search.ed_min.SetFocus();
			alert(cf_getMessage(MSG_00131, "적용기간;적용시작일자;적용종료일자"));
			return false;
			
		}
	}

}

/*******************************************************************************
* 함수명 : btn_import_OnClick
* 기능명 :  엑셀 export
*******************************************************************************/
function btn_export_OnClick(obj)
{
	cf_exportExcel(grd_pol_uplst);
}

/*******************************************************************************
* 함수명 : f_disCmpObjYn
* 기능명 :  운영모델 단가표의 기존여신매입가/확정여신매입가 금액 비교
*******************************************************************************/
function f_disCmpObjYn()
{
	var compMoney = false;
	
	for( var idx=0 ; idx<ds_pol_uplst_aply_mdl.rowcount; idx++ ){
		
		var exitCrdtPrchsPrc = ds_pol_uplst_aply_mdl.GetColumn(idx,"EXIT_CRDT_PRCHS_PRC");
		var fixCrdtPrchsPrc = ds_pol_uplst_aply_mdl.GetColumn(idx,"FIX_CRDT_PRCHS_PRC");
		
		if(toNumber(exitCrdtPrchsPrc)-toNumber(fixCrdtPrchsPrc) != 0){
			compMoney = true;
			break;
		}
	}
	
	return compMoney;
			
}

/*******************************************************************************
* 함수명 : btn_mod_OnClick
* 기능명 : 정책변경 버튼 
*******************************************************************************/
function btn_mod_OnClick(obj)
{	
	var sArg = " APLY_STA_DTM=" + quote(substr(PRE_APLY_STA_DTM,0,8));
		sArg += " HOUR=" + quote(substr(PRE_APLY_STA_DTM,8,2));
		sArg += " MIN=" + quote(substr(PRE_APLY_STA_DTM,10,2));
		sArg += " APLY_END_DTM=" + quote(ds_condition.getColumn(0,"APLY_END_DTM"));
		sArg += " END_HOUR=" + quote(ds_condition.getColumn(0,"END_HOUR"));
		sArg += " END_MIN=" + quote(ds_condition.getColumn(0,"END_MIN"));
		sArg += " MOD_FLAG=" + quote('N');
		
	
	var rtn = dialog("POL::POLRSP00800.xml", sArg, 336, 128);
	
	if(rtn == 0){
		
		cf_setParam(ds_condition,"APLY_STA_DTM"  ,substr(PRE_APLY_STA_DTM,0,8));
		cf_setParam(ds_condition,"HOUR"          ,substr(PRE_APLY_STA_DTM,8,2));
		cf_setParam(ds_condition,"MIN"         	 ,substr(PRE_APLY_STA_DTM,10,2));
	
	}else{
	
		btn_save.Enable = true;
		
	}
	
}

/*******************************************************************************
 * @description    :  월달력 사용 - 이벤트
*******************************************************************************/
function btn_monthCalendar_OnClick(obj)
{
	cf_callMonthCalendar(div_search.cal_polYm);
}
]]></Script>
</Window>