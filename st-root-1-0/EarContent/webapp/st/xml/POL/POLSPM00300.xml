<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="600" Id="POLSPM00300" Left="8" OnLoadCompleted="POLSPM00300_OnLoadCompleted" PidAttrib="7" Title="판매가격표(고정가)&#32;등록" Top="8" Ver="1.0" Width="1024" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_condition">
				<Contents>
					<colinfo id="APLY_YM" size="256" summ="default" type="STRING"/>
					<colinfo id="ORG_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="HIST_YN" size="256" summ="default" type="STRING"/>
					<colinfo id="SALE_TYP_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="APLY_STA_DTM" size="256" summ="default" type="STRING"/>
					<colinfo id="APLY_END_DTM" size="256" summ="default" type="STRING"/>
					<colinfo id="HOUR" size="256" summ="default" type="STRING"/>
					<colinfo id="MIN" size="256" summ="default" type="STRING"/>
					<colinfo id="END_HOUR" size="256" summ="default" type="STRING"/>
					<colinfo id="END_MIN" size="256" summ="default" type="STRING"/>
					<colinfo id="SPLST_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="DEAL_CO_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="UKEY_AGENCY_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DEL_RSN" size="256" summ="default" type="STRING"/>
					<colinfo id="APRV_ST" size="256" summ="default" type="STRING"/>
					<colinfo id="TPLST_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="APLY_DT" size="256" summ="default" type="STRING"/>
					<record>
						<APLY_DT></APLY_DT>
						<APLY_END_DTM></APLY_END_DTM>
						<APLY_STA_DTM></APLY_STA_DTM>
						<APLY_YM></APLY_YM>
						<APRV_ST></APRV_ST>
						<DEAL_CO_NM></DEAL_CO_NM>
						<DEL_RSN></DEL_RSN>
						<END_HOUR></END_HOUR>
						<END_MIN></END_MIN>
						<HIST_YN></HIST_YN>
						<HOUR></HOUR>
						<MIN></MIN>
						<ORG_ID></ORG_ID>
						<SALE_TYP_CD></SALE_TYP_CD>
						<SPLST_ID></SPLST_ID>
						<TPLST_ID></TPLST_ID>
						<UKEY_AGENCY_CD></UKEY_AGENCY_CD>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_saleTypCd">
				<Contents>
					<colinfo id="COMM_CD_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="COMM_CD_VAL" size="256" summ="default" type="STRING"/>
					<colinfo id="COMM_CD_VAL_NM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_preferGrdCl">
				<Contents>
					<colinfo id="COMM_CD_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="COMM_CD_VAL" size="256" summ="default" type="STRING"/>
					<colinfo id="COMM_CD_VAL_NM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_orgLst">
				<Contents>
					<colinfo id="chk" size="256" summ="default" type="STRING"/>
					<colinfo id="org_id" size="256" summ="default" type="STRING"/>
					<colinfo id="org_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="sale_typ_cd" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_preferLst">
				<Contents>
					<colinfo id="column0" size="256" summ="default" type="STRING"/>
					<colinfo id="column1" size="256" summ="default" type="STRING"/>
					<colinfo id="column2" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_splst">
				<Contents>
					<colinfo id="splst_id" size="256" summ="default" type="STRING"/>
					<colinfo id="aply_ym" size="256" summ="default" type="STRING"/>
					<colinfo id="org_id" size="256" summ="default" type="STRING"/>
					<colinfo id="sale_typ_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="aply_sta_dtm" size="256" summ="default" type="STRING"/>
					<colinfo id="aply_end_dtm" size="256" summ="default" type="STRING"/>
					<colinfo id="rmks" size="256" summ="default" type="STRING"/>
					<colinfo id="del_yn" size="256" summ="default" type="STRING"/>
					<colinfo id="upd_cnt" size="256" summ="default" type="STRING"/>
					<colinfo id="ins_dtm" size="256" summ="default" type="STRING"/>
					<colinfo id="ins_user_id" size="256" summ="default" type="STRING"/>
					<colinfo id="mod_dtm" size="256" summ="default" type="STRING"/>
					<colinfo id="mod_user_id" size="256" summ="default" type="STRING"/>
					<colinfo id="pol_cl" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_splstMdl">
				<Contents>
					<colinfo id="chk" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="splst_id" size="256" summ="default" type="STRING"/>
					<colinfo id="aply_ym" size="256" summ="default" type="STRING"/>
					<colinfo id="org_id" size="256" summ="default" type="STRING"/>
					<colinfo id="sale_typ_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="sale_prc" size="256" summ="default" type="STRING"/>
					<colinfo id="sale_cmms" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_cl" size="256" summ="default" type="STRING"/>
					<colinfo id="mfact_id" size="256" summ="default" type="STRING"/>
					<colinfo id="mfact_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_chrtic_1" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_amtGrdCl">
				<Contents>
					<colinfo id="seq" size="256" summ="default" type="STRING"/>
					<colinfo id="amt_from" size="256" summ="default" type="STRING"/>
					<colinfo id="amt_to" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_marCl">
				<Contents>
					<colinfo id="COMM_CD_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="COMM_CD_VAL" size="256" summ="default" type="STRING"/>
					<colinfo id="COMM_CD_VAL_NM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_prodChrtic">
				<Contents>
					<colinfo id="COMM_CD_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="COMM_CD_VAL" size="256" summ="default" type="STRING"/>
					<colinfo id="COMM_CD_VAL_NM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_splstMdlCopy" UpdateControl="False">
				<Contents>
					<colinfo id="chk" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="splst_id" size="256" summ="default" type="STRING"/>
					<colinfo id="aply_ym" size="256" summ="default" type="STRING"/>
					<colinfo id="org_id" size="256" summ="default" type="STRING"/>
					<colinfo id="sale_typ_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="sale_prc" size="256" summ="default" type="STRING"/>
					<colinfo id="sale_cmms" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_cl" size="256" summ="default" type="STRING"/>
					<colinfo id="mfact_id" size="256" summ="default" type="STRING"/>
					<colinfo id="mfact_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_chrtic_1" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_conditionObj">
				<Contents>
					<colinfo id="APLY_YM" size="256" summ="default" type="STRING"/>
					<colinfo id="ORG_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="HIST_YN" size="256" summ="default" type="STRING"/>
					<colinfo id="SALE_TYP_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="APLY_STA_DTM" size="256" summ="default" type="STRING"/>
					<colinfo id="APLY_END_DTM" size="256" summ="default" type="STRING"/>
					<colinfo id="HOUR" size="256" summ="default" type="STRING"/>
					<colinfo id="MIN" size="256" summ="default" type="STRING"/>
					<colinfo id="END_HOUR" size="256" summ="default" type="STRING"/>
					<colinfo id="END_MIN" size="256" summ="default" type="STRING"/>
					<colinfo id="SPLST_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="DEAL_CO_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="UKEY_AGENCY_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DEL_RSN" size="256" summ="default" type="STRING"/>
					<colinfo id="APRV_ST" size="256" summ="default" type="STRING"/>
					<colinfo id="TPLST_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="APLY_DT" size="256" summ="default" type="STRING"/>
					<record>
						<APLY_DT></APLY_DT>
						<APLY_END_DTM></APLY_END_DTM>
						<APLY_STA_DTM></APLY_STA_DTM>
						<APLY_YM></APLY_YM>
						<APRV_ST></APRV_ST>
						<DEAL_CO_NM></DEAL_CO_NM>
						<DEL_RSN></DEL_RSN>
						<END_HOUR></END_HOUR>
						<END_MIN></END_MIN>
						<HIST_YN></HIST_YN>
						<HOUR></HOUR>
						<MIN></MIN>
						<ORG_ID></ORG_ID>
						<SALE_TYP_CD></SALE_TYP_CD>
						<SPLST_ID></SPLST_ID>
						<TPLST_ID></TPLST_ID>
						<UKEY_AGENCY_CD></UKEY_AGENCY_CD>
					</record>
				</Contents>
			</Dataset>
		</Datasets>
		<Div Border="Raised" Height="40" Id="div_search" Left="10" Style="sty_div_input" TabOrder="1" Text="질의내용" Top="12" Width="1004">
			<Contents>
				<Static Align="Right" Height="20" Id="Static3" Left="300" Style="sty_lb_Basic" TabOrder="2" Text="적용기간" Top="7" VAlign="Middle" Width="70"></Static>
				<Calendar BindDataset="ds_condition" Border="Flat" ButtonImageID="btn_i_calendar" Column="APLY_STA_DTM" DayFont="Default,-1" Enable="FALSE" HeaderBorder="NONE" HeaderFont="Default,-1" HeadStyle="sty_calendar_head" Height="20" Id="cal_aplyStaDtm" Left="372" LeftMargin="2" MonthPopupBorder="RAISED" NullValue="&#32;" OnChanged="div_search_cal_aplyStaDtm_OnChanged" RightMargin="2" SaturdayTextColor="user28" Style="sty_calendar" SundayTextColor="user27" TabOrder="2" TodayColor="user26" Top="7" WeeksFont="Default,-1" WeekStyle="sty_calendar_week" Width="90"></Calendar>
				<Static Align="Center" Height="20" Id="Static4" Left="511" TabOrder="3" Text="~" Top="7" VAlign="Middle" Width="20"></Static>
				<Calendar BindDataset="ds_condition" Border="Flat" ButtonImageID="btn_i_calendar" Column="APLY_END_DTM" DayFont="Default,-1" Enable="FALSE" HeaderBorder="NONE" HeaderFont="Default,-1" HeadStyle="sty_calendar_head" Height="20" Id="cal_aplyEndDtm" Left="532" LeftMargin="2" MonthPopupBorder="RAISED" NullValue="&#32;" RightMargin="2" SaturdayTextColor="user28" Style="sty_calendar" SundayTextColor="user27" TabOrder="2" TodayColor="user26" Top="7" WeeksFont="Default,-1" WeekStyle="sty_calendar_week" Width="90"></Calendar>
				<Static Align="Right" Height="20" Id="Static5" Left="10" Style="sty_lb_Basic" TabOrder="1" Text="적용년월" Top="7" VAlign="Middle" Width="60"></Static>
				<Edit BindDataset="ds_condition" Border="Flat" CanChange="div_search_edt_hour_CanChange" Column="HOUR" Enable="FALSE" Height="20" Id="edt_hour" Left="463" LeftMargin="2" MaxLength="2" Number="TRUE" RightMargin="2" Style="sty_ipt_form" TabOrder="0" Top="7" Width="22"></Edit>
				<Edit BindDataset="ds_condition" Border="Flat" CanChange="div_search_edt_min_CanChange" Column="MIN" Enable="FALSE" Height="20" Id="edt_min" Left="486" LeftMargin="2" MaxLength="2" Number="TRUE" RightMargin="2" Style="sty_ipt_form" TabOrder="1" Top="7" Width="22"></Edit>
				<Edit BindDataset="ds_condition" Border="Flat" Column="END_HOUR" Enable="FALSE" Height="20" Id="edt_endHour" Left="623" LeftMargin="2" MaxLength="2" Number="TRUE" RightMargin="2" Style="sty_ipt_form" TabOrder="3" Top="7" Width="22"></Edit>
				<Edit BindDataset="ds_condition" Border="Flat" Column="END_MIN" Enable="FALSE" Height="20" Id="edt_endMin" Left="646" LeftMargin="2" MaxLength="2" Number="TRUE" RightMargin="2" Style="sty_ipt_form" TabOrder="3" Top="7" Width="22"></Edit>
				<MaskEdit BindDataset="ds_condition" Border="Flat" Column="APLY_YM" Enable="FALSE" Height="20" Id="cal_polYm" Left="73" LeftMargin="2" Mask="@@@@-@@" MaxLength="6" Readonly="TRUE" RightMargin="2" Style="sty_ipt_form" TabOrder="10" Top="8" Type="STRING" Width="77"></MaskEdit>
				<Button Cursor="HAND" Enable="FALSE" Height="20" Id="btn_monthCalendar" ImageID="btn_i_calendar" Left="150" OnClick="btn_monthCalendar_OnClick" TabOrder="4" TabStop="FALSE" Text="Button3" Top="8" Width="17"></Button>
				<Button Align="Left" ButtonStyle="TRUE" Height="21" Id="btn_search" ImageID="btn_a_4" Left="905" LeftMargin="5" OnClick="div_search_btn_search_OnClick" Style="sty_btn_a" TabOrder="12" Text="대상정책" Top="6" Width="91"></Button>
			</Contents>
		</Div>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="25" Id="btn_save" ImageID="btn_c_2" Left="889" LeftMargin="5" OnClick="df_save" Style="sty_btn_c" TabOrder="3" Text="저장" Top="565" Width="60"></Button>
		<Div Border="Raised" Height="99" Id="div_adjust" Left="10" Style="sty_div_input" TabOrder="2" Text="질의내용" Top="459" Width="1004">
			<Contents>
				<Static Align="Right" Height="20" Id="Static8" Left="12" Style="sty_lb_Basic" TabOrder="0" Text="비고" Top="6" VAlign="Middle" Width="50"></Static>
				<TextArea Border="Flat" CheckLength="Byte" Height="75" Id="txt_rmks" Left="66" MaxLength="90" Style="sty_ipt_form" TabOrder="1" Top="6" VScroll="TRUE" Width="922"></TextArea>
			</Contents>
		</Div>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="25" Id="btn_delete" ImageID="btn_d_2" Left="952" LeftMargin="5" OnClick="df_delete" Style="sty_btn_d" TabOrder="4" Text="삭제" Top="565" Width="60"></Button>
		<Image Align="Left" Height="25" Id="Image2" ImageID="bul_tit" Left="13" LeftMargin="15" Style="sty_img_tit" TabOrder="5" Text="조직" Top="53" Width="192"></Image>
		<Div Height="21" Id="div_excel" Left="197" TabOrder="6" Text="Div2" Top="56" Width="77">
			<Contents>
				<Button Cursor="HAND" Height="21" Id="btn_addRow" ImageID="btn_i_add_w" Left="32" OnClick="div_excel_btn_addRow_OnClick" TabOrder="1" Text="Button1" ToolTipText="행추가" Width="19"></Button>
				<Button Cursor="HAND" Height="21" Id="btn_delRow" ImageID="btn_i_subtract_w" Left="55" OnClick="div_excel_btn_delRow_OnClick" TabOrder="2" Text="Button1" ToolTipText="추가된&#32;행삭제" Width="19"></Button>
			</Contents>
		</Div>
		<Image Align="Left" Height="25" Id="Image1" ImageID="bul_tit" Left="276" LeftMargin="15" Style="sty_img_tit" TabOrder="7" Text="적용&#32;모델" Top="54" Width="182"></Image>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" BindDataset="ds_splstMdl" BkColor2="user32" BoldHead="true" Border="Flat" Bottom="448" Editable="TRUE" Enable="true" EndLineColor="default" FillArea="TRUE" FillAreaType="Control" HeadBorder="Flat" HeadHeight="22" Height="369" Id="grd_mdl" InputPanel="FALSE" Left="282" LineColor="user33" MinWidth="100" OnExpandUp="grd_mdl_OnExpandUp" Right="1008" RowHeight="21" Style="sty_Grid" TabOrder="8" TabStop="true" Top="79" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="user33" WheelScrollRow="1" Width="726">
			<contents>
				<format id="Default">
					<columns>
						<col width="30"/>
						<col width="106"/>
						<col width="103"/>
						<col width="68"/>
						<col width="67"/>
					</columns>
					<head>
						<cell bkcolor="user34" col="0" color="user35" display="checkbox"/>
						<cell bkcolor="user34" col="1" color="user35" display="text" text="제조사"/>
						<cell bkcolor="user34" col="2" color="user35" display="text" text="*&#32;모델명"/>
						<cell bkcolor="user34" col="3" color="user35" display="text" text="상품특성"/>
						<cell bkcolor="user34" col="4" color="user35" display="text" text="*&#32;판매가"/>
					</head>
					<body>
						<cell align="center" col="0" colid="chk" display="checkbox" edit="expr:decode(FV_EDIT_FLAG,&apos;Y&apos;,&apos;checkbox&apos;,&apos;none&apos;)"/>
						<cell col="1" colid="mfact_nm" display="text"/>
						<cell col="2" colid="prod_nm" display="text" expandimage="btn_i_detail_b" expandshow="expr:decode(FV_NEW_FLAG,&apos;Y&apos;,true,decode(rowtype,&apos;insert&apos;,true,false))"/>
						<cell col="3" colid="prod_chrtic_1" combocol="COMM_CD_VAL" combodataset="ds_prodChrtic" combotext="COMM_CD_VAL_NM" display="combo"/>
						<cell col="4" colid="sale_prc" display="number" edit="expr:decode(FV_EDIT_FLAG,&apos;Y&apos;,&apos;number&apos;,decode(rowtype,&apos;insert&apos;,&apos;number&apos;,&apos;none&apos;))"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Div Height="21" Id="Div0" Left="933" TabOrder="9" Text="Div2" Top="56" Width="77">
			<Contents>
				<Button Cursor="HAND" Height="21" Id="btn_addRowMdl" ImageID="btn_i_add_w" Left="32" OnClick="Div0_btn_addRowMdl_OnClick" TabOrder="1" Text="Button1" ToolTipText="행추가" Width="19"></Button>
				<Button Cursor="HAND" Height="21" Id="btn_delRowMdl" ImageID="btn_i_subtract_w" Left="55" OnClick="Div0_btn_delRowMdl_OnClick" TabOrder="2" Text="Button1" ToolTipText="추가된&#32;행삭제" Width="19"></Button>
			</Contents>
		</Div>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" BindDataset="ds_orgLst" BkColor2="user32" BoldHead="true" Border="Flat" Bottom="448" Editable="TRUE" Enable="true" EndLineColor="default" FillAreaType="Control" HeadBorder="Flat" HeadHeight="22" Height="370" Id="grd_org" InputPanel="FALSE" Left="13" LineColor="user33" MinWidth="100" OnCellClick="grd_org_OnCellClick" OnChar="grd_org_OnChar" OnExpandUp="grd_org_OnExpandUp" OnKeyDown="grd_org_OnKeyDown" Right="272" RowHeight="21" Style="sty_Grid" TabOrder="10" TabStop="true" Top="78" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="user33" WheelScrollRow="1" Width="259">
			<contents>
				<format id="Default">
					<columns>
						<col width="30"/>
						<col width="110"/>
						<col width="73"/>
					</columns>
					<head>
						<cell bkcolor="user34" col="0" color="user35" display="checkbox" edit="checkbox"/>
						<cell bkcolor="user34" col="1" color="user35" display="text" text="*&#32;조직"/>
						<cell bkcolor="user34" col="2" color="user35" display="text" text="*&#32;판매유형"/>
					</head>
					<body>
						<cell align="center" col="0" colid="chk" display="checkbox" edit="checkbox"/>
						<cell col="1" colid="org_nm" cursor="hand" display="text" edit="expr:decode(FV_NEW_FLAG,&apos;Y&apos;,&apos;normal&apos;,&apos;none&apos;)" expandimage="btn_i_detail_b" expandshow="expr:decode(FV_NEW_FLAG,&apos;Y&apos;,true,false)"/>
						<cell col="2" colid="sale_typ_cd" combocol="COMM_CD_VAL" combodataset="ds_saleTypCd" combotext="COMM_CD_VAL_NM" display="combo" edit="expr:decode(FV_NEW_FLAG,&apos;Y&apos;,&apos;combo&apos;,&apos;none&apos;)"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="25" Id="btn_mod" ImageID="btn_c_4" Left="10" LeftMargin="5" OnClick="btn_mod_OnClick" Style="sty_btn_c" TabOrder="11" Text="정책변경" Top="565" Width="85"></Button>
	</Form>
	<Script><![CDATA[/*******************************************************************************
* 프로그램ID : POLSPM00300
* 업무명      : 판매가격표
* 프로그램명  : 판매가격표(모델) 등록
--------------------------------------------------------------------------------
* 작성자      : 이문규
* 작성일      : 2011.10.11
--------------------------------------------------------------------------------
* 1. 변경이력
수정자    :
수정일    :
수정 내역 :
*******************************************************************************/

/*******************************************************************************
// 1. 전 처리기
*******************************************************************************/
#include "lib::lib_commF.js"
#include "lib::lib_commPopup.js"
#include "lib::lib_util.js"

/*******************************************************************************
// 2. 폼 변수 정의
*******************************************************************************/
var FV_STR_NAME; 			//사용자 이름
var SAVE_FLAG = "N";
var APRV_SAVE_FLAG = "N"; 	//승인요청,저장 구분 FLAG
var PRE_APLY_STA_DTM = ""; 
var FV_USER_ID;				// 사용자ID
var FV_USER_NM;				// 사용자명
var FV_ORG_ID;				// 소속
var FV_ORG_CL;				// 소속구분

var FV_KEY_SPLST_ID;        // 가격표ID
var FV_KEY_APLY_YM;         // 적용년월
var FV_KEY_ORG_ID;          // 조직 ID
var FV_KEY_SALE_TYP_CD;     // 판매유형
var FV_APLY_STA_DTM;
var FV_APLY_END_DTM;
var FV_NEW_FLAG;            // 신규 구분
var FV_EDIT_FLAG;           // 수정 구분
var FV_PRE_FRM_NUM;         // 이전화면폼

/*******************************************************************************
* 함수명 : POLSPM00300_OnLoadCompleted
* 기능명 : OnLoadCompleted 이벤트
*******************************************************************************/
function POLSPM00300_OnLoadCompleted(obj)
{
	//cf_setGrdChecknSortEvent(grd_polSplst);	// 그리드 정렬
	// 권한 설정
	cf_setAuth(pFrmNum);
		
	lf_getSession();           
	lf_setCombo();
	lf_setInit();
			
	http.Sync = true;
	
	if(uf_isNull(FV_KEY_SPLST_ID) == true && FV_NEW_FLAG == "Y"){ //신규버튼 클릭시
	
	    //f_getAmtGrdCl();   // 금액 그리드 조회
        FV_EDIT_FLAG = "Y";
	}else{

	    f_getSplst();    // 판매가격표, 모델별 판매가격표 조회
	    
	}
	
	http.Sync = false;
}

/*******************************************************************************
 * @description    : 글로벌 세션 정보
*******************************************************************************/
function lf_getSession()
{
    // 파라메터
    if(IsExistVar("SPLST_ID"     ,true)){ FV_KEY_SPLST_ID = SPLST_ID; }
    if(IsExistVar("APLY_YM"      ,true)){ FV_KEY_APLY_YM = APLY_YM; }
    if(IsExistVar("ORG_ID"       ,true)){ FV_KEY_ORG_ID = ORG_ID; }
    if(IsExistVar("SALE_TYP_CD"  ,true)){ FV_KEY_SALE_TYP_CD = SALE_TYP_CD; }
    if(IsExistVar("APLY_STA_DTM" ,true)){ FV_APLY_STA_DTM = APLY_STA_DTM; }
    if(IsExistVar("APLY_END_DTM" ,true)){ FV_APLY_END_DTM = APLY_END_DTM; }
    if(IsExistVar("NEW_FLAG"     ,true)){ FV_NEW_FLAG = NEW_FLAG;   }
    if(IsExistVar("FV_PRE_FRM_NUM",true)){ FV_PRE_FRM_NUM = PRE_FRM_NUM;   }
    
    // 글러벌 세션
	FV_USER_ID    = gds_session.GetColumn(0, "loginid");						// 사용자ID
	FV_USER_NM    = gds_session.GetColumn(0, "usernm");		
	
	FV_ORG_ID     = gds_session.GetColumn(0, "orgid");
	FV_ORG_CL     = gds_session.GetColumn(0, "orgcl");	
}

/*******************************************************************************
 * @description    : 조회 조건상의 Combox 항목에 공통코드를 설정
*******************************************************************************/
function lf_setCombo()
{
	http.Sync = true;
	cf_setCommonCodeDsEnv();
	cf_setCommonCode("ds_saleTypCd"  , "ZPOL_C_00030");   		//판매유형
	cf_setCommonCode("ds_preferGrdCl", "ZBAS_P_00070"); 		//선호도
	cf_setCommonCode("ds_marCl"      , "ZPOL_C_00550", "선택"); //마진구분
	cf_setCommonCode("ds_prodChrtic" , "ZBAS_C_00020"); 		//상품특성구분
	
	cf_checkCommonCode(); 
	http.Sync = false;		
}

/*******************************************************************************
* 함수명 : lf_setInit
* 기능명 : 도매가격표관리에서 신규버튼 클릭시 초기세팅
*******************************************************************************/
function lf_setInit()
{
    if (FV_NEW_FLAG == "Y"){
        //신규일때
        //div_search.btn_search.Enable = true;
        div_excel.btn_addRow.Enable = true;
        div_excel.btn_delRow.Enable = true;
        div0.btn_addRowMdl.Enable = true;
        div0.btn_delRowMdl.Enable = true;
        
        grd_org.Enable = true;
        //grd_preferGrd.Enable = true;
        //grd_margin.Enable = true;
        
        div_adjust.txt_rmks.Enable = true;
        btn_save.Enable = true;
        btn_delete.Enable = true;
    
    }else{
        //수정일때
        //정책종료 버튼과 삭제 버튼만 활성화
        //div_search.btn_search.Enable = false;
        div_excel.btn_addRow.Enable = false;
        div_excel.btn_delRow.Enable = false;
        //div0.btn_addRowMdl.Enable = false;
        //div0.btn_delRowMdl.Enable = false;
        
        div_adjust.txt_rmks.Enable = false;
        btn_save.Enable = true;
        btn_delete.Enable = true;
    }
    
    var sStaAplyDt = "";
    var sStaHour   = "";
    var sStaMin    = "";
    var sEndAplyDt = "";
    var sEndHour   = "";
    var sEndMin    = "";
    var lastDay    = "";

    if (FV_NEW_FLAG == "Y"){
    
        sStaAplyDt = FV_KEY_APLY_YM + "01";
        sStaHour = "00";
        sStaMin  = "00";

	    lastDay = uf_MonthLastDay(FV_KEY_APLY_YM+"01");
	    
        sEndAplyDt = FV_KEY_APLY_YM + lastDay;	    
        sEndHour = "23";
        sEndMin  = "59";

    }else{
    
        sStaAplyDt = substr(FV_APLY_STA_DTM,0,8);
        sStaHour   = substr(FV_APLY_STA_DTM,8,2);
        sStaMin    = substr(FV_APLY_STA_DTM,10,2);

	    //lastDay = uf_MonthLastDay(FV_KEY_APLY_YM+"01");
	    
        sEndAplyDt = substr(FV_APLY_END_DTM,0,8);
        sEndHour   = substr(FV_APLY_END_DTM,8,2);
        sEndMin    = substr(FV_APLY_END_DTM,10,2);
    }
    
    // 조건값을 ds에 셋팅
	cf_setParam(ds_condition, "splst_id"    , FV_KEY_SPLST_ID);
	cf_setParam(ds_condition, "aply_ym"     , FV_KEY_APLY_YM);
	cf_setParam(ds_condition, "org_id"      , FV_KEY_ORG_ID);
	cf_setParam(ds_condition, "sale_typ_cd" , FV_KEY_SALE_TYP_CD);
	cf_setParam(ds_condition, "aply_sta_dtm", sStaAplyDt);
	cf_setParam(ds_condition, "hour"    , sStaHour);
	cf_setParam(ds_condition, "min"     , sStaMin);
	cf_setParam(ds_condition, "aply_end_dtm", sEndAplyDt);
	cf_setParam(ds_condition, "end_hour"    , sEndHour);
	cf_setParam(ds_condition, "end_min"     , sEndMin);

}

/*******************************************************************************
* 함수명 : df_reSet
* 기능명 : 화면 초기화
*******************************************************************************/
function df_reSet(sArg)
{

}

/*******************************************************************************
* 함수명 : f_callBack 
* 기능명 : 트랜잭션 콜백 
* 파라미터
1. sSvcID  : 서비스 아이디
*******************************************************************************/
function f_callBack(sSvcID)
{
	if(sSvcID == "svcGetAmtGrdCl" ){
	    var rowCntP = ds_preferGrdCl.rowcount;
	    var rowCntA = ds_amtGrdCl.rowcount;
	    
	    
	    // 선호도 그리드에 바인드할 dataset 생성
	    //ds_preferLst.Clear();
	    //for (i = 0 ; i < rowCntP ; i++){
	    //    ds_preferLst.AddRow();
	    //    ds_preferLst.SetColumn(i,"prefer_grd_cl", ds_preferGrdCl.GetColumn(i,"comm_cd_val"));
	    //    ds_preferLst.SetColumn(i,"prefer_grd_cl", ds_preferGrdCl.GetColumn(i,"comm_cd_val"));
	    //}

        var iCnt = 0;
	    //ds_splstMdl.Clear();
	    
	    for (i = 0 ; i < rowCntP ; i++){
	        for (j = 0; j < rowCntA ; j++) {
	            
				ds_splstMdl.AddRow();

				ds_splstMdl.SetColumn(iCnt, "prefer_grd_cl", ds_preferGrdCl.GetColumn(i,"comm_cd_val"));
				
				ds_splstMdl.SetColumn(iCnt, "amt_grd_cl"   , ds_amtGrdCl.GetColumn(j,"amt_grd_cl"));
				ds_splstMdl.SetColumn(iCnt, "amt_from"     , ds_amtGrdCl.GetColumn(j,"amt_from"));
				ds_splstMdl.SetColumn(iCnt, "amt_to"       , ds_amtGrdCl.GetColumn(j,"amt_to"));
				
				iCnt++;
				
			}
	    }
	    
	    //ds_splstMdl.Filter("prefer_grd_cl="+ds_preferGrdCl.GetColumn(ds_preferGrdCl.currow, "comm_cd_val"));
	}
	
	if(sSvcID == "svcGetSplst" ){
		    
		//trace(ds_splst.SaveXML());
		//trace(ds_splstMdl.SaveXML());
		    
		var rowCntP = ds_splst.rowcount;
	    var rowCntA = ds_splstMdl.rowcount;
	    
	    ds_orgLst.ClearData();
	    for (i = 0 ; i < rowCntP ; i++){
	        ds_orgLst.AddRow();
	        ds_orgLst.SetColumn(i, "org_id" , ds_splst.GetColumn(i,"org_id"));
	        ds_orgLst.SetColumn(i, "org_nm" , ds_splst.GetColumn(i,"org_nm"));
	        ds_orgLst.SetColumn(i, "sale_typ_cd" , ds_splst.GetColumn(i,"sale_typ_cd"));
	    }
	    
        div_adjust.txt_rmks.Text = ds_splst.GetColumn(0,"rmks");
        
        //ds_splstMdl.Filter("prefer_grd_cl="+ds_preferGrdCl.GetColumn(0, "comm_cd_val"));	    
        // 마진 및 수수료에 대한 수정 가능 flag
		if (ds_splst.GetColumn(0,"aply_ym") == substr(cf_getDate(),0,6) ) {
		
		    if (ds_splst.GetColumn(0,"aply_sta_dtm") >= substr(cf_getDate(),0,12)) {
		        FV_EDIT_FLAG = "Y";
		    } else {
		        div0.btn_addRowMdl.Enable = false;
		        div0.btn_delRowMdl.Enable = false;
		        
		        FV_EDIT_FLAG = "N";
		    }
            
        }else{
            FV_EDIT_FLAG = "Y";
        }   
	}else if (sSvcID == "svcGetObjSplst" ) {
	
		//trace(ds_splstMdl.SaveXML());
		    
		var rowCntP = ds_splst.rowcount;
	    var rowCntA = ds_splstMdl.rowcount;
	    
	    ds_orgLst.ClearData();
	    for (i = 0 ; i < rowCntP ; i++){
	        ds_orgLst.AddRow();
	        ds_orgLst.SetColumn(i, "org_id" , ds_splst.GetColumn(i,"org_id"));
	        ds_orgLst.SetColumn(i, "org_nm" , ds_splst.GetColumn(i,"org_nm"));
	        ds_orgLst.SetColumn(i, "sale_typ_cd" , ds_splst.GetColumn(i,"sale_typ_cd"));
	    }

        // 마진 및 수수료에 대한 수정 가능 flag
        FV_EDIT_FLAG = "Y";
	}
	
	if(sSvcID == "svcSaveSplstMdl" || sSvcID == "svcSplstMdlChg"){
	    alert("저장되었습니다.");
		gf_movenCall(FV_PRE_FRM_NUM, "div_search_btn_get_OnClick", "");
        this.Close();
	}

	if(sSvcID == "svcModSplstMdl"){
	    alert("저장되었습니다.");
		gf_movenCall(FV_PRE_FRM_NUM, "div_search_btn_get_OnClick", "");
        this.Close();
	}

	if(sSvcID == "svcDelSplst" ) {
	    alert("삭제되었습니다.");
		gf_movenCall(FV_PRE_FRM_NUM, "div_search_btn_get_OnClick", "");
        this.Close();
	}
}

/*******************************************************************************
* 함수명 : df_search
* 기능명 : 공통 조회 버튼 클릭
* 파라미터
1. sButtonID  : 버튼 아이디
*******************************************************************************/
function df_search(sButtonID)
{
	var sSvcID = "svcSearch";
	var sInDs = "ds_condition=ds_condition";
	var sOutDs = "ds_polSplstTmp=ds_polSplstTmp";
	var sArg = "sktst.pol.ASP#getPolSpLstDetail";
	
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
	
}

/*******************************************************************************
 * @description    : 공통 저장 함수
*******************************************************************************/
function df_save()
{
    // 조직 validation check
    // 마진 및 판매수수료 validation check
    
    // tpol_splst 판매가격표 dataset 셋팅
    var rowCntOrg  = ds_orgLst.rowcount;
    var rowCntMdl  = ds_splstMdl.RowCount();
    var rowSearch = -1;
    // 조직 validation check
    // 마진 및 판매수수료 validation check
    
    // 조직, 판매유형 null 체크
    if( rowCntOrg <= 0 ) {
        alert("대상 조직을 입력해 주십시요.");
        return;
    }
    
    for( i = 0 ; i < rowCntOrg ; i++ ) {
        if( uf_isEmpty(ds_orgLst.GetColumn(i,"org_id")) ) {
            alert("대상 조직을 입력해 주십시요.");
            f_set_gridFocus(grd_org, i, 1);
            return;
        }

        if( uf_isEmpty(ds_orgLst.GetColumn(i,"sale_typ_cd")) ) {
            alert("판매유형을 입력해 주십시요.");
            f_set_gridFocus(grd_org, i, 2);
            return;
        }
        
        if ( (i + 1) < rowCntOrg ) { 
            rowSearch = ds_orgLst.SearchRow("org_id='"+ds_orgLst.GetColumn(i,"org_id")+"' AND sale_typ_cd='"+ds_orgLst.GetColumn(i,"sale_typ_cd")+"'", i+1);
            if (rowSearch != -1){
                alert("중복된 조직,판매유형이 있습니다.");
                return;
            }
        }
    }
    
    if( rowCntMdl <= 0 ) {
        alert("적용 모델을 입력해 주십시요.");
        return;
    }
        
    for( i = 0 ; i < rowCntMdl ; i++ ) {
    
        if( uf_isEmpty(ds_splstMdl.GetColumn(i, "prod_cd")) ) {
            alert("적용 모델을 입력해 주십시요.");
            f_set_gridFocus(grd_mdl, i, 2);
            return;
        }

        if( uf_isEmpty( ds_splstMdl.GetColumn(i, "sale_prc")+"" ) ) {
        
            alert(ds_splstMdl.GetColumn(i,"prod_nm") + " 판매가를 입력해 주십시요.");
            f_set_gridFocus(grd_mdl, i, 4);
            return;
        }
        
        if ( (i + 1) < rowCntMdl ) { 
            rowSearch = ds_splstMdl.SearchRow("prod_cd='"+ds_splstMdl.GetColumn(i,"prod_cd")+"'", i+1);
            if (rowSearch != -1){
                alert("중복된 모델이 있습니다.");
                return;
            }
        }        
        
    }

    var iCnt = 0;
    
	var sSvcID;
	var sInDs;
	var sOutDs;
	var sArg;
 
    if (FV_NEW_FLAG == "Y"){
        
		ds_splst.ClearData();
		ds_splstMdlCopy.ClearData();
		
		for ( i = 0 ; i < rowCntOrg ; i++ ) {
			
			// tpol_splst 판매가격표 dataset 셋팅
			ds_splst.AddRow();
			ds_splst.SetColumn(i, "splst_id"    , ds_condition.GetColumn(0,"splst_id"));
			ds_splst.SetColumn(i, "aply_ym"     , APLY_YM);
			ds_splst.SetColumn(i, "org_id"      , ds_orgLst.GetColumn(i, "org_id"));
			ds_splst.SetColumn(i, "sale_typ_cd" , ds_orgLst.GetColumn(i, "sale_typ_cd"));
			ds_splst.SetColumn(i, "aply_sta_dtm", ds_condition.getColumn(0,"APLY_STA_DTM")+ds_condition.GetColumn(0,"hour") + ds_condition.GetColumn(0,"min"));
			ds_splst.SetColumn(i, "aply_end_dtm", ds_condition.getColumn(0,"APLY_END_DTM")+ds_condition.GetColumn(0,"end_hour") + ds_condition.GetColumn(0,"end_min"));
			ds_splst.SetColumn(i, "pol_cl"      , "02");
			ds_splst.SetColumn(i, "rmks"        , div_adjust.txt_rmks.Text);
	
			//ds_splstMdl.FireEvent = false;
			//ds_splstMdl.UnFilter();
			
			for ( j = 0 ; j < rowCntMdl ; j++ ) {
	
				// tpol_splst_prefer 선호도별 판매가격표 dataset 셋팅
				ds_splstMdlCopy.AddRow();
				ds_splstMdlCopy.CopyRow(iCnt, "ds_splstMdl", j);
				 
				ds_splstMdlCopy.SetColumn(iCnt, "splst_id"    , ds_condition.GetColumn(0,"splst_id"));
				ds_splstMdlCopy.SetColumn(iCnt, "aply_ym"     , APLY_YM);
				ds_splstMdlCopy.SetColumn(iCnt, "org_id"      , ds_orgLst.GetColumn(i, "org_id"));
				ds_splstMdlCopy.SetColumn(iCnt, "sale_typ_cd" , ds_orgLst.GetColumn(i, "sale_typ_cd"));
				
				ds_splstMdlCopy.SetRowType(iCnt, ds_splstMdl.GetRowType(j));
				
				iCnt++;
			}
			
			//ds_splstMdl.Filter("prefer_grd_cl="+ds_preferGrdCl.GetColumn(ds_preferGrdCl.row, "comm_cd_val"));
			//ds_splstMdl.FireEvent = true;
	
		}
	
		//trace(ds_splst.SaveXML());
		//trace(ds_splstMdlCopy.SaveXML());

		sSvcID = "svcSaveSplstMdl";
		sInDs  = "ds_splst=ds_splst ds_splstMdlCopy=ds_splstMdlCopy";
		sOutDs = "";
		sArg   = "sktst.pol.SPM#saveSplstMdl";
    }else{
		sSvcID = "svcModSplstMdl";
		sInDs  = "ds_splst=ds_splst ds_splstMdlCopy=ds_splstMdl:U";
		sOutDs = "";
		sArg   = "sktst.pol.SPM#saveModSplstMdl";
    }

    cf_Transaction(sSvcID, sInDs, sOutDs, sArg, null, true, true);
    
	return;

}

/*******************************************************************************
* 함수명 : f_getAmtGrdCl
* 기능명 : 금액 그리드 조회
* 파라미터
1. sButtonID  : 
*******************************************************************************/
function f_getAmtGrdCl()
{
	var sSvcID = "svcGetAmtGrdCl";
	var sInDs = "nc_input_fieldDs=ds_condition";
	var sOutDs = "ds_amtGrdCl=ds_amtGrdCl";
	var sArg = "sktst.pol.SPM#getAmtGrdCl";
	
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
	
}

/*******************************************************************************
* 함수명 : f_getSplst
* 기능명 : 판매가격표 및 선호도별 판매가격표 조회
* 파라미터
1. sButtonID  : 
*******************************************************************************/
function f_getSplst()
{
    //trace(ds_condition.SaveXML());
    
	var sSvcID = "svcGetSplst";
	var sInDs = "nc_input_fieldDs=ds_condition";
	var sOutDs = "ds_splst=ds_splst ds_splstMdl=ds_splstMdl";
	var sArg = "sktst.pol.SPM#getSplstMdlLst";
	
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
	
}

/*******************************************************************************
* 함수명 : f_pre_aprv
* 기능명 : 승인요청 전 체크함수 
*******************************************************************************/
function f_pre_aprv()
{
	/*
	if(APRV_ST == "01"){
		alert(cf_getMessage(MSG_00138, "승인요청된 도매가격표"));
		return;
	}
	
	if(APRV_ST == "03"){
		alert(cf_getMessage(MSG_00138, "승인된 도매가격표"));
		return;
	}
	*/
    return true;
}

/*******************************************************************************
 * @description    : 승인요청버튼 클릭시
*******************************************************************************/
function btn_approvalReq_OnClick(obj)
{
	cf_CheckCloseMnth('04',ds_condition.getColumn(0,"APLY_STA_DTM"),'적용기간');
	if(FV_BOOLEAN_CLOSE) return;
	
	APRV_SAVE_FLAG = "Y";
	cf_setParam(ds_condition,"APRV_ST", "01"); //승인요청중
	
	if (!(f_pre_save())) return;
	
	if (!(f_pre_aprv())) return;
	
	var sSvcID = "";
	var sInDs = "";
	var sOutDs = "";
	var sArg = "";
	
	if(PRE_APLY_STA_DTM == replace(div_search.cal_aplyStaDtm.Text,'-','')
	                       + div_search.edt_hour.Text
	                       + div_search.edt_min.Text)
	{
		
		if(confirm(cf_getMessage(MSG_00136, "도매가격표를 소급변경 및 승인요청")) == 1){
			sSvcID = "svcUpdate";
			sInDs = "ds_condition=ds_condition ds_zPolC=ds_zPolC ds_polSplstTmp=ds_polSplstTmp";
			sOutDs = "ds_polSplstTmp=ds_polSplstTmp";
			sArg = "sktst.pol.ASP#savePolSplst";
			cf_Transaction(sSvcID, sInDs, sOutDs, sArg, null, true, true);
		}
		
	}
	else
	{
		if(uf_isNull(SPLST_ID) == true){ //신규버튼 클릭시
			
			f_dupSplstKey(); //중복된 key 도매가격표 확인
			
		}else{
			
			if(confirm(cf_getMessage(MSG_00136, "새로운 적용년월에 도매가격표를  등록 및 승인요청")) == 1){
				sSvcID = "svcAdd";
				sInDs = "ds_condition=ds_condition ds_zPolC=ds_zPolC ds_polSplstTmp=ds_polSplstTmp";
				sOutDs = "";
				sArg = "sktst.pol.ASP#addPolSplst";
				cf_Transaction(sSvcID, sInDs, sOutDs, sArg, null, true, true);
			}
		}
	}
	
}

/*******************************************************************************
* 함수명 : f_pre_save
* 기능명 : 저장버튼 전 체크함수 
*******************************************************************************/
function f_pre_delete()
{
	
	if(NEW_FLAG == "Y"){
		alert(cf_getMessage(MSG_00138, "신규등록 화면"));
		return false;
	}
	
	if(ds_polSplstTmp.rowcount < 1){
		return false;
	}
	
	if(HIST_FLAG == "Y"){
		alert(cf_getMessage(MSG_00138, "종결된 도매가격표"));
		return false;
	}
	
	
	if(CRUD_FLAG != "Y"){
		alert(cf_getMessage(MSG_00130, "최종 도매가격표"));
		return false;
	}
	
    return true;
}

/*******************************************************************************
* 함수명 : df_delete
* 기능명 : 공통 수정 버튼 클릭
* 파라미터
1. sButtonID  : 버튼 아이디
*******************************************************************************/
function df_delete(sButtonID)
{
	var sCurrYYmm = substr(cf_today(),0,6);

    if ( FV_NEW_FLAG == "Y" ) {
	    alert("삭제할 판매가격표가 없습니다.");
	    return;
    }
    
	if ( FV_KEY_APLY_YM <= sCurrYYmm ){
	    alert("미적용 판매가격표만 삭제할수 있습니다.");
	    return;
	}
	
	var sSvcID = "svcDelSplst";
	var sInDs = "nc_input_fieldDs=ds_condition";
	var sOutDs = "";
	var sArg = "sktst.pol.SPM#deleteSplstMdl";
	
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
	
	return;
}

/*******************************************************************************
* 함수명 : btn_mod_OnClick
* 기능명 : 정책변경 버튼 
*******************************************************************************/
function btn_mod_OnClick(obj)
{	
	var sArg = " APLY_STA_DTM=" + quote(ds_condition.getColumn(0,"APLY_STA_DTM"));
		sArg += " HOUR=" + quote(ds_condition.getColumn(0,"HOUR"));
		sArg += " MIN=" + quote(ds_condition.getColumn(0,"MIN"));
		sArg += " APLY_END_DTM=" + quote(ds_condition.getColumn(0,"APLY_END_DTM"));
		sArg += " END_HOUR=" + quote(ds_condition.getColumn(0,"END_HOUR"));
		sArg += " END_MIN=" + quote(ds_condition.getColumn(0,"END_MIN"));
		sArg += " POL_CL=" + quote('2');
		sArg += " MOD_FLAG=" + quote('Y');
		
	var rtn = dialog("POL::POLSPM00400.xml", sArg, 336, 128);

	if(rtn == 1){
	
		if(confirm(cf_getMessage(MSG_00136, "새로운 판매가격표를 등록")) == 1){
			
			//ds_polSplstTmp.Reset(); //정책변경시에는 초기가격표 그대로 복원한다.
			
			//div_search_btn_search_OnClick();
			
			var sSvcID = "svcSplstMdlChg";
			var sInDs = "ds_condition=ds_condition ds_splst=ds_splst";
			var sOutDs = "";
			var sArg = "sktst.pol.SPM#saveSplstMdlChg";
			
			cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
				
		}
	
	} else if(rtn == 2){
	
		if(confirm(cf_getMessage(MSG_00136, "판매가격표를 종료")) == 1){
			
			//ds_polSplstTmp.Reset(); //정책변경시에는 초기가격표 그대로 복원한다.
			
			//div_search_btn_search_OnClick();
			
			var sSvcID = "svcSplstMdlClose";
			var sInDs = "ds_condition=ds_condition ds_splst=ds_splst";
			var sOutDs = "";
			var sArg = "sktst.pol.SPM#updateSplstClose";
			
			cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
	
		}
	}
	

return;
	
}

/*******************************************************************************
* 함수명 : df_update
* 기능명 : 공통 수정 버튼 클릭
* 파라미터
1. sButtonID  : 버튼 아이디
*******************************************************************************/
function df_update(sButtonID)
{

}

/*******************************************************************************
* 함수명 : df_close
* 기능명 : 화면 종료
*******************************************************************************/
function df_close(sButtonID)
{
	this.close();
}

/*******************************************************************************
* 함수명 : f_getZPolC00040
* 기능명 : 장려금의 세부판매유형 코드 조회
* 파라미터
1. sButtonID  : 버튼 아이디
*******************************************************************************/
function f_getZPolC00040()
{
	var sSvcID = "svcSearchZPolC";
	var sInDs = "nc_input_fieldDs=ds_condition";
	var sOutDs = "ds_zPolC=ds_zPolC";
	var sArg = "sktst.pol.ASP#getZpolC";
	
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}

/*******************************************************************************
* 함수명 : f_getSaleTypCdMin
* 기능명 : 판매가격표의 세부판매유형 코드 조회
* 파라미터
1. sButtonID  : 버튼 아이디
*******************************************************************************/
function f_getSaleTypCdMin()
{
	ds_condition.SetColumn(0,"SPLST_ID",SPLST_ID);
	
	var sSvcID = "svcSearchSaleTypCdMin";
	var sInDs = "nc_input_fieldDs=ds_condition";
	var sOutDs = "ds_zPolC=ds_zPolC";
	var sArg = "sktst.pol.ASP#getSaleTypCdMin";
	
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}

/*******************************************************************************
* 함수명 : f_getCopySaleTypCdMin
* 기능명 : 판매가격표의 세부판매유형 코드 조회
* 파라미터
1. sButtonID  : 버튼 아이디
*******************************************************************************/
function f_getCopySaleTypCdMin()
{
	var sSvcID = "svcSearchCopySaleTypCdMin";
	var sInDs = "nc_input_fieldDs=ds_copyCondition";
	var sOutDs = "ds_zPolC=ds_zPolC";
	var sArg = "sktst.pol.ASP#getSaleTypCdMin";
	
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}

/*******************************************************************************
* 함수명 : f_dupSplstKey
* 기능명 : 판매가격표의 등록여부 key 체크
* 파라미터
1. sButtonID  : 버튼 아이디
*******************************************************************************/
function f_dupSplstKey()
{
	ds_splstKey.ClearData();
		
	var sSvcID = "svcSplstKey";
	var sInDs = "nc_input_fieldDs=ds_Condition";
	var sOutDs = "ds_splstKey=ds_splstKey";
	var sArg = "sktst.pol.ASP#getSplstKey";
	
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}

/*******************************************************************************
* 함수명 : f_setBounty
* 기능명 : 세부판매유형 코드 조회
* 파라미터
1. sButtonID  : 버튼 아이디
*******************************************************************************/
function f_setBounty()
{
	var sSvcID = "svcUpdateBounty";
	var sInDs = "ds_condition=ds_condition";
	var sOutDs = "ds_polSplstTmp=ds_polSplstTmp";
	var sArg = "sktst.pol.ASP#updatePolTemp";
	
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg, "", true, true);
}


/*******************************************************************************
* 함수명 : div_search_btn_search_OnClick
* 기능명 :  모델선택버튼 OnClick 이벤트 발생
*******************************************************************************/
function div_search_btn_search_OnClick(obj)
{
	
	var sArg  = "APLY_YM="+quote(div_search.cal_polYm.Value);
        sArg += " SALE_TYP_CD=" + quote(ds_condition.getColumn(0,"SALE_TYP_CD")); 
        sArg += " ORG_ID=" + quote(ds_condition.getColumn(0,"ORG_ID"));
        sArg += " APLY_STA_DTM=" + quote(ds_condition.getColumn(0,"APLY_STA_DTM"));
	    sArg += " HOUR=" + quote(ds_condition.getColumn(0,"HOUR")); 
	    sArg += " MIN=" + quote(ds_condition.getColumn(0,"MIN"));
	    sArg += " POL_CL=" + quote("02");
	    
	var rtn = dialog("POL::POLSPM00210.xml", sArg, 336, 128);
	
	if (rtn[0] == "1"){
	
	    ds_conditionObj.SetColumn(0,"splst_id"   , rtn[1]);
	    ds_conditionObj.SetColumn(0,"aply_ym"    , rtn[2]);
	    ds_conditionObj.SetColumn(0,"org_id"     , rtn[3]);
	    ds_conditionObj.SetColumn(0,"sale_typ_cd", rtn[4]);
	    
	    var sSvcID = "svcGetObjSplst";
	    var sInDs  = "nc_input_fieldDs=ds_conditionObj";
	    var sOutDs = "ds_splst=ds_splst ds_splstMdl=ds_splstMdl";
	    var sArg   = "sktst.pol.SPM#getSplstMdlLst";
	
	    cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
	}
    
    return;
	
}

/*******************************************************************************
* 함수명 : div_search_cal_aplyStaDtm_CanChange
* 기능명 :  적용기간 시작일 CanChange 발생시
*******************************************************************************/
function div_search_cal_aplyStaDtm_OnChanged(obj,strOldText,strNewText)
{	
	if(strOldText != strNewText){

		if (!(f_compareDate(obj,strOldText,strNewText,"Y"))) return;
		
	}
}

/*******************************************************************************
* 함수명 : div_search_edt_hour_CanChange
* 기능명 :  적용기간 시간 CanChange 발생시
*******************************************************************************/
function div_search_edt_hour_CanChange(obj,stroldText,strText)
{
	if(strOldText != strText){

		if (!(f_compareDate(obj,strOldText,strText,"H"))) return;
		
	}
}

/*******************************************************************************
* 함수명 : div_search_edt_min_CanChange
* 기능명 :  적용기간 분 CanChange 발생시
*******************************************************************************/
function div_search_edt_min_CanChange(obj,stroldText,strText)
{
	if(strOldText != strText){

		if (!(f_compareDate(obj,strOldText,strText,"M"))) return;
		
	}
}

/*******************************************************************************
* 함수명 : f_compareDate
* 기능명 :  시작일자 종료일자 비교
*******************************************************************************/
function f_compareDate(obj,stroldText,strText,flag)
{
	var startDate = "";
	
	if(flag == "Y"){
		
		startDate = strText + ds_condition.GetColumn(0,"HOUR") + ds_condition.GetColumn(0,"MIN");
				 
    }else if(flag == "H"){
		
		if(strText > 23){
			obj.text = "00";
			obj.SetFocus();
			alert(cf_getMessage(MSG_00034, "23시"));
			return false;
		}
		
    	startDate = ds_condition.GetColumn(0,"APLY_STA_DTM") + strText + ds_condition.GetColumn(0,"MIN");
    	
	}else if(flag == "M"){
		
		if(strText > 59){
			obj.text = "00";
			obj.SetFocus();
			alert(cf_getMessage(MSG_00034, "59분"));
			return false;
		}
		
    	startDate = ds_condition.GetColumn(0,"APLY_STA_DTM") + ds_condition.GetColumn(0,"HOUR") + strText;              
	}  
	  
	var endtDate = ds_condition.GetColumn(0,"APLY_END_DTM") + ds_condition.GetColumn(0,"END_HOUR") + ds_condition.GetColumn(0,"END_MIN");	

	if(startDate >= endtDate){
	
		cf_setParam(ds_condition,"APLY_STA_DTM", stroldText);
		obj.setFocus();
		alert(cf_getMessage(MSG_00094, "적용기간 시작일자;적용기간 종료일자"));
		return false;
		
	}else if(substr(startDate,0,6) != substr(endtDate,0,6)){
		
		cf_setParam(ds_condition,"APLY_STA_DTM", stroldText);
		obj.setFocus();
		alert(cf_getMessage(MSG_00087, "적용년월"));
		return false;
				
	}else{
		return true;
	}

}

/*******************************************************************************
* 함수명 : f_set_gridFocus
* 기능명 : 그리드 포커스 이동
*******************************************************************************/
function f_set_gridFocus(gridObj, nRow, nCellIdx) 
{	
	var dataSetObj = object(gridObj.bindDataset);
	dataSetObj.row = nRow;
	gridObj.SetCellPos(nCellIdx);
	gridObj.SetFocus();
}

/*******************************************************************************
 * @description    :  월달력 사용 - 이벤트
*******************************************************************************/
function btn_monthCalendar_OnClick(obj)
{
	cf_callMonthCalendar(div_search.cal_polYm);
}

/*******************************************************************************
* 함수명 : btn_import_OnClick
* 기능명 :  엑셀 export
*******************************************************************************/
function btn_export_OnClick(obj)
{
	//cf_exportExcel(grd_polSplst);
}

/*******************************************************************************
 * @description    :  조직 그리드의 row 추가
*******************************************************************************/
function div_excel_btn_addRow_OnClick(obj)
{
	ds_orgLst.AddRow();
}

/*******************************************************************************
 * @description    :  조직 그리드의 row 삭제
*******************************************************************************/
function div_excel_btn_delRow_OnClick(obj)
{
    var rowCnt = ds_orgLst.rowcount;
        
    https.Sync = true;
    
    for ( i = rowCnt ; i >= 0 ; i--){
        if (ds_orgLst.GetColumn(i,"chk") == "1") {
            ds_orgLst.DeleteRow(i);
        }
    }
    
    https.Sync = false;
	
}

/*******************************************************************************
 * @description    :  조직 그리드의 조직팝업 호출
*******************************************************************************/
function grd_org_OnCellClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{
/*
	if(nCell == 1){
        cf_commPopOrgCdDs("ds_orgLst", nRow);
	}
*/	
}

/*******************************************************************************
 * @description    :  조직 그리드의 조직팝업 호출
*******************************************************************************/
function grd_org_OnExpandUp(obj,nRow,nCell,strVal,nPivotIndex)
{
	if(nCell == 1){
        cf_commPopOrgCdDs("ds_orgLst", nRow);
    }        
}

/*******************************************************************************
 * @description    :  
*******************************************************************************/
function Div0_btn_addRowMdl_OnClick(obj)
{
	var addRow = ds_splstMdl.AddRow();
	
	if(FV_NEW_FLAG != 'Y'){
        ds_splstMdl.SetColumn(addRow, "splst_id"    , ds_condition.GetColumn(0,"splst_id"));
        ds_splstMdl.SetColumn(addRow, "aply_ym"     , APLY_YM);
        ds_splstMdl.SetColumn(addRow, "org_id"      , ds_orgLst.GetColumn(0, "org_id"));
        ds_splstMdl.SetColumn(addRow, "sale_typ_cd" , ds_orgLst.GetColumn(0, "sale_typ_cd"));
	}
}

function Div0_btn_delRowMdl_OnClick(obj)
{
    var rowCnt = ds_splstMdl.rowcount;
        
    https.Sync = true;
    
    for ( i = rowCnt ; i >= 0 ; i--){
        if (ds_splstMdl.GetColumn(i,"chk") == "1") {
            ds_splstMdl.DeleteRow(i);
        }
    }
    
    https.Sync = false;
}

function grd_mdl_OnExpandUp(obj,nRow,nCell,strVal,nPivotIndex)
{
	if(nCell == 2){
	    ds_splstMdl.SetColumn(nRow, "prod_cl", "1");
        cf_commPopProdDs("ds_splstMdl", nRow);
    }  
}

/*******************************************************************************
 * @description    :  조직 그리드에서 조직명이 변경 됐을때 초기화
*******************************************************************************/
function grd_org_OnChar(obj,strPreText,nChar,strPostText,nLLParam,nHLParam,nRow,nCell,nPivotIndex)
{
    if ( nCell == "1" && strPreText != "") {
		ds_orgLst.SetColumn(nRow,"org_nm","");
		ds_orgLst.SetColumn(nRow,"org_id","");
	}
}

function grd_org_OnKeyDown(obj,nChar,bShift,bCtrl,bAlt,nLLParam,nHLParam)
{
    if (nChar == "13"){
		cf_commPopOrgCdDs("ds_orgLst", ds_orgLst.currow);
	}	
}
]]></Script>
</Window>