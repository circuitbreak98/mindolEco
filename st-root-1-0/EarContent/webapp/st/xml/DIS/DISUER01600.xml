<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="600" Id="DISUER01600" Left="8" OnLoadCompleted="DISUER01600_OnLoadCompleted" PidAttrib="7" Title="중고반납기기관리" Top="8" Ver="1.0" Width="1024" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_CustRtnYn"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_CommRtnTyp">
				<Contents></Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_condition">
				<Contents></Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list" OnColumnChanged="ds_list_OnColumnChanged">
				<Contents>
					<colinfo id="org_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="org_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="sale_plc_id" size="256" summ="default" type="STRING"/>
					<colinfo id="sale_plc_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="old_rtn_plc_id" size="256" summ="default" type="STRING"/>
					<colinfo id="old_rtn_plc_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="comm_co_rtn_typ" size="256" summ="default" type="STRING"/>
					<colinfo id="sale_dt" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="ser_num" size="256" summ="default" type="STRING"/>
					<colinfo id="cust_rtn_yn" size="256" summ="default" type="STRING"/>
					<colinfo id="unrtn_rsn" size="256" summ="default" type="STRING"/>
					<colinfo id="del_yn" size="256" summ="default" type="STRING"/>
					<colinfo id="rmks" size="256" summ="default" type="STRING"/>
					<colinfo id="err_flag" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_DisProdInfo"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_childPop"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_tempExcelList">
				<Contents>
					<colinfo id="org_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="org_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="sale_plc_id" size="256" summ="default" type="STRING"/>
					<colinfo id="sale_plc_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="old_rtn_plc_id" size="256" summ="default" type="STRING"/>
					<colinfo id="old_rtn_plc_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="comm_co_rtn_typ" size="256" summ="default" type="STRING"/>
					<colinfo id="sale_dt" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="ser_num" size="256" summ="default" type="STRING"/>
					<colinfo id="cust_rtn_yn" size="256" summ="default" type="STRING"/>
					<colinfo id="unrtn_rsn" size="256" summ="default" type="STRING"/>
					<colinfo id="del_yn" size="256" summ="default" type="STRING"/>
					<colinfo id="rmks" size="256" summ="default" type="STRING"/>
					<record>
						<comm_co_rtn_typ></comm_co_rtn_typ>
						<cust_rtn_yn></cust_rtn_yn>
						<del_yn></del_yn>
						<old_rtn_plc_id></old_rtn_plc_id>
						<old_rtn_plc_nm></old_rtn_plc_nm>
						<org_cd>&#32;</org_cd>
						<org_nm></org_nm>
						<prod_cd></prod_cd>
						<prod_nm></prod_nm>
						<rmks></rmks>
						<sale_dt></sale_dt>
						<sale_plc_id></sale_plc_id>
						<sale_plc_nm></sale_plc_nm>
						<ser_num></ser_num>
						<unrtn_rsn></unrtn_rsn>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_GrdRtnTyp">
				<Contents>
					<colinfo id="code" size="256" summ="default" type="STRING"/>
					<colinfo id="name" size="256" summ="default" type="STRING"/>
					<record>
						<code>1</code>
						<name>고객반납</name>
					</record>
					<record>
						<code>2</code>
						<name>고객미반납</name>
					</record>
					<record>
						<code>3</code>
						<name>분실</name>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_ParentProd">
				<Contents>
					<colinfo id="prod_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_nm" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_tempList">
				<Contents>
					<colinfo id="pcode" size="256" summ="default" type="STRING"/>
					<colinfo id="deal_co_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="deal_co_nm" size="256" summ="default" type="STRING"/>
					<record>
						<deal_co_cd></deal_co_cd>
						<deal_co_nm></deal_co_nm>
						<pcode>&#32;</pcode>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_conTemp">
				<Contents></Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_code" OnColumnChanged="ds_code_OnColumnChanged">
				<Contents>
					<colinfo id="pos_agency" size="256" summ="default" type="STRING"/>
					<record>
						<pos_agency>&#32;</pos_agency>
					</record>
				</Contents>
			</Dataset>
		</Datasets>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" BindDataset="ds_list" BkColor2="user32" BoldHead="true" Border="Flat" Bottom="557" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" FillArea="TRUE" FillAreaType="Control" HeadBorder="Flat" HeadHeight="22" Height="422" Id="grd_list" InputPanel="FALSE" Left="10" LineColor="user33" MinWidth="100" OnEnterDown="grd_list_OnEnterDown" OnExpandUp="grd_list_OnExpandUp" Right="1012" RowHeight="21" Style="sty_Grid" TabOrder="1" TabStop="true" Top="135" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="user33" WheelScrollRow="1" Width="1002">
			<contents>
				<format id="Default">
					<columns>
						<col width="35"/>
						<col width="106"/>
						<col width="106"/>
						<col width="106"/>
						<col width="87"/>
						<col width="93"/>
						<col width="86"/>
						<col width="97"/>
						<col width="45"/>
						<col width="80"/>
						<col width="45"/>
						<col width="229"/>
					</columns>
					<head>
						<cell bkcolor="user34" col="0" color="user35" display="text" rowspan="2" text="번호"/>
						<cell bkcolor="user34" col="3" color="user35" display="text" rowspan="2" text="반납처"/>
						<cell bkcolor="user34" col="4" color="user35" display="text" rowspan="2" text="반납유형"/>
						<cell col="-1" display="text">
							<cell col="0" color="user35" display="text" text="개통번호"/>
							<cell col="0" display="text" row="1"/>
						</cell>
						<cell bkcolor="user34" col="1" color="user35" display="text" rowspan="2" text="대리점"/>
						<cell bkcolor="user34" col="2" color="user35" display="text" rowspan="2" text="판매처"/>
						<cell bkcolor="user34" col="5" color="user35" display="text" rowspan="2" text="판매일"/>
						<cell bkcolor="user34" col="6" color="user35" colspan="2" display="text" text="상품정보"/>
						<cell bkcolor="user34" col="8" color="user35" display="text" rowspan="2" text="반납&#10;여부" wordwrap="word"/>
						<cell bkcolor="user34" col="9" color="user35" display="text" rowspan="2" text="미반납사유" wordwrap="word"/>
						<cell bkcolor="user34" col="10" color="user35" display="text" rowspan="2" text="삭제&#10;여부" wordwrap="exchar"/>
						<cell bkcolor="user34" col="11" color="user35" display="text" rowspan="2" text="오류사항"/>
						<cell bkcolor="user34" col="6" color="user35" display="text" row="1" text="일련번호"/>
						<cell bkcolor="user34" col="7" color="user35" display="text" row="1" text="상품"/>
					</head>
					<body>
						<cell align="center" bkcolor="expr:decode(ERR_FLAG,&apos;S&apos;,&apos;User41&apos;,&apos;default&apos;)" col="0" display="text" expr="currow+1"/>
						<cell bkcolor="expr:decode(ERR_FLAG,&apos;S&apos;,&apos;User41&apos;,&apos;default&apos;)" col="1" colid="org_nm" display="text"/>
						<cell bkcolor="expr:decode(ERR_FLAG,&apos;S&apos;,&apos;User41&apos;,&apos;default&apos;)" col="2" colid="sale_plc_nm" display="text" expandimage="btn_i_detail_b" expandshow="true"/>
						<cell bkcolor="expr:decode(ERR_FLAG,&apos;S&apos;,&apos;User41&apos;,&apos;default&apos;)" col="3" colid="old_rtn_plc_nm" display="text" expandimage="btn_i_detail_b" expandshow="true"/>
						<cell align="center" bkcolor="expr:decode(ERR_FLAG,&apos;S&apos;,&apos;User41&apos;,&apos;default&apos;)" col="4" colid="comm_co_rtn_typ" combocol="code" combodataset="ds_GrdRtnTyp" combotext="name" display="combo" edit="combo"/>
						<cell align="center" bkcolor="expr:decode(ERR_FLAG,&apos;S&apos;,&apos;User41&apos;,&apos;default&apos;)" col="5" colid="sale_dt" display="date" edit="normal" expandimage="btn_i_calendar" expandshow="true"/>
						<cell align="center" bkcolor="expr:decode(ERR_FLAG,&apos;S&apos;,&apos;User41&apos;,&apos;default&apos;)" col="6" colid="ser_num" display="text" edit="normal"/>
						<cell align="center" bkcolor="expr:decode(ERR_FLAG,&apos;S&apos;,&apos;User41&apos;,&apos;default&apos;)" col="7" colid="prod_nm" display="text" expandimage="btn_i_detail_b" expandshow="true"/>
						<cell align="center" bkcolor="expr:decode(ERR_FLAG,&apos;S&apos;,&apos;User41&apos;,&apos;default&apos;)" col="8" colid="cust_rtn_yn" display="checkbox" edit="checkbox"/>
						<cell align="left" bkcolor="expr:decode(ERR_FLAG,&apos;S&apos;,&apos;User41&apos;,&apos;default&apos;)" col="9" colid="unrtn_rsn" display="text" edit="normal"/>
						<cell align="center" bkcolor="expr:decode(ERR_FLAG,&apos;S&apos;,&apos;User41&apos;,&apos;default&apos;)" col="10" colid="del_yn" display="checkbox" edit="checkbox"/>
						<cell align="left" bkcolor="expr:decode(ERR_FLAG,&apos;S&apos;,&apos;User41&apos;,&apos;default&apos;)" col="11" colid="rmks" display="text" edit="normal"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Div Border="Raised" Height="88" Id="div_search" Left="10" Style="sty_div_search" TabOrder="2" Text="Div0" Top="10" Width="1002">
			<Contents>
				<Static Align="Right" Height="20" Id="Static2" Left="30" Style="sty_lb_Search" TabOrder="11" Text="대리점" Top="31" VAlign="Middle" Width="60"></Static>
				<Calendar Border="Flat" ButtonImageID="btn_i_calendar" DayFont="Default,-1" HeaderBorder="NONE" HeaderFont="Default,-1" HeadStyle="sty_calendar_head" Height="20" Id="cal_FromSaleDt" Left="98" LeftMargin="2" MonthPopupBorder="RAISED" NullValue="&#32;" RightMargin="2" SaturdayTextColor="user28" Style="sty_calendar" SundayTextColor="user27" TabOrder="3" TodayColor="user26" Top="7" WeeksFont="Default,-1" WeekStyle="sty_calendar_week" Width="100"></Calendar>
				<Static Align="Right" Height="20" Id="Static3" Left="23" Style="sty_lb_Search" TabOrder="1" Text="판매일" Top="7" VAlign="Middle" Width="68"></Static>
				<Button Align="Left" ButtonStyle="TRUE" Height="21" Id="btn_search" ImageID="btn_a_2" Left="917" LeftMargin="5" OnClick="div_search_btn_search_OnClick" Style="sty_btn_a" TabOrder="2" Text="조회" Top="52" Width="60"></Button>
				<Static Align="Center" Height="20" Id="Static0" Left="199" TabOrder="4" Text="~" Top="7" VAlign="Middle" Width="20"></Static>
				<Calendar Border="Flat" ButtonImageID="btn_i_calendar" DayFont="Default,-1" HeaderBorder="NONE" HeaderFont="Default,-1" HeadStyle="sty_calendar_head" Height="20" Id="cal_ToSaleDt" Left="218" LeftMargin="2" MonthPopupBorder="RAISED" NullValue="&#32;" RightMargin="2" SaturdayTextColor="user28" Style="sty_calendar" SundayTextColor="user27" TabOrder="5" TodayColor="user26" Top="7" WeeksFont="Default,-1" WeekStyle="sty_calendar_week" Width="100"></Calendar>
				<Static Align="Right" Height="20" Id="Static6" Left="393" Style="sty_lb_Search" TabOrder="7" Text="반납여부" Top="53" VAlign="Middle" Width="84"></Static>
				<Combo Border="Flat" CodeColumn="COMM_CD_VAL" DataColumn="COMM_CD_VAL_NM" Height="20" Id="cmb_CustRtnYn" InnerDataset="ds_CustRtnYn" Left="480" Style="sty_ipt_form" TabOrder="6" Top="51" Width="100"></Combo>
				<Static Align="Right" Height="20" Id="Static4" Left="385" Style="sty_lb_Search" TabOrder="9" Text="중고반납유형" Top="27" VAlign="Middle" Width="92"></Static>
				<Combo Border="Flat" CodeColumn="COMM_CD_VAL" DataColumn="COMM_CD_VAL_NM" Height="20" Id="cmb_CommRtnTyp" InnerDataset="ds_CommRtnTyp" Left="480" Style="sty_ipt_form" TabOrder="8" Top="26" Width="100"></Combo>
				<Image Height="21" Id="Image2" ImageID="bul_mand" Left="36" TabOrder="10" Top="6" Transparent="TRUE" Width="20"></Image>
				<Image Height="21" Id="Image0" ImageID="bul_mand" Left="35" TabOrder="14" Top="29" Transparent="TRUE" Width="20"></Image>
				<Edit Border="Flat" Height="20" Id="edt_AgencyNm" Left="98" LeftMargin="2" OnCharChanged="div_search_edt_AgencyNm_OnCharChanged" OnKeyDown="div_search_edt_AgencyNm_OnKeyDown" RightMargin="2" Style="sty_ipt_form" TabOrder="13" Top="31" Width="143"></Edit>
				<Button Height="21" Id="btn_AgencyId" ImageID="btn_i_detail" Left="241" OnClick="div_search_btn_AgencyId_OnClick" TabOrder="12" Text="Button0" Top="31" Width="19"></Button>
				<Edit Border="Flat" Enable="FALSE" Height="20" Id="edt_AgencyUkeyCd" Left="260" LeftMargin="2" RightMargin="2" Style="sty_ipt_form" TabOrder="15" Top="32" Visible="FALSE" Width="57"></Edit>
				<Static Align="Right" Height="20" Id="Static1" Left="30" Style="sty_lb_Search" TabOrder="16" Text="판매처" Top="55" VAlign="Middle" Width="60"></Static>
				<Edit Border="Flat" Height="20" Id="edt_SalePlcNm" Left="98" LeftMargin="2" OnCharChanged="div_search_edt_SalePlcNm_OnCharChanged" OnKeyDown="div_search_edt_SalePlcNm_OnKeyDown" RightMargin="2" Style="sty_ipt_form" TabOrder="18" Top="55" Width="143"></Edit>
				<Button Height="21" Id="btn_SalePlcId" ImageID="btn_i_detail" Left="241" OnClick="div_search_btn_SalePlcId_OnClick" TabOrder="17" Text="Button0" Top="55" Width="19"></Button>
				<Edit Border="Flat" Enable="FALSE" Height="20" Id="edt_SalePlcId" Left="260" LeftMargin="2" RightMargin="2" Style="sty_ipt_form" TabOrder="19" Top="55" Visible="FALSE" Width="57"></Edit>
				<Static Align="Right" Height="20" Id="Static5" Left="649" Style="sty_lb_Search" TabOrder="21" Text="모델" Top="26" VAlign="Middle" Width="60"></Static>
				<Edit Border="Flat" Height="20" Id="edt_ProdCd" Left="713" LeftMargin="2" OnCharChanged="div_search_edt_ProdCd_OnCharChanged" OnKeyDown="div_search_edt_ProdCd_OnKeyDown" RightMargin="2" Style="sty_ipt_form" TabOrder="20" Top="26" Width="70"></Edit>
				<Button Height="21" Id="btn_ProdCd" ImageID="btn_i_detail" Left="781" OnClick="div_search_btn_ProdCd_OnClick" TabOrder="22" Text="Button0" Top="26" Width="19"></Button>
				<Edit Border="Flat" Enable="FALSE" Height="20" Id="edt_ProdNm" Left="800" LeftMargin="2" RightMargin="2" Style="sty_ipt_form" TabOrder="23" Top="26" Width="80"></Edit>
				<Static Align="Right" Height="20" Id="Static7" Left="644" Style="sty_lb_Search" TabOrder="25" Text="일련번호" Top="51" VAlign="Middle" Width="68"></Static>
				<Edit Border="Flat" Height="20" Id="edt_SerNum" Left="714" LeftMargin="2" RightMargin="2" Style="sty_ipt_form" TabOrder="24" Top="51" Width="70"></Edit>
				<Edit BindDataset="ds_code" Border="Flat" Column="pos_agency" Height="20" Id="edt_AgencyCd" Left="318" MaxLength="10" Style="sty_ipt_form" TabOrder="26" TabStop="FALSE" Top="32" UpperOnly="TRUE" Visible="FALSE" Width="8"></Edit>
			</Contents>
		</Div>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="25" Id="btn_save" ImageID="btn_c_2" Left="952" LeftMargin="5" OnClick="btn_save_OnClick" Style="sty_btn_c" TabOrder="3" Text="저장" Top="565" Visible="FALSE" Width="60"></Button>
		<Button Cursor="HAND" Height="21" Id="btn_upload" ImageID="btn_i_excelup_w" Left="973" OnClick="btn_upload_OnClick" TabOrder="4" Text="Button1" ToolTipText="Excel&#32;Upload" Top="108" Width="19"></Button>
		<Button Height="20" Id="btn_addRow" ImageID="btn_i_add_w" Left="927" OnClick="btn_addRow_OnClick" TabOrder="6" Text="Button7" Top="108" Width="20"></Button>
		<Button Height="20" Id="btn_delRow" ImageID="btn_i_subtract_w" Left="950" OnClick="btn_delRow_OnClick" TabOrder="5" Text="Button7" Top="108" Width="20"></Button>
		<Button Cursor="HAND" Height="21" Id="btn_excelDown" ImageID="btn_i_exceldown_w" Left="996" OnClick="div_page_btn_excelDown_OnClick" TabOrder="7" Text="Button1" ToolTipText="Excel&#32;Download" Top="108" Width="19"></Button>
	</Form>
	<Script><![CDATA[/*******************************************************************************
* 프로그램ID : DISUER01600
* 업무명      :  재고관리 - 중고반납기기
* 프로그램명  : 중고반납기기관리
--------------------------------------------------------------------------------
* 작성자      : 전현주
* 작성일      : 2010.03.
--------------------------------------------------------------------------------
* 1. 변경이력
수정자    :
수정일    :
수정 내역 :
*******************************************************************************/

//==============================================================================
// 공통 스크립트 로딩
//==============================================================================
#include "lib::lib_commF.js"
#include "lib::lib_commPopup.js"
#include "lib::lib_SAL.js"
#include "lib::lib_DIS.js"
#include "lib::lib_util.js"

//==============================================================================
// 폼 변수 정의
//==============================================================================

// Session 변수
var FV_ORG_CL;    		// 조직구분
var FV_ORG_ID;    		// 조직ID
var FV_ORG_NM;    		// 조직명
var FV_SUP_ORG_ID; 		// 상위조직
var FV_SUP_ORG_NM;  	// 상위조직명
var FV_USER_GRP;    	// 사용자그룹
var FV_ORG_AREA_CL1;    // 근무지 거래처구분
var FV_ORG_AREA_ID;    // 근무지
var FV_ORG_AREA_NM;    // 근무지명
var FV_POS_AGENCY_ID;		// 소속대리점ID
var FV_POS_AGENCY_NM;   	// 소속대리점명
var FV_POS_AGENCY_UKEY_ID; // 소속대리점 Ukey ID
var FV_AREA_UKEY_ID;		// 근무지UKey ID
var FV_AREA_UKEY_CHANNEL_CD;		// 근무지 Channel Cd
var FV_AREA_UKEY_SUB_CD;			// 근무지 Sub Cd
var FV_RETURN_CNT;


var FV_DIS_PROD_CURR_ROW_INDEX; // 재고상품 현재 Row Index
var FV_PROD_CD_CURR_ROW;

/*******************************************************************************
 * @description    : 최초 폼 로드시 발생 - 이벤트
*******************************************************************************/
function DISUER01600_OnLoadCompleted(obj)
{
    // 등록일자 셋팅
	div_search.cal_FromSaleDt.Value = sf_getFirstDay();
	div_search.cal_ToSaleDt.Value = Mid(cf_getDate(),0,8);
	div_search.cal_FromSaleDt.SetFocus();
		
	// 권한 설정
	cf_setAuth(pFrmNum);

	f_setSessionInfo();

	// 공통 코드 조회
	f_initCombo();
	
	// 로그인 사용자별 조직 제어
	f_setOrgInfo();

	// 그리드 체크 박스 및 정렬 - 옵션
	cf_setGrdChecknSortEvent(grd_list);
}

/*******************************************************************************
 * @description    : 세션 정보 설정
*******************************************************************************/
function f_setSessionInfo()
{
	FV_ORG_CL = gds_session.GetColumn(0,"orgCl");
	FV_ORG_ID = gds_session.GetColumn(0,"orgId");
	FV_ORG_NM = gds_session.GetColumn(0,"orgNm");
	FV_SUP_ORG_ID = gds_session.GetColumn(0,"supOrgId");
	FV_SUP_ORG_NM = gds_session.GetColumn(0,"supOrgNm");
	FV_USER_GRP = gds_session.GetColumn(0,"userGrp");
	FV_ORG_AREA_CL1 = gds_session.GetColumn(0,"orgAreaCl1");
	FV_ORG_AREA_ID = gds_session.GetColumn(0,"orgAreaId");
	FV_ORG_AREA_NM = gds_session.GetColumn(0,"orgAreaNm");
    FV_POS_AGENCY_ID      = gds_session.GetColumn(0,"posAgencyId");   
    FV_POS_AGENCY_NM      = gds_session.GetColumn(0,"posAgencyNm");     
    FV_POS_AGENCY_UKEY_ID = gds_session.GetColumn(0,"posAgencyUkeyId");	
    FV_AREA_UKEY_ID = gds_session.GetColumn(0,"orgAreaUkeyId");
    FV_AREA_UKEY_CHANNEL_CD = gds_session.GetColumn(0,"orgAreaUkeyChannelCd");
    FV_AREA_UKEY_SUB_CD = gds_session.GetColumn(0,"orgAreaUkeySubCd");
}

/*******************************************************************************
 * @description    : 조회 조건상의 Combox 항목에 공통코드를 설정
*******************************************************************************/
function f_initCombo()
{
	var sStr = "";
	
	// 공통 코드를 위한 데이타셋 설정
	cf_setCommonCodeDsEnv();

	cf_setCommonCode("ds_CustRtnYn", "ZDIS_C_00040");   	// 고객반납여부
	cf_setCommonCode("ds_CommRtnTyp", "ZSAL_C_00050");      // 중고반납유형
	
	http.Sync = true;
	// 설정된 코드를 기반으로 공통 코드를 추가 및 데이타 바인딩
	cf_checkCommonCode();
	
	// 조회조건에 기본값 설정
	cf_setInitDataForCmb(div_search.cmb_CustRtnYn,"전체");
	cf_setInitDataForCmb(div_search.cmb_CommRtnTyp,"전체");
	
	http.Sync = false;
}

/*******************************************************************************
 * @description    : 로그인 사용자별 조직 제어
*******************************************************************************/
function f_setOrgInfo()
{
	// 소속 대리점이 있는 경우 대리점 선택 비활성화
	if(!uf_IsNull(FV_POS_AGENCY_ID))
	{
		div_search.edt_AgencyCd.value = FV_POS_AGENCY_ID;
		div_search.edt_AgencyNm.value = FV_POS_AGENCY_NM;
		div_search.edt_AgencyNm.Enable = false;
		div_search.btn_AgencyId.Enable = false;
	}	
	else
	{
		div_search.edt_AgencyNm.Enable = true;	
		div_search.btn_AgencyId.Enable = true;
	}	
}


/*******************************************************************************
 * @description    : 콜백
 * @param sSvcID   : 서비스 아이디
*******************************************************************************/
function f_callBack(sSvcID)
{	
	if(sSvcID == "svcList")
	{		
		return;
	}	

	if(sSvcID == "svcSave")
	{
		return;
	}	
	
	if(sSvcID == "svcDisProdInfo"){
		
		if (ds_DisProdInfo.RowCount() > 1)
		{
			// 일련번호선택 화면 팝업
			var sArg  = "";	
				
			Dialog("DIS::DISDCO00800.xml", sArg, 490, 148);
			
		}else{
			FV_DIS_PROD_CURR_ROW_INDEX = 0;
		}
				
		ds_list.SetColumn(FV_PROD_CD_CURR_ROW,"PROD_CD",ds_DisProdInfo.GetColumn(FV_DIS_PROD_CURR_ROW_INDEX, "prod_cd"));
		ds_list.SetColumn(FV_PROD_CD_CURR_ROW,"PROD_NM",ds_DisProdInfo.GetColumn(FV_DIS_PROD_CURR_ROW_INDEX, "prod_nm"));
		
		return;
	}
}

/*******************************************************************************
 * @description    : 대리점 click 이벤트
*******************************************************************************/
function div_search_btn_AgencyId_OnClick(obj)
{
	// org_id 와 org_cl 의 파라메터는 필수 입니다.
	var sArg  = "org_id=" + FV_ORG_ID; // 필수
		//sArg += " eff_dtm="+quote(div_search.cal_ToSaleDt.Value);

	cf_callAgencyPop(sArg, div_search, "edt_AgencyNm,edt_AgencyCd,edt_agencyUkeyCd");
}

/*******************************************************************************
 * @description    : 대리점 OnKeyDown 이벤트
*******************************************************************************/
function div_search_edt_AgencyNm_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
{
	if(nChar == "13"){
		// org_id 와 org_cl 의 파라메터는 필수 입니다.
		var sArg  = "org_id=" + FV_ORG_ID; // 필수
		    //sArg += " eff_dtm="+quote(div_search.cal_ToSaleDt.Value);
	
		cf_callAgencyPop(sArg, div_search, "edt_AgencyNm,edt_AgencyCd,edt_agencyUkeyCd");
		
	} 	
}

/*******************************************************************************
 * @description    : 대리점 OnCharChanged 이벤트
*******************************************************************************/
function div_search_edt_AgencyNm_OnCharChanged(obj,strPreText,strPostText)
{
	if (strPreText != strPostText)
	{
		div_search.edt_AgencyCd.value = "";
	}
}

/*******************************************************************************
 * @description    : 판매처 OnClick 이벤트
*******************************************************************************/
function div_search_btn_SalePlcId_OnClick(obj)
{	
	if (uf_IsNull(div_search.edt_AgencyCd.Value))
	{
		alert(cf_getMessage(MSG_00083, "대리점"));
		return;
	}

	var sArg  = "deal_co_cl1=" + quote("A2,A3,B1,B2,C1,Z1,C1");
		sArg += " pos_agency=" + div_search.edt_AgencyCd.Value; 
		//sArg += " eff_dtm="+quote(div_search.cal_ToSaleDt.Value);

	cf_callDealPop(sArg, div_search, "edt_SalePlcNm,edt_SalePlcId",0,"Y");
}

/*******************************************************************************
 * @description    : 판매처 OnKeyDown 이벤트
*******************************************************************************/
function div_search_edt_SalePlcNm_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
{
	if (nChar == 13)
	{
		if (uf_IsNull(div_search.edt_AgencyCd.Value))
		{
			alert(cf_getMessage(MSG_00083, "대리점"));
			return;
		}
		
		var sArg  = "deal_co_cl1=" + quote("A2,A3,B1,B2,C1,Z1,C1");
			sArg += " pos_agency=" + div_search.edt_AgencyCd.Value; 
		    //sArg += " eff_dtm="+quote(div_search.cal_ToSaleDt.Value);
	
		cf_callDealPop(sArg, div_search, "edt_SalePlcNm,edt_SalePlcId",0,"Y");
	}	
}

/*******************************************************************************
 * @description    : 판매처 OnKeyDown 이벤트
*******************************************************************************/
function div_search_edt_SalePlcNm_OnCharChanged(obj,strPreText,strPostText)
{
	if (strPreText != strPostText)
	{
		div_search.edt_SalePlcId.value = "";
	}	
}

/*******************************************************************************
 * @description    : 조회버튼 click 이벤트
*******************************************************************************/
function div_search_btn_search_OnClick(obj)
{
	// 조회조건 유효성 검사
	if (f_checkCondition())
	{
		// 중고반납기기 관리 내역 조회
		f_getOldRtnList();	
	}		
}

/*******************************************************************************
 * @description    : 유효성 체크
*******************************************************************************/
function f_checkCondition()
{
	/*
    if(Length(div_search.cal_FromSaleDt.Value) < 1)
    {
		alert(cf_getMessage(MSG_00083, "시작 판매일자"));
        div_search.cal_FromSaleDt.SetFocus();
        return false;
    }
    
    if(Length(div_search.cal_ToSaleDt.Value) < 1)
    {
		alert(cf_getMessage(MSG_00083, "종료 판매일자"));
        div_search.cal_ToSaleDt.SetFocus();
        return false;
    }
    */
    
    if (div_search.cal_FromSaleDt.Value > div_search.cal_ToSaleDt.Value)
    {
        alert(cf_getMessage(MSG_00096, "시작 판매일자;종료 판매일자"));
        div_search.cal_FromSaleDt.SetFocus();
        return false;    
    }
    
    if (uf_IsNull(div_search.edt_AgencyCd.Value))
    {
		alert(cf_getMessage(MSG_00083, "대리점"));
		return false;
    }
    
    /*
    if (uf_IsNull(div_search.edt_SalePlcId.Value))
    {
		alert(cf_getMessage(MSG_00083, "판매처"));
		return false;
    }
    */
    
       
    return true;	
}

/*******************************************************************************
 * @description    : 중고반납기기내역 조회
*******************************************************************************/
function f_getOldRtnList()
{
	// 입력 파라메터 설정
	cf_setParam(ds_condition, "from_sale_dt", div_search.cal_fromSaleDt.Value);  	// 시작 판매일자
	cf_setParam(ds_condition, "to_sale_dt", div_search.cal_ToSaleDt.Value);  		// 종료 판매일자
	cf_setParam(ds_condition, "pos_agency", div_search.edt_AgencyCd.Value);  		// 소속대리점
	cf_setParam(ds_condition, "sale_plc_id", div_search.edt_SalePlcId.Value);		// 판매처
	cf_setParam(ds_condition, "cust_rtn_yn", div_search.cmb_CustRtnYn.Value);		// 반납여부
	cf_setParam(ds_condition, "comm_co_rtn_typ", div_search.cmb_CommRtnTyp.Value);	// 중고반납유형
	cf_setParam(ds_condition, "prod_cd", div_search.edt_ProdCd.Value);		// 상품코드
	cf_setParam(ds_condition, "ser_num", div_search.edt_SerNum.Value);		// 일련번호
	
    // 출력 Dataset 초기화
    ds_list.ClearData();
    
	// 트랜잭션 설정
	var sSvcID = "svcOldRtnList";
	var sInDs = "nc_input_fieldDs=ds_condition";
	var sOutDs = "ds_list=rs_list";
	var sArg = "sktst.dis.UER#getOldRtnProdList";
	
	// 공통 트랜잭션 호출
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg, null, true, true);
}

/*******************************************************************************
 * @description    : 저장버튼 click 이벤트
*******************************************************************************/
function btn_save_OnClick(obj)
{
	//저장 전 변경자료여부 확인
	if(ds_list.GetUpdate() == 0){
		alert(cf_getMessage(MSG_00071,"")); // 처리할 대상이 없습니다
		return;
	}
	
	if(ds_list.GetRowCount() >0){
	
		var dupCnt = 0;
		
		for(var i=0;i<ds_list.rowcount;i++){
			
			var sArrProdCd = ds_list.GetColumn(i,"PROD_CD");
			var sArrSerNum = ds_list.GetColumn(i,"SER_NUM");
			
			/*
			if(ds_list.GetColumn(i,"OLD_RTN_PLC_ID") == null){
				alert((i+1)+"열의 반납처를 선택해주십시오.");
				uf_SelPos(grd_list,i,3);
				return;
			}
			*/
			
			if(ds_list.GetColumn(i,"ERR_FLAG") == "S"){
				alert((i+1)+"열의 오류사항을 확인하십시오.");
				return;
			}
			
			
			if(ds_list.GetColumn(i,"SALE_PLC_ID") == null){
				alert((i+1)+"열의 판매처를 선택해주십시오.");
				uf_SelPos(grd_list,i,2);
				return;
			}
			
			/*
			if(ds_list.GetColumn(i,"OLD_RTN_PLC_ID") == null){
				alert((i+1)+"열의 반납처를 선택해주십시오.");
				uf_SelPos(grd_list,i,3);
				return;
			}
			
			if(ds_list.GetColumn(i,"COMM_CO_RTN_TYP") == null){
				alert((i+1)+"열의 반납 유형을 선택해주십시오.");
				uf_SelPos(grd_list,i,4);
				return;
			}
			*/
			
			if(ds_list.GetColumn(i,"SALE_DT") == null){
				alert((i+1)+"열의 판매일을 선택해주십시오.");
				uf_SelPos(grd_list,i,5);
				return;
			}
			
			if(ds_list.GetColumn(i,"PROD_CD") == null){
				alert((i+1)+"열의 상품을 선택해주십시오.");
				uf_SelPos(grd_list,i,7);
				return;
			}
			
			if(lengthb(ds_list.GetColumn(i,"SER_NUM")) !=7 ){
				alert((i+1)+"열의 일련번호를 7자로 입력해주십시오.");
				uf_SelPos(grd_list,i,6);
				return;			
			}
			
			
			dupCnt = ds_list.CaseCount("PROD_CD==" + quote(sArrProdCd) +" && SER_NUM==" + quote(sArrSerNum));
			
			if(dupCnt > 1){
				alert("중복된 상품코드와 일련번호가 있습니다. ");
				return;
			}
		}
	}	
	
	// 트랜잭션 설정
	if(Confirm("저장하시겠습니까?") == true) {
	
		var sSvcID = "svcSave";
		var sInDs = "ds_list=ds_list:U";
		var sOutDs = "";
		var sArg = "sktst.dis.UER#saveOldRtnProdList";
		
		// 공통 트랜잭션 호출
		cf_Transaction(sSvcID, sInDs, sOutDs, sArg, null, true, true);	
	}
}

/*******************************************************************************
 * @description    : 엑셀 다운로드
*******************************************************************************/
function div_page_btn_excelDown_OnClick(obj)
{
	cf_exportExcel(grd_list, 1);
}

/*******************************************************************************
 * @description    : 그리드 추가
*******************************************************************************/
function btn_addRow_OnClick(obj)
{

	if(uf_IsNull(div_search.edt_AgencyCd.Value))
    {
        alert(cf_getMessage(MSG_00083, "대리점"));
        div_search.edt_AgencyCd.SetFocus();
        return false;
    }

	/*
	if(uf_IsNull(div_search.edt_SalePlcId.Value))
    {
        alert(cf_getMessage(MSG_00083, "판매처"));
        div_search.edt_SalePlcId.SetFocus();
        return false;
    }
    */

	var nRow = ds_list.AddRow();
	
	ds_list.SetColumn(nRow,"org_cd",div_search.edt_AgencyCd.Value);
	ds_list.SetColumn(nRow,"org_nm",div_search.edt_AgencyNm.Text);
	//ds_list.SetColumn(nRow,"sale_plc_id",div_search.edt_SalePlcId.Value);
	//ds_list.SetColumn(nRow,"sale_plc_nm",div_search.edt_SalePlcNm.Text);
	
	grd_list.SetFocus();
    grd_list.SetCellPos(1);

}


/*******************************************************************************
 * @description    : 상품 검색, 반납처 검색 팝업
*******************************************************************************/
function grd_list_OnExpandUp(obj,nRow,nCell,strVal,nPivotIndex)
{
	if(nCell == 2){
		
		var sArg  = "deal_co_cl1=" + quote("A2,A3,B1,B2,C1,Z1,C1");
		sArg += " pos_agency=" + div_search.edt_AgencyCd.Value; 
		//sArg += " eff_dtm="+quote(div_search.cal_ToSaleDt.Value);

		cf_callDealPop(sArg, ds_list, "sale_plc_nm,sale_plc_id", nRow);
	}
	
	if(nCell == 3){
		
		var sArg  = "deal_co_cl1=" + quote("30");
		//sArg += " pos_agency=" + div_search.edt_AgencyCd.Value; 
		//sArg += " eff_dtm="+quote(div_search.cal_ToSaleDt.Value);

		cf_callDealPop(sArg, ds_list, "old_rtn_plc_nm,old_rtn_plc_id", nRow);
	}
	
	if(nCell == 5){
		cf_setGrdCalendar(obj,nRow,nCell,strVal,nPivotIndex);
	}
	
	if(nCell == 7){
		var sInRow = ds_ParentProd.AddRow(); 
		
		ds_ParentProd.SetColumn(sInRow,"prod_cd",ds_list.GetColumn(nRow, "prod_cd"));
		ds_ParentProd.SetColumn(sInRow,"prod_nm",ds_list.GetColumn(nRow, "prod_nm"));
		
		cf_commPopProdDs("ds_ParentProd", sInRow);
				
		ds_list.SetColumn(nRow, "prod_cd", ds_ParentProd.GetColumn(sInRow, "prod_cd"));
		ds_list.SetColumn(nRow, "prod_nm", ds_ParentProd.GetColumn(sInRow, "prod_nm"));
		
		ds_ParentProd.ClearData();
	
	}
}


/*******************************************************************************
 * @description    : 
*******************************************************************************/
function grd_list_OnEnterDown(obj,nRow,nCell,strVal,nPivotIndex)
{
	if(nCell == 6){
	
	if(lengthb(ds_list.GetColumn(nRow,"SER_NUM")) !=7){
		alert("일련번호를 7자로 입력해주십시오.");
		return;
	}
		
	ds_childPop.ClearData();

	// 입력 파라메터 설정
	cf_setParam(ds_childPop, "ser_num", ds_list.GetColumn(nRow,"SER_NUM"));  	
	cf_setParam(ds_childPop, "pos_agency", FV_POS_AGENCY_ID);  //  소속대리점	
	// 로그인한 사용자의 소속매장이 직영점, 판매점인 경우 
	/*
	if(FV_POS_AGENCY_ID != FV_ORG_AREA_ID)
	{
		if (FV_ORG_AREA_CL1 == "A3" || FV_ORG_AREA_CL1 == "B2") // 판매점, 온라인판매점
		{
			cf_setParam(ds_childPop, "pos_agency", FV_POS_AGENCY_ID);  //  소속대리점	
		}
	}	
	*/
	
	FV_PROD_CD_CURR_ROW = nRow;
	
	// 출력 Dataset 초기화
	ds_DisProdInfo.ClearData();
	
	// 트랜잭션 설정
	var sSvcID = "svcDisProdInfo";
	var sInDs = "nc_input_fieldDs=ds_childPop";
	var sOutDs = "ds_DisProdInfo=rs_DisProdInfo";
	var sArg = "sktst.dis.UER#getProdInfoBySerNum";
	
	// 공통 트랜잭션 호출
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);	
	}
}


function Button0_OnClick(obj)
{
	cf_debug("ds_tempList");
}

function btn_delRow_OnClick(obj)
{
	if(ds_list.GetRowType(ds_list.currow) != 'insert'){
		alert(cf_getMessage(MSG_00022,"데이터는")); //  데이터 삭제는 불가능
		return;
	}
	
	ds_list.DeleteRow(ds_list.currow);
}




/*******************************************************************************
* 함수명 : btn_upload_OnClick
* 기능명 :  엑셀 inport
*******************************************************************************/
function btn_upload_OnClick(obj)
{
	if (lengthb(ds_code.GetColumn(0,"POS_AGENCY")) != 5)
    {
		alert(cf_getMessage(MSG_00083, "대리점"));
		return false;
    }
    
    if (ds_list.rowcount > 0){
	   if(!Confirm("입력된 데이터가 있습니다. 데이터를 삭제 하시겠습니까?"))
	   return false;
	}

	ds_tempExcelList.clearData();
	ds_list.ClearData();
	
	grd_list.Redraw = false;
	
	var dupCnt = 0;
	
	ds_tempExcelList.clearData();
		
	f_importExcel("ds_tempExcelList");
	
	ds_tempExcelList.Filter("PROD_CD != null && SER_NUM != null");
	
	ds_tempExcelList.DeleteRow(0); //엑셀의 헤드첫행 삭제
	
	var sConAgencyCd = div_search.edt_AgencyCd.Value;
	var sConAgencyUkeyCd = div_search.edt_AgencyUkeyCd.Value;
	var sConAgencyNm = div_search.edt_AgencyNm.Value;
	
	if(ds_tempExcelList.rowcount > 0) {
				
		for(var nRow= ds_tempExcelList.rowCount-1; nRow>=0; nRow--) {	
			
			var sProdCd = ds_tempExcelList.GetColumn(nRow,"PROD_CD"); 
			var sSerNum = ds_tempExcelList.GetColumn(nRow,"SER_NUM"); 
			var sCommCdRtnTyp  =substr(ds_tempExcelList.GetColumn(nRow,"COMM_CO_RTN_TYP"),0,1);
			
			dupCnt = ds_tempExcelList.CaseCount("PROD_CD==" + quote(sProdCd) +" && SER_NUM==" + quote(sSerNum));			
			
			
			ds_list.AddRow();
			ds_list.CopyRow(ds_list.lastrow,"ds_tempExcelList",nRow);
			
			ds_list.SetColumn(ds_list.lastrow,"COMM_CO_RTN_TYP",substr(ds_tempExcelList.GetColumn(nRow,"COMM_CO_RTN_TYP"),0,1));
			ds_list.SetColumn(ds_list.lastrow,"ORG_CD",div_search.edt_AgencyCd.Value);
			ds_list.SetColumn(ds_list.lastrow,"ORG_NM",div_search.edt_AgencyNm.Text);
			
			ds_list.SetColumn(ds_list.lastrow,"SALE_PLC_ID",ds_tempList.GetColumn(ds_tempList.FindRow("PCODE", ds_tempExcelList.GetColumn(nRow,"SALE_PLC_ID")),"DEAL_CO_CD"));
			ds_list.SetColumn(ds_list.lastrow,"SALE_PLC_NM",ds_tempList.GetColumn(ds_tempList.FindRow("PCODE", ds_tempExcelList.GetColumn(nRow,"SALE_PLC_ID")),"DEAL_CO_NM"));
			
			if(substr(ds_tempExcelList.GetColumn(nRow,"CUST_RTN_YN"),0,1) == "Y"){
				ds_list.SetColumn(ds_list.lastrow,"CUST_RTN_YN", "1");
			}else{
				ds_list.SetColumn(ds_list.lastrow,"CUST_RTN_YN", "0" );
			}
			
			if(substr(ds_tempExcelList.GetColumn(nRow,"DEL_YN"),0,1) == "Y"){
				ds_list.SetColumn(ds_list.lastrow,"DEL_YN", "1" );
			}else{
				ds_list.SetColumn(ds_list.lastrow,"DEL_YN","0" );
			}
				
			if(dupCnt >1 ){
				ds_list.SetColumn(ds_list.lastrow,"ERR_FLAG","S");				
				ds_list.SetColumn(ds_list.lastrow,"RMKS","중복된 상품코드와 일련번호입니다.");
			}else{
				
				//(판매처, 반납일 등을 포함한) 필수 항목 체크 
				if(lengthb(ds_tempExcelList.GetColumn(nRow,"ORG_CD")) == 0){
					ds_list.SetColumn(ds_list.lastrow,"ERR_FLAG","S");				
					ds_list.SetColumn(ds_list.lastrow,"RMKS","대리점 코드를 확인하십시오.");
				}
				
				if((ds_tempExcelList.GetColumn(nRow,"ORG_CD") != sConAgencyCd) && (ds_tempExcelList.GetColumn(nRow,"ORG_CD") != sConAgencyUkeyCd)){
					
					ds_list.SetColumn(ds_list.lastrow,"ERR_FLAG","S");				
					ds_list.SetColumn(ds_list.lastrow,"RMKS","유효한 "+ sConAgencyNm +" 코드를 확인하십시오.");
				}
				
				if(lengthb(ds_list.GetColumn(ds_list.lastrow,"SALE_PLC_ID")) != 5){
					ds_list.SetColumn(ds_list.lastrow,"ERR_FLAG","S");				
					ds_list.SetColumn(ds_list.lastrow,"RMKS","유효한 "+ sConAgencyNm +" 판매처 코드를 입력하십시오.");
				}

				/*
				if(lengthb(ds_tempExcelList.GetColumn(nRow,"OLD_RTN_PLC_ID")) != 5){
					ds_list.SetColumn(ds_list.lastrow,"ERR_FLAG","S");				
					ds_list.SetColumn(ds_list.lastrow,"RMKS","유효한 반납처 코드를 입력하십시오.");
				}
				
				if(ds_tempExcelList.GetColumn(nRow,"COMM_CO_RTN_TYP") == null){
					ds_list.SetColumn(ds_list.lastrow,"ERR_FLAG","S");				
					ds_list.SetColumn(ds_list.lastrow,"RMKS","반납 유형을 선택해주십시오.");
				}
				*/
				
				if(lengthb(ds_tempExcelList.GetColumn(nRow,"SALE_DT")) == 0){
					ds_list.SetColumn(ds_list.lastrow,"ERR_FLAG","S");				
					ds_list.SetColumn(ds_list.lastrow,"RMKS","판매일을 입력해주십시오.");
				}
				
				//(판매처, 판매일 등을 포함한) 필수 항목 체크 끝
				
				
				if(lengthb(sSerNum) != 7){
					ds_list.SetColumn(ds_list.lastrow,"ERR_FLAG","S");				
					ds_list.SetColumn(ds_list.lastrow,"RMKS","단말기 일련번호를 7 Byte로 입력하십시오.");
				}
				
				if(lengthb(ds_tempExcelList.GetColumn(nRow,"SALE_DT")) != 0 && lengthb(ds_tempExcelList.GetColumn(nRow,"SALE_DT")) != 8){
					ds_list.SetColumn(ds_list.lastrow,"ERR_FLAG","S");				
					ds_list.SetColumn(ds_list.lastrow,"RMKS","반납일을 'YYYYMMDD' 형으로 입력하십시오.");
				}
				
				if(sCommCdRtnTyp != "" && sCommCdRtnTyp != "1" && sCommCdRtnTyp != "2" && sCommCdRtnTyp != "3"){
					ds_list.SetColumn(ds_list.lastrow,"ERR_FLAG","S");				
					ds_list.SetColumn(ds_list.lastrow,"RMKS","반납유형을 고객반납, 고객미반납, 분실 중에서 선택하십시오.");
				}
				
				if(lengthb(ds_tempExcelList.GetColumn(nRow,"RMKS")) > 100){
					ds_list.SetColumn(ds_list.lastrow,"ERR_FLAG","S");				
					ds_list.SetColumn(ds_list.lastrow,"RMKS","비고를 100 Byte 이내로 입력하십시오.");
				}
			}		
		}		
	}
	
    ds_tempExcelList.UnFilter();
	
	grd_list.Format = "Default";
		
	ds_list.Sort("SALE_PLC_NM");
	
	grd_list.Redraw = true;
	
}



/*******************************************************************************
 * @description             : 엑셀 파일을 읽어 지정하는 데이타셋에 로드
 * @param sDsName   		: 데이타셋 아이디
		  nUseDsInfo   		: 데이타셋 칼럼 정보 사용 유무 - 1: 사용, 0: 무시
		  nStartIndex   	: 엑셀을 읽을 시작 행 위치
 * @return	                : 선택한 엑셀파일의 풀패스 
 * @etc                     : DS 칼럼 정보 사용시 엑셀의 셀 순서와 DS 칼럼 순서가 같아야 함!
*******************************************************************************/
function f_importExcel(sDsName, nUseDsInfo, nStartIndex, nSheetIndex)
{
	fld_excel.Type = "OPEN";
	var bResult = fld_excel.Open();
	
	if ( bResult )
	{
		var sFullPath = fld_excel.FilePath + '\\' + fld_excel.FileName;

		if(nUseDsInfo == null)
		{
			nUseDsInfo = 1;
		}
		
		if(nStartIndex == null)
		{
			nStartIndex = 1;
		}
		
		if(nSheetIndex == null)
		{
			nSheetIndex = 0;
		}

		var nResult = ext_ExcelImportByIndex(sFullPath, nSheetIndex, sDsName, nUseDsInfo, 0, 0, nStartIndex);
	
						
		if (ds_tempExcelList.count == 0){
			alert("업로드할 자료가 없습니다.");
			return false;
		}	
		
		if(nResult == 0)
		{
			return sFullPath;
		}
		
	}
	
}


function ds_list_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
	if(strColumnID == "comm_co_rtn_typ"){
		
		if(ds_list.GetColumn(nRow, "ERR_FLAG") == "S"){
			
			if(varNewValue == "1" || varNewValue == "2"  || varNewValue == "3"  ){
				ds_list.SetColumn(nRow, "ERR_FLAG","");
				ds_list.SetColumn(nRow, "RMKS","");
			}
		}
	}
	
	
	if(strColumnID == "ser_num"){
				
		if(ds_list.GetColumn(nRow, "ERR_FLAG") == "S"){
			
			var dupCnt = 0 ;
			var sInProdCd = ds_list.GetColumn(nRow, "PROD_CD");
			
			if(lengthb(varNewValue) != 0 && lengthb(varNewValue) == 7){
			
				dupCnt = ds_list.CaseCount("PROD_CD==" + quote(sInProdCd) +" && SER_NUM==" + quote(varNewValue));
				
				if(dupCnt < 1){
					ds_list.SetColumn(nRow, "ERR_FLAG","");
					ds_list.SetColumn(nRow, "RMKS","");
				}else{
					ds_list.SetColumn(nRow, "RMKS","중복된 일련번호입니다.");
				}
			}
		}
	}
	
	
	if(strColumnID == "org_cd"){
		if(ds_list.GetColumn(nRow, "ERR_FLAG") == "S"){
	
			if(lengthb(varNewValue) != 0 && lengthb(varNewValue) == 5){
				ds_list.SetColumn(nRow, "ERR_FLAG","");
				ds_list.SetColumn(nRow, "RMKS","");
			}
		}
	}
	
	
	if(strColumnID == "sale_plc_id"){
		if(ds_list.GetColumn(nRow, "ERR_FLAG") == "S"){
	
			if(lengthb(varNewValue) != 0 && lengthb(varNewValue) == 5){
				ds_list.SetColumn(nRow, "ERR_FLAG","");
				ds_list.SetColumn(nRow, "RMKS","");
			}
		}
	}
	
	if(strColumnID == "old_rtn_plc_id"){
		if(ds_list.GetColumn(nRow, "ERR_FLAG") == "S"){
	
			if(lengthb(varNewValue) != 0 && lengthb(varNewValue) == 5){
				ds_list.SetColumn(nRow, "ERR_FLAG","");
				ds_list.SetColumn(nRow, "RMKS","");
			}
		}
	}
	
	
	if(strColumnID == "sale_dt"){
		if(ds_list.GetColumn(nRow, "ERR_FLAG") == "S"){
	
			if(lengthb(varNewValue) != 0 && lengthb(varNewValue) == 8){
				ds_list.SetColumn(nRow, "ERR_FLAG","");
				ds_list.SetColumn(nRow, "RMKS","");
			}
		}
	}
	
}



/*******************************************************************************
 * @description    : 재고세부내역 OnCharChanged 이벤트
*******************************************************************************/
function div_search_edt_ProdCd_OnCharChanged(obj,strPreText,strPostText)
{
	if (strPreText != strPostText)
	{
		div_search.edt_ProdNm.value = "";
	}		
}


/*******************************************************************************
 * @description    : 모델 OnKeyDown 이벤트
*******************************************************************************/
function div_search_edt_ProdCd_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
{
	if (nChar == 13)
	{
		cf_commPopProd("div_search.edt_ProdCd", "div_search.edt_ProdNm", nChar);
	}			
}


/*******************************************************************************
 * @description    : 모델 click 이벤트
*******************************************************************************/
function div_search_btn_ProdCd_OnClick(obj)
{
	cf_commPopProd("div_search.edt_ProdCd", "div_search.edt_ProdNm", 13);
}



function ds_code_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
	if(strColumnID == "pos_agency"){
		
		if(varNewValue.length ==5){
			
			f_searchDealCode();
			
		}
	}
}




function f_searchDealCode()
{
	// 입력 파라메터 설정
	cf_setParam(ds_conTemp, "pos_agency", div_search.edt_AgencyCd.Value);  	//대리점코드
	
    // 출력 Dataset 초기화
    ds_tempList.ClearData();
    
	// 트랜잭션 설정
	var sSvcID = "svcOldRtnList";
	var sInDs = "nc_input_fieldDs=ds_conTemp";
	var sOutDs = "ds_tempList=rs_tempList";
	var sArg = "sktst.dis.UER#getPCodeMgmt";
	
	// 공통 트랜잭션 호출
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}


function Button1_OnClick(obj)
{
	cf_debug("ds_list");
}

function Button2_OnClick(obj)
{
	cf_debug("ds_tempExcelList");
}

]]></Script>
</Window>