<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="600" Id="form" Left="8" OnLoadCompleted="form_OnLoadCompleted" PidAttrib="7" Title="출고예정등록" Top="8" Ver="1.0" Width="830" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_outClList"></Dataset>
			<Dataset CanColumnChange="ds_outMaster_CanColumnChange" DataSetType="Dataset" Id="ds_outMaster">
				<Contents>
					<colinfo id="out_mgmt_no" size="256" summ="default" type="STRING"/>
					<colinfo id="gnrl_sale_no" size="256" summ="default" type="STRING"/>
					<colinfo id="gnrl_sale_chg_seq" size="256" summ="default" type="STRING"/>
					<colinfo id="out_cl" size="256" summ="default" type="STRING"/>
					<colinfo id="out_schd_dt" size="256" summ="default" type="STRING"/>
					<colinfo id="out_plc_id" size="256" summ="default" type="STRING"/>
					<colinfo id="out_plc_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="in_plc_id" size="256" summ="default" type="STRING"/>
					<colinfo id="in_plc_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="out_fix_dt" size="256" summ="default" type="STRING"/>
					<colinfo id="out_fix_yn" size="256" summ="default" type="STRING"/>
					<colinfo id="rmks" size="256" summ="default" type="STRING"/>
					<colinfo id="pos_agency_id" size="256" summ="default" type="STRING"/>
					<colinfo id="pos_agency_ukey_id" size="256" summ="default" type="STRING"/>
					<colinfo id="pos_agency_nm" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_outDtlList">
				<Contents>
					<colinfo id="out_mgmt_no" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="color_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="color_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_cl" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_cl_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="mfact_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="mfact_id" size="256" summ="default" type="STRING"/>
					<colinfo id="out_qty" size="256" summ="default" type="STRING"/>
					<colinfo id="unit_prc" size="256" summ="default" type="STRING"/>
					<colinfo id="amt" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_prodSerNumList">
				<Contents>
					<colinfo id="prod_cl" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_cl_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="mfact_id" size="256" summ="default" type="STRING"/>
					<colinfo id="mfact_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_cd_org" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="color_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="color_cd_org" size="256" summ="default" type="STRING"/>
					<colinfo id="color_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="out_seq" size="256" summ="default" type="STRING"/>
					<colinfo id="bad_yn" size="256" summ="default" type="STRING"/>
					<colinfo id="dis_st" size="256" summ="default" type="STRING"/>
					<colinfo id="out_qty" size="256" summ="default" type="STRING"/>
					<colinfo id="out_qty_org" size="256" summ="default" type="STRING"/>
					<colinfo id="ser_num" size="256" summ="default" type="STRING"/>
					<colinfo id="chk" size="256" summ="default" type="STRING"/>
					<colinfo id="fix_yn" size="256" summ="default" type="STRING"/>
					<colinfo id="unit_prc" size="256" summ="default" type="STRING"/>
					<colinfo id="amt" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_cd_color_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="upd_cnt" size="256" summ="default" type="STRING"/>
					<colinfo id="mod_dtm" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_prodGrpList">
				<Contents>
					<colinfo id="prod_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_cnt" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_cl" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_cl_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="color_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="color_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="mfact_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="unit_prc" size="256" summ="default" type="STRING"/>
					<colinfo id="amt" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_newRow">
				<Contents>
					<colinfo id="prod_cl" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_cl_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="color_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="color_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="ord_qty" size="256" summ="default" type="STRING"/>
					<colinfo id="out_qty" size="256" summ="default" type="STRING"/>
					<colinfo id="mfact_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="unit_prc" size="256" summ="default" type="STRING"/>
					<colinfo id="amt" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_prodSerNumGrpList"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_condition"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_prodInoutIf"></Dataset>
		</Datasets>
		<Div Border="Raised" Height="63" Id="div_process" Left="10" Style="sty_div_input" TabOrder="1" Text="Div0" Top="10" Width="810">
			<Contents>
				<Edit BindDataset="ds_outMaster" Border="Flat" Column="in_plc_nm" Height="20" Id="edt_inPlcNm" Left="648" LeftMargin="2" OnCharChanged="div_process_edt_inPlcNm_OnCharChanged" OnKeyDown="div_process_edt_inPlcNm_OnKeyDown" RightMargin="2" Style="sty_ipt_form" TabOrder="7" Top="7" Width="130"></Edit>
				<Edit BindDataset="ds_outMaster" Border="Flat" Column="out_plc_nm" Height="20" Id="edt_outPlcNm" Left="365" LeftMargin="2" OnCharChanged="div_process_edt_outPlcNm_OnCharChanged" OnKeyDown="div_process_edt_outPlcNm_OnKeyDown" RightMargin="2" Style="sty_ipt_form" TabOrder="5" Top="30" Width="130"></Edit>
				<Static Align="Right" Height="20" Id="Static5" Left="300" Style="sty_lb_Basic" TabOrder="19" Text="대리점" Top="7" VAlign="Middle" Width="60"></Static>
				<Calendar BindDataset="ds_outMaster" Border="Flat" ButtonImageID="btn_i_calendar" Column="out_schd_dt" DayFont="Default,-1" HeaderBorder="NONE" HeaderFont="Default,-1" HeadStyle="sty_calendar_head" Height="20" Id="cal_outSchdDt" Left="107" LeftMargin="2" MonthPopupBorder="RAISED" NullValue="&#32;" OnChanged="div_process_cal_outSchdDt_OnChanged" RightMargin="2" SaturdayTextColor="user28" Style="sty_calendar" SundayTextColor="user27" TabOrder="1" TodayColor="user26" Top="7" WeeksFont="Default,-1" WeekStyle="sty_calendar_week" Width="121"></Calendar>
				<Static Align="Right" Height="20" Id="Static3" Left="35" Style="sty_lb_Basic" TabOrder="9" Text="출고예정일" Top="7" VAlign="Middle" Width="68"></Static>
				<Static Align="Right" Height="20" Id="Static6" Left="43" Style="sty_lb_Basic" TabOrder="10" Text="출고구분" Top="30" VAlign="Middle" Width="60"></Static>
				<Combo BindDataset="ds_outMaster" Border="Flat" CodeColumn="comm_cd_val" Column="out_cl" DataColumn="comm_cd_val_nm" Height="20" Id="cmb_outCl" InnerDataset="ds_outClList" Left="106" OnChanged="div_process_cmb_outCl_OnChanged" Style="sty_ipt_form" TabOrder="2" Top="29" Width="123"></Combo>
				<Image Height="21" Id="Image0" ImageID="bul_mand" Left="40" TabOrder="11" Top="30" Transparent="TRUE" Width="20"></Image>
				<Image Height="21" Id="Image3" ImageID="bul_mand" Left="27" TabOrder="12" Top="7" Transparent="TRUE" Width="20"></Image>
				<Edit BindDataset="ds_outMaster" Border="Flat" Column="in_plc_id" Height="20" Id="edt_inPlcId" Left="797" LeftMargin="2" RightMargin="2" Style="sty_ipt_form" TabOrder="13" Top="7" Visible="FALSE" Width="10"></Edit>
				<Button Cursor="HAND" Height="21" Id="btn_in" ImageID="btn_i_detail" Left="777" OnClick="div_process_btn_in_OnClick" TabOrder="8" Text="Button0" Top="7" Width="19"></Button>
				<Static Align="Right" Height="20" Id="Static4" Left="584" Style="sty_lb_Basic" TabOrder="14" Text="반품처" Top="7" VAlign="Middle" Width="60"></Static>
				<Edit BindDataset="ds_outMaster" Border="Flat" Column="out_plc_id" Height="20" Id="edt_outPlcId" Left="511" LeftMargin="2" RightMargin="2" Style="sty_ipt_form" TabOrder="15" Top="30" Visible="FALSE" Width="10"></Edit>
				<Image Height="21" Id="Image1" ImageID="bul_mand" Left="594" TabOrder="16" Top="7" Transparent="TRUE" Width="20"></Image>
				<Button Cursor="HAND" Height="21" Id="btn_out" ImageID="btn_i_detail" Left="492" OnClick="div_process_btn_out_OnClick" TabOrder="6" Text="Button0" Top="30" Width="19"></Button>
				<Static Align="Right" Height="20" Id="Static0" Left="301" Style="sty_lb_Basic" TabOrder="17" Text="출고처" Top="30" VAlign="Middle" Width="60"></Static>
				<Image Height="21" Id="Image2" ImageID="bul_mand" Left="311" TabOrder="18" Top="30" Transparent="TRUE" Width="20"></Image>
				<Image Height="21" Id="Image4" ImageID="bul_mand" Left="310" TabOrder="20" Top="7" Transparent="TRUE" Width="20"></Image>
				<Edit BindDataset="ds_outMaster" Border="Flat" Column="pos_agency_nm" Height="20" Id="edt_posAgencyNm" Left="365" LeftMargin="2" OnCharChanged="div_process_edt_posAgencyNm_OnCharChanged" OnKeyDown="div_process_edt_posAgencyNm_OnKeyDown" RightMargin="2" Style="sty_ipt_form" TabOrder="3" Top="7" UserData="대리점" Width="130"></Edit>
				<Button Cursor="HAND" Height="21" Id="btn_agency" ImageID="btn_i_detail" Left="492" OnClick="div_process_btn_agency_OnClick" TabOrder="4" Text="Button0" Top="7" Width="19"></Button>
				<Edit BindDataset="ds_outMaster" Border="Flat" Column="pos_agency_id" Height="20" Id="edt_posAgencyId" Left="511" LeftMargin="2" RightMargin="2" Style="sty_ipt_form" TabOrder="21" Top="7" Visible="FALSE" Width="10"></Edit>
			</Contents>
		</Div>
		<Div Height="21" Id="div_btn" Left="406" TabOrder="4" Text="Div2" Top="83" Width="230">
			<Contents>
				<Button Cursor="HAND" Height="21" Id="btn_excelDown" ImageID="btn_i_exceldown_w" Left="186" OnClick="div_btn_btn_excelDown_OnClick" TabOrder="1" Text="Button1" ToolTipText="Excel&#32;Download" Width="19"></Button>
				<Button Cursor="HAND" Height="21" Id="btn_delRow" ImageID="btn_i_subtract_w" Left="160" OnClick="div_btn_btn_delRow_OnClick" TabOrder="2" Text="Button1" ToolTipText="추가된&#32;행삭제" Width="19"></Button>
				<Button Cursor="HAND" Height="21" Id="btn_excelUp" ImageID="btn_i_excelup_w" Left="211" OnClick="div_btn_btn_excelUp_OnClick" TabOrder="3" Text="Button1" ToolTipText="Excel&#32;Upload" Width="19"></Button>
			</Contents>
		</Div>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" BindDataset="ds_outDtlList" BkColor2="user32" BoldHead="true" Border="Flat" Bottom="470" Editable="TRUE" Enable="true" EndLineColor="default" FillArea="TRUE" HeadBorder="Flat" HeadHeight="22" Height="362" Id="grd_outDtlList" InputPanel="FALSE" Left="10" LineColor="user33" MinWidth="100" OnCellDBLClick="grd_outDtlList_OnCellDblClick" OnChar="grd_outDtlList_OnChar" Right="820" RowHeight="21" Style="sty_Grid" TabOrder="2" TabStop="true" Top="108" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="user33" WheelScrollRow="1" Width="810">
			<contents>
				<format id="Default">
					<columns>
						<col width="41"/>
						<col width="94"/>
						<col width="148"/>
						<col width="144"/>
						<col width="117"/>
						<col width="63"/>
						<col width="97"/>
						<col width="101"/>
					</columns>
					<head>
						<cell bkcolor="user34" col="0" color="user35" cursor="hand" display="text" text="번호"/>
						<cell bkcolor="user34" col="1" color="user35" cursor="hand" display="text" text="상품구분"/>
						<cell bkcolor="user34" col="2" color="user35" cursor="hand" display="text" text="제조사"/>
						<cell bkcolor="user34" col="3" color="user35" cursor="hand" display="text" text="모델"/>
						<cell bkcolor="user34" col="4" color="user35" cursor="hand" display="text" text="색상"/>
						<cell bkcolor="user34" col="5" color="user35" cursor="hand" display="text" text="수량"/>
						<cell bkcolor="user34" col="6" color="user35" cursor="hand" display="text" text="단가"/>
						<cell bkcolor="user34" col="7" color="user35" cursor="hand" display="text" text="금액"/>
					</head>
					<body>
						<cell align="center" col="0" cursor="hand" display="text" expr="currow+1"/>
						<cell align="center" col="1" colid="prod_cl_nm" cursor="hand" display="text"/>
						<cell col="2" colid="mfact_nm" cursor="hand" display="text"/>
						<cell align="left" col="3" colid="prod_nm" cursor="hand" display="text"/>
						<cell align="left" col="4" colid="color_nm" cursor="hand" display="text"/>
						<cell align="right" col="5" colid="out_qty" cursor="hand" display="number" edit="expr:iif(ds_outMaster.GetColumn(0,&apos;out_fix_yn&apos;)==&apos;Y&apos;,&apos;none&apos;,iif(prod_cl==&apos;9&apos;,&apos;number&apos;,&apos;none&apos;))"/>
						<cell align="right" col="6" colid="unit_prc" cursor="hand" display="number" edit="expr:iif(ds_outMaster.GetColumn(0,&apos;out_fix_yn&apos;)==&apos;Y&apos;,&apos;none&apos;,&apos;number&apos;)"/>
						<cell align="right" col="7" colid="amt" cursor="hand" display="number"/>
					</body>
					<summary>
						<cell align="right" bkcolor="user37" col="0" color="user38" display="text"/>
						<cell align="right" bkcolor="user37" col="1" color="user38" display="text"/>
						<cell align="right" bkcolor="user37" col="2" color="user38" display="text"/>
						<cell align="right" bkcolor="user37" col="3" color="user38" display="text"/>
						<cell align="right" bkcolor="user37" col="4" color="user38" display="text" font="돋움,10,Bold" text="합계"/>
						<cell align="right" bkcolor="user37" col="5" color="user38" display="number" expr="sum(&apos;out_qty&apos;)"/>
						<cell align="right" bkcolor="user37" col="6" color="user38" display="number" expr="sum(&apos;unit_prc&apos;)"/>
						<cell align="right" bkcolor="user37" col="7" color="user38" display="number" expr="sum(&apos;amt&apos;)"/>
					</summary>
				</format>
			</contents>
		</Grid>
		<Div Border="Raised" Height="75" Id="div_bottomEdit" Left="10" Style="sty_div_input" TabOrder="3" Text="Div0" Top="480" Width="810">
			<Contents>
				<TextArea BindDataset="ds_outMaster" Border="Flat" Column="rmks" Height="55" Id="txa_rmks" Left="88" Style="sty_ipt_form" TabOrder="1" Top="7" VScroll="TRUE" Width="709"></TextArea>
				<Static Align="Right" Height="20" Id="Static8" Left="24" Style="sty_lb_Basic" TabOrder="2" Text="비고" Top="7" VAlign="Middle" Width="60"></Static>
			</Contents>
		</Div>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="21" Id="btn_prodAdd" ImageID="btn_b_4" Left="641" OnClick="btn_prodAdd_OnClick" Style="sty_btn_b" TabOrder="5" Text="상품입력" Top="83" Width="75"></Button>
		<Grid BindDataset="ds_prodSerNumList" BkColor2="default" BoldHead="true" Bottom="288" ColSizing="TRUE" Enable="true" EndLineColor="default" Height="112" Id="grd_prodSerNumList" InputPanel="FALSE" Left="836" LineColor="default" Right="1144" TabOrder="6" TabStop="true" Top="176" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="FALSE" VLineColor="default" WheelScrollRow="1" Width="308">
			<contents>
				<format id="Default">
					<columns>
						<col width="45"/>
						<col width="84"/>
						<col width="44"/>
						<col width="48"/>
						<col width="55"/>
						<col width="43"/>
						<col width="16"/>
					</columns>
					<head>
						<cell col="0" display="text"/>
						<cell col="1" display="text"/>
						<cell col="2" display="text"/>
						<cell col="3" display="text"/>
						<cell col="4" display="text"/>
						<cell col="5" display="text"/>
						<cell col="6" display="text"/>
					</head>
					<body>
						<cell col="0" colid="out_qty" display="text"/>
						<cell col="1" colid="mod_dtm" display="text"/>
						<cell col="2" colid="amt" display="text"/>
						<cell col="3" colid="prod_cd" display="text"/>
						<cell col="4" colid="unit_prc" display="text"/>
						<cell col="5" colid="upd_cnt" display="text"/>
						<cell col="6" colid="out_qty" display="text"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Grid BindDataset="ds_prodGrpList" BkColor2="default" BoldHead="true" Bottom="396" Enable="true" EndLineColor="default" Height="100" Id="grd_prodGrpList" InputPanel="FALSE" Left="836" LineColor="default" Right="1076" TabOrder="7" TabStop="true" Top="296" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="FALSE" VLineColor="default" WheelScrollRow="1" Width="240">
			<contents>
				<format id="Default">
					<columns>
						<col width="21"/>
						<col width="65"/>
						<col width="33"/>
						<col width="28"/>
						<col width="89"/>
					</columns>
					<head>
						<cell col="0" display="text"/>
						<cell col="1" display="text"/>
						<cell col="2" display="text"/>
						<cell col="3" display="text"/>
						<cell col="4" display="text"/>
					</head>
					<body>
						<cell col="0" colid="prod_cl" display="text"/>
						<cell col="1" colid="prod_cl_nm" display="text"/>
						<cell col="2" colid="color_cd" display="text"/>
						<cell col="3" colid="prod_cnt" display="text"/>
						<cell col="4" colid="mfact_nm" display="text"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Grid BindDataset="ds_newRow" BkColor2="default" BoldHead="true" Bottom="488" Enable="true" EndLineColor="default" Height="88" Id="Grid0" InputPanel="FALSE" Left="836" LineColor="default" Right="940" TabOrder="8" TabStop="true" Top="400" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="FALSE" VLineColor="default" WheelScrollRow="1" Width="104">
			<contents>
				<format id="Default">
					<columns>
						<col width="68"/>
						<col width="60"/>
						<col width="58"/>
						<col width="54"/>
						<col width="26"/>
					</columns>
					<head>
						<cell col="0" display="text"/>
						<cell col="1" display="text"/>
						<cell col="2" display="text"/>
						<cell col="3" display="text"/>
						<cell col="4" display="text"/>
					</head>
					<body>
						<cell col="0" colid="prod_cl_nm" display="text"/>
						<cell col="1" colid="mfact_nm" display="text"/>
						<cell col="2" colid="in_qty" display="text"/>
						<cell col="3" colid="ord_qty" display="text"/>
						<cell col="4" colid="prod_cl" display="text"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Button ButtonStyle="TRUE" Cursor="HAND" Height="21" Id="btn_ukeyAdd" ImageID="btn_b_6" Left="720" OnClick="btn_ukeyAdd_OnClick" Style="sty_btn_b" TabOrder="9" Text="Ukey&#32;상품입력" Top="83" Width="100"></Button>
		<Grid BindDataset="ds_prodInoutIf" BkColor2="default" BoldHead="true" Bottom="579" Enable="true" EndLineColor="default" Height="84" Id="Grid1" InputPanel="FALSE" Left="838" LineColor="default" Right="1014" TabOrder="10" TabStop="true" Top="495" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="FALSE" VLineColor="default" WheelScrollRow="1" Width="176">
			<contents>
				<format id="Default">
					<columns>
						<col width="80"/>
						<col width="80"/>
						<col width="80"/>
						<col width="80"/>
						<col width="80"/>
						<col width="80"/>
						<col width="80"/>
					</columns>
					<body>
						<cell col="0" colid="OP_DT" display="text"/>
						<cell col="1" colid="OP_TM" display="text"/>
						<cell col="2" colid="SEQ" display="text"/>
						<cell col="3" colid="rgst_seq" display="text"/>
						<cell col="4" colid="ser_num" display="text"/>
						<cell col="5" colid="prod_cd" display="text"/>
						<cell col="6" colid="color_cd" display="text"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="25" Id="btn_save" ImageID="btn_c_2" Left="696" LeftMargin="5" OnClick="btn_save_OnClick" Style="sty_btn_c" TabOrder="11" Text="저장" Top="565" Visible="FALSE" Width="60"></Button>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="25" Id="btn_delete" ImageID="btn_d_2" Left="761" LeftMargin="5" OnClick="btn_delete_OnClick" Style="sty_btn_d" TabOrder="12" Text="삭제" Top="565" Visible="FALSE" Width="60"></Button>
	</Form>
	<Script><![CDATA[/*******************************************************************************
* 프로그램ID  : DISOUT00200
* 업무명      : 재고
* 프로그램명  : 출고예정등록
--------------------------------------------------------------------------------
* 작성자      : 한병곤
* 작성일      : 2009.03.02
--------------------------------------------------------------------------------
* 1. 변경이력
수정자    :
수정일    :
수정 내역 :
*******************************************************************************/
//==============================================================================
// 공통 스크립트 로딩
//==============================================================================
#include "lib::lib_commF.js"
#include "lib::lib_DIS.js"
#include "lib::lib_commPopup.js"
#include "lib::lib_util.js"
#include "lib::lib_commMsg.js"

//==============================================================================
// 폼 변수 정의
//==============================================================================
var FV_OUT_MGMT_NO; // 출고번호.
var FV_OUT_PLC_ID;   // 출고처.
var FV_OUT_CL;       // 출고구분.
var FV_PARENT_PAGE_NO; //메뉴번호 
var FV_MENU_NO       = "100000044"; //메뉴번호 (100000044 : 출고예정등록)
var FV_ORG_ID;  //조직코드
var FV_ORG_CL;  //조직구분
var FV_POS_AGENCY_ID;
var FV_POS_AGENCY_UKEY_ID;
var FV_POS_AGENCY_NM;
var FV_ORG_AREA_ID; // 근무지 cd.
var FV_ORG_AREA_NM; // 근무지 nm.
var FV_EVENT_YN = "Y"; //Y인 경우 일자 onchagned evnet 체크 함.

/*******************************************************************************
 * @description    : 최초 폼 로드시 발생 - 이벤트
*******************************************************************************/
function form_OnLoadCompleted(obj)
{
	FV_OUT_MGMT_NO = sOutMgmtNo;
	FV_OUT_PLC_ID  = sOutPlcId;
	FV_OUT_CL      = sOutCl;
	FV_PARENT_PAGE_NO = sParentPageNo;
	
    // 세션정보 취득.
    FV_ORG_ID = gds_session.GetColumn(0,"orgId");
    FV_ORG_CL = gds_session.GetColumn(0,"orgCl");
    FV_POS_AGENCY_ID      = gds_session.GetColumn(0,"posAgencyId");   
    FV_POS_AGENCY_NM      = gds_session.GetColumn(0,"posAgencyNm");     
    FV_POS_AGENCY_UKEY_ID = gds_session.GetColumn(0,"posAgencyUkeyId");
    FV_ORG_AREA_ID        = gds_session.GetColumn(0,"orgAreaId");     
    FV_ORG_AREA_NM        = gds_session.GetColumn(0,"orgAreaNm");     	
	
    // 권한.
    cf_setAuth(FV_MENU_NO);	
	
	// 그리드 체크박스 설정 및 정렬
	cf_setGrdChecknSortEvent(grd_outDtlList, 0);
	
	// 공통 코드를 위한 데이타셋 설정
	cf_setCommonCodeDsEnv();
	
	//  출고구분 : ZDIS_C_00030
	cf_setCommonCode("ds_outClList", "ZDIS_C_00030");	

	http.Sync = true;	
	
	// 설정된 코드를 기반으로 공통 코드를 추가 및 데이타 바인딩
	cf_checkCommonCode();	
	
	// 출고구분 필터링 (구매출고/교품반환출고/교품출고/판매취소출고)	
	ds_outClList.Filter("COMM_CD_VAL == '201' || COMM_CD_VAL == '202' || COMM_CD_VAL == '203'");	
	
	// 조회조건에 기본값 설정
	cf_setInitDataForCmb(div_process.cmb_outCl,"선택");
	
	http.Sync = false;		
	
	// 출고 마스터/상세 조회.
	f_getOutList();	
}

/*******************************************************************************
 * @description    : 콜백
 * @param sSvcID   : 서비스 아이디
*******************************************************************************/
function f_callBack(sSvcID)
{	
	if(sSvcId == "getOutList"){
	
		// 출고관리번호가 없을 경우.(신규등록)
		if( ds_outMaster.GetRowCount() == 0 ){		
					
			// 출고 마스터에 로우 추가.
			ds_outMaster.AddRow();	
							
			// 출고구분 셋팅.
			div_process.cmb_outCl.Index = 0;
			
			div_process.cal_outSchdDt.SetFocus();
			
			FV_EVENT_YN = "N"; //N인 경우 일자 onchagned evnet 체크 안함.
			
			// 출고예정일 셋팅.
			div_process.cal_outSchdDt.Value = Mid(cf_getDate(),0,8);
			
			FV_EVENT_YN = "Y";
			
			div_process.cmb_outCl.Enable = true;
			div_process.cal_outSchdDt.Enable = true;
			
			// 소속대리점이 있으면
			if( !uf_IsNull(FV_POS_AGENCY_ID) ){
			
				div_process.edt_posAgencyId.value = FV_POS_AGENCY_ID;
				div_process.edt_posAgencyNm.value = FV_POS_AGENCY_NM;
				
				div_process.edt_posAgencyNm.Enable = false;
				div_process.btn_agency.Enable = false;	
					
				// 소속대리점이 있으면서 근무지와 다르면 출고처 셋팅.
				if( FV_POS_AGENCY_ID != FV_ORG_AREA_ID ){
										
					div_process.edt_outPlcId.value = FV_ORG_AREA_ID;
					div_process.edt_outPlcNm.value = FV_ORG_AREA_NM;
					
					div_process.edt_outPlcNm.Enable = false;
					div_process.btn_out.Enable = false;
									
				}else{
				
					div_process.edt_outPlcNm.Enable = true;
					div_process.btn_out.Enable = true;					
				}
									
			}else{
			
				div_process.edt_posAgencyNm.Enable = true;
				div_process.btn_agency.Enable = true;		
				div_process.edt_outPlcNm.Enable = true;
				div_process.btn_out.Enable = true;									
			}	
			
			div_process.edt_inPlcNm.Enable = true;		
			div_process.btn_in.Enable = true;				
						
		}else{
		
			// 조회시 출고구분 disable
			div_process.cmb_outCl.Enable = false;
			div_process.cal_outSchdDt.Enable = false;
			div_process.edt_posAgencyNm.Enable = false;
			div_process.edt_inPlcNm.Enable = false;
			div_process.edt_outPlcNm.Enable = false;
			div_process.btn_agency.Enable = false;
			div_process.btn_out.Enable = false;
			div_process.btn_in.Enable = false;
			
			f_setOutSchdData();
		}
				
		//저장버튼, 삭제버튼 
		if(btn_save.Visible){
				
			if(ds_outMaster.GetColumn(0,"out_fix_yn") == "Y"){
				btn_save.Enable = false;
				btn_delete.Enable  = false;			
				div_btn.btn_delRow.Enable = false;		
				btn_prodAdd.Enable = false;		
				btn_ukeyAdd.Enable = false;
				div_bottomEdit.txa_rmks.Readonly = true;
			}else{
				btn_save.Enable = true;
				btn_delete.Enable  = true;			
				div_btn.btn_delRow.Enable = true;		
				btn_prodAdd.Enable = true;		
				btn_ukeyAdd.Enable = true;
				div_bottomEdit.txa_rmks.Readonly = false;
			}			
						
		}else{
			
			// 출고예정일 경우.
			btn_save.Enable = false;
			btn_delete.Enable  = false;
			div_btn.btn_delRow.Enable = false;		
			btn_prodAdd.Enable = false;
			btn_ukeyAdd.Enable = false;
	        div_bottomEdit.txa_rmks.Readonly = true;
		}		
						
		// 데이터 변경 여부 확인 셋팅.
		cf_setOrgDs(ds_outMaster);
		cf_setOrgDs(ds_outDtlList);		
		cf_setOrgDs(ds_prodSerNumList);						
		
	}else if (sSvcId == 'saveOutSchd'){
	
		http.Sync = true;
		
		f_getOutList();
		
		// call parent window method
		f_callParentMethod();
		
		http.Sync = false;
		
		this.Close();	
		
	}else if (sSvcId == 'deleteOutSchd'){
	
		http.Sync = true;
		
		f_getOutList();
		
		// call parent window method
		f_callParentMethod();
		
		http.Sync = false;
		
		this.Close();
	}
}
/*******************************************************************************
 공통 스크립트 영역 끝
*******************************************************************************/


/*******************************************************************************
 * @description    : 상품입력 버튼 클릭 - 이벤트
*******************************************************************************/
function btn_prodAdd_OnClick(obj)
{

	if( uf_IsNull(div_process.cal_outSchdDt.value) ){
	
		alert(cf_getMessage(MSG_00083, "출고예정일"));
		div_process.cal_outSchdDt.SetFocus();
		return;
	}
	
	if( uf_IsNull(div_process.cmb_outCl.value) ){
	
		alert(cf_getMessage(MSG_00083, "출고구분"));
		div_process.cmb_outCl.SetFocus();
		return;
	}
	
	if(uf_IsNull(div_process.edt_posAgencyId.value)){

		alert(cf_getMessage(MSG_00083, "대리점"));
		div_process.edt_posAgencyNm.SetFocus();
		return;
	}
		
	if(uf_IsNull(div_process.edt_outPlcId.value)){

		alert(cf_getMessage(MSG_00083, "출고처"));
		div_process.edt_outPlcNm.SetFocus();
		return;
	}		
	
	if(uf_IsNull(div_process.edt_inPlcId.value)){

		alert(cf_getMessage(MSG_00083, "반품처"));
		div_process.edt_inPlcNm.SetFocus();
		return;
	}	
		
	var sArg = "FV_STR_DSID='ds_prodSerNumList'";
		sArg += " FV_IN_OUT_CL="+quote(div_process.cmb_outCl.value);
		sArg += " FV_APPLY_DT="+quote(div_process.cal_outSchdDt.value);
	    sArg += " FV_CALL_FUNCTION='f_setOutSchdData'";
	
	dialog("DIS::DISDCO00110.xml", sArg ,830, 600);	
}

/*******************************************************************************
 * @description    :  ukey 상품입력 버튼 클릭 이벤트
*******************************************************************************/
function btn_ukeyAdd_OnClick(obj)
{

	if( uf_IsNull(div_process.cal_outSchdDt.value) ){
	
		alert(cf_getMessage(MSG_00083, "출고예정일"));
		div_process.cal_outSchdDt.SetFocus();
		return;
	}	
	
	if( uf_IsNull(div_process.cmb_outCl.value) ){
	
		alert(cf_getMessage(MSG_00083, "출고구분"));
		div_process.cmb_outCl.SetFocus();
		return;
	}
	
	if( div_process.cmb_outCl.value != "202" ){
	
		//Ukey 상품입력은 출고구분이 교품출고 인 경우만 가능합니다.
		alert(MSG_00129);
		div_process.cmb_outCl.SetFocus();
		return;
	}	
	
	if(uf_IsNull(div_process.edt_posAgencyId.value)){

		alert(cf_getMessage(MSG_00083, "대리점"));
		div_process.edt_posAgencyNm.SetFocus();
		return;
	}
		
	if(uf_IsNull(div_process.edt_outPlcId.value)){

		alert(cf_getMessage(MSG_00083, "출고처"));
		div_process.edt_outPlcNm.SetFocus();
		return;
	}		
	
	if(uf_IsNull(div_process.edt_inPlcId.value)){

		alert(cf_getMessage(MSG_00083, "반품처"));
		div_process.edt_inPlcNm.SetFocus();
		return;
	}
				
	var sArg = "sInOutCl="+quote(div_process.cmb_outCl.value);
	    sArg += " sInOutClNm="+quote(div_process.cmb_outCl.text);
	    sArg += " sOutPlcNm="+quote(div_process.edt_outPlcNm.text);
	    sArg += " sOutPlcId="+quote(div_process.edt_outPlcId.value);
	    sArg += " sPosAgencyId="+quote(div_process.edt_posAgencyId.value);	
	    sArg += " sPosAgencyNm="+quote(div_process.edt_posAgencyNm.value);	

	dialog("DIS::DISDCO00130.xml", sArg , 830, 600);
}

/*******************************************************************************
 * @description    : 로우 삭제 - 이벤트
*******************************************************************************/
function div_btn_btn_delRow_OnClick(obj)
{

	var oGrdDs = object(grd_outDtlList.BindDataset);
	// 삭제된 라인에 해당하는 상품의 일련번호를 삭제한다.
	var sProdCd  = ds_outDtlList.GetColumn(oGrdDs.row,"prod_cd");
	var sColorCd = ds_outDtlList.GetColumn(oGrdDs.row,"color_cd");
	
	for(var i= ds_prodSerNumList.GetRowCount()-1 ; i >= 0 ; i-- ){

		if( sProdCd+sColorCd == (ds_prodSerNumList.GetColumn(i,"prod_cd")+ds_prodSerNumList.GetColumn(i,"color_cd"))){
			ds_prodSerNumList.DeleteRow(i);
		}
	}
	
	oGrdDs.DeleteRow(oGrdDs.row);	
	
	//그룹핑된 상품도 삭제한다.
	for(var i= ds_prodGrpList.GetRowCount()-1 ; i >= 0 ; i-- ){

		if( sProdCd+sColorCd == (ds_prodGrpList.GetColumn(i,"prod_cd")+ds_prodGrpList.GetColumn(i,"color_cd"))){
			ds_prodGrpList.DeleteRow(i);
		}
	}	
	
	// 인터페이스 데이터도 삭제한다.
	for(var i= ds_prodInoutIf.GetRowCount()-1 ; i >= 0 ; i-- ){

		if( sProdCd+sColorCd == (ds_prodInoutIf.GetColumn(i,"prod_cd")+ds_prodInoutIf.GetColumn(i,"color_cd"))){
			ds_prodInoutIf.DeleteRow(i);
		}
	}	
}

/*******************************************************************************
 * @description    : excelDown 클릭- 이벤트
*******************************************************************************/
function div_btn_btn_excelDown_OnClick(obj)
{
	cf_exportExcel(grd_outDtlList);
}

/*******************************************************************************
 * @description    : cell double 클릭- 이벤트
*******************************************************************************/
function grd_outDtlList_OnCellDblClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{
	// 출고예정 클릭 시.
	//if(nCell == 6){

		// 상품이 단말기/usim인 경우 물론 0 보다 클때...
		if( (ds_outDtlList.GetColumn(nRow,"prod_cl") == "1" || ds_outDtlList.GetColumn(nRow,"prod_cl") == "2")
			&& (ds_outDtlList.GetColumn(nRow,"out_qty") > 0 ) ){

			ds_prodSerNumList.Filter("prod_cd='"+ds_outDtlList.GetColumn(nRow,"prod_cd")+"'&&color_cd='"+ds_outDtlList.GetColumn(nRow,"color_cd")+"'");
			ds_prodSerNumGrpList.CopyF(ds_prodSerNumList);			
			ds_prodSerNumList.UnFilter();

			Dialog("DIS::DISDCO00300.xml", "FV_STR_DS_DCO300=ds_prodSerNumGrpList FV_STR_DS_ORG_DCO300=ds_prodSerNumList",255,313);
		}
	//}
}

/*******************************************************************************
 * @description    : save button 클릭- 이벤트
*******************************************************************************/
function btn_save_OnClick(obj)
{
	// 변경 datacheck
	if(ds_prodSerNumList.GetUpdate() == 0 && ds_outMaster.GetUpdate() == 0){
		alert(cf_getMessage(MSG_00071,"")); // 처리할 대상이 없습니다
		return;
	}		
	
	// validation
	if(!cf_checkObjValues(div_process)) return;
	
	// 최초 등록시에만 
	if(uf_IsNull(ds_outMaster.GetColumn(0,"out_mgmt_no"))){
	
		// 출고예정일 과거 또는 현재일 + 30일 불가.
		var sOutSchdDt = div_process.cal_outSchdDt.value;
        			
		// 마감월 체크
		cf_CheckCloseDay('01',div_process.cal_outSchdDt.value,"출고예정일"); // 01 : 재고
		if(FV_BOOLEAN_CLOSE) {
			div_process.cal_outSchdDt.SetFocus();
			return; // 입력한 일자가 마감 되었을 경우 '1'(true) 리턴.	
		}        			
	
		if( sOutSchdDt > AddDate(Mid(cf_getDate(),0,8),30) ){
			
			//출고예정일은 현재일자보다 + 30일 이상 일자는 선택 할 수 없습니다.
			alert(cf_getMessage(MSG_00099, "출고예정일")); 
			div_process.cal_outSchdDt.SetFocus();
			return;
		}	
	}	
	
	if(uf_IsNull(div_process.edt_posAgencyId.value)){

		alert(cf_getMessage(MSG_00121, "대리점;저장"));
		div_process.edt_posAgencyNm.SetFocus();
		return;
	}
	
	if(uf_IsNull(div_process.edt_outPlcId.value)){

		alert(cf_getMessage(MSG_00121, "출고처;저장"));
		div_process.edt_outPlcNm.SetFocus();
		return;
	}	
		
	if(uf_IsNull(div_process.edt_inPlcId.value)){

		alert(cf_getMessage(MSG_00121, "반품처;저장"));
		div_process.edt_inPlcNm.SetFocus();
		return;
	}	
	
	if(ds_outDtlList.GetRowCount() == 0){
		//상품은 반드시 한개이상 등록해야 합니다.
		alert(MSG_00114);
		return;
	}
	
	for( var i = 0 ; i < ds_outDtlList.GetRowCount() ; i++){
	
		if(uf_IsNull(ds_outDtlList.GetColumn(i,"out_qty")) || ds_outDtlList.GetColumn(i,"out_qty") == "0" ){
			
			//라인의 예정수량을 반드시 한개이상 등록해야 합니다.
			alert(cf_getMessage(MSG_00115, (i+1))); 
			uf_SelPos(grd_outDtlList,i,5);
			return;
		}
		
		if(uf_IsNull(ds_outDtlList.GetColumn(i,"unit_prc")) || ds_outDtlList.GetColumn(i,"unit_prc") == "0" ){
			
			//라인의 금액은 필수 입니다.
            alert(cf_getMessage(MSG_00124, (i+1)+";금액은"));
			uf_SelPos(grd_outDtlList,i,6);
			return;
		}
	}	
	
	// 트랜잭션 설정
	var sSvcID = "saveOutSchd";
	var sInDs  = "ds_prodSerNumList=ds_prodSerNumList:U ds_outMaster=ds_outMaster:A ds_prodInoutIf=ds_prodInoutIf:U";
	var sOutDs = "";
	var sArg   = "sktst.dis.OUT#saveOutSchd";
	
	// 공통 트랜잭션 호출
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg, null, true, true);
}

/*******************************************************************************
 * @description    : delete button 클릭- 이벤트
*******************************************************************************/
function btn_delete_OnClick(obj)
{

	if(uf_IsNull(FV_OUT_MGMT_NO)){
		// 등록되지 않은 데이터이므로 삭제 할 수 없습니다.
		alert(cf_getMessage(MSG_00022, "등록되지 않은 데이터이므로")); 
		return;
	}
	
	//삭제하시겠습니까?
	if(!confirm(cf_getMessage(MSG_00102, "전체"))){
		return;
	}	

	// 넘길 파라메터 설정
	cf_setParam(ds_condition, "out_mgmt_no", FV_OUT_MGMT_NO);
	
	// 트랜잭션 설정
	var sSvcID = "deleteOutSchd";
	var sInDs  = "ds_prodSerNumList=ds_prodSerNumList:A ds_outMaster=ds_outMaster:A";
	var sOutDs = "";
	var sArg   = "sktst.dis.OUT#deleteOutSchd";
	
	// 공통 트랜잭션 호출
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg, null, true, true);	
}

/*******************************************************************************
 * @description    : 출고 마스터/상세 조회.
*******************************************************************************/
function f_getOutList(){

	// 넘길 파라메터 setting.
	cf_setParam(ds_condition, "out_mgmt_no", FV_OUT_MGMT_NO);
	cf_setParam(ds_condition, "out_plc_id", FV_OUT_PLC_ID);
	cf_setParam(ds_condition, "out_cl", FV_OUT_CL);
	
	// 트랜잭션 설정
	var sSvcID = "getOutList";
	var sInDs  = "nc_input_fieldDs=ds_condition";
	var sOutDs = "ds_outMaster=ds_outMaster ds_outDtlList=ds_outDtlList ds_prodSerNumList=ds_prodSerNumList";
	var sArg   = "sktst.dis.OUT#getOutSchdDtlList";
	
	// 공통 트랜잭션 호출
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);

}

/*******************************************************************************
 * @description    : 출고예정 데이터를 셋팅한다.
*******************************************************************************/
function f_setOutSchdData(){	

	var iAddRowNum = 0;
	
	// 상품일련번호 리스트를 돌려 상품그룹데이터를 만든다.
	for(var i = 0 ; i < ds_prodSerNumList.GetRowCount() ; i++ ){
	
		ds_prodGrpList.Filter("prod_cl='"+ds_prodSerNumList.GetColumn(i,"prod_cl")+"'&&color_cd='"+ds_prodSerNumList.GetColumn(i,"color_cd")+"'&&prod_cd=='"+ds_prodSerNumList.GetColumn(i,"prod_cd")+"'");
		
		if(ds_prodGrpList.GetRowCount() == 0 ){		
	
			ds_prodGrpList.UnFilter();
			iAddRowNum = ds_prodGrpList.AddRow();
			ds_prodGrpList.SetColumn(iAddRowNum,"prod_cd",ds_prodSerNumList.GetColumn(i,"prod_cd"));
			ds_prodGrpList.SetColumn(iAddRowNum,"prod_nm",ds_prodSerNumList.GetColumn(i,"prod_nm"));
			ds_prodGrpList.SetColumn(iAddRowNum,"prod_cl",ds_prodSerNumList.GetColumn(i,"prod_cl"));
			ds_prodGrpList.SetColumn(iAddRowNum,"prod_cl_nm",ds_prodSerNumList.GetColumn(i,"prod_cl_nm"));
			ds_prodGrpList.SetColumn(iAddRowNum,"color_cd",ds_prodSerNumList.GetColumn(i,"color_cd"));
			ds_prodGrpList.SetColumn(iAddRowNum,"color_nm",ds_prodSerNumList.GetColumn(i,"color_nm"));
			ds_prodGrpList.SetColumn(iAddRowNum,"mfact_nm",ds_prodSerNumList.GetColumn(i,"mfact_nm"));
			ds_prodGrpList.SetColumn(iAddRowNum,"unit_prc",ds_prodSerNumList.GetColumn(i,"unit_prc"));
		}		
	}	
	
	iAddRowNum = 0;
	ds_prodGrpList.UnFilter();	
	
	// 상품그룹데이터를 돌려 상품 갯수를 구한다.
	for(var k = 0 ; k < ds_prodGrpList.GetRowCount() ; k++ ){

		// 카운트 셋팅.
		ds_prodSerNumList.Filter("prod_cl='"+ds_prodGrpList.GetColumn(k,"prod_cl")
			+"'&&color_cd='"+ds_prodGrpList.GetColumn(k,"color_cd")
			+"'&&prod_cd=='"+ds_prodGrpList.GetColumn(k,"prod_cd")+"'");

		ds_prodGrpList.SetColumn(k,"prod_cnt",ds_prodSerNumList.Sum("out_qty"));

		ds_prodGrpList.SetColumn(k,"amt",ds_prodSerNumList.Sum("amt"));
			
	}
	
	ds_prodSerNumList.UnFilter();
		
	// ds_newRow 초기화
	ds_newRow.ClearData();	
	iAddRowNum = 0;
	
	// 출고예정데이터와 비교하여 없으면 템프 데이터셋에 추가 있으면 수량만 업데이트한다.
	for(var j = 0 ; j < ds_prodGrpList.GetRowCount() ; j++ ){
		
		ds_outDtlList.Filter("prod_cl='"+ds_prodGrpList.GetColumn(j,"prod_cl")+"'&&color_cd='"+ds_prodGrpList.GetColumn(j,"color_cd")+"'&&prod_cd=='"+ds_prodGrpList.GetColumn(j,"prod_cd")+"'");
		
		if(ds_outDtlList.GetRowCount() == 0 ){		
		
			iAddRowNum = ds_newRow.AddRow();
			
			ds_newRow.SetColumn(iAddRowNum,"prod_cl",ds_prodGrpList.GetColumn(j,"prod_cl"));
			ds_newRow.SetColumn(iAddRowNum,"prod_cl_nm",ds_prodGrpList.GetColumn(j,"prod_cl_nm"));
			ds_newRow.SetColumn(iAddRowNum,"prod_cd",ds_prodGrpList.GetColumn(j,"prod_cd"));
			ds_newRow.SetColumn(iAddRowNum,"prod_nm",ds_prodGrpList.GetColumn(j,"prod_nm"));
			ds_newRow.SetColumn(iAddRowNum,"color_cd",ds_prodGrpList.GetColumn(j,"color_cd"));
			ds_newRow.SetColumn(iAddRowNum,"color_nm",ds_prodGrpList.GetColumn(j,"color_nm"));
			ds_newRow.SetColumn(iAddRowNum,"out_qty",ds_prodGrpList.GetColumn(j,"prod_cnt"));	
			ds_newRow.SetColumn(iAddRowNum,"mfact_nm",ds_prodGrpList.GetColumn(j,"mfact_nm"));	
			ds_newRow.SetColumn(iAddRowNum,"unit_prc",ds_prodGrpList.GetColumn(j,"unit_prc"));
			ds_newRow.SetColumn(iAddRowNum,"amt",ds_prodGrpList.GetColumn(j,"amt"));
				
		}else{
			ds_outDtlList.SetColumn(0,"out_qty",ds_prodGrpList.GetColumn(j,"prod_cnt"));
			ds_outDtlList.SetColumn(0,"amt",ds_prodGrpList.GetColumn(j,"amt"));
		}		
	}	
	
    ds_outDtlList.UnFilter();	
	
	iAddRowNum = 0;
	// 템프 데이터셋에 추가한 열을 출고예정데이터에 추가한다.
	for(var y = 0 ; y < ds_newRow.GetRowCount() ; y++){
	
		iAddRowNum = ds_outDtlList.AddRow();
		
		ds_outDtlList.SetColumn(iAddRowNum,"prod_cl",ds_newRow.GetColumn(y,"prod_cl"));
		ds_outDtlList.SetColumn(iAddRowNum,"prod_cl_nm",ds_newRow.GetColumn(y,"prod_cl_nm"));
		ds_outDtlList.SetColumn(iAddRowNum,"prod_cd",ds_newRow.GetColumn(y,"prod_cd"));
		ds_outDtlList.SetColumn(iAddRowNum,"prod_nm",ds_newRow.GetColumn(y,"prod_nm"));
		ds_outDtlList.SetColumn(iAddRowNum,"color_cd",ds_newRow.GetColumn(y,"color_cd"));
		ds_outDtlList.SetColumn(iAddRowNum,"color_nm",ds_newRow.GetColumn(y,"color_nm"));
		ds_outDtlList.SetColumn(iAddRowNum,"out_qty",ds_newRow.GetColumn(y,"out_qty"));	
		ds_outDtlList.SetColumn(iAddRowNum,"mfact_nm",ds_newRow.GetColumn(y,"mfact_nm"));	
		ds_outDtlList.SetColumn(iAddRowNum,"out_fix_qty","0");
		ds_outDtlList.SetColumn(iAddRowNum,"unit_prc",ds_newRow.GetColumn(y,"unit_prc"));
		ds_outDtlList.SetColumn(iAddRowNum,"amt",ds_newRow.GetColumn(y,"amt"));
	}
}

/*******************************************************************************
 * @description    : 일련번호 조회 창이 닫히기 전에 호출
                     ( 리스트의 출고예정수량 연산. )
*******************************************************************************/
function f_setDsGroup(idsDelCnt){			

	ds_outDtlList.SetColumn(ds_outDtlList.currow,"out_qty",
			toNumber(ds_outDtlList.GetColumn(ds_outDtlList.currow,"out_qty")) - toNumber(idsDelCnt) );			
			
	var sProdCd  = ds_outDtlList.GetColumn(ds_outDtlList.currow,"prod_cd");
	var sColorCd = ds_outDtlList.GetColumn(ds_outDtlList.currow,"color_cd");
					
    if(ds_outDtlList.GetColumn(ds_outDtlList.currow,"out_qty") == 0 ){
		
		//그룹핑된 상품 삭제한다.
		for(var i= ds_prodGrpList.GetRowCount()-1 ; i >= 0 ; i-- ){
	
			if( sProdCd+sColorCd == (ds_prodGrpList.GetColumn(i,"prod_cd")+ds_prodGrpList.GetColumn(i,"color_cd"))){
				ds_prodGrpList.DeleteRow(i);
			}
		}			
	
		ds_outDtlList.DeleteRow(ds_outDtlList.currow);
	}else{
	
		//그룹핑된 상품 삭제한다.
		for(var i= ds_prodGrpList.GetRowCount()-1 ; i >= 0 ; i-- ){
	
			if( sProdCd+sColorCd == (ds_prodGrpList.GetColumn(i,"prod_cd")+ds_prodGrpList.GetColumn(i,"color_cd"))){
				ds_prodGrpList.SetColumn(i,"prod_cnt",
					toNumber(ds_prodGrpList.GetColumn(i,"prod_cnt"))-toNumber(idsDelCnt));
			}
		}			
	}
	
	var iOutQty  = toNumber(ds_outDtlList.GetColumn(ds_outDtlList.currow,"out_qty"));
	var iUnitPrc = toNumber(ds_outDtlList.GetColumn(ds_outDtlList.currow,"unit_prc"));
	var iAmt     = iOutQty*iUnitPrc;
	
	ds_outDtlList.SetColumn(ds_outDtlList.currow,"amt",iAmt);	
}

/*******************************************************************************
 * @description    : 호출한 창의 함수 호출.
*******************************************************************************/
function f_callParentMethod()
{
	var sFrmNum = FV_PARENT_PAGE_NO;
	var sFunc = "div_search_btn_search_OnClick";
	gf_movenCall(sFrmNum, sFunc);	
}

/*******************************************************************************
 * @description    : 대리점 OnKeyDown 이벤트
*******************************************************************************/
function div_process_edt_posAgencyNm_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
{
	if(nChar == "13"){
		// org_id 와 org_cl 의 파라메터는 필수 입니다.
		var sArg  = "org_id="+FV_ORG_ID; // 필수
		    //sArg += " eff_dtm="+quote(div_process.cal_outSchdDt.value); // 옵션

		if(ds_outDtlList.GetUpdate() > 0){
		
			div_process.edt_posAgencyId.SetFocus(); // CanColumnChange event 발생 시키기 위해.
			
			if(ds_outMaster_CanColumnChange()){
				cf_callAgencyPop(sArg, div_process, "edt_posAgencyNm,edt_posAgencyId");	
			}	
			
		}else{
			cf_callAgencyPop(sArg, div_process, "edt_posAgencyNm,edt_posAgencyId");	
		}
	}	
}

/*******************************************************************************
 * @description    : 대리점 버튼 클릭 이벤트
*******************************************************************************/
function div_process_btn_agency_OnClick(obj)
{
	var sArg  = "org_id="+FV_ORG_ID; // 필수
		//sArg += " eff_dtm="+quote(div_process.cal_outSchdDt.value); // 옵션

	cf_callAgencyPop(sArg, div_process, "edt_posAgencyNm,edt_posAgencyId");	
}

/*******************************************************************************
 * @description    : 대리점 OnChanged이벤트
*******************************************************************************/
function div_process_edt_posAgencyNm_OnChanged(obj,strText)
{
	div_process.edt_posAgencyId.value = "";
}

/*******************************************************************************
 * @description    : 반품처 key down - 이벤트
*******************************************************************************/
function div_process_edt_inPlcNm_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
{
	if(nChar == "13"){
	
		var sAgency = div_process.edt_posAgencyId.value;	
		var sArg  = "deal_co_cl1="+quote("30"); // 매입처
		
		//sArg += " eff_dtm="+quote(div_process.cal_outSchdDt.value); // 옵션

		if(ds_outDtlList.GetUpdate() > 0){
		
			div_process.edt_inPlcId.SetFocus(); // CanColumnChange event 발생 시키기 위해.
			
			if(ds_outMaster_CanColumnChange()){
				cf_callDealPop(sArg, div_process, "edt_inPlcNm,edt_inPlcId");
			}	
			
		}else{
			cf_callDealPop(sArg, div_process, "edt_inPlcNm,edt_inPlcId");
		}
	} 	
}

/*******************************************************************************
 * @description    : 반품처 click- 이벤트
*******************************************************************************/
function div_process_btn_in_OnClick(obj)
{
	var sAgency = div_process.edt_posAgencyId.value;	
	var sArg  = "deal_co_cl1="+quote("30"); // 매입처

	//sArg += " eff_dtm="+quote(div_process.cal_outSchdDt.value); // 옵션

	cf_callDealPop(sArg, div_process, "edt_inPlcNm,edt_inPlcId");
}

/*******************************************************************************
 * @description    : 반품처 OnChar Changed 이벤트
*******************************************************************************/
function div_process_edt_inPlcNm_OnChanged(obj,strText)
{
	div_process.edt_inPlcId.value = "";		
}

/*******************************************************************************
 * @description    : 출고처 key down - 이벤트
*******************************************************************************/
function div_process_edt_outPlcNm_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
{
	if(nChar == "13"){
	
		var sAgency = div_process.edt_posAgencyId.value;	
		var sArg    = "deal_co_cl1="+quote("Z1"); // 물류창고
		
		if(uf_IsNull(sAgency)) {
			alert(cf_getMessage(MSG_00083, "대리점"));
			div_process.edt_posAgencyNm.SetFocus();
			return;		
		}
		
		sArg += " pos_agency="+quote(sAgency); // 대리점
		//sArg += " eff_dtm="+quote(div_process.cal_outSchdDt.value); // 옵션

		if(ds_outDtlList.GetUpdate() > 0){
		
			div_process.edt_outPlcId.SetFocus(); // CanColumnChange event 발생 시키기 위해.
			
			if(ds_outMaster_CanColumnChange()){
				cf_callDealPop(sArg, div_process, "edt_outPlcNm,edt_outPlcId");	
			}	
			
		}else{
			cf_callDealPop(sArg, div_process, "edt_outPlcNm,edt_outPlcId");	
		}
	} 	
}

/*******************************************************************************
 * @description    : 출고처 click- 이벤트
*******************************************************************************/
function div_process_btn_out_OnClick(obj)
{
	var sAgency = div_process.edt_posAgencyId.value;	
	var sArg    = "deal_co_cl1="+quote("Z1"); // 물류창고
	
	if(uf_IsNull(sAgency)) {
		alert(cf_getMessage(MSG_00083, "대리점"));
		div_process.edt_posAgencyNm.SetFocus();
		return;		
	}
	
	sArg += " pos_agency="+quote(sAgency); // 대리점
	//sArg += " eff_dtm="+quote(div_process.cal_outSchdDt.value); // 옵션

	cf_callDealPop(sArg, div_process, "edt_outPlcNm,edt_outPlcId");
}

/*******************************************************************************
 * @description    : 출고처 OnChar Changed 이벤트
*******************************************************************************/
function div_process_edt_outPlcNm_OnChanged(obj,strText)
{
	div_process.edt_outPlcId.value = "";
}

/*******************************************************************************
 * @description    : 화면 재설정
*******************************************************************************/
function df_reSet(sArg)
{
	if(sArg == null)
	{
	}else{
	
		ds_outMaster.ClearData();
		ds_outDtlList.ClearData();
		ds_prodSerNumList.ClearData();
		ds_prodGrpList.ClearData();
		ds_prodSerNumGrpList.ClearData();
		ds_condition.ClearData();
		
		cf_setArg("ds_ref", sArg);				
		
		FV_OUT_MGMT_NO  = ds_ref.GetColumn(0,"sOutMgmtNo");
		FV_OUT_PLC_ID = ds_ref.GetColumn(0,"sOutPlcId");
		FV_OUT_CL = ds_ref.GetColumn(0,"sOutCl");
		FV_PARENT_PAGE_NO = ds_ref.GetColumn(0,"sParentPageNo");
		
		f_getOutList();
	}
}

/*******************************************************************************
 * @description    :  화면이 종료될때 체크 대상이 2개 이상일때 데이타셋의 변경 유무를 체크 
*******************************************************************************/
function form_OnUnloadCompleted(obj)
{
	var nResult1 = cf_checkDsChanging(ds_outMaster);
	var nResult2 = cf_checkDsChanging(ds_outDtlList);
	var nResult3 = cf_checkDsChanging(ds_prodSerNumList);
	
	return cf_callDsCheckMsg(nResult1, nResult2, nResult3);
}

/*******************************************************************************
 * @description    :  grid onchar event
*******************************************************************************/
function grd_outDtlList_OnChar(obj,strPreText,nChar,strPostText,nLLParam,nHLParam,nRow,nCell,nPivotIndex)
{

	if(nCell == 6){
				
		var iOutQty  = ds_outDtlList.GetColumn(nRow,"out_qty");
		var iUnitPrc = toNumber(strPostText);
		var iAmt     = iOutQty*iUnitPrc;
		
		ds_outDtlList.SetColumn(nRow,"amt",iAmt);
		
		if(ds_outDtlList.GetColumn(nRow,"prod_cl") == "1" || ds_outDtlList.GetColumn(nRow,"prod_cl") == "2"){
		
			for(var i = 0 ; i < ds_prodSerNumList.rowcount ; i++){
			
				if(ds_outDtlList.GetColumn(nRow,"prod_cd")+ds_outDtlList.GetColumn(nRow,"color_cd") 
					== ds_prodSerNumList.GetColumn(i,"prod_cd")+ds_prodSerNumList.GetColumn(i,"color_cd")){
					
					ds_prodSerNumList.SetColumn(i,"unit_prc",iUnitPrc);
					ds_prodSerNumList.SetColumn(i,"amt",iUnitPrc);				
				}
			}	
			
		}else{			
			
			var iProdRow = ds_prodSerNumList.FindRow("prod_cd_color_cd",ds_outDtlList.GetColumn(nRow,"prod_cd")+ds_outDtlList.GetColumn(nRow,"color_cd"));
	
			ds_prodSerNumList.SetColumn(iProdRow,"unit_prc",iUnitPrc);
			ds_prodSerNumList.SetColumn(iProdRow,"amt",iAmt);				
		}

	}else if (nCell == 5){
	
		var iOutQty  = toNumber(strPostText);
		var iUnitPrc = ds_outDtlList.GetColumn(nRow,"unit_prc");
		var iAmt     = iOutQty*iUnitPrc;
		
		ds_outDtlList.SetColumn(nRow,"amt",iAmt);
		
		var iProdRow = ds_prodSerNumList.FindRow("prod_cd_color_cd",ds_outDtlList.GetColumn(nRow,"prod_cd")+ds_outDtlList.GetColumn(nRow,"color_cd"));

		ds_prodSerNumList.SetColumn(iProdRow,"out_qty",iOutQty);
		ds_prodSerNumList.SetColumn(iProdRow,"amt",iAmt);		
	}
}

function div_process_cmb_outCl_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	f_setMasterChg();
}

/*******************************************************************************
 * @description    :  마스터 변경시 
*******************************************************************************/
function f_setMasterChg(){	
	ds_outDtlList.ClearData();
	ds_prodSerNumList.ClearData();
	ds_prodGrpList.ClearData();
	ds_newRow.ClearData();
	ds_prodSerNumGrpList.ClearData();
	ds_prodInoutIf.ClearData();
}

/*******************************************************************************
 * @description    : 마스터 변경 시 이벤트
*******************************************************************************/
function ds_outMaster_CanColumnChange(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
	if( strColumnID == "OUT_SCHD_DT" || strColumnID == "POS_AGENCY_NM" || strColumnID == "OUT_PLC_NM" 
		|| strColumnID == "IN_PLC_NM" || strColumnID == "OUT_CL"){       

		if(ds_outDtlList.GetUpdate() > 0){
			
			if(confirm(MSG_00163)){
				f_setMasterChg();
				
				if(strColumnID == "POS_AGENCY_NM"){
				
					div_process.edt_posAgencyId.value = "";
					div_process.edt_outPlcId.value = "";
					div_process.edt_outPlcNm.value = "";				
					div_process.edt_posAgencyNm.SetFocus();
					
				}else if(strColumnID == "OUT_PLC_NM"){
				
					div_process.edt_outPlcId.value = "";
					div_process.edt_outPlcNm.SetFocus();
					
				}else if(strColumnID == "IN_PLC_NM"){
				
					div_process.edt_inPlcId.value = "";
					div_process.edt_inPlcNm.SetFocus();
				}
								
				return true;
			}else{

				return false;
			}
		}
	}	
}

/*******************************************************************************
 * @description    : 대리점 OnCharChanged 이벤트
*******************************************************************************/
function div_process_edt_posAgencyNm_OnCharChanged(obj,strPreText,strPostText)
{
	if(ds_outDtlList.GetUpdate() == 0){
		div_process.edt_posAgencyId.value = "";
		div_process.edt_outPlcId.value = "";
		div_process.edt_outPlcNm.value = "";
	}
}

/*******************************************************************************
 * @description    : 반품처 OnCharChanged 이벤트
*******************************************************************************/
function div_process_edt_inPlcNm_OnCharChanged(obj,strPreText,strPostText)
{	
	if(ds_outDtlList.GetUpdate() == 0){
		div_process.edt_inPlcId.value = "";	
	}	
}

/*******************************************************************************
 * @description    : 출고처 OnCharChanged 이벤트
*******************************************************************************/
function div_process_edt_outPlcNm_OnCharChanged(obj,strPreText,strPostText)
{	
	if(ds_outDtlList.GetUpdate() == 0){
		div_process.edt_outPlcId.value = "";
	}		
}

/*******************************************************************************
 * @description    : 출고예정일 OnChanged 이벤트
*******************************************************************************/
function div_process_cal_outSchdDt_OnChanged(obj,strOldText,strNewText)
{
	// 최초 화면 입장 시 현재일자를 셋팅 할때는 제외.
	if( !uf_IsNull(div_process.cal_outSchdDt.value) && FV_EVENT_YN == "Y"){
		// 마감월 체크
		cf_CheckCloseDay('01',div_process.cal_outSchdDt.value,"출고예정일"); // 01 : 재고 
		
		if(FV_BOOLEAN_CLOSE) {
			div_process.cal_outSchdDt.value = "";
			div_process.cal_outSchdDt.SetFocus();
			return; // 입력한 일자가 마감 되었을 경우 '1'(true) 리턴.
		}		
	}	
}

/*******************************************************************************
 * @description    : excelUp 클릭- 이벤트
*******************************************************************************/
function div_btn_btn_excelUp_OnClick(obj)
{
	// div validation 체크.
	if(uf_IsNull(div_process.cal_outSchdDt.value)){
		alert(cf_getMessage(MSG_00043, "출고예정일은"));
		div_process.cal_outSchdDt.SetFocus();
		return;
	}		

	if(uf_IsNull(div_process.cmb_outCl.value)){

		alert(cf_getMessage(MSG_00043, "출고구분"));
		div_process.cmb_outCl.SetFocus();
		return;
	}	
	
	if(uf_IsNull(div_process.edt_posAgencyId.value)){

		alert(cf_getMessage(MSG_00043, "대리점"));
		div_process.edt_posAgencyNm.SetFocus();
		return;
	}

	
	if(uf_IsNull(div_process.edt_outPlcId.value)){

		alert(cf_getMessage(MSG_00043, "출고처"));
		div_process.edt_outPlcId.SetFocus();
		return;
	}	
			
	if(uf_IsNull(div_process.edt_inPlcId.value)){

		alert(cf_getMessage(MSG_00043, "반품처"));
		div_process.edt_inPlcNm.SetFocus();
		return;
	}		
	var sArg = "sOutPlcId="+quote(div_process.edt_outPlcID.value);
	
	dialog("DIS::DISOUT00250.xml", sArg , 830, 535);
//	dialog("DIS::DISDTR00350.xml", sArg , 830, 535);
}]]></Script>
</Window>