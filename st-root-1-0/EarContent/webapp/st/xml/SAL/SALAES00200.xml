<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="600" Id="form" Left="8" OnLoadCompleted="form_OnLoadCompleted" OnUnloadCompleted="form_OnUnloadCompleted" PidAttrib="7" Title="공기기판매_도매" Top="8" Ver="1.0" Width="1024" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_colorList">
				<Contents>
					<colinfo id="COLOR_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="COLOR_NM" size="255" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_mdl">
				<Contents>
					<colinfo id="PROD_CD" size="255" type="STRING"/>
					<colinfo id="PROD_NM" size="255" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_salePlc"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_input"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_prodCl">
				<Contents>
					<colinfo id="COMM_CD_ID" size="255" summ="default" type="STRING"/>
					<colinfo id="COMM_CD_VAL" size="255" summ="default" type="STRING"/>
					<colinfo id="COMM_CD_VAL_NM" size="255" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_uplst">
				<Contents>
					<colinfo id="EXIT_CASH_PRCHS_PRC" size="15" type="DECIMAL"/>
					<colinfo id="EXIT_CRDT_PRCHS_PRC" size="15" type="DECIMAL"/>
					<colinfo id="EXIT_STRD_SALE_PRC" size="15" type="DECIMAL"/>
					<colinfo id="FIX_CASH_PRCHS_PRC" size="15" type="DECIMAL"/>
					<colinfo id="FIX_CRDT_PRCHS_PRC" size="15" type="DECIMAL"/>
					<colinfo id="FIX_STRD_SALE_PRC" size="15" type="DECIMAL"/>
				</Contents>
			</Dataset>
			<Dataset CanRowPosChange="ds_list_CanRowPosChange" DataSetType="Dataset" Id="ds_list" OnColumnChanged="ds_list_OnColumnChanged" OnRowPosChanged="ds_list_OnRowPosChanged">
				<Contents>
					<colinfo id="FREE_PROD_SALE_NO" size="255" summ="default" type="STRING"/>
					<colinfo id="FREE_PROD_SALE_CHG_SEQ" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_DTM" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_CHG_DTM" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_CHG_HST_CL" size="255" summ="default" type="STRING"/>
					<colinfo id="PROD_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="PROD_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="COLOR_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="COLOR_CD_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="SER_NUM" size="255" summ="default" type="STRING"/>
					<colinfo id="PROD_CL" size="255" summ="default" type="STRING"/>
					<colinfo id="MFACT_ID" size="255" summ="default" type="STRING"/>
					<colinfo id="MFACT_ID_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_QTY" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_UNIT_PRC" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_AMT" size="255" summ="default" type="STRING"/>
					<colinfo id="HLD_PLC" size="255" summ="default" type="STRING"/>
					<colinfo id="HLD_PLC_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="HLD_PLC_UKEY_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="HLD_PLC_SUB_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="HLD_PLC_CHANNEL_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="MAX" size="255" summ="default" type="STRING"/>
					<colinfo id="DIS_UPDCNT" size="255" summ="default" type="STRING"/>
					<colinfo id="DIS_COMFIRM_YN" size="255" summ="default" type="STRING"/>
					<colinfo id="FIX_STRD_SALE_PRC" size="255" summ="default" type="STRING"/>
					<colinfo id="PROD_ORG_PRC" size="255" summ="default" type="STRING"/>
					<colinfo id="PROC_FLAG" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_mfact">
				<Contents>
					<colinfo id="MFACT_ID" size="255" type="STRING"/>
					<colinfo id="MFACT_NM" size="255" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cardCorp">
				<Contents>
					<colinfo id="COMM_CD_VAL" size="255" summ="default" type="STRING"/>
					<colinfo id="COMM_CD_VAL_NM" size="255" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_oldList">
				<Contents>
					<colinfo id="FREE_PROD_SALE_NO" size="255" summ="default" type="STRING"/>
					<colinfo id="FREE_PROD_SALE_CHG_SEQ" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_CHG_HST_CL" size="255" summ="default" type="STRING"/>
					<colinfo id="PROD_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="PROD_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="COLOR_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="COLOR_CD_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="SER_NUM" size="255" summ="default" type="STRING"/>
					<colinfo id="PROD_CL" size="255" summ="default" type="STRING"/>
					<colinfo id="MFACT_ID" size="255" summ="default" type="STRING"/>
					<colinfo id="MFACT_ID_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_QTY" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_UNIT_PRC" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_AMT" size="255" summ="default" type="STRING"/>
					<colinfo id="HLD_PLC" size="255" summ="default" type="STRING"/>
					<colinfo id="HLD_PLC_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="HLD_PLC_UKEY_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="HLD_PLC_SUB_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="HLD_PLC_CHANNEL_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="MAX" size="255" summ="default" type="STRING"/>
					<colinfo id="DIS_UPDCNT" size="255" summ="default" type="STRING"/>
					<colinfo id="PROC_FLAG" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_saleMgmtNo"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_output"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_barInfo"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_BarTypeInfo"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_mfactNm"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_chgrgId">
				<Contents>
					<colinfo id="user_id" size="256" summ="default" type="STRING"/>
					<colinfo id="user_nm" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_saleChgHstCl">
				<Contents>
					<colinfo id="COMM_CD_ID" size="255" summ="default" type="STRING"/>
					<colinfo id="COMM_CD_VAL" size="255" summ="default" type="STRING"/>
					<colinfo id="COMM_CD_VAL_NM" size="255" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_TmpList">
				<Contents>
					<colinfo id="FREE_PROD_SALE_NO" size="255" summ="default" type="STRING"/>
					<colinfo id="FREE_PROD_SALE_CHG_SEQ" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_CHG_HST_CL" size="255" summ="default" type="STRING"/>
					<colinfo id="PROD_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="PROD_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="COLOR_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="COLOR_CD_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="SER_NUM" size="255" summ="default" type="STRING"/>
					<colinfo id="PROD_CL" size="255" summ="default" type="STRING"/>
					<colinfo id="MFACT_ID" size="255" summ="default" type="STRING"/>
					<colinfo id="MFACT_ID_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_QTY" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_UNIT_PRC" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_AMT" size="255" summ="default" type="STRING"/>
					<colinfo id="HLD_PLC" size="255" summ="default" type="STRING"/>
					<colinfo id="HLD_PLC_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="HLD_PLC_UKEY_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="HLD_PLC_SUB_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="HLD_PLC_CHANNEL_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="MAX" size="255" summ="default" type="STRING"/>
					<colinfo id="DIS_UPDCNT" size="255" summ="default" type="STRING"/>
					<colinfo id="PROC_FLAG" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_hldPlc"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_prodColorList">
				<Contents>
					<colinfo id="COLOR_CD" size="255" type="STRING"/>
					<colinfo id="COLOR_CD_NM" size="255" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_master">
				<Contents>
					<colinfo id="FREE_PROD_SALE_NO" size="255" summ="default" type="STRING"/>
					<colinfo id="FREE_PROD_SALE_CHG_SEQ" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_DTM" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_CHGRG_ID" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_CHG_HST_CL" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_CHG_DTM" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_CHG_CHGRG_ID" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_PLC" size="255" summ="default" type="STRING"/>
					<colinfo id="STL_PLC" size="255" summ="default" type="STRING"/>
					<colinfo id="SL_NET_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="CASH_SALE_PRC" size="255" summ="default" type="STRING"/>
					<colinfo id="GNRL_SALE_NO" size="255" summ="default" type="STRING"/>
					<colinfo id="GNRL_SALE_CHG_SEQ" size="255" summ="default" type="STRING"/>
					<colinfo id="DIV_REQ_YN" size="255" summ="default" type="STRING"/>
					<colinfo id="RMKS" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_PLC_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_PLC_UKEY_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_PLC_SUB_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_PLC_CHANNEL_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="STL_PLC_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="STL_PLC_UKEY_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="STL_PLC_SUB_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="STL_PLC_CHANNEL_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="AGENCY_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="AGENCY_CD_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="AG_UKEY_AGENCY_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="MAX" size="255" summ="default" type="STRING"/>
					<colinfo id="FLAG" size="255" summ="default" type="STRING"/>
					<colinfo id="ETC_PROD_ORG_PRC" size="256" summ="default" type="STRING"/>
					<colinfo id="DIS_HLD_PLC" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_stlPlc">
				<Contents>
					<colinfo id="STL_PLC" size="255" summ="default" type="STRING"/>
					<colinfo id="STL_PLC_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="ukey_agency_cd" size="255" summ="default" type="STRING"/>
					<colinfo id="ukey_sub_cd" size="255" summ="default" type="STRING"/>
					<colinfo id="ukey_channel_cd" size="255" summ="default" type="STRING"/>
					<colinfo id="deal_end_yn" size="256" summ="default" type="STRING"/>
					<colinfo id="pay_stop_yn" size="256" summ="default" type="STRING"/>
					<colinfo id="sale_stop_yn" size="256" summ="default" type="STRING"/>
					<colinfo id="out_stop_yn" size="256" summ="default" type="STRING"/>
					<colinfo id="pos_agency" size="256" summ="default" type="STRING"/>
					<colinfo id="pos_agency_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="dis_hld_plc" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_ProcDis">
				<Contents>
					<colinfo id="FREE_PROD_SALE_NO" size="255" summ="default" type="STRING"/>
					<colinfo id="FREE_PROD_SALE_CHG_SEQ" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_DTM" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_CHG_DTM" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_CHG_HST_CL" size="255" summ="default" type="STRING"/>
					<colinfo id="PROD_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="PROD_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="COLOR_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="COLOR_CD_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="SER_NUM" size="255" summ="default" type="STRING"/>
					<colinfo id="PROD_CL" size="255" summ="default" type="STRING"/>
					<colinfo id="MFACT_ID" size="255" summ="default" type="STRING"/>
					<colinfo id="MFACT_ID_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_QTY" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_UNIT_PRC" size="255" summ="default" type="STRING"/>
					<colinfo id="SALE_AMT" size="255" summ="default" type="STRING"/>
					<colinfo id="HLD_PLC" size="255" summ="default" type="STRING"/>
					<colinfo id="HLD_PLC_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="HLD_PLC_UKEY_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="HLD_PLC_SUB_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="HLD_PLC_CHANNEL_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="MAX" size="255" summ="default" type="STRING"/>
					<colinfo id="DIS_UPDCNT" size="255" summ="default" type="STRING"/>
					<colinfo id="DIS_COMFIRM_YN" size="255" summ="default" type="STRING"/>
					<colinfo id="FIX_STRD_SALE_PRC" size="255" summ="default" type="STRING"/>
					<colinfo id="PROD_ORG_PRC" size="255" summ="default" type="STRING"/>
					<colinfo id="PROC_FLAG" size="256" summ="default" type="STRING"/>
					<colinfo id="JOB_FLAG" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_payment">
				<Contents>
					<colinfo id="FREE_PROD_SALE_NO" size="255" summ="default" type="STRING"/>
					<colinfo id="FREE_PROD_SALE_CHG_SEQ" size="255" summ="default" type="STRING"/>
					<colinfo id="CASH_PAY_AMT" size="255" summ="default" type="STRING"/>
					<colinfo id="CRDTCRD_CORP1" size="255" summ="default" type="STRING"/>
					<colinfo id="CRDTCRD_PAY_AMT1" size="255" summ="default" type="STRING"/>
					<colinfo id="CRDTCRD_PAY_AMT2" size="255" summ="default" type="STRING"/>
					<colinfo id="CRDTCRD_CORP2" size="255" summ="default" type="STRING"/>
					<colinfo id="MER_BOND_PAY_AMT" size="255" summ="default" type="STRING"/>
					<colinfo id="CRDTCRD_PAY_FIX_YN1" size="255" summ="default" type="STRING"/>
					<colinfo id="CRDTCRD_PAY_FIX_YN2" size="255" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="25" Id="btn_cancel" ImageID="btn_d_2" Left="952" LeftMargin="5" OnClick="btn_close_OnClick" Style="sty_btn_d" TabOrder="6" Text="닫기" Top="565" Width="60"></Button>
		<Div Height="25" Id="div_fuc" Left="926" TabOrder="2" Text="Div2" Top="84" Width="85">
			<Contents>
				<Button Cursor="HAND" Height="21" Id="Button5" ImageID="btn_i_exceldown_w" Left="61" OnClick="div_fuc_btn_excel_OnClick" TabOrder="1" Text="Button1" ToolTipText="Excel&#32;Download" Top="1" Width="19"></Button>
				<Button Cursor="HAND" Height="21" Id="btn_subtract" ImageID="btn_i_subtract_w" Left="28" OnClick="div_fuc_btn_subtract_OnClick" TabOrder="2" Text="Button1" ToolTipText="추가된&#32;행삭제" Width="19"></Button>
				<Button Cursor="HAND" Height="21" Id="btn_add" ImageID="btn_i_add_w" Left="4" OnClick="div_fuc_btn_add_OnClick" TabOrder="3" Text="Button1" ToolTipText="행추가" Width="19"></Button>
			</Contents>
		</Div>
		<Image Align="Left" Height="25" Id="Image1" ImageID="bul_tit" Left="10" LeftMargin="15" Style="sty_img_tit" TabOrder="3" TabStop="FALSE" Text="판매정보" Top="-127" Width="192"></Image>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="25" Id="btn_delete" ImageID="btn_d_2" Left="888" LeftMargin="5" OnClick="btn_delete_OnClick" Style="sty_btn_d" TabOrder="5" Text="삭제" Top="565" Visible="FALSE" Width="60"></Button>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="25" Id="btn_save" ImageID="btn_c_2" Left="824" LeftMargin="5" OnClick="btn_saveMulti_OnClick" Style="sty_btn_c" TabOrder="4" Text="저장" Top="565" Visible="FALSE" Width="60"></Button>
		<Div Border="Raised" Height="64" Id="div_input" Left="10" Style="sty_div_input" TabOrder="1" Text="Div0" Top="10" Width="1000">
			<Contents>
				<Static Align="Right" Height="20" Id="Static3" Left="31" Style="sty_lb_Basic" TabOrder="1" Text="판매일자" Top="7" VAlign="Middle" Width="60"></Static>
				<Image Height="20" Id="Image7" ImageID="bul_mand" Left="25" TabOrder="20" TabStop="FALSE" Top="7" Transparent="TRUE" Width="20"></Image>
				<Static Align="Right" Height="20" Id="Static0" Left="30" Style="sty_lb_Basic" TabOrder="3" Text="변경일자" Top="30" VAlign="Middle" Width="60"></Static>
				<Image Height="20" Id="Image0" ImageID="bul_mand" Left="25" TabOrder="24" TabStop="FALSE" Top="30" Transparent="TRUE" Width="20"></Image>
				<Calendar Border="Flat" ButtonImageID="btn_i_calendar" DayFont="Default,-1" HeaderBorder="NONE" HeaderFont="Default,-1" HeadStyle="sty_calendar_head" Height="20" Id="cal_saleChgDtm" Left="95" LeftMargin="2" MonthPopupBorder="RAISED" NullValue="&#32;" OnChanged="div_input_cal_saleChgDtm_OnChanged" RightMargin="2" SaturdayTextColor="user28" Style="sty_calendar" SundayTextColor="user27" TabOrder="4" TodayColor="user26" Top="30" WeeksFont="Default,-1" WeekStyle="sty_calendar_week" Width="93"></Calendar>
				<Edit Align="CENTER" Border="Flat" Font="굴림,-1" Height="20" Id="edt_saleChgDtmHH" Left="189" MaxLength="2" Number="TRUE" OnChanged="div_input_edt_saleChgDtmHH_OnChanged" Style="sty_ipt_search" TabOrder="5" Top="30" Width="30"></Edit>
				<Edit Align="CENTER" Border="Flat" Font="굴림,-1" Height="20" Id="edt_saleChgDtmMM" Left="220" MaxLength="2" Number="TRUE" OnChanged="div_input_edt_saleChgDtmMM_OnChanged" Style="sty_ipt_search" TabOrder="6" Top="30" Width="30"></Edit>
				<Edit Align="CENTER" Border="Flat" Font="굴림,-1" Height="20" Id="edt_saleDtmMM" Left="220" MaxLength="2" Number="TRUE" OnChanged="div_input_edt_saleDtmMM_OnChanged" Style="sty_ipt_search" TabOrder="3" Top="7" Width="30"></Edit>
				<Edit Align="CENTER" Border="Flat" Font="굴림,-1" Height="20" Id="edt_saleDtmHH" Left="189" MaxLength="2" Number="TRUE" OnChanged="div_input_edt_saleDtmHH_OnChanged" Style="sty_ipt_search" TabOrder="2" Top="7" Width="30"></Edit>
				<Calendar Border="Flat" ButtonImageID="btn_i_calendar" DayFont="Default,-1" HeaderBorder="NONE" HeaderFont="Default,-1" HeadStyle="sty_calendar_head" Height="20" Id="cal_saleDtm" Left="95" LeftMargin="2" MonthPopupBorder="RAISED" NullValue="&#32;" OnChanged="div_input_cal_saleDtm_OnChanged" RightMargin="2" SaturdayTextColor="user28" Style="sty_calendar" SundayTextColor="user27" TabOrder="1" TodayColor="user26" Top="7" WeeksFont="Default,-1" WeekStyle="sty_calendar_week" Width="93"></Calendar>
				<Combo BindDataset="ds_master" Border="Flat" CodeColumn="user_id" Column="SALE_CHGRG_ID" DataColumn="user_nm" Editable="TRUE" Height="20" Id="cmb_saleChgrgId" InnerDataset="ds_chgrgId" Left="396" Search="FILTERED" Style="sty_ipt_form" TabOrder="9" Top="28" Visible="FALSE" Width="176"></Combo>
				<Static Align="Right" Height="20" Id="Static1" Left="325" Style="sty_lb_Basic" TabOrder="13" Text="판매담당자" Top="31" VAlign="Middle" Visible="FALSE" Width="68"></Static>
				<Static Align="Right" Height="20" Id="Static2" Left="606" Style="sty_lb_Basic" TabOrder="14" Text="판매처" Top="7" VAlign="Middle" Width="76"></Static>
				<Edit BindDataset="ds_master" Border="Flat" Column="SALE_PLC_NM" Height="20" Id="edt_salePlcNm" Left="684" LeftMargin="2" OnCharChanged="div_input_edt_salePlcNm_OnCharChanged" OnKeyDown="div_input_edt_salePlcNm_OnKeyDown" OnKillFocus="div_input_edt_salePlcNm_OnKillFocus" RightMargin="2" Style="sty_ipt_form" TabOrder="10" Top="7" Width="104"></Edit>
				<Button Height="21" Id="btn_salePlc" ImageID="btn_i_detail" Left="787" OnClick="div_input_btn_salePlc_OnClick" TabOrder="11" Text="Button0" Top="7" Width="19"></Button>
				<Edit BindDataset="ds_master" Border="Flat" Column="SALE_PLC_UKEY_CD" Enable="FALSE" Height="20" Id="edt_salePlcUkeyCd" Left="807" LeftMargin="2" RightMargin="2" Style="sty_ipt_form" TabOrder="17" TabStop="FALSE" Top="7" Width="56"></Edit>
				<Edit BindDataset="ds_master" Border="Flat" Column="STL_PLC_SUB_CD" Enable="FALSE" Height="20" Id="edt_salePlcSubCd" Left="864" LeftMargin="2" RightMargin="2" Style="sty_ipt_form" TabOrder="13" TabStop="FALSE" Top="7" Width="56"></Edit>
				<Edit BindDataset="ds_master" Border="Flat" Column="SALE_PLC_CHANNEL_CD" Enable="FALSE" Height="20" Id="edt_salePlcChannelCd" Left="921" LeftMargin="2" RightMargin="2" Style="sty_ipt_form" TabOrder="14" TabStop="FALSE" Top="7" Width="56"></Edit>
				<Edit BindDataset="ds_master" Border="Flat" Column="SALE_PLC" Height="20" Id="edt_salePlc" Left="975" LeftMargin="2" RightMargin="2" Style="sty_ipt_form" TabOrder="12" TabStop="FALSE" Top="7" Visible="FALSE" Width="11"></Edit>
				<Edit BindDataset="ds_master" Border="Flat" Column="STL_PLC_NM" Enable="FALSE" Height="20" Id="edt_stlPlcNm" Left="684" LeftMargin="2" OnKeyDown="div_search_edt_payPlcNm_OnKeyDown" RightMargin="2" Style="sty_ipt_form" TabOrder="18" TabStop="FALSE" Top="30" Visible="FALSE" Width="11"></Edit>
				<Edit BindDataset="ds_master" Border="Flat" Column="SALE_PLC_UKEY_CD" Enable="FALSE" Height="20" Id="edt_stlPlcUkeyCd" Left="694" LeftMargin="2" RightMargin="2" Style="sty_ipt_form" TabOrder="16" TabStop="FALSE" Top="30" Visible="FALSE" Width="11"></Edit>
				<Edit BindDataset="ds_master" Border="Flat" Column="STL_PLC_SUB_CD" Enable="FALSE" Height="20" Id="edt_stlPlcSubCd" Left="704" LeftMargin="2" RightMargin="2" Style="sty_ipt_form" TabOrder="19" TabStop="FALSE" Top="30" Visible="FALSE" Width="11"></Edit>
				<Edit BindDataset="ds_master" Border="Flat" Column="STL_PLC_CHANNEL_CD" Enable="FALSE" Height="20" Id="edt_stlPlcChannelCd" Left="714" LeftMargin="2" RightMargin="2" Style="sty_ipt_form" TabOrder="21" TabStop="FALSE" Top="30" Visible="FALSE" Width="11"></Edit>
				<Edit BindDataset="ds_master" Border="Flat" Column="STL_PLC" Height="20" Id="edt_stlPlc" Left="724" LeftMargin="2" RightMargin="2" Style="sty_ipt_form" TabOrder="15" TabStop="FALSE" Top="30" Visible="FALSE" Width="11"></Edit>
				<Static Align="Right" Height="20" Id="Static4" Left="606" Style="sty_lb_Basic" TabOrder="25" Text="정산처" Top="30" VAlign="Middle" Visible="FALSE" Width="76"></Static>
				<Static Align="Right" Height="20" Id="Static5" Left="334" Style="sty_lb_Basic" TabOrder="26" Text="대리점" Top="6" VAlign="Middle" Width="60"></Static>
				<Edit BindDataset="ds_master" Border="Flat" Column="AGENCY_CD_NM" Height="20" Id="edt_agencyCdNm" Left="397" MaxLength="10" OnCharChanged="div_input_edt_agencyCdNm_OnCharChanged" OnKeyDown="div_input_edt_agencyCdNm_OnKeyDown" OnKillFocus="div_input_edt_agencyCdNm_OnKillFocus" Style="sty_ipt_form" TabOrder="7" Top="6" UpperOnly="TRUE" Width="86"></Edit>
				<Button BindDataset="ds_DlvFee" Cursor="HAND" Height="20" Id="btn_agency" ImageID="btn_i_detail_b" Left="482" OnClick="div_input_btn_agency_OnClick" TabOrder="8" Text="Button0" Top="6" Width="20"></Button>
				<Edit BindDataset="ds_master" Border="Flat" Column="AG_UKEY_AGENCY_CD" Enable="FALSE" Height="20" Id="edt_agencyUkeyCd" Left="500" MaxLength="10" Style="sty_ipt_form" TabOrder="22" TabStop="FALSE" Top="6" UpperOnly="TRUE" Width="68"></Edit>
				<Edit BindDataset="ds_master" Border="Flat" Column="AGENCY_CD" Height="20" Id="edt_agencyCd" Left="571" MaxLength="10" Style="sty_ipt_form" TabOrder="23" TabStop="FALSE" Top="6" UpperOnly="TRUE" Visible="FALSE" Width="8"></Edit>
				<Image Height="20" Id="Image2" ImageID="bul_mand" Left="629" TabOrder="25" TabStop="FALSE" Top="7" Transparent="TRUE" Width="20"></Image>
				<Image Height="20" Id="Image3" ImageID="bul_mand" Left="342" TabOrder="26" TabStop="FALSE" Top="7" Transparent="TRUE" Width="20"></Image>
				<Edit BindDataset="ds_master" Border="Flat" Column="DIS_HLD_PLC" Height="20" Id="edt_disHldPlc" Left="736" LeftMargin="2" RightMargin="2" Style="sty_ipt_form" TabOrder="33" TabStop="FALSE" Top="30" Visible="FALSE" Width="11"></Edit>
			</Contents>
		</Div>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" BindDataset="ds_list" BkColor2="user32" BoldHead="true" Border="Flat" Bottom="495" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" FillArea="TRUE" FillAreaType="Control" HeadBorder="Flat" HeadHeight="22" Height="383" Id="grd_list" InputPanel="FALSE" Left="8" LineColor="user33" MinWidth="100" OnCellClick="grd_list_OnCellClick" OnChar="grd_list_OnChar" OnEnterDown="grd_list_OnEnterDown" OnExpandUp="grd_list_OnExpandUp" OnHeadClick="cf_markGridSort" Right="1008" RowHeight="21" Style="sty_Grid" TabOrder="7" TabStop="true" Top="112" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="user33" WheelScrollRow="1" Width="1000">
			<contents>
				<format id="Default">
					<columns>
						<col width="70"/>
						<col width="63"/>
						<col width="58"/>
						<col width="109"/>
						<col width="73"/>
						<col width="79"/>
						<col width="63"/>
						<col width="94"/>
						<col width="56"/>
						<col width="64"/>
						<col width="101"/>
						<col width="0"/>
						<col width="0"/>
					</columns>
					<head>
						<cell bkcolor="user34" col="0" color="user35" display="text" text="번호"/>
						<cell bkcolor="user34" col="1" color="user35" display="text" text="구분"/>
						<cell bkcolor="user34" col="2" color="user35" display="text" text="*&#32;상품구분"/>
						<cell bkcolor="user34" col="3" color="user35" display="text" text="*&#32;일련번호"/>
						<cell bkcolor="user34" col="4" color="user35" display="text" text="*&#32;제조사"/>
						<cell bkcolor="user34" col="5" color="user35" display="text" text="*&#32;모델"/>
						<cell bkcolor="user34" col="6" color="user35" display="text" text="*&#32;색상"/>
						<cell bkcolor="user34" col="7" color="user35" display="text" text="보유처"/>
						<cell bkcolor="user34" col="8" color="user35" display="text" text="*&#32;판매수량"/>
						<cell bkcolor="user34" col="9" color="user35" display="text" text="*&#32;판매단가"/>
						<cell bkcolor="user34" col="10" color="user35" display="text" text="판매가"/>
						<cell bkcolor="user34" col="11" color="user35" display="text" text="원&#32;단가"/>
						<cell bkcolor="user34" col="12" color="user35" display="text" text="원&#32;판매&#32;단가"/>
					</head>
					<body>
						<cell align="center" bkcolor="expr:iif((max==null&#32;||&#32;free_prod_sale_chg_seq&#32;==&#32;max)&#32;&amp;&amp;&#32;sale_chg_hst_cl&#32;==&#32;&apos;01&apos;,&apos;default&apos;,&apos;User13&apos;)" col="0" display="text" expr="row+1"/>
						<cell align="center" bkcolor="expr:iif((max==null&#32;||&#32;free_prod_sale_chg_seq&#32;==&#32;max)&#32;&amp;&amp;&#32;sale_chg_hst_cl&#32;==&#32;&apos;01&apos;,&apos;default&apos;,&apos;User13&apos;)" col="1" colid="sale_chg_hst_cl" combocol="COMM_CD_VAL" combodataset="ds_saleChgHstCl" combotext="COMM_CD_VAL_NM" display="combo"/>
						<cell bkcolor="expr:iif((max==null&#32;||&#32;free_prod_sale_chg_seq&#32;==&#32;max)&#32;&amp;&amp;&#32;sale_chg_hst_cl&#32;==&#32;&apos;01&apos;,&apos;default&apos;,&apos;User13&apos;)" col="2" colid="PROD_CL" combocol="COMM_CD_VAL" combodataset="ds_prodCl" combotext="COMM_CD_VAL_NM" display="combo" edit="expr:iif((max==null&#32;&amp;&amp;&#32;sale_chg_hst_cl&#32;==&#32;&apos;01&apos;),&#32;&apos;combo&apos;,&#32;&apos;none&apos;)"/>
						<cell bkcolor="expr:iif((max==null&#32;||&#32;free_prod_sale_chg_seq&#32;==&#32;max)&#32;&amp;&amp;&#32;sale_chg_hst_cl&#32;==&#32;&apos;01&apos;,&apos;default&apos;,&apos;User13&apos;)" col="3" colid="SER_NUM" display="text" edit='expr:iif((max==null&#32;||&#32;free_prod_sale_chg_seq&#32;==&#32;max)&#32;&amp;&amp;&#32;sale_chg_hst_cl&#32;==&#32;&apos;01&apos;&#32;&amp;&amp;&#32;(prod_cl&#32;==&#32;&apos;1&apos;&#32;||&#32;prod_cl&#32;==&#32;&apos;2&apos;&#32;||&#32;prod_cl&#32;==&#32;&apos;&apos;),&#32;&quot;normal&quot;,&#32;&quot;none&quot;)'/>
						<cell bkcolor="expr:iif((max==null&#32;||&#32;free_prod_sale_chg_seq&#32;==&#32;max)&#32;&amp;&amp;&#32;sale_chg_hst_cl&#32;==&#32;&apos;01&apos;,&apos;default&apos;,&apos;User13&apos;)" col="4" colid="MFACT_ID_NM" display="text" edit="expr:iif((max==null&#32;||&#32;free_prod_sale_chg_seq&#32;==&#32;max)&#32;&amp;&amp;&#32;sale_chg_hst_cl&#32;==&#32;&apos;01&apos;&#32;&amp;&amp;&#32;prod_cl&#32;==&apos;9&apos;,&#32;&apos;normal&apos;,&#32;&apos;none&apos;)" expandimage="btn_i_detail_b" expandshow="expr:iif((max==null&#32;||&#32;free_prod_sale_chg_seq&#32;==&#32;max)&#32;&amp;&amp;&#32;sale_chg_hst_cl&#32;==&#32;&apos;01&apos;&#32;&amp;&amp;&#32;prod_cl&#32;==&apos;9&apos;,&#32;true,&#32;false)"/>
						<cell align="center" bkcolor="expr:iif((max==null&#32;||&#32;free_prod_sale_chg_seq&#32;==&#32;max)&#32;&amp;&amp;&#32;sale_chg_hst_cl&#32;==&#32;&apos;01&apos;,&apos;default&apos;,&apos;User13&apos;)" col="5" colid="PROD_NM" display="text" edit='expr:iif((max==null&#32;||&#32;free_prod_sale_chg_seq&#32;==&#32;max)&#32;&amp;&amp;&#32;sale_chg_hst_cl&#32;==&#32;&apos;01&apos;&#32;&amp;&amp;&#32;prod_cl&#32;==&apos;9&apos;,&#32;&quot;normal&quot;,&#32;&quot;none&quot;)' expandimage="btn_i_detail_b" expandshow="expr:iif((max==null&#32;||&#32;free_prod_sale_chg_seq&#32;==&#32;max)&#32;&amp;&amp;&#32;sale_chg_hst_cl&#32;==&#32;&apos;01&apos;&#32;&amp;&amp;&#32;prod_cl&#32;==&apos;9&apos;,&#32;true,&#32;false)"/>
						<cell align="center" bkcolor="expr:iif((max==null&#32;||&#32;free_prod_sale_chg_seq&#32;==&#32;max)&#32;&amp;&amp;&#32;sale_chg_hst_cl&#32;==&#32;&apos;01&apos;,&apos;default&apos;,&apos;User13&apos;)" col="6" colid="COLOR_CD" combocol="COLOR_CD" combodataset="ds_colorList" combofilter="expr:f_getColorFilter()" combotext="COLOR_NM" display="combo" edit="expr:iif((max==null&#32;||&#32;free_prod_sale_chg_seq&#32;==&#32;max)&#32;&amp;&amp;&#32;sale_chg_hst_cl&#32;==&#32;&apos;01&apos;&#32;&amp;&amp;&#32;prod_cl&#32;==&apos;9&apos;,&#32;&apos;combo&apos;,&#32;&apos;none&apos;)"/>
						<cell align="center" bkcolor="expr:iif((max==null&#32;||&#32;free_prod_sale_chg_seq&#32;==&#32;max)&#32;&amp;&amp;&#32;sale_chg_hst_cl&#32;==&#32;&apos;01&apos;,&apos;default&apos;,&apos;User13&apos;)" col="7" colid="HLD_PLC_NM" display="text"/>
						<cell align="right" bkcolor="expr:iif(((max==null&#32;||&#32;free_prod_sale_chg_seq&#32;==&#32;max)&#32;&amp;&amp;&#32;sale_chg_hst_cl&#32;==&#32;&apos;01&apos;),&apos;default&apos;,&apos;User13&apos;)" col="8" colid="SALE_QTY" display="number" edit='expr:iif((max==null&#32;||&#32;free_prod_sale_chg_seq&#32;==&#32;max)&#32;&amp;&amp;&#32;sale_chg_hst_cl&#32;==&#32;&apos;01&apos;&#32;&amp;&amp;&#32;prod_cl&#32;==&apos;9&apos;,&#32;&quot;number&quot;,&#32;&quot;none&quot;)' limit="8"/>
						<cell align="right" bkcolor="expr:iif(((max==null&#32;||&#32;free_prod_sale_chg_seq&#32;==&#32;max)&#32;&amp;&amp;&#32;sale_chg_hst_cl&#32;==&#32;&apos;01&apos;),&apos;default&apos;,&apos;User13&apos;)" col="9" colid="SALE_UNIT_PRC" display="number"/>
						<cell align="right" bkcolor="expr:iif((max==null&#32;||&#32;free_prod_sale_chg_seq&#32;==&#32;max)&#32;&amp;&amp;&#32;sale_chg_hst_cl&#32;==&#32;&apos;01&apos;,&apos;default&apos;,&apos;User13&apos;)" col="10" colid="SALE_AMT" display="number"/>
						<cell align="right" col="11" colid="FIX_STRD_SALE_PRC" display="number"/>
						<cell col="12" colid="PROD_ORG_PRC" display="text"/>
					</body>
					<summary>
						<cell bkcolor="user37" col="0" color="user38" display="text"/>
						<cell bkcolor="user37" col="1" color="user38" display="text"/>
						<cell bkcolor="user37" col="2" color="user38" display="text"/>
						<cell bkcolor="user37" col="3" color="user38" display="text"/>
						<cell bkcolor="user37" col="4" color="user38" display="text"/>
						<cell bkcolor="user37" col="5" color="user38" display="text"/>
						<cell align="right" bkcolor="user37" col="6" color="user38" display="text" font="돋움,10,Bold"/>
						<cell align="right" bkcolor="user37" col="7" color="user38" display="text" font="돋움,10,Bold" text="합계"/>
						<cell align="right" bkcolor="user37" col="8" color="user38" display="number" expr='SUM(&quot;SALE_QTY&quot;)'/>
						<cell align="right" bkcolor="user37" col="9" color="user38" display="number" expr='SUM(&quot;(Iif((max&#32;==&#32;free_prod_sale_chg_seq&#32;||&#32;max&#32;==&#32;&apos;&apos;)&#32;&amp;&amp;&#32;sale_chg_hst_cl&#32;==&#32;&apos;01&apos;,SALE_UNIT_PRC,&#32;&apos;0&apos;))&quot;)'/>
						<cell align="right" bkcolor="user37" col="10" color="user38" display="number" expr='SUM(&quot;(Iif((max&#32;==&#32;free_prod_sale_chg_seq&#32;||&#32;max&#32;==&#32;&apos;&apos;)&#32;&amp;&amp;&#32;sale_chg_hst_cl&#32;==&#32;&apos;01&apos;,SALE_AMT,&#32;&apos;0&apos;))&quot;)'/>
						<cell align="right" bkcolor="user37" col="11" color="user38" display="number" expr='SUM(&quot;FIX_STRD_SALE_PRC&quot;)'/>
						<cell align="right" bkcolor="user37" col="12" color="user38" display="normal" expr='SUM(&quot;PROD_ORG_PRC&quot;)'/>
					</summary>
				</format>
			</contents>
		</Grid>
		<Div Border="Raised" Height="56" Id="div_inputCard" Left="8" Style="sty_div_input" TabOrder="8" Text="Div0" Top="500" Width="1000">
			<Contents>
				<Static Align="Right" Height="20" Id="Static13" Left="24" Style="sty_lb_Basic" TabOrder="1" Text="비고" Top="5" VAlign="Middle" Width="60"></Static>
				<TextArea BindDataset="ds_master" Border="Flat" Column="RMKS" Height="41" Id="txt_rmks" ImeMode="none" Left="88" Style="sty_ipt_form" TabOrder="2" Top="5" VScroll="TRUE" Width="900"></TextArea>
			</Contents>
		</Div>
	</Form>
	<Script><![CDATA[/*******************************************************************************
* 프로그램ID : SALAES00200
* 업무명      : 도매영업 - 공기기판매
* 프로그램명  : 공기기판매
--------------------------------------------------------------------------------
* 작성자      : 정재열
* 작성일      : 2009.01.20
--------------------------------------------------------------------------------
* 1. 변경이력
수정자    :
수정일    :
수정 내역 :
*******************************************************************************/

//==============================================================================
// 공통 스크립트 로딩
//==============================================================================
#include "lib::lib_commF.js"
#include "lib::lib_commMsg.js"
#include "lib::lib_commPopup.js"
#include "lib::lib_global.js"
#include "lib::lib_util.js"
#include "lib::lib_SAL.js"


//==============================================================================
// 폼 변수 정의
//==============================================================================
var FV_STR_NAME; // 사용자 이름
var FV_JOB;		// NEW
var FV_FREE_PROD_SALE_NO;		// 변경 판매관리번호
var FV_GNRL_SALE_NO;			// 일반판매관리번호
var FV_GNRL_SALE_CHG_SEQ;		// 일반판매변경번호
var FV_SALE_CHGRG_ID;			// 판매담당자

var FV_BAR_TYPE_CURR_ROW_INDEX = 0;
var	FV_PROD_STA_LEN;
var	FV_PROD_LEN_NUM;
var	FV_COLOR_STA_LEN;
var	FV_COLOR_LEN_NUM;
var	FV_SER_NUM_STA_LEN;
var FV_SER_NUM_LEN_NUM;

var FV_PROD_CD;
var FV_COLOR_CD;
var FV_SER_NUM;
var FV_DIS_CONFIRM_YN = false;  // 재고출고가능 확인 여부 
var FV_UPL_CONFIRM_YN;
var FV_DELETE = false;			// 삭제 여부 

// 글로벌 세션정보
var FV_USER_ID;	// 사용자ID
var FV_USER_NM;		// 사용자명

var	FV_ORG_ID;				// 소속 
var	FV_ORG_NM;				// 소속명
var	FV_ORG_CL;				// 소속구분
var	FV_AGENCY_ID;           // 소속 대리점ID
var	FV_AGENCY_NM;           // 소속 대리점명
var	FV_AGENCY_UKEY_ID;      // 소속 대리점UKEY ID	
	
var	FV_ORG_AREA_ID;				// 근무지 ID
var	FV_ORG_AREA_NM;				// 근무지명
var	FV_ORG_AREA_POS_AGENCY_CD;	// 근무지 
var	FV_ORG_AREA_UKEY_ID;     // 근무지ukeyid
var	FV_ORG_AREA_SUB_CD;      // 근무지subcd
var	FV_ORG_AREA_CHANNEL_CD;  // 근무지 channelcd	
var	FV_USER_GRP;			 // 유저그룹

var	FV_DUTY;					// 사용자 직책
var	FV_ORG_AREA_CL1;			// 근무지 구분


/*******************************************************************************
 * @description    : 최초 폼 로드시 발생 - 이벤트
*******************************************************************************/
function form_OnLoadCompleted(obj)
{
	cf_setAuth(pFrmNum);	// 권한 공통
	cf_setGrdChecknSortEvent(grd_list);	// 그리드 정렬
	
	f_init();
}


/*******************************************************************************
 * @description    : 공통 닫기 함수
*******************************************************************************/
function df_close()
{
	this.Close();
}

/*******************************************************************************
 * @description    : 콜백
 * @param sSvcID   : 서비스 아이디
*******************************************************************************/
function f_callBack(sSvcID)
{
	switch(sSvcID)
	{
	case "svcList":	// 조회
		if(ds_list.GetRowCount() >0)
		{
			div_fuc.btn_add.Enable = false;
			FV_JOB = "MOD";
			
			sf_enable("div_input.edt_agencyCdNm,div_input.btn_agency", false);	// 대리점
			sf_enable("div_input.edt_salePlcNm,div_input.btn_salePlc", false);	// 대리점
			sf_enable("div_input.cal_saleDtm,div_input.edt_saleDtmHH,div_input.edt_saleDtmMM", false);	//  판매일자
			sf_enable("div_input.cal_saleChgDtm,div_input.edt_saleChgDtmHH,div_input.edt_saleChgDtmMM", true);	// 변경일자
			sf_setDate("div_input.cal_saleChgDtm","div_input.edt_saleChgDtmHH","div_input.edt_saleChgDtmMM");
			
			var sMax         = ds_master.GetColumn(0, "MAX");
			var sSaleDtm     = ds_master.GetColumn(0, "SALE_DTM");
			var sSaleChgrgId = ds_master.GetColumn(0, "SALE_CHGRG_ID");
			var sGnrlSaleNo  = ds_master.GetColumn(0, "GNRL_SALE_NO");
			var sGnrlSaleChgSeq  = ds_master.GetColumn(0, "FV_GNRL_SALE_CHG_SEQ");

			FV_GNRL_SALE_NO  = sGnrlSaleNo;
			FV_GNRL_SALE_CHG_SEQ  = sGnrlSaleChgSeq;
			FV_SALE_CHGRG_ID = sSaleChgrgId; 
			
			div_input.cal_saleDtm.Value  = SubStr(sSaleDtm, 0,8);
			div_input.edt_saleDtmHH.Text = SubStr(sSaleDtm, 8,2);
			div_input.edt_saleDtmMM.Text = SubStr(sSaleDtm, 10,2);	
			
			f_getChgrgIdList();
			
			div_input.cmb_saleChgrgId.Value = sSaleChgrgId;
			
			// 마지막 변경 순번 필더만 oldList에 복사해서 판매취소로 활용
			ds_TmpList.Copy(ds_list);
			ds_TmpList.Filter("free_prod_sale_chg_seq=" + quote(sMax)
			              +" && sale_chg_hst_cl='01'");
			ds_oldList.CopyF(ds_TmpList);
			
			if(ds_oldList.GetRowCount() == 0)
			{	// 판매취소건이 없을 경우
				//btn_delete.Enable = false;
			}
			ds_list.UnFilter();

			grd_list_OnCellClick(grd_list,0);

		}
		else
		{	// 조회 건수가 없을 경우 
			FV_JOB = "NEW";
			FV_FREE_PROD_SALE_NO = "";
			div_fuc.btn_add.Enable = true;
		}
		break;
	
	case "svcMfactLst":	// 제조사		
		//f_mdlList();
		break;

	case "svcMdlList":	// 모델

		break;

	case "svcColorList":	// 상품색상리스트
		f_setFilterProdColor();
		break;
	
	case "svcAllColorList":
		ds_colorList.insertRow(0);			
		ds_colorList.SetColumn(0, "COLOR_CD" , "");
		ds_colorList.SetColumn(0, "COLOR_NM", "선택");
		break;

	case "svcUplst":	// 운영단가표
		var nRow = ds_list.currow;
		var sSaleUnitPrc = "0";
		if(ds_uplst.GetRowCount() > 0)
		{
			sSaleUnitPrc = ds_uplst.GetColumn(0,"fix_strd_sale_prc");
			ds_list.SetColumn(nRow, "fix_strd_sale_prc", sSaleUnitPrc);
			
			btn_save.Enable = true;
			FV_UPL_CONFIRM_YN = true;
		}
		else	
		{
			ds_list.SetColumn(nRow, "fix_strd_sale_prc", "0");
			alert("판매 불가능한 상품입니다.");

			FV_UPL_CONFIRM_YN = false;
		}

		ds_list.SetColumn(nRow, "SALE_UNIT_PRC" , sSaleUnitPrc);
		break;


	case "svcStlPlc":	//  정산처
		var sStlPlc     = ds_stlPlc.GetColumn(0,"STL_PLC");
		var sStlPlcNm   = ds_stlPlc.GetColumn(0,"STL_PLC_NM");	
		var sUkeyCd     = ds_stlPlc.GetColumn(0,"ukey_agency_cd");
		var sSubCd      = ds_stlPlc.GetColumn(0,"ukey_sub_cd");	
		var sChannelCd  = ds_stlPlc.GetColumn(0,"ukey_channel_cd");	
		var sDealEndYn  = ds_stlPlc.GetColumn(0,"deal_end_yn");		// 거래종료여부
		var sSaleStopYn = ds_stlPlc.GetColumn(0,"sale_stop_yn");	// 판매정지여부     
		var sDisHldPlc  = ds_stlPlc.GetColumn(0,"dis_hld_plc");	

		if (sDealEndYn == 'N' && sSaleStopYn == 'N')
		{	// 판매가능한 상태
			btn_save.Enable = true;		
		}
		else
		{	// 판매 불가 상태
			//btn_save.Enable = false; // 20090417
		}

		div_input.edt_stlPlc.Text           = sStlPlc;
		div_input.edt_stlPlcNm.Text         = sStlPlcNm;
		div_input.edt_stlPlcUkeyCd.Text     = sUkeyCd;
		div_input.edt_stlPlcSubCd.Text      = sSubCd;
		div_input.edt_stlPlcChannelCd.Text  = sChannelCd; 
		div_input.edt_disHldPlc.Text        = sDisHldPlc; 

		break;

	case "svcSave":	// 저장
		var sErrCode = ds_saleMgmtNo.GetColumn(0, "errcode");
		if(sErrCode == "F")
		{
			alert(ds_saleMgmtNo.GetColumn(0, "errmsg"));
			return;
		}
		FV_FREE_PROD_SALE_NO = ds_saleMgmtNo.GetColumn(0, "free_prod_sale_no");
		FV_JOB = "MOD";
		ds_mdl.DeleteAll();
		ds_colorList.DeleteAll();
		
		// 재조회
		Parent.btn_searchList_OnClick();
		ds_list.ApplyChange();
		Close();
		break;
		
	case "svcHldPlc":	//  보유처
		var nRow = ds_list.currow;
		ds_list.SetColumn(nRow ,"HLD_PLC", ds_hldPlc.GetColumn(0,"deal_co_cd"));
		ds_list.SetColumn(nRow ,"HLD_PLC_NM", ds_hldPlc.GetColumn(0,"deal_co_nm"));
		ds_list.SetColumn(nRow ,"HLD_PLC_UKEY_CD", ds_hldPlc.GetColumn(0,"ukey_agency_cd"));
		ds_list.SetColumn(nRow ,"HLD_PLC_SUB_CD", ds_hldPlc.GetColumn(0,"ukey_sub_cd"));
		ds_list.SetColumn(nRow ,"HLD_PLC_CHANNEL_CD", ds_hldPlc.GetColumn(0,"ukey_channel_cd"));
		break;
		
	case "svcDelete":	// 삭제
		Parent.btn_searchList_OnClick();
		
		ds_list.ApplyChange();
		Close();
		break;
		
	case "getUsimMdlInfo":
		var nRow = ds_list.currow;
        if (ds_output.rowcount > 0)
        {			
			if(ds_output.rowcount > 1)
			{

				//단말기 일련번호에 해당하는 모델이 2개 이상이면 popup창에서 선택할수 있게 한다.
				sf_salDupProdPop(nRow, "ds_list","ds_output", "f_validProd(" +nRow+ ")");
				return;	
	
			}
             
			if(ds_output.rowcount == 1)
			{
				if ( Left(ds_output.GetColumn(0,"errcode"),1) == "F" )
				{
					// 실보유처 검색
					ds_list.SetColumn(nRow, "HLD_PLC", ds_output.GetColumn(0,"DIS_HLD_PLC_ID"));
	
					f_getHldPlc();
				
					alert(ds_output.GetColumn(0,"errmsg"));
					div_input.msk_saleUnitPrc = 0;
					ds_list.SetColumn(nRow, "DIS_COMFIRM_YN" , "0");
					
					FV_DIS_CONFIRM_YN = false;
					// btn_save.Enable = false;	// 20090417
					return;
				}
			
				// 전체 색상(그리드 클릭시 필터링 적용되어 있어 무관할듯)
				ds_colorList.UnFilter();
				
				// 이벤트 제거 : 모델구분,제조사,모델,색상 변경시 항목 클리어가 되기때문에 일단 미적용
				ds_list.onColumnChanged = "";
				
				
				ds_list.SetColumn(nRow, "MFACT_ID"    , ds_output.GetColumn(0,"MFACT_ID"));
				ds_list.SetColumn(nRow, "MFACT_ID_NM" , ds_output.GetColumn(0,"MFACT_ID_NM"));
				ds_list.SetColumn(nRow, "PROD_CL"     , ds_output.GetColumn(0,"PROD_CL"));
				ds_list.SetColumn(nRow, "PROD_CD"     , ds_output.GetColumn(0,"PROD_CD"));
				ds_list.SetColumn(nRow, "PROD_NM"     , ds_output.GetColumn(0,"PROD_NM"));
				ds_list.SetColumn(nRow, "COLOR_CD"    , ds_output.GetColumn(0,"COLOR_CD"));
				ds_list.SetColumn(nRow, "COLOR_CD_NM" , ds_output.GetColumn(0,"COLOR_CD_NM"));
				
				ds_list.SetColumn(nRow, "dis_updcnt" , ds_output.GetColumn(0,"dis_upd_cnt"));
				
				// 이벤트 살리기
				ds_list.onColumnChanged = "ds_list_OnColumnChanged";
				
				FV_DIS_CONFIRM_YN = true;

				// 보유처 검색
				ds_list.SetColumn(nRow, "HLD_PLC", ds_output.GetColumn(0,"DIS_HLD_PLC_ID"));
				f_getHldPlc();

				//  운용단가표 
				FV_DIS_CONFIRM_YN = f_uplst();	
				f_calculateSaleAMT(nRow);
				f_calculateUnitPrc(nRow);
				
				ds_list.SetColumn(nRow, "DIS_COMFIRM_YN" , "1");
			}
             
		}
        else
        {
            alert("일련번호에 해당하는 상품 정보가 없습니다.");
            grd_list.SetFocus();
    		FV_DIS_CONFIRM_YN = false;
    		ds_list.SetColumn(nRow, "DIS_COMFIRM_YN" , "0");
        }			
		break;

	case "getEtcProd":
		FV_DIS_CONFIRM_YN = false;
		var nRow = ds_list.currow;
        if (ds_output.rowcount > 0)
        {
			        
			if(ds_output.rowcount == 1)
			{
				if ( Left(ds_output.GetColumn(0,"errcode"),1) == "F" )
				{
					// 실보유처 검색
					ds_list.SetColumn(nRow, "HLD_PLC", ds_output.GetColumn(0,"DIS_HLD_PLC_ID"));
					f_getHldPlc();
	
					alert(ds_output.GetColumn(0,"errmsg"));
					div_input.msk_saleUnitPrc = 0;
					
					
					ds_list.SetColumn(nRow, "DIS_COMFIRM_YN" , "0");
					return;
				}	
						
				ds_list.SetColumn(nRow, "dis_updcnt" , ds_output.GetColumn(0,"dis_upd_cnt"));

				ds_list.SetColumn(nRow, "HLD_PLC", ds_output.GetColumn(0,"DIS_HLD_PLC_ID"));
				f_getHldPlc();
				
				FV_DIS_CONFIRM_YN = f_uplst();	
				f_calculateSaleAMT(nRow);
				f_calculateUnitPrc(nRow);
				
				ds_list.SetColumn(nRow, "DIS_COMFIRM_YN" , "1");
				btn_save.Enable = true;				
			}
			else
			{
				alert("getEtcProd 확인!!");
				ds_list.SetColumn(nRow, "DIS_COMFIRM_YN" , "0");
			}
		}
        else
        {
            alert("상품 정보가 없습니다.");
            ds_list.SetColumn(nRow, "DIS_COMFIRM_YN" , "0");
        }
		break;		
	
	case "svcBarTypeInfo":	// 바코드 타입 정보 취득
		var nRow = ds_list.currow;
		
		if (ds_BarTypeInfo.RowCount() > 1)
		{
			var sArg  = "";	
				
			Dialog("DIS::DISDCO00900.xml", sArg, 470, 129);
			
		}
		else
		{
			FV_BAR_TYPE_CURR_ROW_INDEX = 0;
		}
		
		var sSerNum = ds_list.GetColumn(nRow, "SER_NUM");
		
		FV_PROD_STA_LEN  = ds_BarTypeInfo.GetColumn(FV_BAR_TYPE_CURR_ROW_INDEX,"mdl_sta_len");
		FV_PROD_LEN_NUM  = ds_BarTypeInfo.GetColumn(FV_BAR_TYPE_CURR_ROW_INDEX,"mdl_len_num");
		FV_COLOR_STA_LEN = ds_BarTypeInfo.GetColumn(FV_BAR_TYPE_CURR_ROW_INDEX,"color_sta_len");
		FV_COLOR_LEN_NUM = ds_BarTypeInfo.GetColumn(FV_BAR_TYPE_CURR_ROW_INDEX,"color_len_num");
		FV_SER_NUM_STA_LEN = ds_BarTypeInfo.GetColumn(FV_BAR_TYPE_CURR_ROW_INDEX,"ser_num_sta_len");
		FV_SER_NUM_LEN_NUM = ds_BarTypeInfo.GetColumn(FV_BAR_TYPE_CURR_ROW_INDEX,"ser_num_len_num");
		
		FV_PROD_CD  = substr(sSerNum, ToInteger(FV_PROD_STA_LEN) - 1, ToInteger(FV_PROD_LEN_NUM) );
		FV_COLOR_CD = substr(sSerNum, ToInteger(FV_COLOR_STA_LEN) - 1, ToInteger(FV_COLOR_LEN_NUM) ) ;
		FV_SER_NUM  = substr(sSerNum, ToInteger(FV_SER_NUM_STA_LEN) - 1, ToInteger(FV_SER_NUM_LEN_NUM) );

		f_getMfactNm(FV_PROD_CD);
		break;
		
	case "svcCheckProdInfo":	// 바코드로 읽은 정보와 일치하는지
		if(ds_CheckProdInfo.rowcount > 0)
		{
			div_input.edt_mfactId.Text   = ds_CheckProdInfo.GetColumn(0, "MFACT_ID");
			div_input.edt_mfactIdNm.Text = ds_CheckProdInfo.GetColumn(0, "MFACT_NM");
			
			var nRow = ds_list.GetRowCount();
			
			http.Sync = true;
			f_mdlList(nRow);		// 모델
			div_input.cmb_mdlCd.Value   = ds_CheckProdInfo.GetColumn(0, "PROD_CD");
			f_prodColorList(nRow);	// 색상
			div_input.cmb_colorCd.Value = ds_CheckProdInfo.GetColumn(0, "COLOR_CD");
			http.Sync = false;			
		}
		else
		{
			alert("기준정보 / 재고 테이블 확인 바랍니다.");
			var nRow = ds_list.GetRowCount();
			
			var sProdCd  = substr(div_input.edt_SerNum.Text, ToInteger(FV_PROD_STA_LEN) - 1, ToInteger(FV_PROD_LEN_NUM) );
			var sColorCd = substr(div_input.edt_SerNum.Text, ToInteger(FV_COLOR_STA_LEN) - 1, ToInteger(FV_COLOR_LEN_NUM) ) ;
			var sSerNum  = substr(div_input.edt_SerNum.Text, ToInteger(FV_SER_NUM_STA_LEN) - 1, ToInteger(FV_SER_NUM_LEN_NUM) );
			
			http.Sync = true;
			f_mdlList(nRow);		// 모델
			div_input.cmb_mdlCd.Value   = sProdCd;
			f_prodColorList(nRow);	// 색상
			div_input.cmb_colorCd.Value = sColorCd;
			http.Sync = false;		
			
			div_input.edt_serNum.Text = sSerNum;
		}
		break;
		
	case "svcMfactNm":
		if(ds_mfactNm.GetRowCount() > 0)
		{
			var nRow = ds_list.currow;
			
			var sMfactId = ds_mfactNm.GetColumn(0, "mfact_id");
			var sMfactNm = ds_mfactNm.GetColumn(0, "mfact_id_nm");
			
			div_input.edt_mfactId.Text   = sMfactId;
			div_input.edt_mfactIdNm.Text = sMfactNm;
			
			http.Sync = true;
			f_mdlList(nRow);		// 모델
			div_input.cmb_mdlCd.Value   = FV_PROD_CD;
			f_prodColorList(nRow);	// 색상
			div_input.cmb_colorCd.Value = FV_COLOR_CD;
			http.Sync = false;		
			div_input.edt_serNum.Text = FV_SER_NUM;
			
			f_getDisPordList();	// 재고 조사
		}
		else
		{
			alert("제조사 정보를 찾지 못했습니다.");
		}
		FV_PROD_CD  = "";
		FV_COLOR_CD = "";
		FV_SER_NUM  = "";
		break;
		
	case "svcChrgrIdList":
		cf_setInitDataForCmb(div_input.cmb_saleChgrgId, "선택");
		break;

	 
	default:
		break;

	}
}
/*******************************************************************************
 공통 스크립트 영역 끝
*******************************************************************************/


//#############################################################################
// 서비스
//#############################################################################


/*******************************************************************************
 * @description    :  제조사명 취득
*******************************************************************************/
function f_getMfactNm(sProdCd)
{
	// 상품 정보 조회
	ds_input.ClearData();
	
	// 입력 파라메터 설정
	cf_setParam(ds_input, "prod_cd", sProdCd);
	
	// 트랜잭션 설정
	var sSvcID = "svcMfactNm";
	var sInDs  = "nc_input_fieldDs=ds_input";
	var sOutDs = "ds_mfactNm=List";
	var sArg   = "sktst.sal.SCO#getMfactNm";
	
	// 공통 트랜잭션 호출
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}

/*******************************************************************************
 * @description    : 재고 가용여부 트랜젝션
*******************************************************************************/
function f_getDisTransaction(sSvcID, sArg)
{
	var nRow     = ds_list.currow;
	var nLength  = f_getLengthSerNum();	// 일련번호 길이 
	var sSaleDtm = div_input.cal_saleDtm.Value;
	var sSalePlc = div_input.edt_salePlc.Text;
	
	var sProdCl  = ds_list.GetColumn(nRow, "PROD_CL");
	var sSerNum  = ds_list.GetColumn(nRow, "SER_NUM");
	var sProdCd  = ds_list.GetColumn(nRow, "PROD_CD");
	var sColorCd = ds_list.GetColumn(nRow, "COLOR_CD");
	var sSaleQty = ds_list.GetColumn(nRow, "SALE_QTY");
	
	var sDisHldPlc = ds_master.GetColumn(0, "dis_hld_plc");

//	sSerNum = Lpad(sSerNum, "0", nLength);
 
	// 입력상품 중복 체크
	if (f_searchSaleDtlTypChk() == false) return;
	
	cf_setParam(ds_input, "sale_dtm"  , sSaleDtm);  //판매일시
	cf_setParam(ds_input, "ser_num"   , sSerNum);   //일련번호
	cf_setParam(ds_input, "sale_plc"  , sDisHldPlc); 	//재고보유처 
	cf_setParam(ds_input, "prod_cl"   , sProdCl);   //상품구분
	cf_setParam(ds_input, "prod_cd"   , sProdCd);	//상품코드
	cf_setParam(ds_input, "color_cd"  , sColorCd);	//상품색상코드
	cf_setParam(ds_input, "sale_qty"  , sSaleQty);	//상품판매수량

	var sInDs  = "nc_input_fieldDs=ds_input";
	var sOutDs = "ds_output=DisProdList";

	http.Sync = true;
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);   
	http.Sync = false;
	return FV_DIS_CONFIRM_YN;
}


/*******************************************************************************
 * @description    :  상품모델 취득
*******************************************************************************/
function f_getChkProdInfo(sProdCd,sColorCd,sSerNum)
{
	// 상품 정보 조회
	ds_input.ClearData();
	
	// 입력 파라메터 설정
	cf_setParam(ds_input, "prod_cd", sProdCd);
	cf_setParam(ds_input, "color_cd", sColorCd);  	
	cf_setParam(ds_input, "ser_num", sSerNum  );  		
	
	// 출력 Dataset 초기화
	ds_CheckProdInfo.ClearData();
	
	// 트랜잭션 설정
	var sSvcID = "svcCheckProdInfo";
	var sInDs  = "nc_input_fieldDs=ds_input";
	var sOutDs = "ds_CheckProdInfo=ds_CheckProdInfo";
	var sArg   = "sktst.dis.DCO#getCheckProdInfo";
	
	// 공통 트랜잭션 호출
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}


/*******************************************************************************
 * @description    : 바코드 타입정보 취득
*******************************************************************************/
function f_getBarTypeInfo()
{
	// 바코드유형 정보 조회
	ds_input.ClearData();
	
	// 입력 파라메터 설정
	cf_setParam(ds_input, "all_len_num", Length(div_input.edt_SerNum.Text));  
		
	// 출력 Dataset 초기화
	ds_BarTypeInfo.ClearData();
	
	// 트랜잭션 설정
	var sSvcID = "svcBarTypeInfo";
	var sInDs  = "nc_input_fieldDs=ds_input";
	var sOutDs = "ds_BarTypeInfo=ds_BarTypeInfo";
	var sArg   = "sktst.dis.DCO#getBarTypeInfo";
	
	// 공통 트랜잭션 호출
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}


/*******************************************************************************
 * @description    : 재고 정보 취득
*******************************************************************************/
function f_getDisPordList()
{
	if(uf_isNull(div_input.edt_salePlc.Text) == true)
	{
		alert(cf_getMessage(MSG_00083, "판매처"));
		div_input.edt_salePlcNm.SetFocus();
		return false;
	}

	var sSvcID = "getUsimMdlInfo";
	var sArg   = "sktst.sal.SCO#getDisFreeProdList";	
	
	return f_getDisTransaction(sSvcID,sArg);
}


/*******************************************************************************
 * @description    :  색상정보 취득
*******************************************************************************/
function f_getColorList()
{
	ds_input.Clear();	

	// 트랜잭션 설정
	var sSvcID = "svcAllColorList";
	var sInDs  = "nc_input_fieldDs=ds_input";
	var sOutDs = "ds_colorList=List";
	var sArg   = "sktst.sal.SCO#getColorList"; 
	
	// 공통 트랜잭션 호출
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}


/*******************************************************************************
 * @description    :  상품 모델 취득
*******************************************************************************/
function f_prodColorList(nRow)
{
	var sMdlCd   = ds_list.GetColumn(nRow, "PROD_CD");
		
	sf_prodColorList( "ds_input", "ds_prodColorList", sMdlCd);
}


/*******************************************************************************
 * @description    :  운용단가표 취득
*******************************************************************************/
function f_uplst()
{
	
	var nRow      = ds_list.currow;
	var sMdlCd    = ds_list.GetColumn(nRow, "PROD_CD");
	var sSaleDtm    = div_input.cal_saleDtm.Value
	                + div_input.edt_saleDtmHH.Text
	                + div_input.edt_saleDtmMM.Text;	

	http.Sync = true;
	sf_getUplst( "ds_input", "ds_uplst", sMdlCd, sSaleDtm);
	http.Sync = false;
	
	return FV_UPL_CONFIRM_YN;
}


/*******************************************************************************
 * @description    :  데이터 리스트 취득
*******************************************************************************/
function f_list()
{
	ds_input.Clear();
		
	cf_setParam(ds_input, "FREE_PROD_SALE_NO", FV_FREE_PROD_SALE_NO);	// 판매관리번호
	
	// 트랜잭션 설정
	var sSvcID = "svcList";
	var sInDs  = "nc_input_fieldDs=ds_input";
	var sOutDs = "ds_list=ds_itemList ds_master=ds_master";
	var sArg   = "sktst.sal.asl.AES#getFreeEquipSaleDtList";
	
	// 공통 트랜잭션 호출
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}


/*******************************************************************************
 * @description    :  정산처 취득
*******************************************************************************/
function f_getStlPlc()
{
	var sPlc     = div_input.edt_salePlc.Text;
	var sSaleDtm = f_getDate("NEW");

	if( uf_isNull(sPlc) == true) 
	{
		//trace('판매처가 입력되지 않았습니다. : ' + sPlc);
		return;
	}


	if( uf_isNull(sSaleDtm) == true) return;
	
	ds_input.Clear();	
	
	sf_getStlPlc( "ds_input", "ds_stlPlc", sPlc, sSaleDtm );
}



/*******************************************************************************
 * @description    :  보유처 취득
*******************************************************************************/
function f_getHldPlc()
{
	var nRow     = ds_list.currow;
	var sPlc     = ds_list.GetColumn(nRow, "HLD_PLC");
	var sSaleDtm = f_getDate("NEW");

	if( uf_isNull(sSaleDtm) == true)
	{
		alert(cf_getMessage(MSG_00083, "판매일자"));	
		return;
	}
	
	ds_input.Clear();	
	cf_setParam(ds_input, "deal_co_cd", sPlc);
	cf_setParam(ds_input, "deal_dtm"  , sSaleDtm);

	// 트랜잭션 설정
	var sSvcID = "svcHldPlc";
	var sInDs  = "nc_input_fieldDs=ds_input";
	var sOutDs = "ds_hldPlc=List";
	var sArg   = "sktst.sal.SCO#getDealCoNmByDealCoCd"; 
	
	// 공통 트랜잭션 호출
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}



//#############################################################################
// 함수 
//#############################################################################


/*******************************************************************************
 * @description    :  최초 로딩시
*******************************************************************************/
function f_init() 
{
	div_input.cal_saleDtm.OnChanged = "";
	div_input.cal_saleChgDtm.OnChanged = "";

	http.Sync = true;
	ds_master.AddRow();
	
	// 디폴트: 오늘날짜 설정
	f_setDefaultDate();	
	
	f_setCombo();	
	f_setAuth();
	

	if(IsExistVar("freeProdSaleNo", true) == true)
	{
		FV_FREE_PROD_SALE_NO = freeProdSaleNo;
	}
	
	if(uf_isNull(FV_FREE_PROD_SALE_NO) == true)
	{
		FV_JOB = "NEW";
		sf_enable("div_input.cal_saleChgDtm,div_input.edt_saleChgDtmHH,div_input.edt_saleChgDtmMM",false);
	}
	else
	{
		sf_enable("div_input.cal_saleDtm,div_input.edt_saleDtmHH,div_input.edt_saleDtmMM",false);
		
		f_list();	// 검색
	}
	// 수정모드일경우 변경일자 오늘날짜 설정
	f_setDefaultDate();	
	
	if(IsExistVar("gnrl_sale_no", true) == true)
	{
		FV_GNRL_SALE_NO                     = gnrl_sale_no;
		FV_GNRL_SALE_CHG_SEQ                = gnrl_sale_chg_seq;
		
		div_input.cal_saleDtm.Value         = gnrl_sale_dt;
		div_input.edt_saleDtmHH.Text        = gnrl_sale_hh;
		div_input.edt_saleDtmMM.Text        = gnrl_sale_mm;
		div_input.edt_salePlcNm.Text        = gnrl_sale_nm;
		div_input.edt_salePlc.Text          = gnrl_sale_plc;
		div_input.edt_salePlcUkeyCd.Text    = gnrl_sale_ukey_cd;
		div_input.edt_salePlcSubCd.Text     = gnrl_sale_sub_cd;
		div_input.edt_salePlcChannelCd.Text = gnrl_sale_channel;	

		f_getChgrgIdList();
		div_input.cmb_saleChgrgId.Value  = gnrl_sale_chgrg_id;	
		
		if(uf_getAuthCode() == 2)
		{			
			div_input.cmb_saleChgrgId.Enable = false;
		}
		
		f_getStlPlc();
		
		div_input.edt_agencyCd.Text     = ds_stlPlc.GetColumn(0,"pos_agency");
		div_input.edt_agencyCdNm.Text   = ds_stlPlc.GetColumn(0,"pos_agency_nm");
		div_input.edt_agencyUkeyCd.Text = ds_stlPlc.GetColumn(0,"ukey_agency_cd");		
		
		sf_enable("div_input.edt_agencyCdNm,div_input.btn_agency", false);	// 대리점
		sf_enable("div_input.edt_salePlcNm,div_input.btn_salePlc", false);	// 대리점
		sf_enable("div_input.cal_saleDtm,div_input.edt_saleDtmHH,div_input.edt_saleDtmMM", false);	//  판매일자
		sf_enable("div_input.cal_saleChgDtm,div_input.edt_saleChgDtmHH,div_input.edt_saleChgDtmMM", false);	// 변경일자
		
	}
		
	http.Sync = false;
	div_input.cal_saleDtm.OnChanged    = "div_input_cal_saleDtm_OnChanged";
	div_input.cal_saleChgDtm.OnChanged = "div_input_cal_saleChgDtm_OnChanged";

}


/*******************************************************************************
 * @description    : 글로벌 섹션 정보
*******************************************************************************/
function f_getSession()
{
	FV_USER_ID        = gds_session.GetColumn(0, "loginid");	// 사용자ID
	FV_USER_NM        = gds_session.GetColumn(0, "usernm");		// 사용자명

	FV_ORG_ID         = gds_session.GetColumn(0, "orgid");				// 소속 
	FV_ORG_NM         = gds_session.GetColumn(0, "orgnm");				// 소속명
	FV_ORG_CL         = gds_session.GetColumn(0, "orgcl");				// 소속구분
	FV_AGENCY_ID      = gds_session.GetColumn(0, "posAgencyId");        // 소속 대리점ID
	FV_AGENCY_NM      = gds_session.GetColumn(0, "posAgencyNm");        // 소속 대리점명
	FV_AGENCY_UKEY_ID = gds_session.GetColumn(0, "posAgencyUkeyId");    // 소속 대리점UKEY ID	
	
	FV_ORG_AREA_ID            = gds_session.GetColumn(0, "orgareaid");			// 근무지 ID
	FV_ORG_AREA_NM            = gds_session.GetColumn(0, "orgareanm");			// 근무지명
	FV_ORG_AREA_POS_AGENCY_CD = gds_session.GetColumn(0, "orgareaposagencycd");	// 근무지 
	FV_ORG_AREA_UKEY_ID       = gds_session.GetColumn(0, "orgareaukeyid");      // 근무지ukeyid
	FV_ORG_AREA_SUB_CD        = gds_session.GetColumn(0, "orgareaukeysubcd");   // 근무지subcd
	FV_ORG_AREA_CHANNEL_CD    = gds_session.GetColumn(0, "orgareaukeychannelcd");  // 근무지 channelcd	
	FV_USER_GRP               = gds_session.GetColumn(0, "usergrp");			// 유저그룹
	
	FV_ORG_AREA_CL1           = gds_session.GetColumn(0, "orgareacl1");			// 근무지 구분
	FV_DUTY                   = gds_session.GetColumn(0, "duty");	   		    // 직책			

}




/*******************************************************************************
 * @description    : 권한 설정
*******************************************************************************/
function f_setAuth()
{
	f_getSession();

	uf_enableAgencyByAuth("div_input", "edt_agencyCdNm,edt_agencyCd,btn_agency", "edt_agencyUkeyCd");
	uf_enableDealByAuth("div_input", "edt_salePlcNm,edt_salePlc,btn_salePlc", "edt_salePlcUkeyCd,edt_salePlcSubCd,edt_salePlcChannelCd");

	f_getChgrgIdList();		
	uf_enableChgrgByAuth(div_input.cmb_saleChgrgId);
}



/*******************************************************************************
 * @description    :  콤보박스 셋팅
*******************************************************************************/
function f_setCombo()
{
	cf_setCommonCodeDsEnv();
	cf_setCommonCode("ds_prodCl"       , "ZBAS_C_00010", "선택");	// 상품구분
	cf_setCommonCode("ds_saleChgHstCl" , "ZSAL_C_00110");	// 판매 변경이력 구분
	cf_checkCommonCode(); 
	
	// 전체 색상 조회
	f_getColorList();	
	
	cf_setInitDataForCmb(div_input.cmb_saleChgrgId, "선택");
	
}


/*******************************************************************************
 * @description    :  판매담당자 취득
*******************************************************************************/
function f_getChgrgIdList()
{
	var sSalePlc = div_input.edt_salePlc.Text;
	var sSaleDtm = f_getDate("NEW");
	
	// 공통 트랜잭션 호출
	sf_getChgrgIdList("ds_input", "ds_chgrgId", "", sSalePlc, sSaleDtm);
}


/*******************************************************************************
 * @description    :  판매금액 계산
*******************************************************************************/
function f_calculateSaleAMT(nRow)
{
	var sSaleQty    = ds_list.GetColumn(nRow, "SALE_QTY");
	var sSaleUntPrc = ds_list.GetColumn(nRow, "SALE_UNIT_PRC");
	
	var nSaleQty    = Iif(uf_isNull(sSaleQty) == true, 0, ParseInt(sSaleQty));
	var nSaleUntPrc = Iif(uf_isNull(sSaleUntPrc) == true, 0, ParseInt(sSaleUntPrc));

	ds_list.SetColumn(nRow, "SALE_AMT", (nSaleQty*nSaleUntPrc));
}

/*******************************************************************************
 * @description    :  운용모델단가표 확정기준가 판ㅁ개금액 계산
*******************************************************************************/
function f_calculateUnitPrc(nRow)
{
	var sSaleQty        = ds_list.GetColumn(nRow, "SALE_QTY");
	var sFixStrdSalePrc = ds_list.GetColumn(nRow, "FIX_STRD_SALE_PRC");
	
	var nSaleQty    = Iif(uf_isNull(sSaleQty) == true, 0, ParseInt(sSaleQty));
	var nFixStrdSalePrc = Iif(uf_isNull(sFixStrdSalePrc) == true, 0, ParseInt(sFixStrdSalePrc));
	
	ds_list.SetColumn(nRow, "PROD_ORG_PRC", (nSaleQty*nFixStrdSalePrc));
}

/*******************************************************************************
 * @description    :  총 판매금액
*******************************************************************************/
function f_getSaleTotal()
{
	var sSaleTotalAmt   = grd_list.GetCellText("Summ", 0, 10);
	var nSaleTotalAmt   = toNumber(replace(sSaleTotalAmt,",", ""));
	return nSaleTotalAmt;
}


/*******************************************************************************
 * @description    :  저장시 수납정보 유효성 검사(소매용)
*******************************************************************************/
function f_validPayment()
{
	var sCashPayAmt     = div_inputCard.msk_cashPayAmt.Value;
	var sCrdtCrdPayAmt1 = div_inputCard.msk_crdtCrdPayAmt1.Value;
	var sCrdtCrdPayAmt2 = div_inputCard.msk_crdtCrdPayAmt2.Value;
	var sMerBondPayAmt  = div_inputCard.msk_merBondPayAmt.Value;

	var nCashPayAmt     = Iif(sCashPayAmt == "", 0 , ParseInt(sCashPayAmt));
	var nCrdtCrdPayAmt1 = Iif(sCrdtCrdPayAmt1 == "", 0, ParseInt(sCrdtCrdPayAmt1));
	var nCrdtCrdPayAmt2 = Iif(sCrdtCrdPayAmt2 == "", 0, ParseInt(sCrdtCrdPayAmt2));
	var nMerBondPayAmt  = Iif(sMerBondPayAmt == "", 0, ParseInt(sMerBondPayAmt));

	var nSaleTotalAmt   = f_getSaleTotal();
	if(uf_isNull(div_inputCard.cmb_crdtCorp1.Value) == false)
	{
		if(uf_isNull(sCrdtCrdPayAmt1) == true)
		{
			alert(cf_getMessage(MSG_00083, "신용카드1 금액"));
			div_inputCard.msk_crdtCrdPayAmt1.SetFocus();
			return false;
		}	
	}
	if(uf_isNull(div_inputCard.cmb_crdtCorp2.Value) == false)
	{
		if(uf_isNull(sCrdtCrdPayAmt2) == true)
		{
			alert(cf_getMessage(MSG_00083, "신용카드2 금액"));
			div_inputCard.msk_crdtCrdPayAmt2.SetFocus();
			return false;
		}	
	}
	

	if(nSaleTotalAmt != (nCashPayAmt + nCrdtCrdPayAmt1 + nCrdtCrdPayAmt2 + nMerBondPayAmt))
	{
		alert("판매가 총합계와 수납금액이 일치하지 않습니다.");
		return false;
	}
	return true;
}

/*******************************************************************************
 * @description    :  저장 가능 여부 
*******************************************************************************/
function f_validSavePosbility()
{
	if( uf_isNull(FV_SAVE_DEL_DISABLE) == false)
	{
		if(FV_SAVE_DEL_DISABLE == "01")
		{
			alert(cf_getMessage(MSG_00142, "신용카드"));
			return false;
		}
	}
	return true;
}

/*******************************************************************************
 * @description    :  마스터 정보 유효성 검사
*******************************************************************************/
function f_validDate()
{
	// 마스터 정보 유효성 검사
	var sSaleDtm    = substr(f_getDate("NEW"),0,12);
	var sSaleChgDtm = substr(f_getDate("MOD"),0,12);
	

	// 판매일자 체크 
	if(uf_isNull(sSaleDtm) == true)
	{
		alert(cf_getMessage(MSG_00083, "판매일자"));
		div_input.cal_saleDtm.SetFocus();
		return false;	
	}

	if(uf_CheckDate( sSaleDtm ,"YYYYMMDDHH24MI")== false)
	{	// MSG_00061: 입력 오류입니다. 입력 정보를 확인 하십시오 
		alert(cf_getMessage(MSG_00061, "판매일자"));
		return false;
	}
	
	var sNowDate = substr(getDate(), 0, 12);
	var bRetDate = sf_compare(sSaleDtm, sNowDate);

	if( bRetDate == -1)
	{	// MSG_00094 : 이전 날짜만 입력이 가능합니다.
		alert(cf_getMessage(MSG_00094, "판매일자;현재날짜"));
		div_input.cal_saleDtm.SetFocus();
		return false;
	}
	
	// 판매변경일자 체크 
	if(FV_JOB == "MOD")
	{
		// 판매일자 체크 
		if(uf_isNull(sSaleChgDtm) == true)
		{
			alert(cf_getMessage(MSG_00083, "판매변경일자"));
			div_input.cal_saleChgDtm.SetFocus();
			return false;	
		}
	
		if(uf_CheckDate( sSaleChgDtm ,"YYYYMMDDHH24MI")== false)
		{	// MSG_00061: 입력 오류입니다. 입력 정보를 확인 하십시오 
			alert(cf_getMessage(MSG_00061, "판매변경일자"));
			div_input.cal_saleChgDtm.SetFocus();
			return false;
		}
		
		bRetDate = sf_compare(sSaleChgDtm, sNowDate);
		if( bRetDate == -1)
		{	// MSG_00094 : 이전 날짜만 입력이 가능합니다.
			alert(cf_getMessage(MSG_00094, "판매변경일자;현재날짜"));
			div_input.cal_saleDtm.SetFocus();
			return false;
		}
		
		bRetDate = sf_compare(sSaleDtm, sSaleChgDtm);
		if( bRetDate == -1 )
		{	// MSG_00095 : 이후 날짜만 입력이 가능합니다..
			alert(cf_getMessage(MSG_00095, "판매변경일자;판매날짜"));
			div_input.cal_saleDtm.SetFocus();
			return false;
		}
		
	}
	

	
	return true;
}

/*******************************************************************************
 * @description    :  판매 추가시 유효성 검사
*******************************************************************************/
function f_validProd(nRow)
{

	//  데이터 셋 값 변경 이벤트에서 이미 체크를 했을 경우 
	// 변경사항이 없을 경우 
	var sRowType = ds_list.GetRowType(nRow);
	if(sRowType == "normal") return;

	// 마스터 정보 유효성 검사 
	if(f_validDate() == false) return false;
	
	// 그리드 정보 유효성 검사 
	var sProdCl     = ds_list.GetColumn(nRow,"PROD_CL");
	var sSerNum     = ds_list.GetColumn(nRow,"SER_NUM");
	var sSaleQty    = ds_list.GetColumn(nRow,"SALE_QTY");
	var sSeq        = ds_list.GetColumn(nRow,"FREE_PROD_SALE_CHG_SEQ");
	var sMax        = ds_list.GetColumn(nRow,"MAX");
	var sSaleQty    = ds_list.GetColumn(nRow,"SALE_QTY");
	var sSaleUnitPrc= ds_list.GetColumn(nRow,"SALE_UNIT_PRC");

	
	var sFields    = "PROD_CL,MFACT_ID,PROD_CD,COLOR_CD";
	var sFieldNms  = "상품구분,제조사,모델,색상";
	var sPosIndex  = "2,4,5,6";

	var arrFields    = Split(sFields  , ",");
	var arrFieldNm   = Split(sFieldNms, ",");	
	var arrPosIndex  = Split(sPosIndex, ",");	
	var nFields      = arrFields.length();
	
	for(var i=0; i<nFields; i++)
	{
		var sValue = ds_list.GetColumn(nRow, arrFields[i]);

		if(uf_isNull(sValue) == true)
		{	// MSG_00083 : 반드시 입력해야 합니다.
			alert(cf_getMessage(MSG_00083, arrFieldNm[i]));
			grd_list_OnCellClick(grd_list,nRow);
			grd_list.SetFocus();
			grd_list.SetCellPos(arrPosIndex[i]);
			return false;
		}
	}
	
	// 일련번호 유효성 체크
	if(f_searchSaleDtlTypChk() == false) return false;

	// 중복등록 상품 체크
	if(f_chkDupDisItem(nRow) == true) return false;

	if(f_validModedProd(nRow) == false) return false;
	
	return true;
}


/*******************************************************************************
 * @description    :  판매 추가시 유효성 검사
*******************************************************************************/
function f_chkDupDisItem(nRow)
{
	var nRows    = ds_list.GetRowCount();
	var sProdCl  = ds_list.GetColumn(nRow, "PROD_CL");
	var sSerNum  = ds_list.GetColumn(nRow, "SER_NUM");
	var sMdlCd   = ds_list.GetColumn(nRow, "PROD_CD");
	var sColorCd = ds_list.GetColumn(nRow, "COLOR_CD");
	

	for(var i=0; i < nRows; i++)
	{
		var sSeq     = ds_list.GetColumn(i, "FREE_PROD_SALE_CHG_SEQ");
		var sMax     = ds_list.GetColumn(i, "MAX");	
		// 비교대상항목은 제외
		if(nRow == i) continue;
		if(sMax != sSeq) continue;
		
		var sDsSerNum  = ds_list.GetColumn(i, "SER_NUM");
		var sDsMdlCd   = ds_list.GetColumn(i, "PROD_CD");
		var sDsColorCd = ds_list.GetColumn(i, "COLOR_CD");
		
		if(sProdCl == "1" || sProdCl == "2")
		{	// 단말기 USIM
			if( sSerNum == sDsSerNum 
				&& sMdlCd == sDsMdlCd
				&& sColorCd == sDsColorCd)
			{
				alert(cf_getMessage(MSG_00984, "상품"));
				grd_list.SetFocus();
				grd_list.SetCellPos(2);					
				return true;
			}
		}
		else
		{	// 기타 상품
			if( sMdlCd == sDsMdlCd
				&& sColorCd == sDsColorCd)
			{
				alert(cf_getMessage(MSG_00984, "기타 상품"));
				grd_list.SetFocus();
				grd_list.SetCellPos(2);				
				return true;
			}			
		}
	}

	return false;
}



/*******************************************************************************
 * @description    : 판매유형 조회전 validation check
*******************************************************************************/
function f_searchSaleDtlTypChk()
{
	var nRow        = ds_list.currow;
	var sProdCl     = ds_list.GetColumn(nRow,"PROD_CL");
	var sSerNum     = ds_list.GetColumn(nRow,"SER_NUM");

	if(sProdCl == "1" || sProdCl == "2")
	{	// 상품구분에 따라 
		if(uf_isNull(sSerNum) == true)
		{
			alert(cf_getMessage(MSG_00083, "일련번호"));
			grd_list.SetFocus();
			grd_list.SetCellPos(3);	
			return false;				
		}

		var nLength = Length(sSerNum);
/* KIMYS 2010.08   단말기일련번호 고도화
   단말기 일련번호가 15까지 처리됨
		if(sProdCl == "1" && nLength != 7)	// 단말기
		{	// MSG_00030 : 입력 정보를 확인하십시오.
			alert(cf_getMessage(MSG_00030, "단말기 일련번호"));
			grd_list.SetFocus();
			grd_list.SetCellPos(3);	
			return false;		
		}
		else if(sProdCl == "2" && nLength != 8)	// USIM
*/
		if (sProdCl == "2" && nLength != 8)	// USIM
		{	// MSG_00030 : 입력 정보를 확인하십시오.
			alert(cf_getMessage(MSG_00030, "USIM 일련번호"));
			grd_list.SetFocus();
			grd_list.SetCellPos(3);	
			return false;			
		}
	}
	return true;
}



/*******************************************************************************
 * @description    :  수납정보 초기화
*******************************************************************************/
function f_initPayment()
{
	div_inputCard.msk_cashPayAmt.Value       = "0";
	div_inputCard.msk_merBondPayAmt.Value    = "0";
	div_inputCard.msk_crdtCrdPayAmt1.Value   = "0";
	div_inputCard.msk_crdtCrdPayAmt2.Value   = "0";
}


/*******************************************************************************
 * @description    :  디폴트 날짜 셋팅
*******************************************************************************/
function f_setDefaultDate()
{
	if(uf_isNull(FV_JOB) == true || FV_JOB == "NEW")
	{	// 신규일 경우 
		sf_setDate("div_input.cal_saleDtm", "div_input.edt_SaleDtmHH", "div_input.edt_SaleDtmMM");
	}
	else
	{	// 수정일 경우 
		sf_setDate("div_input.cal_saleChgDtm", "div_input.edt_SaleChgDtmHH", "div_input.edt_SaleChgDtmMM");
	}
}


/*******************************************************************************
 * @description    :  디폴트 날짜 셋팅
*******************************************************************************/
function f_getDate(sGubun)
{
	var sRetValue = "";
	if(sGubun == "NEW")
	{
		sRetValue    = div_input.cal_saleDtm.Value
	                 + div_input.edt_saleDtmHH.Text
	                 + div_input.edt_saleDtmMM.Text + "00";
	}
	else
	{
	     sRetValue = div_input.cal_saleChgDtm.Value
				    + div_input.edt_saleChgDtmHH.Text
				    + div_input.edt_saleChgDtmMM.Text;
				    
		if(uf_isNull(sRetValue) == false) 
		{
			sRetValue += "00";
		}
    }
    return sRetValue;
}

/*******************************************************************************
 * @description    :  일련번호 번호 길이
*******************************************************************************/
function f_getLengthSerNum()
{
	var nRet;
	var sProdCl = ds_list.GetColumn(ds_list.currow, "PROD_CL");
	
	if( uf_IsNull(sProdCl) == true) return 0;
	
	if(sProdCl == "1")
	{	// 단말기
		nRet = 7;
	}
	else
	{	// USIM
		nRet = 8;
	}
	return nRet;
}



/*******************************************************************************
 * @description    : Seq Max 이전 값 모두 삭제 판매 건만 남겨두기
*******************************************************************************/
function f_delRowList(sMax)
{
	var nRow = ds_list.GetRowCount();
	for(var i = nRow-1; i >= 0 ;i--)
	{
		var sSeq = ds_list.GetColumn(i, "free_prod_sale_chg_seq");
		if(uf_isNull(sSeq) == true) continue;
		

		if(sMax > sSeq)
		{	// 과거 이력은 모두 삭제
			ds_list.DeleteRow(i);
		}
		else
		{
			var sChangeFields = sf_checkRowChangeField("ds_list", i);

			if( (sChangeFields.indexOf("SER_NUM") != -1) 
				|| (sChangeFields.indexOf("SALE_QTY") != -1) )
			{	
				
				// 이력 데이터 삭제
				var sProdCl  = ds_list.GetOrgBuffColumn(i, "PROD_CL");
				var sPROD_CD = ds_list.GetOrgBuffColumn(i, "PROD_CD");
				var sSerNum  = ds_list.GetOrgBuffColumn(i, "SER_NUM");
				
				if(sProdCl == "9")	
				{	// 기타상품
				}
				else
				{	// 단말기/USIM
					var nFindIndex = ds_oldList.FindRow("SER_NUM", sSerNum);
					//ds_oldList.SetColumn(nFindIndex, "PROC_FLAG", "I");
				}
			}
		}
	}
}



/*******************************************************************************
 * @description    : 색상 설정
*******************************************************************************/
function f_getColorFilter()
{	
	http.Sync = true;
	
	f_prodColorList(ds_list.currow);
	
	var sCondition = "";
	
	for(var i = 0 ; i < ds_prodColorList.rowcount ; i++)
	{
		
		sCondition = sCondition + "color_cd=='"+ds_prodColorList.GetColumn(i,"color_cd")+"'||";
	}
	
	if(ds_prodColorList.rowcount == 1)
	{
		ds_list.SetColumn(ds_list.currow,"color_cd",ds_prodColorList.GetColumn(0,"color_cd"));
	}
		
	var sFilter = sCondition + "color_cd==''";	
	
	http.Sync = false;

	return sFilter;
}


/*******************************************************************************
 * @description    :  색상리스트에 조회한 상품색상으로 필터한다.
*******************************************************************************/
function f_setFilterProdColor()
{
	var sColorCds = "color_cd=='' || ";
	var iRowCnt   = ds_prodColorList.GetRowCount();

	for(var i = 0 ; i < iRowCnt ; i++ )
	{
		
		if(i>0)
		{
			sColorCds = sColorCds + "||";
		}
		
		sColorCds = sColorCds+ "color_cd==" + quote(ds_prodColorList.GetColumn(i,"color_cd"));
	}
	
	if(iRowCnt == 0)
	{
		ds_colorList.Filter("color_cd=='XXX'");
	}
	else
	{
		ds_colorList.Filter(sColorCds);
	}
}

/*******************************************************************************
 * @description    : 판매가 계산 - OnChar 이벤트에서 사용
                     (데이터 값은 적용전이기 때문에 strPostText의 값 이용)
*******************************************************************************/
function f_setSaleAmt(nCell, nRow, strPostText)
{
	if(nCell != 8 && nCell != 9) return;

	var sSaleQty       = ds_list.GetColumn(nRow, "SALE_QTY");
	var sSaleUnitPrc   = ds_list.GetColumn(nRow, "SALE_UNIT_PRC");

	if(nCell == 8)
	{	// 판매수량
		sSaleQty = strPostText;
	}
	else
	{	// 판매단가
		sSaleUnitPrc = strPostText;
	}

	var nSaleQty       = Iif(uf_isNull(sSaleQty) == true, 0, ToNumber(sSaleQty));
	var nSaleUnitPrc   = Iif(uf_isNull(sSaleQty) == true, 0, ToNumber(sSaleUnitPrc));
	var nSaleAmt       = nSaleUnitPrc * nSaleQty ; // 판매가 
	ds_list.SetColumn(nRow, "SALE_AMT", nSaleAmt);
}

/*******************************************************************************
 * @description    :  판매 담당자 초기화
*******************************************************************************/
function f_initSaleChgrgId()
{
	ds_chgrgId.DeleteAll();
	cf_setInitDataForCmb(div_input.cmb_saleChgrgId, "선택");
}



/*******************************************************************************
 * @description    :  List 에 변경된 데이터가 있는지 
*******************************************************************************/
function f_isChangeList()
{
	var nRows = ds_list.GetRowCount();	
	
	if(ds_list.GetDelRowCount() > 0)
	{
		return true;
	}
	
	for(var i=0; i<nRows;i++)
	{
		if(sf_checkRowChangeField("ds_list", i) != "")
		{
			return true;
		}	
	}
	return false;
}

/*******************************************************************************
 * @description    :  상품 변경으로 인해 재확인
*******************************************************************************/
function f_validModedProd(nRow)
{
	var sChangedField = sf_checkRowChangeField("ds_list", nRow);
	var sDisComfirmYn = ds_list.GetColumn(nRow, "dis_comfirm_yn");
	var sProdCl       = ds_list.GetColumn(nRow, "prod_cl");
	var sRowType      = ds_list.GetRowType(nRow);

	// 이미 재고/운용모델단가 확인이 된 건이일 경우
	if(sDisComfirmYn  == "1") return true;	
	
	if(sProdCl == "9")
	{	// 기타상품
		if( (sChangedField.indexOf("SALE_QTY") != -1)
		|| (sChangedField.indexOf("PROD_CD") != -1) 
		|| (sRowType == "insert")
		)
		{	
			var sSvcID = "getEtcProd";
			var sArg   = "sktst.sal.SCO#getDisEtcProd";	
			
			if(f_getDisTransaction(sSvcID, sArg) == false) return false;
		}
	}
	else
	{	// 단말기 / USIM
		if( (sChangedField.indexOf("PROD_CD") != -1)
		|| (sChangedField.indexOf("SER_NUM") != -1) 
		|| (sRowType == "insert")
		)
		{
			if(f_getDisPordList() == false) return false;
			//if(f_validProd(nRow, false) == false) return;
		}				
	}
	return true;
}

//#############################################################################
// 이벤트 
//#############################################################################


/*******************************************************************************
 * @description    : 엑셀 출력 - 이벤트
*******************************************************************************/
function div_fuc_btn_excel_OnClick(obj)
{
	// oGrd - 엑셀화할 그리드 객체 , nMode - 엑셀 저장 모드 1 or null : 엑셀로드 , 2 : 파일 저장
	cf_exportExcel(grd_list);
}


/*******************************************************************************
 * @description    : 멀티(추가, 수정, 삭제) 작업 - 이벤트
*******************************************************************************/
function btn_saveMulti_OnClick(obj)
{
	if(f_isChangeList() == false)
	{
		alert(cf_getMessage(MSG_00071,""));
		return;
	}

	var nRow = ds_list.currow;
	
	var sSaleChgrgId = div_input.cmb_saleChgrgId.Value;

	if(f_validProd(nRow) == false) return;
	
		if(uf_isNull(FV_UPL_CONFIRM_YN) == false &&  FV_UPL_CONFIRM_YN == false)
	{
		alert('판매 불가능한 상품입니다.');
		return;
	}
		
	if(Confirm( "저장하시겠습니까?" ) == false) return;

	if(FV_JOB == "NEW")
	{	// 신규모드
		ds_master.SetColumn(0, "SALE_DTM"    , f_getDate("NEW"));
		ds_master.SetColumn(0, "SALE_CHG_DTM", f_getDate("NEW"));			
	}
	else
	{	// 수정모드 
		var sMax = ds_master.GetColumn(0, "MAX");
		f_delRowList(sMax);	// 이력 정보 삭제
		var sSaleChgChgrgId = div_input.cmb_saleChgrgId.Value;
		ds_master.SetColumn(0, "SALE_CHGRG_ID", FV_SALE_CHGRG_ID);
		ds_master.SetColumn(0, "SALE_CHG_CHGRG_ID", sSaleChgChgrgId);
		
		ds_master.SetColumn(0, "SALE_DTM"    , f_getDate("NEW"));
		ds_master.SetColumn(0, "SALE_CHG_DTM", f_getDate("MOD"));
	}

	ds_master.SetColumn(0, "CASH_SALE_PRC" , f_getSaleTotal());
	
	// 마스터 테이블 정보 셋팅
	ds_master.SetColumn(0, "FLAG", FV_JOB);
	
	// 일반판매정보
	var sEtcProdOrgPrc = grd_list.GetCellText("Summ", 0, 12);	// 숨겨진 컬럼
	ds_master.SetColumn(0, "GNRL_SALE_NO", uf_null2space(FV_GNRL_SALE_NO));
	ds_master.SetColumn(0, "GNRL_SALE_CHG_SEQ", uf_null2space(FV_GNRL_SALE_CHG_SEQ));
	ds_master.SetColumn(0, "ETC_PROD_ORG_PRC" , uf_null2space( sEtcProdOrgPrc));

	f_ProcDis_Setting("UPDATE");

	ds_payment.AddRow();
	ds_payment.SetColumn(0, "FREE_PROD_SALE_NO",      ds_master.GetColumn(0, "FREE_PROD_SALE_NO",));
	ds_payment.SetColumn(0, "FREE_PROD_SALE_CHG_SEQ", ds_master.GetColumn(0, "FREE_PROD_SALE_CHG_SEQ",));

	// 트랜잭션 설정
	var sSvcID = "svcSave";
	var sInDs  = "itemList=ds_list oldItemList=ds_oldlist master=ds_master payment=ds_payment procdis=ds_ProcDis";
	var sOutDs = "ds_saleMgmtNo=List";
	var sArg   = "sktst.sal.asl.AES#saveFreeEquipSale";

	// 공통 트랜잭션 호출
    cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}


/*******************************************************************************
 * @description    :  삭제 버튼 클릭 이벤트
*******************************************************************************/
function btn_delete_OnClick(obj)
{
	var bFinded = false;
	var nRows = ds_list.GetRowCount();
	
	for(var i=0; i < nRows; i++)
	{
		var sMax  = ds_list.getColumn(i, "MAX");
		if(uf_isNull(sMax) == false)
		{
			bFinded = true;
			break;
		}
	}
	
	if(nRows == 0 || bFinded != true)
	{	// 삭제 가능한 로우가 존재할 경우
		alert(cf_getMessage(MSG_00071,""));
		return;	
	}

	// 마감월 체크
	cf_CheckCloseDay('02', f_getDate("MOD"), "판매변경일자"); // 03 영업
	if(FV_BOOLEAN_CLOSE) return; // 입력한 일자가 마감 되었을 경우 '1'(true) 리턴.
	
	if(Confirm("전체 판매건을 취소하시겠습니까?") == false) return;
	
	if(FV_JOB == "NEW")
	{	// 신규모드
	}
	else
	{	// 수정모드 
		f_delRowList(sMax);	// 이력 정보 삭제
		var sSaleChgChgrgId = div_input.cmb_saleChgrgId.Value;
		ds_master.SetColumn(0, "SALE_CHGRG_ID", FV_SALE_CHGRG_ID);
		ds_master.SetColumn(0, "SALE_CHG_CHGRG_ID", sSaleChgChgrgId);
		ds_master.SetColumn(0, "SALE_CHG_DTM", f_getDate("MOD"));
	}	

	ds_master.SetColumn(0, "FLAG", "DEL");

	f_ProcDis_Setting("DELETE");

	ds_payment.AddRow();
	ds_payment.SetColumn(0, "FREE_PROD_SALE_NO",      ds_master.GetColumn(0, "FREE_PROD_SALE_NO",));
	ds_payment.SetColumn(0, "FREE_PROD_SALE_CHG_SEQ", ds_master.GetColumn(0, "FREE_PROD_SALE_CHG_SEQ",));

	var sSvcID = "svcDelete";
	var sInDs  = "itemList=ds_list oldItemList=ds_oldlist master=ds_master payment=ds_payment procdis=ds_ProcDis";
	var sOutDs = "";
	var sArg   = "sktst.sal.asl.AES#saveFreeEquipSale";

	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}

/*******************************************************************************
 * @description    :  닫기
*******************************************************************************/
function btn_close_OnClick(obj)
{
	Close();
}

/*******************************************************************************
 * @description    :  로우 추가 이벤트
*******************************************************************************/
function div_fuc_btn_add_OnClick(obj)
{
	var nRow = 0;
	if(ds_list.GetRowCount() > 0)
	{	
		nRow = ds_list.currow;
		if(f_validProd(nRow) == false) return;
	}
	nRow = ds_list.AddRow();

	ds_list.SetColumn(nRow, "SALE_CHG_HST_CL", "01");
	ds_list.SetColumn(nRow, "SALE_QTY", "1");
	ds_list.SetColumn(nRow, "SALE_UNIT_PRC", "0");
	ds_list.SetColumn(nRow, "PROD_CL", "");	// 상품구분 선택 항목 선택
	
	// 수납정보
	if( uf_IsNull(FV_GNRL_SALE_NO) == false)
	{
		ds_list.SetColumn(nRow, "PROD_CL", "9");
		grd_list.SetCellProp("Body", 2, "edit", "none");
	}
	
	div_fuc.btn_subtract.Enable = true;
}


/*******************************************************************************
 * @description    :  추가된 로우 삭제
*******************************************************************************/
function div_fuc_btn_subtract_OnClick(obj)
{
	var nRow = ds_list.currow;
	
	var nRows = ds_list.GetRowCount();
	
	if(ds_list.GetRowType(nRow) == "insert")
	{
		ds_list.DeleteRow(nRow);
	}
	else
	{	// 이미 등록된 건
		if(nRows == 0) return;
		
		var sMax = ds_list.GetColumn(nRow,"MAX");
		var sSeq = ds_list.GetColumn(nRow,"FREE_PROD_SALE_CHG_SEQ");
		
		if(sMax > sSeq)
		{
			alert("이력은 삭제할 수 없습니다.");
			return;
		}
		
		if(confirm("선택된 판매건을 취소하시겠습니까?") == false) return;
		
		var sSerNum  = ds_list.GetColumn(nRow,"SER_NUM");
		var nFindIdx = ds_oldList.FindRow("SER_NUM", sSerNum);
		
		// 불량판매취소입고를 위해 PROC_FLAG : I 처리
		ds_list.DeleteRow(nRow);
		FV_DELETE = true;
	}
	
	nRows = ds_list.GetRowCount();
	if(nRows == 0)
	{
	}
	else
	{
		grd_list_OnCellClick(grd_list,nRow-1);
	}
}


/*******************************************************************************
 * @description    :  로우 변경시 유효성 검사
*******************************************************************************/
function ds_list_CanRowPosChange(obj,nOldRow,nRow)
{
	return f_validProd(nOldRow);
}



/*******************************************************************************
 * @description    :  삭제버튼 이벤트
*******************************************************************************/
function btn_deleteRow_OnClick(obj)
{
	df_delete();
}


/*******************************************************************************
 * @description    :  판매일자 변경 이벤트
*******************************************************************************/
function div_input_cal_saleDtm_OnChanged(obj,strOldText,strNewText)
{
	
}



/*******************************************************************************
 * @description    :  판매시간 변경 이벤트
*******************************************************************************/
function div_input_edt_saleDtmHH_OnChanged(obj,strText)
{
	
}

/*******************************************************************************
 * @description    :  판매분 변경 이벤트
*******************************************************************************/
function div_input_edt_saleDtmMM_OnChanged(obj,strText)
{
	
}

/*******************************************************************************
 * @description    :  변경일자 변경 이벤트
*******************************************************************************/
function div_input_cal_saleChgDtm_OnChanged(obj,strOldText,strNewText)
{
	
}

/*******************************************************************************
 * @description    :  변경시간 변경 이벤트
*******************************************************************************/
function div_input_edt_saleChgDtmHH_OnChanged(obj,strText)
{
	
}

/*******************************************************************************
 * @description    :  변경분 변경 이벤트
*******************************************************************************/
function div_input_edt_saleChgDtmMM_OnChanged(obj,strText)
{
	
}



/*******************************************************************************
 * @description    :  그리드 클릭시 판매관리번호 셋팅 이벤트
*******************************************************************************/
function grd_list_OnCellClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{

	var nMax = ds_list.GetColumn(nRow,"MAX");
	var nSeq = ds_list.GetColumn(nRow,"FREE_PROD_SALE_CHG_SEQ");
	
	var sSaleDtm    = ds_list.GetColumn(nRow,"SALE_DTM");
	var sSaleChgDtm = ds_list.GetColumn(nRow,"SALE_CHG_DTM");
	var sProdCl     = ds_list.GetColumn(nRow,"PROD_CL");
	var sMdlCd      = ds_list.GetColumn(nRow,"PROD_CD");
	var sMdlCdNm    = ds_list.GetColumn(nRow,"PROD_NM");
	var sColorCd    = ds_list.GetColumn(nRow,"COLOR_CD");
	var sColorCdNm  = ds_list.GetColumn(nRow,"COLOR_CD_NM");
	var sSaleChgrgId= ds_list.GetColumn(nRow,"SALE_CHGRG_ID");

	// 정산처
	var sStlPlc          = ds_list.GetColumn(nRow,"STL_PLC");
	var sStlPlcNm        = ds_list.GetColumn(nRow,"STL_PLC_NM");
	var sStlPlcUkeyCd    = ds_list.GetColumn(nRow,"STL_PLC_UKEY_CD");
	var sStlPlcSubCd     = ds_list.GetColumn(nRow,"STL_PLC_SUB_CD");
	var sStlPlcChannelCd = ds_list.GetColumn(nRow,"STL_PLC_CHANNEL_CD");

	

	// 상품구분이 null 일 경우 - 선택 -
	if(uf_isNull(sProdCl) == true)
	{
		ds_list.SetColumn(nRow,"PROD_CL", "");
	}

}


/*******************************************************************************
 * @description    :  카드1 콤보 변경 이벤트
*******************************************************************************/
function div_inputCard_cmb_crdtCorp1_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	div_inputCard.msk_crdtCrdPayAmt1.Value = "0";
}

/*******************************************************************************
 * @description    :  카드1 콤보 변경 이벤트
*******************************************************************************/
function div_inputCard_cmb_crdtCorp2_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	div_inputCard.msk_crdtCrdPayAmt2.Value = "0";
}




/*******************************************************************************
 * @description    :  로우 위치 변경 이벤트
*******************************************************************************/
function ds_list_OnRowPosChanged(obj,nOldRow,nRow)
{
	grd_list_OnCellClick(obj,nRow);
}



/*******************************************************************************
 * @description    :  로우의 이미지 클릭 이벤트
*******************************************************************************/
function grd_list_OnExpandUp(obj,nRow,nCell,strVal,nPivotIndex)
{
	var sSaleDtm = div_input.cal_saleDtm.Value;
	var sProdCl = ds_list.GetColumn(nRow, "PROD_CL");
	
	if(uf_isNull(sSaleDtm) == true)
	{	// MSG_00043 : 반드시 입력해야 합니다.
		alert(cf_getMessage(MSG_00043, "판매일자")); 
		div_input.cal_saleDtm.SetFocus();
		return;
	}	
	
	if(uf_isNull(sProdCl) == true)
	{	// MSG_00043 : 반드시 입력해야 합니다.
		alert(cf_getMessage(MSG_00043, "상품구분")); 
		grd_list.SetFocus();
		grd_list.SetCellPos(5);	
		return;
	}
	
	switch(nCell)
	{
	case 4: // 제조사
		if(uf_isNull(sProdCl) == true || sProdCl == "1" || sProdCl == "2") return;
		
		var sArg  = "deal_co_cl1="+quote("20"); // 필수 물류창고, 직영점, 판매점
			sArg += " eff_dtm="+quote(sSaleDtm); // 옵션
	
		cf_callDealPop(sArg, ds_list, "mfact_id_nm,mfact_id", nRow);
		
		break;		
	case 5:	// 모델
		if(uf_isNull(sProdCl) == true || sProdCl == "1" || sProdCl == "2") return;
		var sMfactId = ds_list.GetColumn(nRow, "MFACT_ID");		

		sf_salProdPopDs("ds_list", nRow, sSaleDtm, sProdCl, sMfactId, "f_getColorFilter");
		break;
	default:
		break;
	}
}




/*******************************************************************************
 * @description    :  From 닫을 경우 
*******************************************************************************/
function form_OnUnloadCompleted(obj)
{
	if(ds_list.GetUpdate() == false) return;
	
	if(f_isChangeList() == true)
	{
		if(confirm("변경된 데이타가 미반영 상태입니다. 이대로 종료 하시겠습니까?") == true)
		{
			return true;
		}
		return false;
	}
}



/*******************************************************************************
 * @description    :  그리드 키 입력 이벤트
*******************************************************************************/
function grd_list_OnChar(obj,strPreText,nChar,strPostText,nLLParam,nHLParam,nRow,nCell,nPivotIndex)
{
//trace("grd_list_OnChar(" + nRow + ", " + nCell+ ")" );

	var sSaleQty       = ds_list.GetColumn(nRow, "SALE_QTY");
	var sSaleUnitPrc   = ds_list.GetColumn(nRow, "SALE_UNIT_PRC");
	
	switch(nCell)
	{
	
	case 3:
		if( Length(strPostText) == 0)
		{
			ds_list.SetColumn(nRow, "SER_NUM", "");
		}
		break;
		
	case 8:	// 판매수량
		f_setSaleAmt(nCell, nRow, strPostText);
		break;
		

	case 9:	// 판매단가
		f_setSaleAmt(nCell, nRow, strPostText);
			break;
		
	default:
		break;
	}
	


}

/*******************************************************************************
 * @description    :  그리드 엔터키 입력 이벤트
*******************************************************************************/
function grd_list_OnEnterDown(obj,nRow,nCell,strVal,nPivotIndex)
{
	var sSaleDtm = div_input.cal_saleDtm.Value;
	var sProdCl  = ds_list.GetColumn(nRow, "PROD_CL");
	
	switch(nCell)
	{
	case 3:	// 시리얼 번호 체크
		var nLength = Length(ds_list.GetColumn(nRow, "SER_NUM"));

/* KIMYS 2010.08   단말기일련번호 고도화
 * 단말기 일련번호가 15까지 처리됨
   
		if(nLength < 9)
		{	// 수기입력일 경우 		
			var sRowType = ds_list.GetRowType(nRow);
			if( sRowType == "insert")
			{	// 추가건일 경우
			
				var nLenSerNum = f_getLengthSerNum();
				
				if(nLenSernum != 0)
				{	// 상품구분을 선택했을 경우 자동으로 0을 채움
					strVal = Lpad(strVal, "0", nLenSerNum).ToUpper();
				}

				ds_list.SetColumn(nRow, "SER_NUM", strVal);
				if(f_validDate() == false) return;
				if(f_searchSaleDtlTypChk() == false) return;
				f_getDisPordList();
				if(f_chkDupDisItem(nRow) == true) return;
			}
			else
			{	// 수정일경우 			
				f_validModedProd(nRow);
			}
		}
		else
		{	// 바코드
			f_getBarTypeInfo();
		}
*/

		var sRowType = ds_list.GetRowType(nRow);
		if( sRowType == "insert")
		{	// 추가건일 경우
			
			var nLenSerNum = f_getLengthSerNum();

			ds_list.SetColumn(nRow, "SER_NUM", strVal);
			if(f_validDate() == false) return;
			if(f_searchSaleDtlTypChk() == false) return;
			f_getDisPordList();
			if(f_chkDupDisItem(nRow) == true) return;
		}
		else
		{	// 수정일경우 			
			f_validModedProd(nRow);
		}

		break;
		
	case 4: // 제조사
		if(uf_isNull(sProdCl) == true || sProdCl == "1" || sProdCl == "2") return;
		
		var sArg  = "deal_co_cl1="+quote("20"); // 필수 물류창고, 직영점, 판매점
			sArg += " eff_dtm="+quote(sSaleDtm); // 옵션
	
		cf_callDealPop(sArg, ds_list, "mfact_id_nm,mfact_id", nRow);
		
		break;		
		
	case 5:	// 모델
		if(uf_isNull(sProdCl) == true || sProdCl == "1" || sProdCl == "2") return;
		var sMfactId = ds_list.GetColumn(nRow, "MFACT_ID");		

		sf_salProdPopDs("ds_list", nRow, sSaleDtm, sProdCl, sMfactId, "f_getColorFilter");
		break;		
	}

	
}


/*******************************************************************************
 * @description    :  그리드 셀 값 변경 이벤트
*******************************************************************************/
function ds_list_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
//trace("ds_list_OnColumnChanged(" + nRow + ",'" + strColumnID +"')");
	
	switch(strColumnID)
	{
	case "PROD_CL":	// 상품구분
		ds_list.SetColumn(nRow, "SER_NUM", "");		// 시리얼번호
		
		ds_list.SetColumn(nRow, "MFACT_ID"     , "");	// 제조사코드
		ds_list.SetColumn(nRow, "MFACT_ID_NM"  , "");	// 제조사명
		ds_list.SetColumn(nRow, "PROD_CD"      , "");	// 상품 코드 
		ds_list.SetColumn(nRow, "PROD_NM"      , "");	// 상품명
		ds_list.SetColumn(nRow, "COLOR_CD"     , "");	// 상품색상
		ds_list.SetColumn(nRow, "HLD_PLC"      , "");	// 보유처
		ds_list.SetColumn(nRow, "HLD_PLC_NM"   , "");	// 보유처명
		ds_list.SetColumn(nRow, "HLD_PLC_UKEY_CD"      , "");	// 보유처유니코드
		ds_list.SetColumn(nRow, "HLD_PLC_SUB_CD"       , "");	// 보유처서브코드
		ds_list.SetColumn(nRow, "HLD_PLC_CHANNEL_CD"   , "");	// 보유처채널코드
		ds_list.SetColumn(nRow, "SALE_UNIT_PRC", "0");	// 판매단가
		ds_list.SetColumn(nRow, "SALE_AMT"     , "0");	// 판매가
		ds_list.SetColumn(nRow, "DIS_COMFIRM_YN", "0");	// 재고 확인여부 
		ds_list.OnColumnChanged = "";	
		
		ds_list.OnColumnChanged = "";	
		if(varNewValue == "9")
		{
			ds_list.SetColumn(nRow, "SALE_QTY", "0");
		}
		else
		{
			ds_list.SetColumn(nRow, "SALE_QTY", "1");
		}
		ds_list.OnColumnChanged = "ds_list_OnColumnChanged";	
		break;
		
	case "SER_NUM":
		ds_list.SetColumn(nRow, "MFACT_ID"     , "");	// 제조사코드
		ds_list.SetColumn(nRow, "MFACT_ID_NM"  , "");	// 제조사명
		ds_list.SetColumn(nRow, "PROD_CD"      , "");	// 상품 코드 
		ds_list.SetColumn(nRow, "PROD_NM"      , "");	// 상품명
		ds_list.SetColumn(nRow, "COLOR_CD"     , "");	// 상품색상
		ds_list.SetColumn(nRow, "HLD_PLC"      , "");	// 보유처
		ds_list.SetColumn(nRow, "HLD_PLC_NM"   , "");	// 보유처명
		ds_list.SetColumn(nRow, "HLD_PLC_UKEY_CD"      , "");	// 보유처유니코드
		ds_list.SetColumn(nRow, "HLD_PLC_SUB_CD"       , "");	// 보유처서브코드
		ds_list.SetColumn(nRow, "HLD_PLC_CHANNEL_CD"   , "");	// 보유처채널코드
		ds_list.SetColumn(nRow, "SALE_UNIT_PRC", "0");	// 판매단가
		ds_list.SetColumn(nRow, "SALE_AMT"     , "0");	// 판매가
		ds_list.SetColumn(nRow, "DIS_COMFIRM_YN", "0");	// 재고 확인여부 
		
		var sProdCl = ds_list.GetColumn(nRow, "PROD_CL");
		ds_list.OnColumnChanged = "";
		if(sProdCl == "9")
		{
			ds_list.SetColumn(nRow, "SALE_QTY", "0");
		}
		else
		{
			ds_list.SetColumn(nRow, "SALE_QTY", "1");
		}			
		ds_list.OnColumnChanged = "ds_list_OnColumnChanged";				
		break;
	
	case "MFACT_ID_NM":	//제조사
		ds_list.SetColumn(nRow, "PROD_CD"      , "");	// 상품 코드 
		ds_list.SetColumn(nRow, "PROD_NM"      , "");	// 상품명
		ds_list.SetColumn(nRow, "COLOR_CD"     , "");	// 상품색상
		ds_list.SetColumn(nRow, "HLD_PLC"      , "");	// 보유처
		ds_list.SetColumn(nRow, "HLD_PLC_NM"   , "");	// 보유처명
		ds_list.SetColumn(nRow, "HLD_PLC_UKEY_CD"      , "");	// 보유처유니코드
		ds_list.SetColumn(nRow, "HLD_PLC_SUB_CD"       , "");	// 보유처서브코드
		ds_list.SetColumn(nRow, "HLD_PLC_CHANNEL_CD"   , "");	// 보유처채널코드
		ds_list.SetColumn(nRow, "SALE_UNIT_PRC", "0");	// 판매단가
		ds_list.SetColumn(nRow, "SALE_AMT"     , "0");	// 판매가
		ds_list.SetColumn(nRow, "DIS_COMFIRM_YN", "0");	// 재고 확인여부 
		var sProdCl = ds_list.GetColumn(nRow, "PROD_CL");
		
		ds_list.OnColumnChanged = "";
		if(sProdCl == "9")
		{
			ds_list.SetColumn(nRow, "SALE_QTY", "0");
		}
		else
		{
			ds_list.SetColumn(nRow, "SALE_QTY", "1");
		}				
		ds_list.OnColumnChanged = "ds_list_OnColumnChanged";
		break;
	
	case "PROD_NM":	//상품명
		ds_list.SetColumn(nRow, "COLOR_CD"     , "");	// 상품색상
		ds_list.SetColumn(nRow, "HLD_PLC"      , "");	// 보유처
		ds_list.SetColumn(nRow, "HLD_PLC_NM"   , "");	// 보유처명
		ds_list.SetColumn(nRow, "HLD_PLC_UKEY_CD"      , "");	// 보유처유니코드
		ds_list.SetColumn(nRow, "HLD_PLC_SUB_CD"       , "");	// 보유처서브코드
		ds_list.SetColumn(nRow, "HLD_PLC_CHANNEL_CD"   , "");	// 보유처채널코드
		ds_list.SetColumn(nRow, "SALE_UNIT_PRC", "0");	// 판매단가
		ds_list.SetColumn(nRow, "SALE_AMT"     , "0");	// 판매가		
		ds_list.SetColumn(nRow, "DIS_COMFIRM_YN", "0");	// 재고 확인여부 
		var sProdCl = ds_list.GetColumn(nRow, "PROD_CL");
		
		ds_list.OnColumnChanged = "";
		if(sProdCl == "9")
		{
			ds_list.SetColumn(nRow, "SALE_QTY", "0");
		}
		else
		{
			ds_list.SetColumn(nRow, "SALE_QTY", "1");
		}			
		ds_list.OnColumnChanged = "ds_list_OnColumnChanged";			
		break;
		
	case "SALE_QTY": // 판매수량		
		// 기타상품일 경우에만 상품유효성 검사
		var sProdCl = ds_list.GetColumn(nRow, "PROD_CL");
		if(uf_isNull(sProdCl) == true || sProdCl != 9 ) return;		
		
		//ds_list.SetColumn(nRow, "DIS_COMFIRM_YN", "0");	// 재고 확인여부 
		
		if(f_validProd(nRow) == false) return;


		break;		
	}
}




/*******************************************************************************
 * @description    :  대리점 키 이벤트
*******************************************************************************/
function div_input_edt_agencyCdNm_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
{
	if(nChar == 13)
	{
		var sArg  = "org_id="+quote(FV_ORG_ID); 
			sArg += " org_cl="+quote(FV_ORG_CL); 
			sArg += " eff_dtm="+quote(f_getDate("NEW")); // 옵션
			sArg += " deal_status="+quote("4"); // 옵션 판매정지

		cf_callAgencyPop(sArg, div_input, "edt_agencyCdNm,edt_agencyCd,edt_agencyUkeyCd");

		if(uf_isNull(FV_STR_POP_RESULT) == true) return;
			
		//f_getStlPlc();
		//f_getChgrgIdList();
	}	
}


/*******************************************************************************
 * @description    :  대리점 문자값 변경 이벤트
*******************************************************************************/
function div_input_edt_agencyCdNm_OnCharChanged(obj,strPreText,strPostText)
{

	sf_clearControls("div_input.edt_agencyCd,div_input.edt_agencyUkeyCd");
	sf_clearControls("div_input.edt_salePlcNm,div_input.edt_salePlc,div_input.edt_salePlcUkeyCd,div_input.edt_salePlcSubCd,div_input.edt_salePlcChannelCd");
	sf_clearControls("div_input.edt_stlPlcNm,div_input.edt_stlPlc,div_input.edt_stlPlcUkeyCd,div_input.edt_stlPlcSubCd,div_input.edt_stlPlcChannelCd");	

	f_initSaleChgrgId();	
}


/*******************************************************************************
 * @description    :  대리점 키 이벤트
*******************************************************************************/
function div_input_btn_agency_OnClick(obj)
{
	sf_clearControls("div_input.edt_agencyCd,div_input.edt_agencyUkeyCd");
	sf_clearControls("div_input.edt_salePlcNm,div_input.edt_salePlc,div_input.edt_salePlcUkeyCd,div_input.edt_salePlcSubCd,div_input.edt_salePlcChannelCd");
	sf_clearControls("div_input.edt_stlPlcNm,div_input.edt_stlPlc,div_input.edt_stlPlcUkeyCd,div_input.edt_stlPlcSubCd,div_input.edt_stlPlcChannelCd");	
	
	f_initSaleChgrgId();
	
	var sArg  = "org_id="+quote(FV_ORG_ID); 
		sArg += " org_cl="+quote(FV_ORG_CL); 
		sArg += " eff_dtm="+quote(f_getDate("NEW")); // 옵션
		sArg += " deal_status="+quote("3"); // 옵션 판매정지

	cf_callAgencyPop(sArg, div_input, "edt_agencyCdNm,edt_agencyCd,edt_agencyUkeyCd");	

	if(uf_isNull(FV_STR_POP_RESULT) == true) return;
	
	
	//f_getChgrgIdList();
}


/*******************************************************************************
 * @description    :  판매처 키 이벤트
*******************************************************************************/
function div_input_edt_salePlcNm_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
{
	f_initSaleChgrgId();
	
	if(nChar == 13)
	{
		var sPosAgency = div_input.edt_agencyCd.Text;
		
		if(uf_isNull(sPosAgency) == true)
		{
			alert(cf_getMessage(MSG_00083, "대리점"));
			div_input.edt_agencyCdNm.SetFocus();
			return;
		}

		var sArg  = "deal_co_cl1="+quote(sf_getDealCoCl1());	// 소매 
			sArg += " pos_agency="+quote(sPosAgency); // 옵션
			sArg += " eff_dtm="+quote(f_getDate("NEW")); // 옵션
			sArg += " deal_status="+quote("3"); // 옵션 판매정지
		cf_callDealPop(sArg, div_input, "edt_salePlcNm,edt_salePlc,edt_salePlcUkeyCd,edt_salePlcSubCd,edt_salePlcChannelCd");	
		
		if(uf_isNull(FV_STR_POP_RESULT) == true) return;
		
		f_getChgrgIdList();
		f_getStlPlc();
	}	
}


/*******************************************************************************
 * @description    :  판매처 문자값 변경 이벤트
*******************************************************************************/
function div_input_edt_salePlcNm_OnCharChanged(obj,strPreText,strPostText)
{
	sf_clearControls("div_input.edt_salePlc,div_input.edt_salePlcUkeyCd,div_input.edt_salePlcSubCd,div_input.edt_salePlcChannelCd");
	sf_clearControls("div_input.edt_stlPlcNm,div_input.edt_stlPlc,div_input.edt_stlPlcUkeyCd,div_input.edt_stlPlcSubCd,div_input.edt_stlPlcChannelCd");		
}


/*******************************************************************************
 * @description    :  판매처 버튼 이벤트
*******************************************************************************/
function div_input_btn_salePlc_OnClick(obj)
{
	sf_clearControls("div_input.edt_salePlc,div_input.edt_salePlcUkeyCd,div_input.edt_salePlcSubCd,div_input.edt_salePlcChannelCd");
	sf_clearControls("div_input.edt_stlPlcNm,div_input.edt_stlPlc,div_input.edt_stlPlcUkeyCd,div_input.edt_stlPlcSubCd,div_input.edt_stlPlcChannelCd");	
	
	f_initSaleChgrgId();
	
	var sPosAgency = div_input.edt_agencyCd.Text;
	if(uf_isNull(sPosAgency) == true)
	{
		alert(cf_getMessage(MSG_00083, "대리점"));
		div_input.edt_agencyCdNm.SetFocus();
		return;
	}
	
	var sArg  = "deal_co_cl1="+quote(sf_getDealCoCl1());	// 소매
		sArg += " pos_agency="+quote(sPosAgency); // 옵션
		sArg += " eff_dtm="+quote(f_getDate("NEW")); // 옵션
		sArg += " deal_status="+quote("4"); // 옵션 판매정지
		
	cf_callDealPop(sArg, div_input, "edt_salePlcNm,edt_salePlc,edt_salePlcUkeyCd,edt_salePlcSubCd,edt_salePlcChannelCd");		
	
	if(uf_isNull(FV_STR_POP_RESULT) == true) return;
	
	f_getChgrgIdList();
	f_getStlPlc();
}

/*******************************************************************************
 * @description    :  판매처 포커스 킬포커스 이벤트
*******************************************************************************/
function div_input_edt_salePlcNm_OnKillFocus(obj)
{
	//f_getChgrgIdList();
}


/*******************************************************************************
 * @description    :  대리점 포커스 킬포커스 이벤트
*******************************************************************************/
function div_input_edt_agencyCdNm_OnKillFocus(obj)
{
	//f_getChgrgIdList();
}

/*******************************************************************************
 * @description    :  수정 및 삭제취소를 위한 Dataset 생성
*******************************************************************************/
function f_ProcDis_Setting(sJobFlag)
{			
	ds_ProcDis.Clear();

	// ds_list의 내용중 최종이력만 ds_ProcDis로 복사	
	var sMax         = ds_master.GetColumn(0, "MAX");
	ds_TmpList.Copy(ds_list);

	if (sMax == "" || sMax == null) {
		ds_TmpList.Filter("sale_chg_hst_cl='01'");
	} else {
		ds_TmpList.Filter("free_prod_sale_chg_seq=" + quote(sMax) + " && sale_chg_hst_cl='01'");
	}
	ds_ProcDis.CopyF(ds_TmpList);

	ds_ProcDis.AddColumn("JOB_FLAG");
	ds_ProcDis.AddColumn("SALE_DTM");
	ds_ProcDis.AddColumn("SALE_CHG_DTM");

	// ds_ProcDis의 내용과 ds_oldlist의 내용을 비교하여 Pass / Insert / Delete의 처리구분 Setting
	var sProdCd_P;
	var sProdCd_O;
	var sSerNum_P;
	var sSerNum_O;
	var sFlag;
	var i;
	var j;

	// 삭제 Button Click시 JOB_FLAG 에 'D'를 Setting
	if (sJobFlag == "DELETE") {
		for(i=0; i < ds_ProcDis.rowcount; i++) {			
			ds_ProcDis.SetColumn(i, "JOB_FLAG", "D");
			ds_ProcDis.SetColumn(i, "SALE_DTM",               f_getDate("NEW"));
			ds_ProcDis.SetColumn(i, "SALE_CHG_DTM",           f_getDate("MOD"));
		}
		return;
	}

	// 1. ds_ProcDis 기준
	//    ds_ProcDis에는 존재하나 ds_oldlist에는 없는 경우 - 추가 판매건
	for(i=0; i < ds_ProcDis.rowcount; i++)
	{
		sFlag     = false;
		sProdCd_P = ds_ProcDis.GetColumn(i, "PROD_CD");
		sSerNum_P = ds_ProcDis.GetColumn(i, "SER_NUM");

		for(j=0; j < ds_oldlist.rowcount; j++)
		{
			sProdCd_O = ds_oldlist.GetColumn(j, "PROD_CD");
			sSerNum_O = ds_oldlist.GetColumn(j, "SER_NUM");

			if(sProdCd_P == sProdCd_O && sSerNum_P == sSerNum_O)
			{	
				sFlag = true;
				ds_ProcDis.SetColumn(i, "JOB_FLAG", "P");
			}
		}

		if (sFlag == false) {

			// 마감월 체크
			cf_CheckCloseDay("02", f_getDate("NEW"), "판매일자");
			if(FV_BOOLEAN_CLOSE) return; // 입력한 일자가 마감 되었을 경우 '1'(true) 리턴.

			ds_ProcDis.SetColumn(i, "JOB_FLAG", "I");
			ds_ProcDis.SetColumn(i, "SALE_DTM",               f_getDate("NEW"));
			ds_ProcDis.SetColumn(i, "SALE_CHG_DTM",           f_getDate("MOD"));
		}

	}

	// 2. ds_oldlist 기준
	//    ds_oldlist에는 존재하나 ds_ProcDis에는 없는 경우 - 판매취소건
	for(i=0; i < ds_oldlist.rowcount; i++)
	{
		sFlag     = false;
		sProdCd_O = ds_oldlist.GetColumn(i, "PROD_CD");
		sSerNum_O = ds_oldlist.GetColumn(i, "SER_NUM");

		for(j=0; j < ds_ProcDis.rowcount; j++)
		{
			sProdCd_P = ds_ProcDis.GetColumn(j, "PROD_CD");
			sSerNum_P = ds_ProcDis.GetColumn(j, "SER_NUM");

			if(sProdCd_P == sProdCd_O && sSerNum_P == sSerNum_O)
			{	
				sFlag = true;
				ds_ProcDis.SetColumn(j, "JOB_FLAG", "P");
			}
		}

		if (sFlag == false) {

			// 마감월 체크
			cf_CheckCloseDay("02", f_getDate("MOD"), "판매변경일자");
			if(FV_BOOLEAN_CLOSE) return; // 입력한 일자가 마감 되었을 경우 '1'(true) 리턴.

			ds_ProcDis.AddRow();

			j = ds_ProcDis.rowcount - 1;

			ds_ProcDis.SetColumn(j, "JOB_FLAG",               "D");
			ds_ProcDis.SetColumn(j, "PROC_FLAG",              ds_oldlist.GetColumn(i, "PROC_FLAG"));
			ds_ProcDis.SetColumn(j, "FREE_PROD_SALE_NO",      ds_oldlist.GetColumn(i, "FREE_PROD_SALE_NO"));
			ds_ProcDis.SetColumn(j, "FREE_PROD_SALE_CHG_SEQ", ds_oldlist.GetColumn(i, "FREE_PROD_SALE_CHG_SEQ"));
			ds_ProcDis.SetColumn(j, "SALE_DTM",               f_getDate("NEW"));
			ds_ProcDis.SetColumn(j, "SALE_CHG_DTM",           f_getDate("MOD"));
			ds_ProcDis.SetColumn(j, "PROD_CD",                ds_oldlist.GetColumn(i, "PROD_CD"));
			ds_ProcDis.SetColumn(j, "COLOR_CD",               ds_oldlist.GetColumn(i, "COLOR_CD"));
			ds_ProcDis.SetColumn(j, "SER_NUM",                ds_oldlist.GetColumn(i, "SER_NUM"));
			ds_ProcDis.SetColumn(j, "PROD_CL",                ds_oldlist.GetColumn(i, "PROD_CL"));
			ds_ProcDis.SetColumn(j, "SALE_QTY",               ds_oldlist.GetColumn(i, "SALE_QTY"));
			ds_ProcDis.SetColumn(j, "HLD_PLC",                ds_oldlist.GetColumn(i, "HLD_PLC"));
		}

	}
}
]]></Script>
</Window>