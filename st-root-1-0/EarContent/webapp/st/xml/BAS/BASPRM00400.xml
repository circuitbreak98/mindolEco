<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="600" Id="BASPRM00400" Left="8" OnLoadCompleted="BASSPRM00400_OnLoadCompleted" PidAttrib="7" Title="정산예정일&#32;관리" Top="8" Ver="1.0" Width="830" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_acc_typ">
				<Contents>
					<colinfo id="COMM_CD_VAL" size="256" summ="default" type="STRING"/>
					<colinfo id="COMM_CD_VAL_NM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_acc">
				<Contents>
					<colinfo id="deal_co_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="ser_num" size="256" summ="default" type="STRING"/>
					<colinfo id="acc_typ" size="256" summ="default" type="STRING"/>
					<colinfo id="acc_mth" size="256" summ="default" type="STRING"/>
					<colinfo id="acc_dt" size="256" summ="default" type="STRING"/>
					<colinfo id="rmks" size="256" summ="default" type="STRING"/>
					<colinfo id="upd_cnt" size="256" summ="default" type="STRING"/>
					<colinfo id="ins_dtm" size="256" summ="default" type="STRING"/>
					<colinfo id="ins_user_id" size="256" summ="default" type="STRING"/>
					<colinfo id="mod_dtm" size="256" summ="default" type="STRING"/>
					<colinfo id="mod_user_id" size="256" summ="default" type="STRING"/>
					<colinfo id="deal_co_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="comm_cd_val_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="comm_cd_val" size="256" summ="default" type="STRING"/>
					<colinfo id="column2" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_condition">
				<Contents>
					<colinfo id="DEAL_CO_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="ACC_TYP" size="256" summ="default" type="STRING"/>
					<colinfo id="DEAL_CO_NM" size="256" summ="default" type="STRING"/>
					<record>
						<ACC_TYP></ACC_TYP>
						<DEAL_CO_CD></DEAL_CO_CD>
						<DEAL_CO_NM></DEAL_CO_NM>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_acc_mth">
				<Contents>
					<colinfo id="COMM_CD_VAL" size="256" summ="default" type="STRING"/>
					<colinfo id="COMM_CD_VAL_NM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_acc_dt">
				<Contents>
					<colinfo id="COMM_CD_VAL" size="256" summ="default" type="STRING"/>
					<colinfo id="COMM_CD_VAL_NM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_acc_typ2">
				<Contents>
					<colinfo id="COMM_CD_VAL" size="256" summ="default" type="STRING"/>
					<colinfo id="COMM_CD_VAL_NM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_ParentDeal">
				<Contents>
					<colinfo id="DEAL_CO_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DEAL_CO_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="DEAL_CO_CL1" size="256" summ="default" type="STRING"/>
					<colinfo id="DEAL_CO_CL2" size="256" summ="default" type="STRING"/>
					<colinfo id="U_KEY_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="BIZ_NUM" size="256" summ="default" type="STRING"/>
					<colinfo id="REP_USER_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="CHRGR" size="256" summ="default" type="STRING"/>
					<colinfo id="ZIP_CD1" size="256" summ="default" type="STRING"/>
					<colinfo id="ZIP_CD2" size="256" summ="default" type="STRING"/>
					<colinfo id="OTH_ADDR" size="256" summ="default" type="STRING"/>
					<colinfo id="WPHON" size="256" summ="default" type="STRING"/>
					<colinfo id="FAX" size="256" summ="default" type="STRING"/>
					<colinfo id="MBL_PHON1" size="256" summ="default" type="STRING"/>
					<colinfo id="MBL_PHON2" size="256" summ="default" type="STRING"/>
					<colinfo id="MBL_PHON3" size="256" summ="default" type="STRING"/>
					<colinfo id="PHONE" size="256" summ="default" type="STRING"/>
					<colinfo id="DEAL_STA_DT" size="256" summ="default" type="STRING"/>
					<colinfo id="DEAL_CL" size="256" summ="default" type="STRING"/>
					<colinfo id="ORG_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="SALE_BR_GRP" size="256" summ="default" type="STRING"/>
					<colinfo id="SAL_CHRGR" size="256" summ="default" type="STRING"/>
					<colinfo id="STL_PLC" size="256" summ="default" type="STRING"/>
					<colinfo id="RMKS" size="256" summ="default" type="STRING"/>
					<colinfo id="DEL_YN" size="256" summ="default" type="STRING"/>
					<colinfo id="UPD_CNT" size="256" summ="default" type="STRING"/>
					<colinfo id="INS_DTM" size="256" summ="default" type="STRING"/>
					<colinfo id="INS_USER_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="MOD_DTM" size="256" summ="default" type="STRING"/>
					<colinfo id="MOD_USER_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="ZIP_CD" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_conditionDeal">
				<Contents>
					<colinfo id="DEAL_CO_CL2" size="256" summ="default" type="STRING"/>
					<colinfo id="DEAL_CO_CL1" size="256" summ="default" type="STRING"/>
					<colinfo id="DEAL_CO_NM" size="256" summ="default" type="STRING"/>
					<record>
						<DEAL_CO_CL1></DEAL_CO_CL1>
						<DEAL_CO_CL2></DEAL_CO_CL2>
						<DEAL_CO_NM></DEAL_CO_NM>
					</record>
				</Contents>
			</Dataset>
		</Datasets>
		<Image Height="5" Id="Image1" ImageID="img_Title_Sub" Left="11" TabOrder="2" Top="57" Width="8"></Image>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" BindDataset="ds_acc" BkColor2="default" BoldHead="true" Border="Flat" Bottom="549" Editable="TRUE" Enable="true" EndLineColor="default" FillArea="TRUE" HeadBorder="Flat" HeadHeight="22" Height="464" Id="grd_list" InputPanel="FALSE" Left="10" LineColor="user33" MinWidth="100" OnCellClick="grd_list_OnCellClick" OnHeadClick="cf_allChecknSort" Right="820" RowHeight="21" Style="sty_Grid" TabOrder="1" TabStop="true" Top="85" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="user33" WheelScrollRow="1" Width="810">
			<contents>
				<format id="Default">
					<columns>
						<col width="30"/>
						<col width="57"/>
						<col width="136"/>
						<col width="214"/>
						<col width="20"/>
						<col width="80"/>
						<col width="80"/>
						<col width="205"/>
					</columns>
					<head>
						<cell bkcolor="user34" col="0" display="checkbox" edit="checkbox" font="돋움,9,Bold" Valign="Center"/>
						<cell align="center" bkcolor="user34" col="1" color="user35" display="text" font="돋움,9,Bold" text="NO" Valign="Center"/>
						<cell align="center" bkcolor="user34" col="2" color="user35" display="text" font="돋움,9,Bold" text="*&#32;정산유형" Valign="Center"/>
						<cell align="center" bkcolor="user34" col="3" color="user35" colspan="2" display="text" font="돋움,9,Bold" text="*&#32;거래처" Valign="Center"/>
						<cell align="center" bkcolor="user34" col="5" color="user35" display="text" font="돋움,9,Bold" text="*&#32;정산월" Valign="Center"/>
						<cell align="center" bkcolor="user34" col="6" color="user35" display="text" font="돋움,9,Bold" text="*&#32;정산일" Valign="Center"/>
						<cell align="center" bkcolor="user34" col="7" color="user35" display="text" font="돋움,9,Bold" text="비고" Valign="Center"/>
					</head>
					<body>
						<cell bkcolor2="user32" col="0" display="checkbox" edit="checkbox"/>
						<cell align="center" bkcolor2="user36" col="1" display="text" expr="currow+1"/>
						<cell bkcolor2="user36" col="2" colid="acc_typ" display="combo" edit='expr:decode(rowType,&quot;insert&quot;,&quot;combo&quot;,&quot;none&quot;)'/>
						<cell bkcolor2="user36" col="3" colid="deal_co_nm" display="text"/>
						<cell bkcolor2="user32" bkimageid="btn_i_detail_b" col="4" cursor="hand" display="button"/>
						<cell align="left" bkcolor2="user36" col="5" colid="acc_mth" combocol="COMM_CD_VAL" combodataset="ds_acc_mth" combotext="COMM_CD_VAL_NM" display="combo" edit="combo"/>
						<cell bkcolor2="user36" col="6" colid="acc_dt" combocol="COMM_CD_VAL" combodataset="ds_acc_dt" combotext="COMM_CD_VAL_NM" display="combo" edit="combo"/>
						<cell bkcolor2="user36" col="7" colid="rmks" display="normal" edit="normal"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Button Cursor="HAND" Height="21" Id="btn_addRow" ImageID="btn_i_add_w" Left="777" OnClick="btn_addRow_OnClick" TabOrder="4" Text="Button7" Top="60" Width="19"></Button>
		<Button Cursor="HAND" Height="21" Id="btn_delRow" ImageID="btn_i_subtract_w" Left="799" OnClick="btn_delRow_OnClick" TabOrder="3" Text="Button7" Top="60" Width="19"></Button>
		<Div Border="Raised" Height="40" Id="div_search" Left="8" Style="sty_div_search" TabOrder="5" Text="Div0" Top="10" Width="810">
			<Contents>
				<Static Align="Right" Border="None" Height="20" Id="Static1" Left="3" Style="sty_lb_Search" TabOrder="3" Text="거래처" Top="7" VAlign="Middle" Width="84"></Static>
				<Static Align="Right" Border="None" Height="20" Id="Static0" Left="311" Style="sty_lb_Search" TabOrder="2" Text="정산유형" Top="7" VAlign="Middle" Width="84"></Static>
				<Combo BindDataset="ds_condition" Border="Flat" Column="ACC_TYP" Height="20" Id="cbo_orgCl" INDEX="0" InnerDataset="ds_acc_typ" Left="396" OnChanged="cbo_orgCl_OnChanged" OnKeyDown="div_search_cbo_orgCl_OnKeyDown" Style="sty_ipt_form" TabOrder="1" Top="6" Width="116"></Combo>
				<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="21" Id="btn_search" ImageID="btn_a_2" Left="526" LeftMargin="5" OnClick="btn_search_OnClick" Style="sty_btn_a" TabOrder="4" Text="조회" Top="7" Width="60"></Button>
				<Button BindDataset="ds_DlvFee" Cursor="HAND" Height="20" Id="btn_searchDeal" ImageID="btn_i_detail_b" Left="176" OnClick="btn_searchDeal_OnClick" TabOrder="6" Text="Button0" Top="7" Width="20"></Button>
				<Edit BindDataset="ds_condition" Border="Flat" Column="DEAL_CO_CD" Height="20" Id="edt_DealCoCd" Left="92" MaxLength="10" OnKeyDown="edt_DealCoNm_OnKeyDown" Style="sty_ipt_form" TabOrder="7" Top="7" UpperOnly="TRUE" Width="85"></Edit>
				<Edit Border="Flat" Enable="FALSE" Height="20" Id="edt_dealNm" Left="194" MaxLength="10" OnKeyDown="dealCo_OnKeyDown" Style="sty_ipt_form" TabOrder="5" Top="7" UpperOnly="TRUE" Width="113"></Edit>
			</Contents>
		</Div>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="25" Id="btn_saveMulti" ImageID="btn_c_2" Left="760" LeftMargin="5" OnClick="btn_saveMulti_OnClick" Style="sty_btn_c" TabOrder="6" Text="저장" Top="565" Width="60"></Button>
		<Image Align="Left" Height="25" Id="Image0" ImageID="bul_tit" Left="8" LeftMargin="15" Style="sty_img_tit" TabOrder="7" Text="정산예정일" Top="60" Width="192"></Image>
	</Form>
	<Script><![CDATA[/*******************************************************************************
* 프로그램ID  :  BASPRM00400
* 업무명      :  기준정보 - 정산예정일 관리  
* 프로그램명  :  정산예정일 관리 
--------------------------------------------------------------------------------
* 작성자      : shimyunjung
* 작성일      : 2009.01.20
--------------------------------------------------------------------------------
* 거래처는 '판매점'을 제외하고 조회한다. 
* 1. 변경이력
수정자    :
수정일    :
수정 내역 :
*******************************************************************************/
//==============================================================================
// 공통 스크립트 로딩
//==============================================================================
#include "lib::lib_commF.js"
#include "lib::lib_commMsg.js"
#include "lib::lib_util.js"
#include "lib::lib_commPopup.js"

//==============================================================================
// 폼 변수 정의
//==============================================================================
var FV_STR_NAME; // 사용자 이름

/*******************************************************************************
 * @description    : 최초 폼 로드시 발생 - 이벤트
*******************************************************************************/
function BASSPRM00400_OnLoadCompleted(obj)
{
	// 권한 설정
	cf_setAuth(pFrmNum);
	
	// 그리드 체크박스 설정 및 정렬
	cf_setGrdChecknSortEvent(grd_list, 0);
	
	// 공통 코드를 위한 데이타셋 설정
	cf_setCommonCodeDsEnv();
	// 정산유형  : ZBAS_C_00140
	cf_setCommonCode("div_search.cbo_orgCl", 	"ZBAS_C_00140", ", 전체");
	cf_setCommonCode("grd_list", "ZBAS_C_00140", null, 2);
	// 정산월 : ZBAS_C_00150
	cf_setCommonCode("grd_list", "ZBAS_C_00150", null, 5);
	// 정산일 : ZBAS_C_00160
	cf_setCommonCode("grd_list", "ZBAS_C_00160", null, 6);
	// 설정된 코드를 기반으로 공통 코드를 추가 및 데이타 바인딩
	cf_checkCommonCode();
	f_init();
}

/*******************************************************************************
 * @description    : 공통 조회 함수
*******************************************************************************/
function  btn_search_OnClick(obj)
{
	var sSvcID = "svcList";
	var sInDs = "nc_input_fieldDs=ds_condition";
	var sOutDs = "ds_acc=ds_acc";
	var sArg = "sktst.bas.PRM#getAccList";
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}
		
/*******************************************************************************
 * @description    : 공통 저장 함수
*******************************************************************************/
function btn_saveMulti_OnClick(obj)
{
	if(Confirm(cf_getMessage(MSG_00063,"")) == true) { //저장하시겠습니까
	
		var nRow = ds_acc.rowcount;
		var chkDeal = 0;
		var chkTyp = 0;
		var chkMth = 0;
		var chkDt= 0;
		
		for (var i=0; i<nRow; i++) {
			if (ds_acc.GetRowType(i) == "insert") {
				if (length(trim(ds_acc.GetColumn(i, "DEAL_CO_CD"))) ==0) {
					chkDeal++;
				} else if (length(trim(ds_acc.GetColumn(i, "acc_typ"))) ==0) {
					chkTyp++;
				} else if (length(trim(ds_acc.GetColumn(i, "acc_mth"))) ==0) {
					chkMth++;
				} else if (length(trim(ds_acc.GetColumn(i, "acc_dt"))) ==0) {
					chkDt++;
				} 
			}
		}
		ds_acc.row = i;			
		if (chkTyp) {
			alert(cf_getMessage(MSG_00028, "정산유형")); 
			grd_list.SetFocus();
			grd_list.SetCellPos(2);
			return false;
		} else if (chkDeal) {
			alert(cf_getMessage(MSG_00028, "거래처")); 
			grd_list.SetFocus();
			grd_list.SetCellPos(4);
			return false;
		} else if (chkMth) {
			alert(cf_getMessage(MSG_00028, "정산월"));
			 grd_list.SetFocus();
			grd_list.SetCellPos(5);
			return false;
		} else if (chkDt) {
			alert(cf_getMessage(MSG_00028, "정산일")); 
			grd_list.SetFocus();
			grd_list.SetCellPos(6);
			return false;
		} else {
			var sSvcID = "svcInsertAll";
			var sInDs = "ds_acc=ds_acc:U";
			var sOutDs = "ds_acc=ds_acc";
			var sArg = "sktst.bas.PRM#saveAcc";
			cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
		}		
	}  
}

/*******************************************************************************
 * @description    : 초기화 
*******************************************************************************/
function df_init()
{
	ds_acc.ClearData();
	f_init();
}

/*******************************************************************************
 * @description    : 공통 닫기 함수
*******************************************************************************/
function df_close(sButtonID)
{
	this.Close();
}


//==============================================================================
//  기타 업무 메소드들
//==============================================================================
/*******************************************************************************
* 함수명 : f_callBack 
* 기능명 : 트랜잭션 콜백 
* 파라미터
1. sSvcID  : 서비스 아이디
*******************************************************************************/
function f_callBack(sSvcID)
{	
	trace(sSvcID);
}

/*******************************************************************************
 * @description    : 로우 추가 - 이벤트
*******************************************************************************/
function btn_addRow_OnClick(obj)
{
	var oGrdDs = object(grd_list.BindDataset);
	oGrdDs.AddRow();
}


/*******************************************************************************
 * @description    : 로우 삭제- 이벤트
*******************************************************************************/
function btn_delRow_OnClick(obj)
{	
	var nRow =ds_acc.rowcount;
	var nchk = 0;
	for (var i=0; i<nRow; i++) {
		if (ds_acc.GetColumn(i, "chk") ==1) {
			nchk++;
		}
	}
	
	if (nRow==0) {
		return false;
	} else if (nchk==0){
		alert(cf_getMessage(MSG_00047, "삭제할 항목을"));  //"삭제할 항목을 선택하십시오.
		return false;
	} else if(Confirm("삭제하시겠습니까?") == true) {
		for (var i = nRow-1; i>=0; i--) {
		 	if (ds_acc.GetColumn(i, "chk") ==1) {
				ds_acc.DeleteRow(i);	
			}
		}
	}
}

/* 거래처 팝업 */
function btn_searchDeal_OnClick(obj)
{
	cf_commPopDealCo("div_search.edt_DealCoCd", "div_search.edt_dealNm", "1;2;3;4;5;7;8;9;10;", 13);
}

function edt_DealCoNm_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
{
	if (nChar==13) {
		cf_commPopDealCo("div_search.edt_DealCoCd", "div_search.edt_dealNm", "1;2;3;4;5;7;8;9;10;", 13 );
	}
}

function grd_list_OnCellClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{
	if (ds_acc.GetRowType(nRow) != "insert") {
		return false;
	}
	
	if (nCell==4) {
		cf_commPopDealDs("ds_acc", ds_acc.currow, "1;2;3;4;5;7;8;9;10;");
	}
}

//==============================================================================
//  사용자정의함수 
//==============================================================================
/*  초기화면 세팅 */
function f_init()
{
	div_search.cbo_orgCl.Index = 0;
	div_search.edt_DealCoCd.Text = "";
	div_search.edt_dealNm.Text = "";
}




function div_search_cbo_orgCl_OnKeyDown(obj,nChar,bShift,bCtrl,bAlt,LLParam,HLParam)
{
	if (nChar==13) {
		btn_search_OnClick();
	}
}

 ]]></Script>
</Window>