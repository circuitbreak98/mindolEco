<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="680" Id="SACRFD00200" Left="8" OnLoadCompleted="SACRFD00200_OnLoadCompleted" PidAttrib="7" Title="환불처리" Top="8" Ver="1.0" Width="1024" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_condition">
				<Contents>
					<colinfo id="deal_co_nm" size="100" summ="default" type="STRING"/>
					<colinfo id="dpst_dt_from" size="10" summ="default" type="STRING"/>
					<colinfo id="dpst_dt_to" size="10" summ="default" type="STRING"/>
					<colinfo id="pos_agency" size="10" summ="default" type="STRING"/>
					<colinfo id="deal_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="deal_ukey" size="256" summ="default" type="STRING"/>
					<colinfo id="stl_plc" size="256" summ="default" type="STRING"/>
					<colinfo id="dpst_yymm" size="10" summ="default" type="STRING"/>
					<colinfo id="dpst_cl" size="1" summ="default" type="STRING"/>
					<colinfo id="mod" size="256" summ="default" type="STRING"/>
					<record>
						<deal_co_nm></deal_co_nm>
						<deal_nm></deal_nm>
						<deal_ukey></deal_ukey>
						<dpst_cl>1</dpst_cl>
						<dpst_dt_from></dpst_dt_from>
						<dpst_dt_to></dpst_dt_to>
						<dpst_yymm></dpst_yymm>
						<mod>N</mod>
						<pos_agency></pos_agency>
						<stl_plc></stl_plc>
					</record>
				</Contents>
			</Dataset>
			<Dataset CanColumnChange="ds_rfndproc_CanColumnChanged" DataSetType="Dataset" Id="ds_rfndproc" OnColumnChanged="ds_rfndproc_OnColumnChanged">
				<Contents>
					<colinfo id="DEAL_CO_NM" size="100" summ="default" type="STRING"/>
					<colinfo id="YMD" size="100" summ="default" type="STRING"/>
					<colinfo id="IMAG_ACC_NO" size="100" summ="default" type="STRING"/>
					<colinfo id="ACCOUNT_CL" size="100" summ="default" type="STRING"/>
					<colinfo id="BALANCE" size="100" summ="default" type="DECIMAL"/>
					<colinfo id="DPST_AMT" size="100" summ="default" type="DECIMAL"/>
					<colinfo id="CHAG_DPST_ACC_AMT" size="100" summ="default" type="DECIMAL"/>
					<colinfo id="RFND_AMT" size="100" summ="default" type="DECIMAL"/>
					<colinfo id="BAMT" size="100" summ="default" type="DECIMAL"/>
					<colinfo id="BANK_CD" size="100" summ="default" type="STRING"/>
					<colinfo id="SLCM_DFRY_ACC_NO" size="100" summ="default" type="STRING"/>
					<colinfo id="SLCM_DFRY_BANK_CD" size="100" summ="default" type="STRING"/>
					<colinfo id="POS_SLCM_DFRY_ACC_NO" size="100" summ="default" type="STRING"/>
					<colinfo id="POS_SLCM_DFRY_BANK_CD" size="100" summ="default" type="STRING"/>
					<colinfo id="CHK" size="100" summ="default" type="STRING"/>
					<colinfo id="SEQ_NO" size="100" summ="default" type="STRING"/>
					<colinfo id="REFUND_YN" size="100" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_rfnd_info">
				<Contents>
					<colinfo id="RFND_DEAL_CO" size="20" summ="default" type="STRING"/>
					<colinfo id="RFND_DT" size="20" summ="default" type="STRING"/>
					<colinfo id="RFND_ACC_NO" size="20" summ="default" type="STRING"/>
					<colinfo id="RFND_SEQ" size="20" summ="default" type="STRING"/>
					<colinfo id="RFND_CL" size="20" summ="default" type="STRING"/>
					<colinfo id="POS_AGENCY" size="20" summ="default" type="STRING"/>
					<colinfo id="DPST_YYMM" size="20" summ="default" type="STRING"/>
					<colinfo id="DPST_PLC" size="20" summ="default" type="STRING"/>
					<colinfo id="RFND_BANK_CD" size="20" summ="default" type="STRING"/>
					<colinfo id="RFND_AMT" size="20" summ="default" type="DECIMAL"/>
					<colinfo id="PROC_DTM" size="20" summ="default" type="STRING"/>
					<colinfo id="PROC_USER_ID" size="20" summ="default" type="STRING"/>
					<colinfo id="TRMS_DT" size="20" summ="default" type="STRING"/>
					<colinfo id="FIX_YN" size="20" summ="default" type="STRING"/>
					<colinfo id="FIX_DT" size="20" summ="default" type="STRING"/>
					<colinfo id="REMARK" size="200" summ="default" type="STRING"/>
					<colinfo id="IMAG_ACC_NO" size="100" summ="default" type="STRING"/>
					<colinfo id="BANK_CD" size="100" summ="default" type="STRING"/>
					<colinfo id="MOD_POS_YN" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQ_NO" size="20" summ="default" type="STRING"/>
					<colinfo id="RFND_SEQ_NO" size="20" summ="default" type="STRING"/>
					<colinfo id="DPST_DT" size="20" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_rfnd_deal_co">
				<Contents>
					<colinfo id="rfnd_deal_co_cd" size="10" summ="default" type="STRING"/>
					<colinfo id="rfnd_deal_co_nm" size="200" summ="default" type="STRING"/>
					<colinfo id="rfnd_acc_no" size="20" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_acc_cl">
				<Contents>
					<colinfo id="CODE" size="1" summ="default" type="STRING"/>
					<colinfo id="NAME" size="10" summ="default" type="STRING"/>
					<record>
						<CODE>1</CODE>
						<NAME>요금</NAME>
					</record>
					<record>
						<CODE>2</CODE>
						<NAME>기타</NAME>
					</record>
					<record>
						<CODE>3</CODE>
						<NAME>불명</NAME>
					</record>
					<record>
						<CODE>4</CODE>
						<NAME>카드</NAME>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_out_bank"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_rfnd_deal">
				<Contents>
					<colinfo id="CODE" size="256" summ="default" type="STRING"/>
					<colinfo id="VALUE" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_rowRfnd"></Dataset>
		</Datasets>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" BindDataset="ds_rfndproc" BkColor2="user32" BoldHead="true" Border="Flat" Bottom="546" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" FillArea="TRUE" HeadBorder="Flat" HeadHeight="22" Height="466" Id="grd_list" InputPanel="FALSE" Left="16" LineColor="user33" MinWidth="100" OnCellClick="grd_list_OnCellClick" OnChar="grd_list_OnChar" Right="1020" RowHeight="21" Style="sty_Grid" TabOrder="3" TabStop="true" Top="80" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="user33" WheelScrollRow="1" Width="1004">
			<contents>
				<format id="Default">
					<columns>
						<col width="134"/>
						<col width="80"/>
						<col width="100"/>
						<col width="80"/>
						<col width="100"/>
						<col width="100"/>
						<col width="100"/>
						<col width="100"/>
						<col width="100"/>
					</columns>
					<head>
						<cell bkcolor="user34" col="0" color="user35" display="date" font="돋움,10,Bold" text="입금처"/>
						<cell bkcolor="user34" col="1" color="user35" display="date" font="돋움,10,Bold" text="일자"/>
						<cell bkcolor="user34" col="2" color="user35" display="date" font="돋움,10,Bold" text="가상계좌"/>
						<cell bkcolor="user34" col="3" color="user35" display="text" font="돋움,10,Bold" text="계좌구분"/>
						<cell bkcolor="user34" col="4" color="user35" display="text" font="돋움,10,Bold" text="이월잔액"/>
						<cell bkcolor="user34" col="5" color="user35" display="text" font="돋움,10,Bold" text="입금액"/>
						<cell bkcolor="user34" col="6" color="user35" display="text" font="돋움,10,Bold" text="정산액"/>
						<cell bkcolor="user34" col="7" color="user35" display="text" font="돋움,10,Bold" text="환불액"/>
						<cell bkcolor="user34" col="8" color="user35" display="text" font="돋움,10,Bold" text="잔액"/>
					</head>
					<body>
						<cell col="0" colid="DEAL_CO_NM" display="text"/>
						<cell align="center" col="1" colid="YMD" display="date"/>
						<cell align="center" col="2" colid="IMAG_ACC_NO" display="text"/>
						<cell align="center" col="3" colid="ACCOUNT_CL" display="text"/>
						<cell align="right" col="4" colid="BALANCE" display="number"/>
						<cell align="right" col="5" colid="DPST_AMT" display="number"/>
						<cell align="right" col="6" colid="CHAG_DPST_ACC_AMT" display="number"/>
						<cell align="right" col="7" colid="RFND_AMT" display="number"/>
						<cell align="right" col="8" colid="BAMT" display="number"/>
					</body>
					<summary>
						<cell bkcolor="user34" col="0" color="user35" display="text"/>
						<cell bkcolor="user34" col="1" color="user35" display="text"/>
						<cell bkcolor="user34" col="2" color="user35" display="text"/>
						<cell align="right" bkcolor="user34" col="3" color="user38" display="text" font="돋움,9,Bold" text="합계"/>
						<cell bkcolor="user34" col="4" color="user35" display="number" expr='sum(&quot;BALANCE&quot;)'/>
						<cell bkcolor="user34" col="5" color="user35" display="number" expr='sum(&quot;DPST_AMT&quot;)'/>
						<cell bkcolor="user34" col="6" color="user35" display="number" expr='sum(&quot;CHAG_DPST_ACC_AMT&quot;)'/>
						<cell bkcolor="user34" col="7" color="user35" display="number" expr='sum(&quot;RFND_AMT&quot;)'/>
						<cell bkcolor="user34" col="8" color="user35" display="number" expr='ds_rfndproc.getColumn(rowcount-1,&quot;BAMT&quot;)'/>
					</summary>
				</format>
			</contents>
		</Grid>
		<Image Align="Left" Height="25" Id="Image3" ImageID="bul_tit" Left="10" LeftMargin="15" Style="sty_img_tit" TabOrder="2" Text="입금&#32;내역" Top="56" Width="192"></Image>
		<Div Border="Raised" Height="43" Id="div_search" Left="10" Style="sty_div_search" TabOrder="1" Text="Div0" Top="10" Width="1004">
			<Contents>
				<Static Align="Right" Height="20" Id="Static6" Left="32" Style="sty_lb_Search" TabOrder="1" Text="입금월" Top="9" VAlign="Middle" Width="46"></Static>
				<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="21" Id="btn_search" ImageID="btn_a_2" Left="932" LeftMargin="5" OnClick="btn_search_OnClick" Style="sty_btn_a" TabOrder="2" Text="조회" Top="8" Width="60"></Button>
				<Image Height="21" Id="Image0" ImageID="bul_mand" Left="27" TabOrder="3" Top="8" Transparent="TRUE" Width="20"></Image>
				<Static Align="Right" Height="20" Id="Static1" Left="188" Style="sty_lb_Search" TabOrder="4" Text="대리점" Top="8" VAlign="Middle" Width="53"></Static>
				<Edit BindDataset="ds_condition" Border="Flat" Column="deal_co_nm" Height="20" Id="edt_agencyNm" Left="248" LeftMargin="2" OnCharChanged="div_search_edt_agencyNm_OnCharChanged" OnKeyDown="div_search_edt_agencyNm_OnKeyDown" RightMargin="2" Style="sty_ipt_form" TabOrder="6" Top="8" UserData="대리점" Width="122"></Edit>
				<Button Cursor="HAND" Height="21" Id="btn_agency" ImageID="btn_i_detail" Left="371" OnClick="btn_agency_OnClick" TabOrder="5" Text="Button0" Top="8" Width="19"></Button>
				<Edit Border="Flat" Enable="FALSE" Height="20" Id="edt_agencyUkeyCd" Left="390" MaxLength="10" Readonly="TRUE" Style="sty_ipt_form" TabOrder="7" TabStop="FALSE" Top="8" UpperOnly="TRUE" Width="74"></Edit>
				<Edit BindDataset="ds_condition" Border="Flat" Column="pos_agency" Height="20" Id="edt_agencyCd" Left="465" MaxLength="10" Style="sty_ipt_form" TabOrder="8" TabStop="FALSE" Top="8" UpperOnly="TRUE" Visible="FALSE" Width="8"></Edit>
				<Image Height="21" Id="Image1" ImageID="bul_mand" Left="186" TabOrder="9" Top="8" Transparent="TRUE" Width="14"></Image>
				<Static Align="Right" Border="None" Height="20" Id="Static2" Left="493" Style="sty_lb_Search" TabOrder="13" Text="입금처" Top="8" VAlign="Middle" Width="42"></Static>
				<Edit BindDataset="ds_condition" Border="Flat" Column="deal_nm" Height="20" Id="edt_dealNm" ImeMode="none" Left="541" LeftMargin="2" OnCharChanged="div_search_edt_dealNm_OnCharChanged" OnKeyDown="div_search_edt_dealNm_OnKeyDown" RightMargin="2" Style="sty_ipt_form" TabOrder="10" Top="8" Width="129"></Edit>
				<Button Cursor="HAND" Height="21" Id="btn_dealCo" ImageID="btn_i_detail" Left="667" OnClick="div_search_btn_dealCo_OnClick" TabOrder="12" Text="Button0" Top="8" Width="19"></Button>
				<Edit BindDataset="ds_condition" Border="Flat" Column="stl_plc" Enable="FALSE" Height="20" Id="edt_dealCd" ImeMode="none" Left="689" LeftMargin="2" OnCharChanged="div_search_edt_dealCd_OnCharChanged" Readonly="TRUE" RightMargin="2" Style="sty_ipt_form" TabOrder="11" Top="8" Width="74"></Edit>
				<MaskEdit BindDataset="ds_condition" Border="Flat" Column="dpst_yymm" Height="20" Id="cal_dpst_yymm" Left="88" LeftMargin="2" Mask="@@@@-@@" MaxLength="6" Readonly="TRUE" RightMargin="2" Style="sty_ipt_form" TabOrder="15" Top="8" Type="STRING" Width="88"></MaskEdit>
				<Button Cursor="HAND" Height="18" Id="btn_monthCalendar" ImageID="btn_i_calendar" Left="158" OnClick="btn_monthCalendar_OnClick" TabOrder="14" Text="Button3" Top="9" Width="17"></Button>
				<Static Align="Right" Height="20" Id="Static0" Left="760" Style="sty_lb_Search" TabOrder="16" Text="환불구분" Top="10" VAlign="Middle" Width="62"></Static>
				<Combo BindDataset="ds_condition" Border="Flat" CodeColumn="CODE" Column="dpst_cl" DataColumn="NAME" Height="20" Id="cmb_dpst_cl" ImeMode="none" INDEX="1" InnerDataset="ds_acc_cl" Left="828" OnChanged="div_search_cmb_dpst_cl_OnChanged" Style="sty_ipt_form" TabOrder="17" Top="8" Width="72"></Combo>
				<Image Height="21" Id="Image2" ImageID="bul_mand" Left="485" TabOrder="18" Top="10" Transparent="TRUE" Width="14"></Image>
			</Contents>
		</Div>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="25" Id="btn_save" ImageID="btn_c_2" Left="888" LeftMargin="5" OnClick="btn_save_OnClick" Style="sty_btn_c" TabOrder="4" Text="저장" Top="556" Visible="FALSE" Width="60"></Button>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="25" Id="btn_close" ImageID="btn_d_2" Left="956" LeftMargin="5" OnClick="btn_close_OnClick" Style="sty_btn_d" TabOrder="5" Text="닫기" Top="556" Width="60"></Button>
		<Div Border="Raised" Height="68" Id="div_process1" Left="12" Style="sty_div_input" TabOrder="6" Text="Div0" Top="588" Width="1004">
			<Contents>
				<Static Align="Right" Border="None" Height="20" Id="Static3" Left="14" Style="sty_lb_Basic" TabOrder="1" Text="환불거래처" Top="8" VAlign="Middle" Width="70"></Static>
				<Static Align="Right" Border="None" Height="20" Id="Static4" Left="14" Style="sty_lb_Basic" TabOrder="2" Text="환불적용일" Top="35" VAlign="Middle" Width="70"></Static>
				<Static Align="Right" Border="None" Height="20" Id="Static6" Left="812" Style="sty_lb_Basic" TabOrder="3" Text="환불은행" Top="8" VAlign="Middle" Width="70"></Static>
				<Static Align="Right" Border="None" Height="20" Id="Static7" Left="256" Style="sty_lb_Basic" TabOrder="4" Text="비고" Top="35" VAlign="Middle" Width="70"></Static>
				<Static Align="Right" Border="None" Height="20" Id="Static9" Left="256" Style="sty_lb_Basic" TabOrder="5" Text="환불계좌" Top="8" VAlign="Middle" Width="70"></Static>
				<Combo BindDataset="ds_rfnd_info" Border="Flat" CodeColumn="COMM_CD_VAL" Column="RFND_BANK_CD" DataColumn="COMM_CD_VAL_NM" Height="20" Id="cmb_bankCd3" ImeMode="none" INDEX="0" InnerDataset="ds_out_bank" Left="888" Style="sty_ipt_form" TabOrder="5" Top="8" Width="90"></Combo>
				<Edit BindDataset="ds_rfnd_info" Border="Flat" CheckLength="Byte" Column="RFND_ACC_NO" Height="20" Id="edt_acc2" Left="338" LeftMargin="2" MaxLength="18" Number="TRUE" RightMargin="2" Style="sty_ipt_form" TabOrder="3" Top="8" Width="185"></Edit>
				<Edit Align="RIGHT" BindDataset="ds_rfnd_info" Border="Flat" CheckLength="Byte" Column="RFND_AMT" Height="20" Id="edt_rfndAmt" ImeMode="none" Left="629" LeftMargin="2" MaxLength="9" Number="TRUE" RightMargin="2" Style="sty_ipt_form" TabOrder="4" Top="8" Width="117"></Edit>
				<Static Align="Right" Border="None" Height="20" Id="Static1" Left="533" Style="sty_lb_Basic" TabOrder="8" Text="환불액" Top="8" VAlign="Middle" Width="92"></Static>
				<Calendar BindDataset="ds_rfnd_info" Border="Flat" ButtonImageID="btn_i_calendar" Column="RFND_DT" DayFont="Default,-1" Enable="FALSE" HeaderBorder="NONE" HeaderFont="Default,-1" HeadStyle="sty_calendar_head" Height="20" Id="cal_runDtmTo" Left="91" LeftMargin="2" MonthPopupBorder="RAISED" NullValue="&#32;" RightMargin="2" SaturdayTextColor="user28" Style="sty_calendar" SundayTextColor="user27" TabOrder="2" TodayColor="user26" Top="35" WeeksFont="Default,-1" WeekStyle="sty_calendar_week" Width="105"></Calendar>
				<Combo BindDataset="ds_rfnd_info" Border="Flat" CodeColumn="CODE" Column="RFND_DEAL_CO" DataColumn="VALUE" Height="20" Id="cmb_rfnd_deal" ImeMode="none" INDEX="1" InnerDataset="ds_rfnd_deal" Left="90" OnChanged="div_process1_cmb_rfnd_deal_OnChanged" Style="sty_ipt_form" TabOrder="1" Top="8" Width="168"></Combo>
				<Edit BindDataset="ds_rfnd_info" Border="Flat" Column="REMARK" Height="20" Id="edt_remark" Left="338" LeftMargin="2" RightMargin="2" Style="sty_ipt_form" TabOrder="6" Top="35" Width="642"></Edit>
			</Contents>
		</Div>
		<Image Align="Left" Height="22" Id="Image0" ImageID="bul_tit" Left="16" LeftMargin="15" Style="sty_img_tit" TabOrder="7" Text="거래처&#32;정보" Top="559" Width="96"></Image>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="25" Id="btn_delete" ImageID="btn_c_2" Left="819" LeftMargin="5" OnClick="btn_delete_OnClick" Style="sty_btn_c" TabOrder="8" Text="삭제" Top="556" Visible="FALSE" Width="60"></Button>
		<Image Align="Left" Height="20" Id="img_polChg" ImageID="bul_caution" Left="120" LeftMargin="20" Style="sty_lb_info" TabOrder="9" Text="환불적용일은&#32;최종마감일&#32;+1일&#32;만&#32;가능합니다." Top="560" Width="350"></Image>
	</Form>
	<Script><![CDATA[/*******************************************************************************
* 프로그램ID  : SACRPD00200
* 업무명      : 판매회계 - 환불처리
* 프로그램명  : 환불처리
--------------------------------------------------------------------------------
* 작성자      : 하창주
* 작성일      : 2009.06.22
--------------------------------------------------------------------------------
* 1. 변경이력
수정자    :
수정일    :
수정 내역 :
*******************************************************************************/

//==============================================================================
// 공통 스크립트 로딩
//==============================================================================
#include "lib::lib_commF.js"
#include "lib::lib_util.js"
#include "lib::lib_DIS.js"
#include "lib::lib_commMsg.js"
#include "lib::lib_commPopup.js"

var sAgencyNm = "";
var sAgencyUkeyCd = "";
var sAgencyCd = "";
var sRfnd_cl = "";
var sDpstPlc = "";
var sDpstPlcNm = "";


//==============================================================================
// 전역변수선언
//==============================================================================
var FV_LOGIN_ID = gds_session.GetColumn(0, "loginId");		//사용자계정
var FV_ORG_ID = gds_session.GetColumn(0, "orgId");			//조직코드
var FV_ORG_NM = gds_session.GetColumn(0, "orgNm");			//조직코드
var FV_ORG_CL = gds_session.GetColumn(0, "orgCl");			//조직구분
var FV_SUP_ORG_ID = gds_session.GetColumn(0, "supOrgId");	//상위조직코드
var FV_USER_GRP = gds_session.GetColumn(0, "userGrp");		//사용자그룹
var FV_ORG_AREA = gds_session.GetColumn(0, "orgAreaId");	//근무지코드
var FV_POS_AGENCY_ID = gds_session.GetColumn(0,"posAgencyId");         	// 소속 대리점ID
var FV_POS_AGENCY_NM = gds_session.GetColumn(0,"posAgencyNm");       	// 소속 대리점명
var FV_POS_AGENCY_UKEY_ID = gds_session.GetColumn(0,"posAgencyUkeyId"); // 소속 대리점UKEY ID
var FV_CLOSE_DT;
var FV_SEARCH_YN = 'N';
var FV_MOD;			// 수정 또는 신규 구분
var FV_PRE_RFND_CL = '0';	// 이전 환불구분
var FV_RFND_AMT;	// 환불금액
var FV_FIX_YN;		// 확정여부(2,4일때는 저장/삭제 불가)
var FV_DEAL_CL;		// 입금처/대리점 구분
var FV_MTH_CHK_YN;	// 월마감여부

/*******************************************************************************
 * @description    : 최초 폼 로드시 발생 - 이벤트
*******************************************************************************/
function SACRFD00200_OnLoadCompleted(obj)
{
	// 권한 설정
	cf_setAuth(pFrmNum);
	// 그리드 체크박스 설정 및 정렬
	cf_setGrdChecknSortEvent(grd_list);
	div_search.cal_dpst_yymm.Value = SubStr(today(), 0, 6);

	div_process1.cal_runDtmTo.Value = SubStr(today(), 0, 8);

	div_search.edt_agencyNm.Value = sAgencyNm;
	div_search.edt_agencyUkeyCd.Value = sAgencyUkeyCd;
	div_search.edt_agencyCd.Value = sAgencyCd;
	if(!uf_IsNull(sRfnd_cl)) div_search.cmb_dpst_cl.Value = sRfnd_cl;
	
	div_search.edt_dealNm.Value = sDpstPlcNm;
	div_search.edt_dealCd.Value = sDpstPlc;

	// 대리점 화면권한 설정
	uf_enableAgencyByAuth("div_search", "edt_agencyNm,edt_agencyCd,btn_agency", "edt_agencyUkeyCd");
	uf_enableDealByAuth("div_search", "edt_dealNm,edt_dealCd,btn_dealCo");

	// 공통 코드 설정
	cf_setCommonCodeDsEnv();
	cf_setCommonCode("ds_out_bank", "ZBAS_C_00420", "선택", null, false); // 은행
	cf_checkCommonCode();


	div_search_cmb_dpst_cl_OnChanged();
	ds_rowRfnd.ClearData();
		

	//alert(FV_MOD);

	// 수정일 경우
	if(FV_MOD == "M"){
		//부모창 데이터셋 복사
		ds_rowRfnd.Copy(Object("parent."+dsParent));
		ds_rfnd_info.AddRow();
		
		//alert(ds_rowRfnd.SaveXML());

		ds_condition.SetColumn(0,"dpst_yymm",ds_rowRfnd.GetColumn(0,"DPST_YYMM"));
		ds_condition.SetColumn(0,"stl_plc",ds_rowRfnd.GetColumn(0,"DPST_PLC"));
		ds_condition.SetColumn(0,"deal_nm",ds_rowRfnd.GetColumn(0,"DPST_PLC_NM"));
		ds_condition.SetColumn(0,"dpst_cl",ds_rowRfnd.GetColumn(0,"RFND_CL"));
		ds_condition.SetColumn(0,"mod","M");

		ds_rfnd_info.SetColumn(0,"RFND_ACC_NO",ds_rowRfnd.GetColumn(0,"RFND_ACC_NO"));	// 환불계좌
		ds_rfnd_info.SetColumn(0,"RFND_AMT",ds_rowRfnd.GetColumn(0,"RFND_AMT"));	// 환불금액
		ds_rfnd_info.SetColumn(0,"RFND_BANK_CD",ds_rowRfnd.GetColumn(0,"RFND_BANK_CD"));	// 환불은행
		//div_process1.cmb_bankCd3.Value = ds_rowRfnd.GetColumn(0,"RFND_BANK_CD"); // 환불은행
		ds_rfnd_info.SetColumn(0,"RFND_DT",ds_rowRfnd.GetColumn(0,"RFND_DT"));	// 환불처리일
		ds_rfnd_info.SetColumn(0,"REMARK",ds_rowRfnd.GetColumn(0,"REMARK"));	// 비고

		ds_rfnd_info.SetColumn(0,"RFND_CL",ds_rowRfnd.GetColumn(0,"RFND_CL"));	// 환불구분
		ds_rfnd_info.SetColumn(0,"IMAG_ACC_NO",ds_rowRfnd.GetColumn(0,"IMAG_ACC_NO"));	// 환불대상가상계좌번호
		ds_rfnd_info.SetColumn(0,"SEQ_NO",ds_rowRfnd.GetColumn(0,"SEQ_NO"));	// 환불대상일련번호(불명금일경우에만 발생함)
		ds_rfnd_info.SetColumn(0,"DPST_DT",ds_rowRfnd.GetColumn(0,"DPST_DT"));	// 입금일
		ds_rfnd_info.SetColumn(0,"RFND_SEQ_NO",ds_rowRfnd.GetColumn(0,"RFND_SEQ_NO"));	// 환불발생시 가상계좌일련번호
		ds_rfnd_info.SetColumn(0,"BANK_CD",ds_rowRfnd.GetColumn(0,"BANK_CD"));	// 은행코드
		ds_rfnd_info.SetColumn(0,"MOD_POS_YN",ds_rowRfnd.GetColumn(0,"MOD_POS_YN"));	// 수정가능여부
		ds_rfnd_info.SetColumn(0,"POS_AGENCY",ds_rowRfnd.GetColumn(0,"POS_AGENCY"));	// 소속대리점
		ds_rfnd_info.SetColumn(0,"RFND_SEQ",ds_rowRfnd.GetColumn(0,"RFND_SEQ"));	// 환불순번
		
		FV_RFND_AMT = ds_rowRfnd.GetColumn(0,"RFND_AMT");	// 전환불금액
		FV_FIX_YN	= ds_rowRfnd.GetColumn(0,"FIX_YN");	// 확정여부
		FV_MTH_CHK_YN = ds_rowRfnd.GetColumn(0,"MTH_CHK_YN");	// 월마감여부

		div_process1.cmb_rfnd_deal.Enable = false;
		div_process1.edt_acc2.Enable = false;
		//div_process1.cmb_bankCd3.Enable = false;

		//alert(btn_delete.Visible);
		//alert(ds_rfnd_info.GetColumn(0,"MOD_POS_YN"));

		if (ds_rfnd_info.GetColumn(0,"MOD_POS_YN") == "Y") {
			btn_delete.Visible = true;
		}
		else
		{
			btn_delete.Visible = false;
		}

		//  조회 인 경우 조회버튼을 삭제
		div_search.btn_search.Visible = false;


		f_search();
	}
	else
	{
		btn_delete.Visible = false;
		// 신규일때는 월마감여부 체크안함.
		FV_MTH_CHK_YN = 'N';
	}


	//alert(ds_rowRfnd.SaveXML());

	// 조회여부 초기화
	FV_SEARCH_YN = 'N';
}

/*******************************************************************************
 * @description    : 폼 Un로드시 발생 - 이벤트
*******************************************************************************/
function SACRFD00200_OnUnLoadCompleted(obj) {
	//setParentAgencyInfo();
	//this.close(1);
}

/*******************************************************************************
 * @description    :  월달력 사용 - 이벤트
*******************************************************************************/
function btn_monthCalendar_OnClick(obj)
{
	cf_callMonthCalendar(div_search.cal_dpst_yymm);
}

/*******************************************************************************
 * @description    : 대리점 검색 팝업
*******************************************************************************/
function btn_agency_OnClick(obj)
{
	var sArg  =  "org_id="+quote(FV_ORG_ID);  // 필수
	cf_callAgencyPop(sArg, div_search, "edt_agencyNm,edt_agencyCd,edt_agencyUkeyCd");
}

/*******************************************************************************
 * @description    : 대리점 key down팝업
*******************************************************************************/
function div_search_edt_agencyNm_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
{
	if(nChar == "13"){
		var sArg  =  "org_id="+quote(FV_ORG_ID);  // 필수

		cf_callAgencyPop(sArg, div_search, "edt_agencyNm,edt_agencyCd,edt_agencyUkeyCd");
		
		// 입금처 초기화
		div_search.edt_dealNm.Text = "";
		div_search.edt_dealCd.Text = "";
	}
}

/*
function div_search_edt_ordPlcNm_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
{
	if(nChar == "13"){
		var sArg  = "org_id="+quote(gds_session.GetColumn(0,"orgId")); // 필수
		cf_callAgencyPop(sArg, div_search, "edt_ordPlcNm,edt_ordPlcId,edt_ordPlcUkeyId");
	}
}
*/


/*******************************************************************************
 * @description    : 대리점 OnChar Changed 이벤트
*******************************************************************************/
function div_search_edt_ordPlcNm_OnCharChanged(obj,strPreText,strPostText)
{
	if(strPreText != strPostText){
		div_search.edt_ordPlcId.value = "";
		div_search.edt_ordPlcUkeyId.Text = "";
	}
}



/*******************************************************************************
 * @description : 입금처   팝업
 ******************************************************************************/
function div_search_btn_dealCo_OnClick(obj)
{
	var dealCd = ds_condition.GetColumn(0, "pos_agency");

	var sArg  = "deal_co_cl1="+quote("A2,A3,A4,B1,B2,C1"); // 필수 - 복수시 A1,A2,A3 형태의 콤바구분자로 설정
		sArg += " pos_agency="+quote(dealCd);

	//cf_callDealPop(sArg, ds_condition, "deal_nm,stl_plc,deal_ukey", 0);
	cf_callDealPop(sArg, div_search, "edt_dealNm,edt_dealCd", 0, "Y");
}

/*******************************************************************************
 * @description    : 입금처enter- 이벤트
*******************************************************************************/
function div_search_edt_dealNm_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
{
	if(nChar == "13"){

		var dealCd = ds_condition.GetColumn(0, "pos_agency");

		var sArg  = "deal_co_cl1="+quote("A2,A3,A4,B1,B2,C1"); // 필수 - 복수시 A1,A2,A3 형태의 콤바구분자로 설정
			sArg += " pos_agency="+quote(dealCd);

		//cf_callDealPop(sArg, ds_condition, "deal_nm,stl_plc,deal_ukey", 0);
		cf_callDealPop(sArg, div_search, "edt_dealNm,edt_dealCd");
	}
}


function div_search_edt_agencyNm_OnCharChanged(obj,strPreText,strPostText)
{
	div_search.edt_agencyCd.Text = "";
	div_search.edt_agencyUkeyCd.Text = "";
	
	// 입금처 초기화
	div_search.edt_dealNm.Text = "";
	div_search.edt_dealCd.Text = "";
}


function div_search_edt_dealNm_OnCharChanged(obj,strPreText,strPostText)
{
	div_search.edt_dealCd.Text = "";
}



/*******************************************************************************
 * @description : 조회
 ******************************************************************************/
function btn_search_OnClick(obj)
{
	FV_CLOSE_DT = div_search.cal_dpst_yymm.Value;

	if(uf_IsNull(div_search.edt_agencyCd.value)){
		alert(cf_getMessage(MSG_00135, "대리점"));
		div_search.edt_agencyNm.SetFocus();
		return;
	}

	if( uf_isNull(div_search.cal_dpst_yymm.Value) == true ) {
		alert(cf_getMessage(MSG_00135, "입금월"));
		div_search.cal_dpst_yymm.SetFocus();
		return false;
	}

	if( div_search.cmb_dpst_cl.Value == "1" || div_search.cmb_dpst_cl.Value == "2" ) {
		if( uf_isNull(div_search.edt_dealCd.Value) == true ) {
			alert(cf_getMessage(MSG_00135, "입금처"));
			div_search.edt_dealNm.SetFocus();
			return false;
		}
	}

	f_search();
}

function f_search() {
	//var sRfndCl = div_search.chk_objamt.Value;
	//trace("sRfndCl : "  + sRfndCl);

	if (FV_PRE_RFND_CL == "0") {
		FV_PRE_RFND_CL = ds_condition.GetColumn(0,"dpst_cl");
	}
	else
	{
		if (FV_PRE_RFND_CL != ds_condition.GetColumn(0,"dpst_cl")) {

			ds_condition.SetColumn(0,"mod","N");
			FV_MOD = "N";
			reset_ds_rfnd_info();

		}
	}

	if (FV_MOD == "N") {

		reset_ds_rfnd_info();

	}

	var sSvcID = "getRfndProcList";
	var sInDs = "nc_input_fieldDs=ds_condition";
	//var sOutDs = "ds_rfnd_deal_co=ds_rfnd_deal_co ds_rfndproc=ds_rfndproc";
	var sOutDs;
	
	if(FV_MOD == "N"){
		sOutDs = "ds_rfndproc=ds_rfndproc ds_rfnd_info=ds_rfnd_info";
	}else{
		sOutDs = "ds_rfndproc=ds_rfndproc";
	}
	
	var sArg = "sktst.sac.RFD#getRfndProcList";

	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);

}

function f_callBack(sSvcID){
	if (sSvcID == "getRfndProcList")  {
		//trace(ds_rfndproc.SaveXML());

		ds_rfnd_deal.ClearData();
		
		if(FV_MOD == "N") {
			if ( uf_IsNull(ds_condition.GetColumn(0,"stl_plc")) )
			{
				ds_rfnd_deal.AddRow();
				ds_rfnd_deal.SetColumn(0,"VALUE",ds_condition.GetColumn(0,"deal_co_nm"));
				ds_rfnd_deal.SetColumn(0,"CODE",ds_condition.GetColumn(0,"pos_agency"));
			}
			else
			{
				ds_rfnd_deal.AddRow();
				ds_rfnd_deal.SetColumn(0,"VALUE",ds_condition.GetColumn(0,"deal_nm"));
				ds_rfnd_deal.SetColumn(0,"CODE",ds_condition.GetColumn(0,"stl_plc"));
				ds_rfnd_deal.AddRow();
				ds_rfnd_deal.SetColumn(1,"VALUE",ds_condition.GetColumn(0,"deal_co_nm"));
				ds_rfnd_deal.SetColumn(1,"CODE",ds_condition.GetColumn(0,"pos_agency"));
			}
			
			// 환불계좌번호 (거래처정보 출금계좌번호)
			div_process1.edt_acc2.Value = ds_rfndproc.GetColumn(0,"SLCM_DFRY_ACC_NO");		
			// 환불은행 (거래처정보 출금은행)
			div_process1.cmb_bankCd3.Value = ds_rfndproc.GetColumn(0,"SLCM_DFRY_BANK_CD");
			
			// 최초조회시 입금처 계좌번호/은행 셋팅
			FV_DEAL_CL = '1';
			
		} else if(FV_MOD == "M") {
			
			ds_rfnd_deal.AddRow();
			ds_rfnd_deal.SetColumn(0,"VALUE",ds_rowRfnd.GetColumn(0,"RFND_DEAL_CO_NM"));
			ds_rfnd_deal.SetColumn(0,"CODE",ds_rowRfnd.GetColumn(0,"RFND_DEAL_CO"));
		
		}
		ds_rfnd_info.SetColumn(0,"RFND_DEAL_CO",ds_rowRfnd.GetColumn(0,"RFND_DEAL_CO"));	// 환불거래처
		ds_rfnd_info.SetColumn(0,"BANK_CD",ds_rfndproc.GetColumn(0,"BANK_CD"));	// 은행코드
		
		
//		ds_rfnd_info.SetColumn(0,"IMAG_ACC_NO",ds_rfndproc.GetColumn(0,"IMAG_ACC_NO"));	// 가상계좌번호
		
		
		
		div_process1.cmb_rfnd_deal.Index = 0;

		if (ds_rfndproc.GetRowCount() > 0) {
			// 조회여부 완료
			FV_SEARCH_YN = 'Y';
		} else {
			FV_SEARCH_YN = 'N';
		}
		
		ds_rfnd_info.SetRowType(0, "Normal");

	} else if (sSvcID == "saveRfndInfo")  {

		// 수정일 경우
		if (FV_MOD == "M") {

			f_search();

		} else if (FV_MOD == "D"){
			btn_close_OnClick();
		} else {
			reset_ds_rfnd_info();
			f_search();
		}


		//trace(ds_rfnd_deal_co.SaveXML());
	}

	return;
}

/*******************************************************************************
 * @description    :  환불거래처리스트에 조회한 거래처와 소속대리점으로 필터한다.
*******************************************************************************/
function f_setFilterRfndDealCo() {
	var sfilter = "";
	var rowIdx = ds_rfndproc.GetCurrow();

	sfilter = "rfnd_deal_co_cd==" + quote(ds_rfndproc.GetColumn(rowIdx, "pos_agency"));
	sfilter = sfilter + " || rfnd_deal_co_cd==" + quote(ds_rfndproc.GetColumn(rowIdx, "dpst_plc"));

	trace("sfilter : " + sfilter);
	ds_rfnd_deal_co.Filter(sfilter);
}



function ds_rfndproc_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
	if ( strColumnID == "RFND_DEAL_CO" ) {
		var rfndDealCd = obj.GetColumn(nRow, "RFND_DEAL_CO");
		var rfndAccNo = "";

		trace("rfndDealCd : " + rfndDealCd);
		for (var i = 0; i < ds_rfnd_deal_co.GetRowCount(); i++ ) {
			//trace("rfndDealCd : " + ds_rfnd_deal_co.GetColumn(i, "RFND_DEAL_CO_CD"));

			if ( ds_rfnd_deal_co.GetColumn(i, "RFND_DEAL_CO_CD") == rfndDealCd ) {
				rfndAccNo = ds_rfnd_deal_co.GetColumn(i, "RFND_ACC_NO");
				break;
			}
		}

		obj.SetColumn(nRow, "RFND_ACC_NO", rfndAccNo);
	}

}

function ds_rfndproc_CanColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
	//alert("ds_rfndproc_CanColumnChanged");


}

function ds_rfndproc_CanColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{

}

/*******************************************************************************
 * @description    : 닫기 - 이벤트
*******************************************************************************/
function btn_close_OnClick(obj) {
//	setParentAgencyInfo();
	this.Close(1);
}

function setParentAgencyInfo() {
	parent.div_search.edt_agencyNm.Value = div_search.edt_agencyNm.Value;
	parent.div_search.edt_agencyUkeyCd.Value = div_search.edt_agencyUkeyCd.Value;
	parent.div_search.edt_agencyCd.Value = div_search.edt_agencyCd.Value;
	parent.div_search.cmb_rfnd_cl.Value = div_search.cmb_dpst_cl.Value;
	
	parent.div_search.edt_dealNm.Value = div_search.edt_dealNm.Value;
	parent.div_search.edt_dealCd.Value = div_search.edt_dealCd.Value;
}

// 저장버튼 클릭
function btn_save_OnClick(obj)
{

    if (ds_rfnd_info.GetUpdate()){
    }
	if (FV_MTH_CHK_YN == 'Y') {
		alert("월 마감된 환불정보는 수정 또는 삭제할 수 없습니다.");
		return;
	}
	
	if (FV_SEARCH_YN == 'N') {
		alert("잔액정보를 확인하셔야 저장하실 수 있습니다.");
		return;
	}
	
	if (FV_FIX_YN == '2' || FV_FIX_YN == '4') {
		alert("ERP 전송건은 수정 또는 삭제하실 수 없습니다.");
		return;
	}

	if (ds_rfnd_info.GetColumn(0, "REFUND_YN") == 'Y') {
		alert("환불처리 된 데이터 입니다..");
		return;
	}
	
	if(uf_IsNull(ds_rfndproc.GetColumn(0,"BANK_CD"))){
		
		alert("거래처 관리에서 계좌 정보를 확인하십시오.");
		return;
	}
	
	// 수정일 경우
	if(FV_MOD == "M"){

		var mod_yn = ds_rfnd_info.GetColumn(0,"MOD_POS_YN");
		if (mod_yn == "N" || uf_isNull(mod_yn) == true) {
			alert("마지막 환불금만 수정가능합니다.");
			return;
		}

	}

	//alert(div_process1.edt_OrgAreaId.value);
	//return;

	//cf_CheckCloseMnth('03',FV_CLOSE_DT,"마감일");
	//if(FV_BOOLEAN_CLOSE) return;

	if (uf_isNull(ds_rfnd_info.GetColumn(0, "RFND_DEAL_CO")) == true) {
		alert("환불거래처를 입력하세요.");
		div_process1.cmb_rfnd_deal.SetFocus();
		return;
	}

	if (uf_isNull(ds_rfnd_info.GetColumn(0, "RFND_ACC_NO")) == true) {
		alert("환불계좌를 입력하세요.");
		div_process1.edt_acc2.SetFocus();
		return;
	}

	if (uf_isNull(ds_rfnd_info.GetColumn(0, "RFND_AMT")) == true || ds_rfnd_info.GetColumn(0, "RFND_AMT") == "0" || ds_rfnd_info.GetColumn(0, "RFND_AMT") == 0) {
		alert("환불액을 입력하세요.");
		div_process1.edt_rfndAmt.SetFocus();
		return;
	}

	if(FV_MOD == "N") {
		if ( toNumber(ds_rfnd_info.GetColumn(0, "RFND_AMT")) > toNumber(ds_rfndproc.getColumn(ds_rfndproc.GetRowCount()-1,"BAMT") )) {
			alert("환불액이 현재잔액보다 클수 없습니다.");
			if(div_search.cmb_dpst_cl.Value != "3"){
				div_process1.edt_rfndAmt.Value = "";
			}
			div_process1.edt_rfndAmt.SetFocus();
			return;
		}
	} else if(FV_MOD == "M") {
		
		if ( toNumber(ds_rfnd_info.GetColumn(0, "RFND_AMT")) > 
		toNumber(( ds_rfndproc.getColumn(ds_rfndproc.GetRowCount()-1,"BAMT") + FV_RFND_AMT ) )) {
			alert("환불액이 현재잔액보다 클수 없습니다.");
			if(div_search.cmb_dpst_cl.Value != "3"){
				div_process1.edt_rfndAmt.Value = "";
			}
			div_process1.edt_rfndAmt.SetFocus();
			return;
		}
	
	}
	
	

	if (uf_isNull(ds_rfnd_info.GetColumn(0, "RFND_BANK_CD")) == true) {
		alert("환불은행을 입력하세요.");
		div_process1.cmb_bankCd3.SetFocus();
		return;
	}

	ds_rfnd_info.SetColumn(0,"RFND_CL",ds_condition.GetColumn(0,"dpst_cl"));	// 환불구분
	ds_rfnd_info.SetColumn(0,"DPST_YYMM",ds_condition.GetColumn(0,"dpst_yymm"));	// 입금월
	ds_rfnd_info.SetColumn(0,"POS_AGENCY",ds_condition.GetColumn(0,"pos_agency"));	// 대리점
	ds_rfnd_info.SetColumn(0,"DPST_PLC",ds_condition.GetColumn(0,"stl_plc"));	// 입금처

	// 환불구분이 불명금이 아닌 경우 가상계좌를 넣어준다.
	if(div_search.cmb_dpst_cl.Value != "3") {
		ds_rfnd_info.SetColumn(0,"IMAG_ACC_NO",ds_rfndproc.GetColumn(0,"IMAG_ACC_NO"));	// 가상계좌번호
	}
	
	ds_rfnd_info.SetColumn(0,"BANK_CD",ds_rfndproc.GetColumn(0,"BANK_CD"));	// 은행코드

	//alert(ds_rfnd_info.GetColumn(0,"RFND_DT"));
	//return;


	if (confirm("저장 하시겠습니까?") == true) {
		var sSvcID 	= "saveRfndInfo";
		var sInDs 	= "nc_input_fieldDs=ds_condition ds_rfnd_info=ds_rfnd_info";
		var sOutDs 	= "";
		var sArg 	= "sktst.sac.RFD#saveRfndInfo";

		// 공통 트랜잭션 호출
		cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
	}

}

// 환불정보 초기화
function reset_ds_rfnd_info()
{
	div_process1.edt_acc2.Value = "";
	div_process1.edt_rfndAmt.Value = "";
	div_process1.cmb_bankCd3.Value = "";
	div_process1.edt_remark.Value = "";

	div_process1.cmb_rfnd_deal.Enable = true;
	div_process1.edt_acc2.Enable = true;
}


function grd_list_OnCellDBLClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{
	var sArg = "";
	sArg  = 'dpstDt=' + quote(ds_rfndproc.GetColumn(nRow, "dpst_dt"));
	sArg += ' bankNm=' + quote(ds_rfndproc.GetColumn(nRow, "bank_nm"));
	sArg += ' accNo=' + quote(ds_rfndproc.GetColumn(nRow, "imag_acc_no"));

	trace("sArg : " + sArg);
	var sResult = dialog("SAC::SACRFD00300.xml", sArg);

	if (sResult != null && sResult != 0) {
		var dpstAmt = ds_rfndproc.GetColumn(nRow, "DPST_AMT");			//입금액
		var accAmt = ds_rfndproc.GetColumn(nRow, "ACC_AMT");			//정산액
		var balance = ds_rfndproc.GetColumn(nRow, "BALANCE");			//잔액
		var nowBalance = ds_rfndproc.GetColumn(nRow, "NOW_BALANCE");	//현재잔액
		var rfndAmt = ds_rfndproc.GetColumn(nRow, "RFND_AMT");			//환불금액

		//trace("strPreText : " + strPreText +  ", strPostText : " + strPostText);
		//trace("accAmt : " + parseInt(accAmt));
		if ( parseInt(accAmt) == 0 ) {
			if ( parseInt(dpstAmt) < parseInt(rfndAmt) ) {
				alert("환불금액이 입금액을 초과 할 수 없습니다.");
				ds_rfndproc.SetColumn(nRow, "RFND_AMT", "0");
				obj.SetCellPos(nCell);
			}
		} else {
			if ( parseInt(balance) < parseInt(rfndAmt) || parseInt(nowBalance) < parseInt(rfndAmt) ) {
				alert("환불금액이 입금일 잔액과 현재잔액을 초과 할 수 없습니다.");
				ds_rfndproc.SetColumn(nRow, "RFND_AMT", "0");
				obj.SetCellPos(nCell);
			}
		}
	}
}


function grd_list_OnChar(obj,strPreText,nChar,strPostText,nLLParam,nHLParam,nRow,nCell,nPivotIndex)
{
	//trace("OnChan nCell : " + nCell);
	var nRfndAmt = f_getIndexByGridColId(obj, "RFND_AMT");
	//trace("nRfndAmt : " + nRfndAmt);
	//환불금액
	if ( nCell == nRfndAmt && strPreText != strPostText) {
		var dpstAmt = ds_rfndproc.GetColumn(nRow, "DPST_AMT");			//입금액
		var accAmt = ds_rfndproc.GetColumn(nRow, "ACC_AMT");			//정산액
		var balance = ds_rfndproc.GetColumn(nRow, "BALANCE");			//잔액
		var nowBalance = ds_rfndproc.GetColumn(nRow, "NOW_BALANCE");	//현재잔액
		var rfndAmt = ds_rfndproc.GetColumn(nRow, "RFND_AMT");			//환불금액

		//trace("strPreText : " + strPreText +  ", strPostText : " + strPostText);
		//trace("accAmt : " + parseInt(accAmt));
		if ( parseInt(accAmt) == 0 ) {
			if ( parseInt(dpstAmt) < parseInt(strPostText) ) {
				alert("환불금액이 입금액을 초과 할 수 없습니다.");
				ds_rfndproc.SetColumn(nRow, "RFND_AMT", strPreText);
				obj.SetCellPos(nCell);
			}
		} else {
			if ( parseInt(balance) < parseInt(strPostText) || parseInt(nowBalance) < parseInt(strPostText) ) {
				alert("환불금액이 입금일 잔액과 현재잔액을 초과 할 수 없습니다.");
				ds_rfndproc.SetColumn(nRow, "RFND_AMT", strPreText);
				obj.SetCellPos(nCell);
			}
		}
	}

}


/*******************************************************************************
 * @description    : 컬럼ID로 Cell index 얻기
objGrid : 그리드 오브젝트
strGridColId : 찾고자하는 컬럼ID
nCntColId : 동일한 컬럼 존재시 몇번째넘(생략가)
*******************************************************************************/
function f_getIndexByGridColId(objGrid, strGridColId, nCntColId) {
	var nCntFind = 0;

	if(nCntColId == null) {
		nCntColId = 0;
	}

	var nCntCols = objGrid.GetCellCount("BODY");

	for(var i=0; i < nCntCols; i++) {
		var strColId = objGrid.GetCellProp("BODY", i, "COLID");

		if(strColId == strGridColId) {
			var nColIndex = objGrid.GetCellProp("HEAD", i, "COL");

			if(nCntColId == nCntFind) {
				return toNumber(nColIndex);
			}
			nCntFind++;
		}
	}

	return -1;
}


/*******************************************************************************
 * @description    : 환불거래처 click- 이벤트
*******************************************************************************/
function rfnd_deal_OnClick(obj)
{
	var sArg  = "deal_co_cl1="+quote("A1,A2,A3,B1,B2,C1"); // 필수 - 대리점,직영점,판매점 등등

	cf_callDealPop(sArg, div_process1, "edt_OrgAreaNm,edt_OrgAreaId");
}

/*******************************************************************************
 * @description    : 환불구분 change- 이벤트
*******************************************************************************/
function div_search_cmb_dpst_cl_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{

	ds_rfndproc.DeleteAll();
	ds_rfndproc.AddRow();
	
	if(div_search.cmb_dpst_cl.Value == "3" || div_search.cmb_dpst_cl.Value == "4") {
		div_search.edt_dealNm.Text = "";
		div_search.edt_dealCd.Text = "";
		div_process1.edt_rfndAmt.Text = "";
		div_search.edt_dealNm.Enable = false;
		div_search.btn_dealCo.Enable = false;
		div_process1.edt_rfndAmt.Enable = false;
	} else {
		div_search.edt_dealNm.Enable = true;
		div_search.btn_dealCo.Enable = true;
		div_process1.edt_rfndAmt.Enable = true;
	}
	
	// 환불구분이 불명금인 경우 환불액 필드 처리
	if(div_search.cmb_dpst_cl.Value == "3") {
		div_process1.edt_rfndAmt.Text = "";
		div_process1.edt_rfndAmt.Enable = false;
	} else {
		div_process1.edt_rfndAmt.Enable = true;
	}

}

/*******************************************************************************
 * @description    : 삭제
*******************************************************************************/
function btn_delete_OnClick(obj)
{
	if (FV_MTH_CHK_YN == 'Y') {
		alert("월 마감된 환불정보는 수정 또는 삭제할 수 없습니다.");
		return;
	}
	
	if (FV_FIX_YN == '2' || FV_FIX_YN == '4') {
		alert("ERP 전송건은 수정 또는 삭제하실 수 없습니다.");
		return;
	}
	
	ds_condition.SetColumn(0,"mod","D");
	if (confirm("삭제 하시겠습니까?") == true) {
		var sSvcID 	= "saveRfndInfo";
		var sInDs 	= "nc_input_fieldDs=ds_condition ds_rfnd_info=ds_rfnd_info";
		var sOutDs 	= "";
		var sArg 	= "sktst.sac.RFD#saveRfndInfo";

		// 공통 트랜잭션 호출
		cf_Transaction(sSvcID, sInDs, sOutDs, sArg);

		FV_MOD = "D";
	}

}

/*******************************************************************************
 * @description    : 환불거래처 변경
*******************************************************************************/
function div_process1_cmb_rfnd_deal_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	if(FV_DEAL_CL == '1') {
		div_process1.edt_acc2.Value = ds_rfndproc.GetColumn(0,"POS_SLCM_DFRY_ACC_NO");
		div_process1.cmb_bankCd3.Value = ds_rfndproc.GetColumn(0,"POS_SLCM_DFRY_BANK_CD");
		// 최초조회시 입금처 계좌번호/은행 셋팅
		FV_DEAL_CL = '2';
	} else {
		div_process1.edt_acc2.Value = ds_rfndproc.GetColumn(0,"SLCM_DFRY_ACC_NO");
		div_process1.cmb_bankCd3.Value = ds_rfndproc.GetColumn(0,"SLCM_DFRY_BANK_CD");
		// 최초조회시 입금처 계좌번호/은행 셋팅
		FV_DEAL_CL = '1';
	}
}

/*******************************************************************************
 * @description    : 불명금인 경우 처리
*******************************************************************************/
function grd_list_OnCellClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{
   /*
    *   환불구분이 불명금('3')인 경우 만 처리
    */
	var dpstCl = div_search.cmb_dpst_cl.Value;
	if(dpstCl != '3'){
		return;
	}
	div_process1.edt_rfndAmt.Text = ds_rfndproc.GetColumn(nRow,"DPST_AMT");
	var refundYn  = ds_rfndproc.GetColumn(nRow,"REFUND_YN");
	var imagAccNo = ds_rfndproc.GetColumn(nRow,"IMAG_ACC_NO");
	var seqNo     = ds_rfndproc.GetColumn(nRow,"SEQ_NO");
	var dpstDt    = ds_rfndproc.GetColumn(nRow,"YMD");

   /*
    *   환불여부가 "N" 경우만 처리
    */
	if(refundYn == "Y"){
		alert("환불처리된 데이터 입니다.");
	}

	ds_rfnd_info.SetColumn(0, "IMAG_ACC_NO", imagAccNo);
	ds_rfnd_info.SetColumn(0, "DPST_DT", dpstDt);
	ds_rfnd_info.SetColumn(0, "SEQ_NO", seqNo);
	ds_rfnd_info.SetColumn(0, "REFUND_YN", refundYn);
}
]]></Script>
</Window>