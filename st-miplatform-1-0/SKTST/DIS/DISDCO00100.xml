<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="600" Id="DISDCO00100" Left="8" OnLoadCompleted="DISDCO00100_OnLoadCompleted" PidAttrib="7" Title="상품입력(입고)" Top="8" Ver="1.0" Width="830" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_prod" OnColumnChanged="ds_prod_OnColumnChanged">
				<Contents>
					<colinfo id="prod_cl" size="256" summ="default" type="STRING"/>
					<colinfo id="mfact_id" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="color_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="ser_num" size="256" summ="default" type="STRING"/>
					<colinfo id="bad_yn" size="256" summ="default" type="STRING"/>
					<colinfo id="dis_st" size="256" summ="default" type="STRING"/>
					<colinfo id="in_qty" size="256" summ="default" type="STRING"/>
					<colinfo id="chk" size="256" summ="default" type="STRING"/>
					<colinfo id="edt_flg" size="256" summ="default" type="STRING"/>
					<colinfo id="bar_cd_typ" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_cl_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="mfact_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="color_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="dum_yn" size="256" summ="default" type="STRING"/>
					<colinfo id="fix_yn" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_cd_color_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_cd_ser_num" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_prodCl">
				<Contents>
					<colinfo id="COMM_CD_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="COMM_CD_VAL" size="256" summ="default" type="STRING"/>
					<colinfo id="COMM_CD_VAL_NM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_mfact"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_color">
				<Contents>
					<colinfo id="COMM_CD_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="COMM_CD_VAL" size="256" summ="default" type="STRING"/>
					<colinfo id="COMM_CD_VAL_NM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_bad">
				<Contents>
					<colinfo id="COMM_CD_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="COMM_CD_VAL" size="256" summ="default" type="STRING"/>
					<colinfo id="COMM_CD_VAL_NM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_disSt">
				<Contents>
					<colinfo id="COMM_CD_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="COMM_CD_VAL" size="256" summ="default" type="STRING"/>
					<colinfo id="COMM_CD_VAL_NM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_in"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_prodColor"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_childPop"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_barInfo"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_retCnt"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_prodInfo"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_disProd"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_asIn"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_condition"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_prodInfoByBarCode"></Dataset>
		</Datasets>
		<Div Border="Raised" Height="40" Id="div_search" Left="10" Style="sty_div_input" TabOrder="1" Text="Div0" Top="10" Width="810">
			<Contents>
				<Image Align="Left" Height="20" Id="Image0" ImageID="bul_caution" Left="242" LeftMargin="20" Style="sty_lb_info" TabOrder="1" Text="일련번호&#32;입력은&#32;상품구분이&#32;단말기,USIM&#32;경우만&#32;입력&#32;가능함." Top="7" Width="328"></Image>
			</Contents>
		</Div>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" BindDataset="ds_prod" BkColor2="user32" BoldHead="true" Border="Flat" Bottom="549" Editable="TRUE" Enable="true" EndLineColor="default" FillArea="TRUE" HeadBorder="Flat" HeadHeight="22" Height="464" Id="grd_prod" InputPanel="FALSE" Left="10" LineColor="user33" MinWidth="100" OnCellPosChanged="grd_prod_OnCellPosChanged" OnChar="grd_prod_OnChar" OnEnterDown="grd_prod_OnEnterDown" OnExpandUp="grd_prod_OnExpandUp" OnHeadClick="grd_menu_OnHeadClick" Right="820" RowHeight="21" Style="sty_Grid" TabOrder="2" TabStop="true" Top="85" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="user33" WheelScrollRow="1" Width="810">
			<contents>
				<format id="Default">
					<columns>
						<col width="30"/>
						<col width="62"/>
						<col width="85"/>
						<col width="133"/>
						<col width="103"/>
						<col width="107"/>
						<col width="92"/>
						<col width="65"/>
						<col width="65"/>
						<col width="65"/>
					</columns>
					<head>
						<cell bkcolor="user34" col="0" color="user35" display="checkbox" edit="checkbox"/>
						<cell bkcolor="user34" col="1" color="user35" display="text" text="번호"/>
						<cell bkcolor="user34" col="2" color="user35" display="text" text="상품구분"/>
						<cell bkcolor="user34" col="3" color="user35" display="text" text="제조사"/>
						<cell bkcolor="user34" col="4" color="user35" display="text" text="모델"/>
						<cell bkcolor="user34" col="5" color="user35" display="text" text="색상"/>
						<cell bkcolor="user34" col="6" color="user35" display="text" text="일련번호"/>
						<cell bkcolor="user34" col="7" color="user35" display="text" text="불량여부"/>
						<cell bkcolor="user34" col="8" color="user35" display="text" text="재고상태"/>
						<cell bkcolor="user34" col="9" color="user35" display="text" text="수량"/>
					</head>
					<body>
						<cell align="center" col="0" colid="chk" display="checkbox" edit="checkbox"/>
						<cell align="center" col="1" display="text" expr="currow+1"/>
						<cell align="center" col="2" colid="prod_cl" combocol="code" combodataset="ds_prodCl" combotext="value" display="combo" expandsize="17"/>
						<cell col="3" colid="mfact_id" combocol="code" combodataset="ds_mfact" combodisplayrowcnt="10" combotext="value" display="combo" expandsize="17"/>
						<cell align="left" col="4" colid="prod_nm" display="text" edit='expr:Iif(edt_flg==2,&#32;&quot;none&quot;,&#32;&quot;normal&quot;)' expandimage="btn_i_detail_b" expandshow='expr:Iif(edt_flg==2,&#32;&quot;false&quot;,&#32;&quot;true&quot;)'/>
						<cell align="center" col="5" colid="color_cd" combocol="code" combodataset="ds_color" combodisplayrowcnt="10" combotext="value" display="combo" edit='expr:Iif(edt_flg==2,&#32;&quot;none&quot;,iif(FV_IN_OUT_CL==&quot;103&quot;||FV_IN_OUT_CL==&quot;109&quot;,&quot;none&quot;,&quot;combo&quot;))' expandimage="btn_combo" expandshow="expr:decode(edt_flg,&apos;2&apos;,&apos;false&apos;,&apos;true&apos;)" expandsize="17"/>
						<cell align="center" col="6" colid="ser_num" color="expr:decode(dum_yn,&apos;Y&apos;,&apos;red&apos;,&apos;defalut&apos;)" display="text" edit='expr:Iif(edt_flg==2||prod_cl==9,&#32;&quot;none&quot;,&#32;&quot;normal&quot;)' imemode="english" useime="false"/>
						<cell align="center" col="7" colid="bad_yn" combocol="code" combodataset="ds_bad" combotext="value" display="combo"/>
						<cell align="center" col="8" colid="dis_st" combocol="code" combodataset="ds_disSt" combotext="value" display="combo"/>
						<cell align="right" col="9" colid="in_qty" display="text" edit="expr:decode(prod_cl,&apos;9&apos;,decode(edt_flg,&apos;2&apos;,&apos;none&apos;,&apos;number&apos;),&apos;none&apos;)"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="25" Id="btn_close" ImageID="btn_d_2" Left="761" LeftMargin="5" OnClick="btn_close_OnClick" Style="sty_btn_d" TabOrder="4" Text="닫기" Top="565" Width="60"></Button>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="25" Id="btn_confirm" ImageID="btn_c_2" Left="696" LeftMargin="5" OnClick="btn_confirm_OnClick" Style="sty_btn_c" TabOrder="3" Text="확인" Top="565" Width="60"></Button>
		<Div Height="21" Id="div_excel" Left="746" TabOrder="5" Text="Div2" Top="60" Width="77">
			<Contents>
				<Button Cursor="HAND" Height="21" Id="btn_addRow" ImageID="btn_i_add_w" Left="32" OnClick="div_excel_btn_addRow_OnClick" TabOrder="1" Text="Button1" ToolTipText="행추가" Width="19"></Button>
				<Button Cursor="HAND" Height="21" Id="btn_delRow" ImageID="btn_i_subtract_w" Left="55" OnClick="div_excel_btn_delRow_OnClick" TabOrder="2" Text="Button1" ToolTipText="추가된&#32;행삭제" Width="19"></Button>
			</Contents>
		</Div>
	</Form>
	<Script><![CDATA[/*******************************************************************************
* 프로그램ID : DISDCO00100
* 업무명      :  재고관리 - 상품입력(입고)
* 프로그램명  : 상품입력(입고)
--------------------------------------------------------------------------------
* 작성자      : 김중일
* 작성일      : 2009.01.19
--------------------------------------------------------------------------------
* 1. 변경이력
수정자    :
수정일    :
수정 내역 :
*******************************************************************************/

//==============================================================================
// 공통 스크립트 로딩
//==============================================================================
#include "lib::lib_commF.js"
#include "lib::lib_commPopup.js"
#include "lib::lib_DIS.js"

//==============================================================================
// 폼 변수 정의
//==============================================================================
var FV_STR_DSID;  // 데이터셋 ID
var FV_OBJ_DS;    // 데이터셋 객체
var FV_SER_NUM;   // 일련번호
var FV_IN_OUT_CL; // 입고구분
var FV_CALL_FUNCTION; // 부모창 호출 함수명
var FV_APPLY_DT;  // 상품조회시 적용일.
var FV_ORD_QTY;   // 발주수량

/*******************************************************************************
 * @description    : 최초 폼 로드시 발생 - 이벤트
*******************************************************************************/
function DISDCO00100_OnLoadCompleted(obj)
{
    http.Sync = true;
    FV_OBJ_DS = Object("parent." + FV_STR_DSID);
    
    // 그리드 체크박스 설정 및 정렬
    cf_setGrdChecknSortEvent(grd_prod, 0);  
    
    // 공통 코드 조회
    f_getCommCd("ds_prodCl", "ZBAS_C_00010");  // 상품구분
    f_getCommCd("ds_color" , "ZBAS_C_00040");  // 색상
    f_getCommCd("ds_bad"   , "ZDIS_C_00090");  // 불량여부
    f_getCommCd("ds_disSt" , "ZDIS_C_00100");  // 재고상태


    //cf_setCommonCode("ds_prodCl", "ZBAS_C_00010");  // 상품구분
    //cf_setCommonCode("ds_color" , "ZBAS_C_00040");  // 색상
    //cf_setCommonCode("ds_bad"   , "ZDIS_C_00090");  // 불량여부
    //cf_setCommonCode("ds_disSt" , "ZDIS_C_00100");  // 재고상태
	
	
	
    // 제조사 리스트 조회
    f_getMfact();
    
    f_addRow();
    
    http.Sync = false;
    
    
}

/*******************************************************************************
 * @description    : 콜백
 * @param sSvcID   : 서비스 아이디
*******************************************************************************/
function f_callBack(sSvcID)
{   
    // 기본값 셋팅(공통 코드, 제조사)
    if(Left(sSvcID, 3) == "ds_")
    {
        //f_setDefault(sSvcID);
    }
    
    // 상품코드별 색상
    if(sSvcID == "svcProdColor")
    {
        if(ds_prodColor.rowcount > 0)
        {
            f_setProdColor();
        }
        else
        {
            ds_color.UnFilter();
        }
        
        grd_prod.SetCellProp("Body", 5, "edit", "expr:Iif(edt_flg==2, \"none\", Iif(FV_IN_OUT_CL==109||FV_IN_OUT_CL==103,\"none\",\"combo\")");
    
    }else if(sSvcID == "svcProdInfo")
    {
        if(ds_prodInfo.colcount > 0)
        {
        
            // 구매입고 또는 교품입고인 경우 201, 206 가능         
            if(FV_IN_OUT_CL == "101" || FV_IN_OUT_CL == "102"){
                 
                if(uf_IsNull(ds_prodInfo.GetColumn(0,"last_inout_dtl_cl"))){
					// last_inout_dtl_cl 없으면 신규이므로 가능.
                }else{                
					
					if(ds_prodInfo.GetColumn(0,"last_inout_dtl_cl") == "206"
						|| ds_prodInfo.GetColumn(0,"last_inout_dtl_cl") == "201"){
						
						// last_inout_dtl_cl 있지만 201,206인 경우엔 가능.
						
					}else{
						
						alert("등록된 일련번호입니다.");
						
						grd_prod.SetFocus();
						grd_prod.SetCellPos(6);
						return;     						
					}
                }
                
            }else{
        
                if(!uf_IsNull(ds_prodInfo.GetColumn(0,"ser_num"))){
                    
                    alert("등록된 일련번호입니다.");
                    
                    grd_prod.SetFocus();
                    grd_prod.SetCellPos(6);
                    return;             
                }
            }
            
            ds_prod.SetColumn(ds_prod.currow, "bad_yn", "01");
            ds_prod.SetColumn(ds_prod.currow, "dis_st", "01");     
            f_setAddedRow();
        }
        else
        {
            // 등록되지 않은 상품입니다.;
            alert(MSG_00125);
            
            grd_prod.SetFocus();
            grd_prod.SetCellPos(4);
            return;
        }
        
    }else if(sSvcID == "searchProd"){
    
        f_dialogPop(ds_prod.currow);
        
    }else if(sSvcID == "searchProdInfoByBarCode"){

        if(ds_prodInfoByBarCode.rowcount == 0){
        
            //("스캔한 정보에 해당하는 상품이 존재 하지 않습니다.");
            alert(cf_getMessage(MSG_00143)); 
            ds_prod.SetColumn(ds_prod.currow, "ser_num",null);
            grd_prod.SetFocus();
            grd_prod.SetCellPos(6);
            return;
            
        }else{

            if( uf_IsNull(ds_prodInfoByBarCode.GetColumn(0,"ser_num"))){
                
                //alert("바코드 정보에 일련번호가 존재하지 않습니다. 직접 KEY IN 바랍니다.");
                alert(cf_getMessage(MSG_00144)); 
                ds_prod.SetColumn(ds_prod.currow, "ser_num",null);
                grd_prod.SetFocus();
                grd_prod.SetCellPos(6);
                
                return;
            }else if( uf_IsNull(ds_prodInfoByBarCode.GetColumn(0,"raw_color_cd"))
                   && ds_prod.GetColumn(ds_prod.currow, "prod_cl") != "2"){
                
                //alert("바코드 정보에 색상이 존재하지 않습니다. 직접 KEY IN 바랍니다.");
                alert(cf_getMessage(MSG_00145)); 
//                ds_prod.SetColumn(ds_prod.currow, "ser_num",null);
                ds_prod.SetColumn(ds_prod.currow, "ser_num", ds_prodInfoByBarCode.GetColumn(0,"ser_num"));
                grd_prod.SetFocus();
                grd_prod.SetCellPos(5);
                return;
            }else if( uf_IsNull(ds_prodInfoByBarCode.GetColumn(0,"color_cd"))
                    && ds_prod.GetColumn(ds_prod.currow, "prod_cl") != "2"){
                
                //alert("상품에 등록되지 않은 색상코드["+ds_prodInfoByBarCode.GetColumn(0,"raw_color_cd")+"]입니다.");
                alert(cf_getMessage(MSG_00146,ds_prodInfoByBarCode.GetColumn(0,"raw_color_cd"))); 
                ds_prod.SetColumn(ds_prod.currow, "ser_num",null);
                ds_prod.SetColumn(ds_prod.currow, "color_cd",null);
                grd_prod.SetFocus();
                grd_prod.SetCellPos(5);
                return;
            }else{
            
                //재고상태를 체크한다.
                if( FV_IN_OUT_CL == "103"  ){
                    // as 입고 시
                    
                    if(ds_prodInfoByBarCode.GetColumn(0,"bad_yn") != "02" ){
                        //alert("상품의 불량구분이 불량이어야 합니다.");
                        alert(cf_getMessage(MSG_00147)); 
                        ds_prod.SetColumn(ds_prod.currow, "ser_num",null);
                        ds_prod.SetColumn(ds_prod.currow, "color_cd",null);                     
                        return;
                    }
                    
                    if(ds_prodInfoByBarCode.GetColumn(0,"dis_st") != "02" ){
                        //alert("상품의 재고상태가 비가용이어야 합니다.");
                        alert(cf_getMessage(MSG_00148)); 
                        ds_prod.SetColumn(ds_prod.currow, "ser_num",null);
                        ds_prod.SetColumn(ds_prod.currow, "color_cd",null);                     
                        return;
                    }
                                        
                    if(ds_prodInfoByBarCode.GetColumn(0,"last_inout_cl") != "200" ){
                        //alert("상품의 입출고구분이 출고이어야 합니다.");
                        alert(cf_getMessage(MSG_00149)); 
                        ds_prod.SetColumn(ds_prod.currow, "ser_num",null);
                        ds_prod.SetColumn(ds_prod.currow, "color_cd",null);                     
                        return;
                    }               
                                            
                    if(ds_prodInfoByBarCode.GetColumn(0,"last_inout_dtl_cl") != "203" ){
                        //alert("상품의 입출고상세구분이 AS출고이어야 합니다.");
                        alert(cf_getMessage(MSG_00150,"AS출고")); 
                        ds_prod.SetColumn(ds_prod.currow, "ser_num",null);
                        ds_prod.SetColumn(ds_prod.currow, "color_cd",null);                     
                        return;
                    }   
                                                                
                    ds_prod.SetColumn(ds_prod.currow, "bad_yn", ds_prodInfoByBarCode.GetColumn(0,"bad_yn"));
                    ds_prod.SetColumn(ds_prod.currow, "dis_st", ds_prodInfoByBarCode.GetColumn(0,"dis_st"));                    
                    
                }else if(FV_IN_OUT_CL == "109"){
                    // 교품 반환입고 시
                    
                    if(ds_prodInfoByBarCode.GetColumn(0,"bad_yn") != "02" ){
                        //alert("상품의 불량구분이 불량이어야 합니다.");
                        alert(cf_getMessage(MSG_00147)); 
                        ds_prod.SetColumn(ds_prod.currow, "ser_num",null);
                        ds_prod.SetColumn(ds_prod.currow, "color_cd",null);                     
                        return;
                    }
                    
                    if(ds_prodInfoByBarCode.GetColumn(0,"dis_st") != "02" ){
                        //alert("상품의 재고상태가 비가용이어야 합니다.");
                        alert(cf_getMessage(MSG_00148)); 
                        ds_prod.SetColumn(ds_prod.currow, "ser_num",null);
                        ds_prod.SetColumn(ds_prod.currow, "color_cd",null);                     
                        return;
                    }
                                        
                    if(ds_prodInfoByBarCode.GetColumn(0,"last_inout_cl") != "200" ){
                        //alert("상품의 입출고구분이 출고이어야 합니다.");
                        alert(cf_getMessage(MSG_00149)); 
                        ds_prod.SetColumn(ds_prod.currow, "ser_num",null);
                        ds_prod.SetColumn(ds_prod.currow, "color_cd",null);                     
                        return;
                    }               
                                            
                    if(ds_prodInfoByBarCode.GetColumn(0,"last_inout_dtl_cl") != "202" ){
                        //alert("상품의 입출고상세구분이 교품출고이어야 합니다.");
                        alert(cf_getMessage(MSG_00150,"교품출고")); 
                        ds_prod.SetColumn(ds_prod.currow, "ser_num",null);
                        ds_prod.SetColumn(ds_prod.currow, "color_cd",null);                     
                        return;
                    }   

                    ds_prod.SetColumn(ds_prod.currow, "bad_yn", ds_prodInfoByBarCode.GetColumn(0,"bad_yn"));
                    ds_prod.SetColumn(ds_prod.currow, "dis_st", ds_prodInfoByBarCode.GetColumn(0,"dis_st"));                    
                }else{
                    ds_prod.SetColumn(ds_prod.currow, "bad_yn", "01");
                    ds_prod.SetColumn(ds_prod.currow, "dis_st", "01");  
                    
                    
					if(FV_IN_OUT_CL == "101" || FV_IN_OUT_CL == "102"){
						 
						if(uf_IsNull(ds_prodInfoByBarCode.GetColumn(0,"last_inout_dtl_cl"))){
							// last_inout_dtl_cl 없으면 신규이므로 가능.
						}else{                
							
							if(ds_prodInfoByBarCode.GetColumn(0,"last_inout_dtl_cl") == "206"
								|| ds_prodInfoByBarCode.GetColumn(0,"last_inout_dtl_cl") == "201"){
								
								// last_inout_dtl_cl 있지만 201,206인 경우엔 가능.
								
							}else{
									
								alert(MSG_00126);
								return;   						
							}
						}
						
					}else {                    
                                
						if(!uf_IsNull(ds_prodInfoByBarCode.GetColumn(0,"last_inout_cl"))){
							alert(MSG_00126);
							return;
						}
                    }
                }
                
                if(ds_prod.GetColumn(ds_prod.currow, "prod_cl") != "2")
                {
                    ds_prod.SetColumn(ds_prod.currow, "color_cd",ds_prodInfoByBarCode.GetColumn(0,"color_cd"));
                }
                ds_prod.SetColumn(ds_prod.currow, "ser_num",ds_prodInfoByBarCode.GetColumn(0,"ser_num"));
                f_setAddedRow();
            }
        }
    }
}

/*******************************************************************************
 * @description    : 기본값 셋팅
*******************************************************************************/
function f_setDefault(sDsID)
{
    Object(sDsID).InsertRow(0);
    Object(sDsID).SetColumn(0, "code", "");
    Object(sDsID).SetColumn(0, "value", "선택");
}

/*******************************************************************************
 * @description    : 공통 코드 조회
 * @param sOutDsID : 출력 데이터셋 아이디
 *        sCommCd  : 공통 코드
*******************************************************************************/
function f_getCommCd(sOutDsID, sCommCd)
{
    // 입력 파라메터 셋팅
    ds_in.ClearData();
    cf_setParam(ds_in, "comm_cd_id", sCommCd);
    
    // 트랜잭션 설정
    var sSvcID = sOutDsID;
    var sInDs = "nc_input_fieldDs=ds_in";
    var sOutDs = sOutDsID + "=CommList";
    var sArg = "sktst.dis.DCO#getCommList";
    
    // 공통 트랜잭션 호출
    cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}

/*******************************************************************************
 * @description    : 제조사 리스트 조회
*******************************************************************************/
function f_getMfact()
{
    // 입력 파라메터 셋팅
    ds_in.ClearData();
    ds_mfact.ClearData();
    cf_setParam(ds_in, "deal_co_cl", "20"); 
    
    // 트랜잭션 설정
    var sSvcID = "ds_mfact";
    var sInDs = "nc_input_fieldDs=ds_in";
    var sOutDs = "ds_mfact=DealCoList";
    var sArg = "sktst.dis.DCO#getDealCoList";
    
    // 공통 트랜잭션 호출
    cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}

/*******************************************************************************
 * @description    : 상품코드별 색상 리스트 조회
   @param sProdCd  : 상품코드
*******************************************************************************/
function f_getProdColor()
{
    grd_prod.SetCellProp("Body", 5, "edit", "none");
    
    // 입력 파라메터 셋팅
    ds_in.ClearData();
    ds_prodColor.ClearData();
    cf_setParam(ds_in, "prod_cd", ds_prod.GetColumn(ds_prod.currow, "prod_cd"));
    
    // 트랜잭션 설정
    var sSvcID = "svcProdColor";
    var sInDs = "nc_input_fieldDs=ds_in";
    var sOutDs = "ds_prodColor=ProdColorList";
    var sArg = "sktst.dis.DCO#getProdColorList";
    
    // 공통 트랜잭션 호출
    cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}

/*******************************************************************************
 * @description    : 상품 정보 조회
*******************************************************************************/
function f_getProdInfo(sSerNum)
{
    // 입력 파라메터 셋팅
    ds_in.ClearData();
    ds_prodInfo.ClearData();
    cf_setParam(ds_in, "prod_cd", ds_prod.GetColumn(ds_prod.currow, "prod_cd"));
    cf_setParam(ds_in, "ser_num", sSerNum);

    // 트랜잭션 설정
    var sSvcID = "svcProdInfo";
    var sInDs = "nc_input_fieldDs=ds_in";
    var sOutDs = "ds_prodInfo=nc_output_fieldDs";
    var sArg = "sktst.dis.DCO#getProdInfo";
    
    // 공통 트랜잭션 호출
    cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}

/*******************************************************************************
 * @description    : 결과 카운트 조회
*******************************************************************************/
function f_getRetCnt(sDealNm)
{
    // 입력 파라메터 셋팅
    ds_in.ClearData();
    ds_retCnt.ClearData();
    cf_setParam(ds_in, "prod_cd", ds_prod.GetColumn(ds_prod.currow, "prod_cd"));
    cf_setParam(ds_in, "color_cd", ds_prod.GetColumn(ds_prod.currow, "color_cd"));
    cf_setParam(ds_in, "ser_num", FV_SER_NUM);
  
    // 트랜잭션 설정
    var sSvcID = "svcRetCnt";
    var sInDs = "nc_input_fieldDs=ds_in";
    var sOutDs = "ds_retCnt=nc_output_fieldDs";
    var sArg = sDealNm;
    
    // 공통 트랜잭션 호출
    cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}

/*******************************************************************************
 * @description    : 검증 완료된 행에 대한 기본 값 셋팅 및 행 추가
*******************************************************************************/
function f_setAddedRow()
{
    if(!f_checkSerNum(ds_prod.GetColumn(ds_prod.rowcount-1, "ser_num"),ds_prod.GetColumn(ds_prod.rowcount-1, "prod_cd"))) return;
    
    var inQty = "1";  // 입고수량 기본 1
    if ( ds_prod.GetColumn(ds_prod.currow, "prod_cl") != "1" && 
         ds_prod.GetColumn(ds_prod.currow, "prod_cl") != "2" ) {
        inQty = FV_ORD_QTY;         
    }         
         
	ds_prod.SetColumn(ds_prod.currow, "ser_num", FV_SER_NUM);
	ds_prod.SetColumn(ds_prod.currow, "in_qty", inQty);
	ds_prod.SetColumn(ds_prod.currow, "edt_flg", "2");
	ds_prod.SetColumn(ds_prod.currow, "prod_cd_ser_num", 
	ds_prod.GetColumn(ds_prod.currow, "prod_cd") + FV_SER_NUM);

    f_addRow();

    ds_prod.SetColumn(ds_prod.currow, "prod_cl", ds_prod.GetColumn(ds_prod.currow-1, "prod_cl"));
    ds_prod.SetColumn(ds_prod.currow, "mfact_id", ds_prod.GetColumn(ds_prod.currow-1, "mfact_id"));
    ds_prod.SetColumn(ds_prod.currow, "prod_cd", ds_prod.GetColumn(ds_prod.currow-1, "prod_cd"));
    ds_prod.SetColumn(ds_prod.currow, "prod_nm", ds_prod.GetColumn(ds_prod.currow-1, "prod_nm"));
    ds_prod.SetColumn(ds_prod.currow, "color_cd", ds_prod.GetColumn(ds_prod.currow-1, "color_cd"));
    ds_prod.SetColumn(ds_prod.currow, "bar_cd_typ", ds_prod.GetColumn(ds_prod.currow-1, "bar_cd_typ"));
    
    grd_prod.SetFocus();
    grd_prod.SetCellPos(6);
}

/*******************************************************************************
 * @description    : 상품코드별 색상 필터링
*******************************************************************************/
function f_setProdColor()
{
    var sFilterStr = "code = ''";

    for(var i=0; i<ds_prodColor.rowcount; i++)
    {
        sFilterStr += " || code = '" + ds_prodColor.GetColumn(i, "color_cd") + "'"; 
    }

    ds_color.Filter(sFilterStr);
}

/*******************************************************************************
 * @description    : 기본 값 유효성 체크 key in OR 행추가
*******************************************************************************/
function f_checkDefault()
{
    if(Length(ds_prod.GetColumn(ds_prod.currow, "prod_cd")) < 1)
    {
        alert(cf_getMessage(MSG_00083, "모델"));
        grd_prod.SetFocus();
        grd_prod.SetCellPos(4);
        return false;
    }
    
    if(Length(ds_prod.GetColumn(ds_prod.currow, "prod_cl")) < 1)
    {
        alert(cf_getMessage(MSG_00083, "상품구분"));
        grd_prod.SetFocus();
        grd_prod.SetCellPos(2);
        return false;
    }
    
    if ( ds_prod.GetColumn(ds_prod.currow, "prod_cl") == "1" ) {
		if(Length(ds_prod.GetColumn(ds_prod.currow, "mfact_id")) < 1)
		{
			alert(cf_getMessage(MSG_00083, "제조사"));
			grd_prod.SetFocus();
			grd_prod.SetCellPos(3);
			return false;
		}
	}	
    
    if( ( FV_IN_OUT_CL == "101" || FV_IN_OUT_CL == "102" ) 
            && Length(ds_prod.GetColumn(ds_prod.currow, "color_cd")) < 1
            && ds_prod.GetColumn(ds_prod.currow, "prod_cl") != "2")
    {
        alert(cf_getMessage(MSG_00083, "색상"));
        grd_prod.SetFocus();
        grd_prod.SetCellPos(5);
        return false;
    }
    
    /**
     *   단말기 일련번호 체크
     *   7  : 일반단말기
     *   8  : USIM
     *   11 : 아이폰
     *   12 : I Pad
     **/
    if(ds_prod.GetColumn(ds_prod.currow, "prod_cl") != "9")                
    {
    
        if(ds_prod.GetColumn(ds_prod.currow, "prod_cl") == "1"
            &&   ( Length(ds_prod.GetColumn(ds_prod.currow, "ser_num")) != 7)){
            
            if (Length(ds_prod.GetColumn(ds_prod.currow, "ser_num")) != 11){
				if (Length(ds_prod.GetColumn(ds_prod.currow, "ser_num")) != 12){
			
					//alert("일련번호가 바르게 입력되지 않았습니다. [단말기:7자리]");
					alert(cf_getMessage(MSG_00151, "[단말기:7자리,11자리,12자리]"));
					
					grd_prod.SetFocus();
					grd_prod.SetCellPos(6);
					return false;      
				}
            }
        }
        
        if(ds_prod.GetColumn(ds_prod.currow, "prod_cl") == "2"
            && Length(ds_prod.GetColumn(ds_prod.currow, "ser_num")) != 8){
        
            //alert("일련번호가 바르게 입력되지 않았습니다. [USIM:8자리]");
            alert(cf_getMessage(MSG_00151, "[USIM:8자리]"));
            grd_prod.SetFocus();
            grd_prod.SetCellPos(6);
            return false;       
        }       

    }

    return true;
}

/*******************************************************************************
 * @description    : 바코드 정보 유효성 체크
*******************************************************************************/
function f_checkBarInfo()
{      
    if(ds_barInfo.rowcount < 1)
    {
        alert(cf_getMessage(MSG_00013,"입력된 바코드 정보가"));
        grd_prod.SetFocus();
        grd_prod.SetCellPos(6);
        return false;
    }

    if(ds_barInfo.GetColumn(0, "all_len_num") != Length(ds_prod.GetColumn(ds_prod.currow, "ser_num")))
    {
        //alert("입력된 바코드 정보가 등록되어 있는 정보와 일치하지 않습니다.");
        alert(cf_getMessage(MSG_00123,"입력된 바코드 정보가"));
        
        grd_prod.SetFocus();
        grd_prod.SetCellPos(6);
        return false;
    }

    FV_SER_NUM = "";
    var sProdBarCd = ds_prod.GetColumn(ds_prod.currow, "ser_num");
    var sProdMdl = ds_prod.GetColumn(ds_prod.currow, "prod_cd");
    var sProdCol = ds_prod.GetColumn(ds_prod.currow, "color_cd");
    var nBarMdlSta = ToNumber(ds_barInfo.GetColumn(0, "mdl_sta_len"));
    var nBarMdlLen = ToNumber(ds_barInfo.GetColumn(0, "mdl_len_num"));
    var nBarColSta = ToNumber(ds_barInfo.GetColumn(0, "color_sta_len"));
    var nBarColLen = ToNumber(ds_barInfo.GetColumn(0, "color_len_num"));
    var nBarSerSta = ToNumber(ds_barInfo.GetColumn(0, "ser_num_sta_len"));
    var nBarSerLen = ToNumber(ds_barInfo.GetColumn(0, "ser_num_len_num"));
    var sBarMdl = Iif(nBarMdlLen < 1, "", SubStr(sProdBarCd, nBarMdlSta-1, nBarMdlLen));
    var sBarCol = Iif(nBarColLen < 1, "", SubStr(sProdBarCd, nBarColSta-1, nBarColLen));
    var sBarSer = Iif(nBarSerLen < 1, "", SubStr(sProdBarCd, nBarSerSta-1, nBarSerLen));
    
    // 일련번호 중복 체크
    if(!f_checkSerNum(sBarSer, sBarMdl)) return false;

    if(sProdMdl != sBarMdl)
    {
        //alert("모델코드가 바코드 정보와 일치하지 않습니다.");
        alert(cf_getMessage(MSG_00059,"모델코드가 바코드 정보와"));
        
        grd_prod.SetFocus();
        grd_prod.SetCellPos(6);
        return false;
    }

    if(sProdCol != sBarCol && ds_prod.GetColumn(ds_prod.currow, "prod_cl") != "2")
    {
        //alert("색상코드가 바코드 정보와 일치하지 않습니다.");
        alert(cf_getMessage(MSG_00059,"색상코드가 바코드 정보와"));        
        grd_prod.SetFocus();
        grd_prod.SetCellPos(6);
        return false;
    }
    
    FV_SER_NUM = sBarSer;
    
    return true;
}

/*******************************************************************************
 * @description    : 행을 추가한다.
*******************************************************************************/
function f_addRow()
{
    ds_prod.AddRow();
    ds_prod.SetColumn(ds_prod.currow, "fix_yn", "N");
    grd_prod.SetFocus();
    grd_prod.SetCellPos(4);
}

/*******************************************************************************
 * @description    : 상품검색
*******************************************************************************/
function f_getProdList()
{
    
    cf_setParam(ds_condition, "PROD_NM", ds_prod.GetColumn(ds_prod.currow, "PROD_NM"));
    cf_setParam(ds_condition, "PROD_CD", null);
    cf_setParam(ds_condition, "APLY_DT", FV_APPLY_DT);
        
    var sSvcID = "searchProd";
    var sInDs  = "nc_input_fieldDs=ds_condition";
    var sOutDs = "ds_childPop=ds_prodList";
    var sArg   = "sktst.dis.DCO#getProdList";
    
    cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}


/*******************************************************************************
 * @description    : 다이얼로그 팝업 창을 띄워서 검색된 값을 받는다.
*******************************************************************************/
function f_dialogPop(nRow)
{
    http.Sync = true;
    
    if(ds_childPop.rowcount != 1 ){
    
        ds_childPop.ClearData();
        cf_setParam(ds_childPop, "prod_cd", "");
        cf_setParam(ds_childPop, "prod_nm", ds_prod.GetColumn(nRow, "prod_nm"));
        cf_setParam(ds_childPop, "prod_cl", "");
        cf_setParam(ds_childPop, "mfact_id", "");
        cf_setParam(ds_childPop, "bar_cd_typ", "");     
        
        cf_disProdPopDs("ds_childPop", 0, FV_APPLY_DT);     
    }

    ds_prod.SetColumn(nRow, "prod_cl", ds_childPop.GetColumn(0, "prod_cl"));
    ds_prod.SetColumn(nRow, "prod_cl_nm", ds_childPop.GetColumn(0, "prod_cl_nm"));
    ds_prod.SetColumn(nRow, "mfact_id", ds_childPop.GetColumn(0, "mfact_id"));
    ds_prod.SetColumn(nRow, "mfact_nm", ds_childPop.GetColumn(0, "mfact_nm"));
    ds_prod.SetColumn(nRow, "prod_cd", ds_childPop.GetColumn(0, "prod_cd"));
    ds_prod.SetColumn(nRow, "prod_nm", ds_childPop.GetColumn(0, "prod_nm"));
    ds_prod.SetColumn(nRow, "bar_cd_typ", ds_childPop.GetColumn(0, "bar_cd_typ"));
    
    ds_prod.SetColumn(nRow, "prod_cd_color_cd", ds_childPop.GetColumn(0, "prod_cd")+ds_prod.GetColumn(nRow, "color_cd"));
    
    f_getProdColor();
    
    if(ds_color.rowcount == 1){
        ds_prod.SetColumn(nRow, "color_cd", ds_color.GetColumn(0, "code")); 
    }else{
        ds_prod.SetColumn(nRow, "color_cd", null);
    }    
    
    if(!uf_IsNull(ds_prod.GetColumn(nRow, "prod_cd"))){
        grd_prod.SetFocus();
        grd_prod.SetCellPos(6);
    }
    
    http.Sync = false;
}

/*******************************************************************************
 * @description    : 중복된 일련번호를 체크한다.
 * @param sSerNum  : 비교할 일련번호
*******************************************************************************/
function f_checkSerNum(sSerNum, sProdCd)
{
    for(var i=0; i<ds_prod.rowcount-1; i++)
    {
        if( (sSerNum+sProdCd) == (ds_prod.GetColumn(i, "ser_num")+ds_prod.GetColumn(i, "prod_cd")))
        {
            //alert((i+1) + " 번 행에 중복된 일련번호가 있습니다.");
            alert(cf_getMessage(MSG_00152,(i+1)));
            grd_prod.SetFocus();
            grd_prod.SetCellPos(6);
            return false; 
        }
    }
    
    FV_SER_NUM = sSerNum;
    return true;
}
    
/*******************************************************************************
 * @description    : 현재 창 닫기
*******************************************************************************/
function btn_close_OnClick(obj)
{
    this.close();
}

/*******************************************************************************
 * @description    : 플러스 버튼 클릭 이벤트 (행 검증 및 새로운 행 추가)
*******************************************************************************/
function div_excel_btn_addRow_OnClick(obj)
{
    if(ds_prod.rowcount < 1)
    {
        f_addRow();
        
        ds_prod.SetColumn(ds_prod.currow, "prod_cl", "9");
        ds_prod.SetColumn(ds_prod.currow, "color_cd", "99");
        
        grd_prod.SetFocus();
        grd_prod.SetCellPos(4);
        
        return false;
    }
    
//    if(Length(ds_prod.GetColumn(ds_prod.currow, "ser_num")) < 12){
	/*
	 * 상품코드가 IPad 인경우 자릿수가 12 자리
	 */
	 if( Length(ds_prod.GetColumn(ds_prod.currow, "ser_num")) < 12 
	|| (Length(ds_prod.GetColumn(ds_prod.currow, "ser_num")) == 12 && ds_prod.GetColumn(ds_prod.currow, "bar_cd_typ") == "5")){
    
        if(!f_checkDefault()) return false;
    }else{
        if(Length(ds_prod.GetColumn(ds_prod.currow, "prod_cd")) < 1)
        {
            alert(cf_getMessage(MSG_00083, "모델"));
            grd_prod.SetFocus();
            grd_prod.SetCellPos(4);
            return false;
        }   
    }
    
    if(ds_prod.GetColumn(ds_prod.currow, "prod_cl") == "9" || ds_prod.GetColumn(ds_prod.currow, "edt_flg") == "2")
    {        
        
        if(ds_prod.GetColumn(ds_prod.currow, "prod_cl") != "9"){
            
            ds_prod.SetColumn(ds_prod.currow, "bad_yn", "01");
            ds_prod.SetColumn(ds_prod.currow, "dis_st", "01");          
            ds_prod.SetColumn(ds_prod.currow, "in_qty", "1");
        }
        
        ds_prod.SetColumn(ds_prod.currow, "edt_flg", "2");
    
        f_addRow();
        
        ds_prod.SetColumn(ds_prod.currow, "prod_cl", "9");
        ds_prod.SetColumn(ds_prod.currow, "color_cd", "99");
        
        grd_prod.SetFocus();
        grd_prod.SetCellPos(4);
    } 
    else
    {
//        if(Length(ds_prod.GetColumn(ds_prod.currow, "ser_num")) < 12) {
        /*
         * 상품코드가 IPad 인경우 자릿수가 12 자리
         */
         if( Length(ds_prod.GetColumn(ds_prod.currow, "ser_num")) < 12 
        || (Length(ds_prod.GetColumn(ds_prod.currow, "ser_num")) == 12 && ds_prod.GetColumn(ds_prod.currow, "bar_cd_typ") == "5")){
            FV_SER_NUM = ds_prod.GetColumn(ds_prod.currow, "ser_num");
            if(FV_IN_OUT_CL == "101" || FV_IN_OUT_CL == "102" ){
                f_getProdInfo(FV_SER_NUM);
            }else{              
                f_getProdInfoBySerNum();
            }
        }
        else
        {
            f_getProdInfoByBarCode();
        }
    }

}

/*******************************************************************************
 * @description    : 마이너스 버튼 클릭 이벤트 (행 삭제)
*******************************************************************************/
function div_excel_btn_delRow_OnClick(obj)
{
    ds_prod.DeleteRow(ds_prod.currow);
    for(var i=0; i<ds_prod.rowcount; i++)
    {
        if(ds_prod.GetColumn(i, "chk") == "1")
        {
            ds_prod.DeleteRow(i);
            i--;
        }
    }
}

/*******************************************************************************
 * @description    : 그리드 익스펜드 클릭
*******************************************************************************/
function grd_prod_OnExpandUp(obj,nRow,nCell,strVal,nPivotIndex)
{

    if(nCell == 4){
    // 상품명 대문자로 변경.
        ds_prod.SetColumn(ds_prod.currow,"prod_nm"
            ,ToUpper(ds_prod.GetColumn(ds_prod.currow,"prod_nm")));   
        f_getProdList();
    }
}

/*******************************************************************************
 * @description    : 그리드 엔터키 다운
*******************************************************************************/
function grd_prod_OnEnterDown(obj,nRow,nCell,strVal,nPivotIndex)
{
    if(nCell == 4)
    {   
        // 상품명 대문자로 변경.
        ds_prod.SetColumn(ds_prod.currow,"prod_nm"
            ,ToUpper(ds_prod.GetColumn(ds_prod.currow,"prod_nm")));    
    
        // 상품정보 팝업
        f_getProdList();
    }
    else if(nCell == 6)
    {   
        // 대문자로 변경.
        ds_prod.SetColumn(ds_prod.currow,"ser_num"
            ,ToUpper(ds_prod.GetColumn(ds_prod.currow,"ser_num")));     
    
        http.Sync = true;
        grd_prod.SetCellProp("Body", nCell, "edit", "none");

        /*
         * 상품코드가 IPad 인경우 자릿수가 12 자리
         */
         if( Length(ds_prod.GetColumn(ds_prod.currow, "ser_num")) < 12 
        || (Length(ds_prod.GetColumn(ds_prod.currow, "ser_num")) == 12 && ds_prod.GetColumn(ds_prod.currow, "bar_cd_typ") == "5")){
              
            if(f_checkDefault()){
            
                FV_SER_NUM = ds_prod.GetColumn(ds_prod.currow, "ser_num");

                if(FV_IN_OUT_CL == "101" || FV_IN_OUT_CL == "102" ||  FV_IN_OUT_CL == "114" ){
                    f_getProdInfo(FV_SER_NUM);
                }else{              
                    f_getProdInfoBySerNum();
                }
            }
            
        } else{
        
            if(Length(ds_prod.GetColumn(ds_prod.currow, "prod_cd")) < 1)
            {
                alert(cf_getMessage(MSG_00083, "모델"));
                grd_prod.SetFocus();
                grd_prod.SetCellPos(4);
                ds_prod.SetColumn(ds_prod.currow, "ser_num",null);
                grd_prod.SetCellProp("Body", nCell, "edit", "expr:Iif(edt_flg==2||prod_cl==9, \"none\", \"normal\")");
                return;
            }       
        
            // 바코드정보를 가지고 색상과 일련번호를 추출한다.
            f_getProdInfoByBarCode();
        }
        
        grd_prod.SetCellProp("Body", nCell, "edit", "expr:Iif(edt_flg==2||prod_cl==9, \"none\", \"normal\")");   
        http.Sync = false;
        
    }else if(nCell == 9)
    {
        div_excel_btn_addRow_OnClick();
    }
}

/*******************************************************************************
 * @description    : 상품조회 일련번호
*******************************************************************************/
function f_getProdInfoBySerNum(){

    cf_setParam(ds_condition, "prod_cd", ds_prod.GetColumn(ds_prod.currow, "prod_cd"));
    cf_setParam(ds_condition, "ser_num", ds_prod.GetColumn(ds_prod.currow, "ser_num"));

    var sSvcID = "searchProdInfoByBarCode";
    var sInDs  = "nc_input_fieldDs=ds_condition";
    var sOutDs = "ds_prodInfoByBarCode=ds_prod";
    var sArg   = "sktst.dis.DCO#getProdInfoBySerNum";
    
    cf_Transaction(sSvcID, sInDs, sOutDs, sArg);

}

/*******************************************************************************
 * @description    : 상품조회 바코드
*******************************************************************************/
function f_getProdInfoByBarCode(){

    cf_setParam(ds_condition, "prod_cd", ds_prod.GetColumn(ds_prod.currow, "prod_cd"));
    cf_setParam(ds_condition, "ser_num", ds_prod.GetColumn(ds_prod.currow, "ser_num"));
        
    var sSvcID = "searchProdInfoByBarCode";
    var sInDs  = "nc_input_fieldDs=ds_condition";
    var sOutDs = "ds_prodInfoByBarCode=ds_prod";
    var sArg   = "sktst.dis.DCO#getProdInfoByBarCode";
    
    cf_Transaction(sSvcID, sInDs, sOutDs, sArg);

}

/*******************************************************************************
 * @description    : 확인 버튼 클릭
*******************************************************************************/
function btn_confirm_OnClick(obj)
{
    // validation check
    var iLastRowNum = ds_prod.GetLastRow();
    
    if(uf_IsNull(ds_prod.GetColumn(iLastRowNum,"prod_cd"))
        || uf_IsNull(ds_prod.GetColumn(iLastRowNum,"prod_nm"))){
    
        alert(cf_getMessage(MSG_00124, (iLastRowNum+1)+";모델은"));
        grd_prod.SetFocus();
        grd_prod.SetCellPos(4);     
        return;
        
    }else if(uf_IsNull(ds_prod.GetColumn(iLastRowNum,"color_cd"))){
    
        alert(cf_getMessage(MSG_00124, (iLastRowNum+1)+";색상은"));
        grd_prod.SetFocus();
        grd_prod.SetCellPos(5);         
        return;
        
    }

//    if(ds_prod.GetColumn(iLastRowNum,"prod_cl") != "9"){
    if(ds_prod.GetColumn(iLastRowNum,"prod_cl") == "1"){
    
        // 상품구분이 기타상품 아닌 경우
    
        if(uf_IsNull(ds_prod.GetColumn(iLastRowNum,"ser_num"))){
        
            alert(cf_getMessage(MSG_00124, (iLastRowNum+1)+";일련번호는"));
            grd_prod.SetFocus();
            grd_prod.SetCellPos(6);                 
            return;
            
        }else if(uf_IsNull(ds_prod.GetColumn(iLastRowNum,"dis_st"))){
        
            
            alert(cf_getMessage(MSG_00153, (iLastRowNum+1)));
            //alert((iLastRowNum+1)+"라인의 일련번호의 재고상태가 조회 되지 않았습니다. \n\n일련번호 셀에서 enter키를 눌러 재고상태를 조회하세요.");
            grd_prod.SetFocus();
            grd_prod.SetCellPos(6);             
            return;
            
        }else if(ds_prod.GetColumn(iLastRowNum,"bad_yn") == "Y" ){
        
            //alert((iLastRowNum+1)+"라인의 상품이 불량이므로 처리할 수 없습니다.");
            alert(cf_getMessage(MSG_00154, (iLastRowNum+1)));
            grd_prod.SetFocus();
            grd_prod.SetCellPos(6);             
            return;
            
        }else if(ds_prod.GetColumn(iLastRowNum,"dis_st") == "02" ){
        
            if(FV_IN_OUT_CL != "103" && FV_IN_OUT_CL != "109"){
                //alert((iLastRowNum+1)+"라인의 상품재고상태가 비가용이므로 처리할 수 없습니다.");
                alert(cf_getMessage(MSG_00155, (iLastRowNum+1)));
                grd_prod.SetFocus();
                grd_prod.SetCellPos(6);             
                return;
            }
            
        }           
    }
    
    if(uf_IsNull(ds_prod.GetColumn(iLastRowNum,"in_qty"))){
    
        //alert((iLastRowNum+1)+"번째 라인의 수량은 필수입니다.");
        alert(cf_getMessage(MSG_00124, (iLastRowNum+1)+";수량은"));
        return;
        
    }       
    
    var iDuplicationCnt = 0;
    
    // 일련번호 중복을 체크한다.
    for(var i = 0 ; i < ds_prod.GetRowCount() ; i++ ){
    
        // 일련번호 있는 상품.
        if(ds_prod.GetColumn(i,"prod_cl") != '3'){      
    
            FV_OBJ_DS.Filter("prod_cl='"+ds_prod.GetColumn(i,"prod_cl")
            +"'&&prod_cd=='"+ds_prod.GetColumn(i,"prod_cd")+"'&&ser_num=='"+ds_prod.GetColumn(i,"ser_num")+"'");
            
            if(FV_OBJ_DS.GetRowCount() > 0 ){       
        
                ds_prod.SetColumn(i,"dum_yn","Y");
                iDuplicationCnt++;
            }else{
                ds_prod.SetColumn(i,"dum_yn","N");
            }
            
        }else{
            ds_prod.SetColumn(i,"dum_yn","N");
        }
        
        //코드명 셋팅.
        ds_prod.SetColumn(i, "prod_cl_nm", grd_prod.GetCellText("Body", i, 2));
        ds_prod.SetColumn(i, "mfact_nm", grd_prod.GetCellText("Body", i, 3));
        ds_prod.SetColumn(i, "color_nm", grd_prod.GetCellText("Body", i, 5));           
    }
        
    FV_OBJ_DS.UnFilter();

    if(iDuplicationCnt > 0){
    
        // "이미 입고예정대상으로 선택된 일련번호가 존재합니다. \n\n중복된 일련번호를 제외하고 처리하시겠습니까?"
        if(!confirm(cf_getMessage(MSG_00156, "입고예정대상"))){
            return;
        }       
        
    }
    
    var iFirstRow = 0;
    
    // 동일한 기타 상품을 합친다.
    for(var i = 0 ; i < ds_prod.GetRowCount() ; i++ ){
    
        // 기타상품
        if(ds_prod.GetColumn(i,"prod_cl") == "9"){
        
            // 동일한 기타상품중 첫번째 라인을 구한다.
            iFirstRow = ds_prod.FindRow("prod_cd_color_cd",ds_prod.GetColumn(i,"prod_cd_color_cd"));
            
            for(var j = ds_prod.GetRowCount()-1 ; j >= 0 ; j-- ){
            
                if( j != iFirstRow && ds_prod.GetColumn(i,"prod_cd_color_cd") == ds_prod.GetColumn(j,"prod_cd_color_cd") ){
                    
                    var iFirstOutQty   = toNumber(ds_prod.GetColumn(iFirstRow,"in_qty"));
                    var iCurrowOutQty  = toNumber(ds_prod.GetColumn(j,"in_qty"));

                    ds_prod.SetColumn(iFirstRow,"in_qty",(iFirstOutQty+iCurrowOutQty));
                    ds_prod.DeleteRow(j);
                }
            }
        }
    }   

    ds_prod.Filter("dum_yn='N'");
    sf_copyDataSet(FV_OBJ_DS, ds_prod, "IN");

    eval("parent."+FV_CALL_FUNCTION+"()");
    this.Close();

}

/*******************************************************************************
 * @description    : 셀 이동 이벤트
*******************************************************************************/
function grd_prod_OnCellPosChanged(obj,nRow,nCell,nOldRow,nOldCell,nPivotIndex,nOldPivotIndex)
{
    if(nCell == 5)
    {
        grd_prod.SetCellProp("Body", 5, "edit", "expr:Iif(edt_flg==2, \"none\", \"combo\")");
        if(ds_prod.GetColumn(nRow, "edt_flg") == "2") return;
    }
}

/*******************************************************************************
 * @description    : 데이터셋 변경 이벤트
*******************************************************************************/
function ds_prod_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
    if (strColumnID = "color_cd"){
    
        ds_prod.SetColumn(nRow, "prod_cd_color_cd", ds_prod.GetColumn(nRow, "prod_cd")+ds_prod.GetColumn(nRow, "color_cd"));
    }
}

/*******************************************************************************
 * @description    : grid OnChar 이벤트
*******************************************************************************/
function grd_prod_OnChar(obj,strPreText,nChar,strPostText,nLLParam,nHLParam,nRow,nCell,nPivotIndex)
{
    if(nCell == 4){
    
        if(strPreText != strPostText){
        
            ds_prod.SetColumn(nRow, "prod_cd"  ,null);
            ds_prod.SetColumn(nRow, "prod_cl"  ,null);
            ds_prod.SetColumn(nRow, "mfact_id" ,null);
            ds_prod.SetColumn(nRow, "ser_num"  ,null);
            ds_prod.SetColumn(nRow, "color_cd" ,null);      
        }
    }
}

/*******************************************************************************
 * @description    : 2차원바코드 클릭 이벤트
*******************************************************************************/
/*
function btn_barCode_OnClick(obj)
{
    var sArg = "sApplyDt="+quote(FV_APPLY_DT);
        sArg += " sInOutCl="+quote(FV_IN_OUT_CL);
        sArg += " sPlcId="+quote(parent.div_process.edt_inPlcId.value); 

    dialog("DIS::DISDCO00101.xml", sArg , 768, 472);        
}
*/]]></Script>
</Window>