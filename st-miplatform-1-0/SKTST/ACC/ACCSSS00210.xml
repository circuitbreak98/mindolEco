<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="545" Id="ACCSSS00210" Left="8" OnLoadCompleted="ACCSSS00210_OnLoadCompleted" PidAttrib="7" Title="장려금정산등록" Top="8" Ver="1.0" Width="800" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_amt">
				<Contents>
					<colinfo id="pos_agency" size="256" summ="default" type="STRING"/>
					<colinfo id="pol_oper" size="256" summ="default" type="STRING"/>
					<colinfo id="new_pay_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="old_pay_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="etc_pay_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="rtn_pay_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="data_mkt_pay_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="AGREE" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_fix" OnColumnChanged="ds_fix_OnColumnChanged">
				<Contents>
					<colinfo id="fix_sply_prc" size="256" summ="default" type="STRING"/>
					<colinfo id="fix_vat" size="256" summ="default" type="STRING"/>
					<colinfo id="agrmt_astamt" size="256" summ="default" type="STRING"/>
					<colinfo id="fix_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="u_key_trms_dtm" size="256" summ="default" type="STRING"/>
					<colinfo id="asmpt_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="rmks_fix_sply_prc" size="256" summ="default" type="STRING"/>
					<colinfo id="rmks_fix_vat" size="256" summ="default" type="STRING"/>
					<colinfo id="rmks_fix_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="rmks" size="256" summ="default" type="STRING"/>
					<colinfo id="deal_co_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="acc_mth" size="256" summ="default" type="STRING"/>
					<colinfo id="acc_plc" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_ukey" OnColumnChanged="ds_ukey_OnColumnChanged">
				<Contents>
					<colinfo id="aply_prc_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="vat_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="new_pay_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="old_pay_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="etc_pay_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="rtn_pay_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="data_mkt_pay_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="agree" size="256" summ="default" type="STRING"/>
					<colinfo id="new_pay_acc_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="old_pay_acc_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="etc_pay_acc_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="rtn_pay_acc_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="data_mkt_pay_acc_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="agree_acc" size="256" summ="default" type="STRING"/>
					<colinfo id="new_pay_prchs_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="old_pay_prchs_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="etc_pay_prchs_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="rtn_pay_prchs_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="data_mkt_pay_prchs_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="agree_prchs" size="256" summ="default" type="STRING"/>
					<colinfo id="new_pay_fix_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="old_pay_fix_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="etc_pay_fix_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="rtn_pay_fix_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="data_mkt_pay_fix_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="agree_fix" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_ukey_tmp">
				<Contents>
					<colinfo id="new_pay_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="old_pay_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="etc_pay_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="rtn_pay_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="data_mkt_pay_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="agree" size="256" summ="default" type="STRING"/>
					<colinfo id="new_pay_acc_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="old_pay_acc_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="etc_pay_acc_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="rtn_pay_acc_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="data_mkt_pay_acc_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="agree_acc" size="256" summ="default" type="STRING"/>
					<colinfo id="new_pay_fix_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="old_pay_fix_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="etc_pay_fix_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="rtn_pay_fix_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="data_mkt_pay_fix_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="agree_fix" size="256" summ="default" type="STRING"/>
					<colinfo id="new_pay_prchs_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="old_pay_prchs_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="etc_pay_prchs_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="rtn_pay_prchs_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="data_mkt_pay_prchs_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="agree_prchs" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_condition">
				<Contents>
					<colinfo id="pos_agency" size="256" summ="default" type="STRING"/>
					<colinfo id="acc_mth" size="256" summ="default" type="STRING"/>
					<colinfo id="pol_oper" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_save_dtl">
				<Contents>
					<colinfo id="deal_co_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="acc_mth" size="256" summ="default" type="STRING"/>
					<colinfo id="acc_plc" size="256" summ="default" type="STRING"/>
					<colinfo id="pr_mny_typ_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="asmpt_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="u_key_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="acc_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="prchs_debt_mtch" size="256" summ="default" type="STRING"/>
					<colinfo id="fix_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="rmks" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" BindDataset="ds_amt" BkColor2="user32" BoldHead="true" Border="Flat" Bottom="254" Enable="FALSE" EndLineColor="default" FillArea="TRUE" FillAreaType="Control" HeadBorder="Flat" HeadHeight="22" Height="172" Id="grd_amt" InputPanel="FALSE" Left="10" LineColor="user33" MinWidth="100" Right="296" RowHeight="21" Style="sty_Grid" TabOrder="10" TabStop="FALSE" Top="82" UseDBuff="true" UsePopupMenu="true" UseSelColor="FALSE" Visible="true" VLineColor="user33" WheelScrollRow="1" Width="286">
			<contents>
				<format id="Default">
					<columns>
						<col width="180"/>
						<col width="110"/>
					</columns>
					<head>
						<cell bkcolor="user34" col="0" color="user35" display="text" text="장려금&#32;유형"/>
						<cell bkcolor="user34" col="1" color="user35" display="text" text="추정금액"/>
					</head>
					<body>
						<cell col="0" display="text" text="신규개통정책지급총액"/>
						<cell col="0" display="text" row="1" text="보상기변정책지급총액"/>
						<cell col="0" display="text" row="2" text="기타정책지급총액"/>
						<cell col="0" display="text" row="3" text="환수정책지급총액"/>
						<cell col="0" display="text" row="4" text="데이터마케팅지급총액"/>
						<cell col="0" display="text" row="5" text="T기본약정지급총액"/>
						<cell col="1" colid="new_pay_amt" display="number"/>
						<cell col="1" colid="old_pay_amt" display="number" row="1"/>
						<cell col="1" colid="etc_pay_amt" display="number" row="2"/>
						<cell col="1" colid="rtn_pay_amt" display="number" row="3"/>
						<cell col="1" colid="data_mkt_pay_amt" display="number" row="4"/>
						<cell col="1" colid="AGREE" display="number" row="5"/>
					</body>
					<summary>
						<cell align="right" bkcolor="user37" col="0" color="user38" display="text" font="돋움,9,Bold" text="합계"/>
						<cell align="right" bkcolor="user37" col="1" color="user38" display="number" expr='sum(&quot;new_pay_amt+old_pay_amt+etc_pay_amt+rtn_pay_amt+data_mkt_pay_amt+AGREE&quot;)' font="돋움,9,Bold"/>
					</summary>
				</format>
			</contents>
		</Grid>
		<Div Border="RaisedEdge" Height="39" Id="div_search" Left="10" Style="sty_div_dataview" TabOrder="4" Text="Div0" Top="10" Width="778">
			<Contents>
				<Static Align="Right" Height="20" Id="Static0" Left="225" Style="sty_lb_dataview" TabOrder="1" Text="정산월" Top="7" VAlign="Middle" Width="68"></Static>
				<Edit Border="Flat" Enable="FALSE" Height="20" Id="edt_agencyNm" Left="94" LeftMargin="2" Readonly="TRUE" RightMargin="2" Style="sty_ipt_form" TabOrder="2" Top="7" Width="116"></Edit>
				<MaskEdit Border="Flat" Enable="FALSE" Height="20" Id="cal_accMth" Left="297" LeftMargin="2" Mask="@@@@-@@" MaxLength="6" Readonly="TRUE" RightMargin="2" Style="sty_ipt_form" TabOrder="3" Top="7" Type="STRING" Width="116"></MaskEdit>
				<Static Align="Right" Height="20" Id="Static1" Left="13" Style="sty_lb_dataview" TabOrder="4" Text="대리점" Top="7" VAlign="Middle" Width="68"></Static>
				<Edit Border="Flat" Enable="FALSE" Height="20" Id="edt_polOper" Left="506" LeftMargin="2" Readonly="TRUE" RightMargin="2" Style="sty_ipt_form" TabOrder="5" Top="7" Width="116"></Edit>
				<Static Align="Right" Height="20" Id="Static2" Left="425" Style="sty_lb_dataview" TabOrder="6" Text="정산처" Top="7" VAlign="Middle" Width="68"></Static>
			</Contents>
		</Div>
		<Image Align="Left" Height="25" Id="Image0" ImageID="bul_tit" Left="10" LeftMargin="15" Style="sty_img_tit" TabOrder="5" Text="장려금&#32;정산내역" Top="59" Width="192"></Image>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="25" Id="btn_save" ImageID="btn_c_2" Left="665" LeftMargin="5" OnClick="btn_save_OnClick" Style="sty_btn_c" TabOrder="6" Text="저장" Top="510" Width="60"></Button>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="25" Id="btn_close" ImageID="btn_d_2" Left="729" LeftMargin="5" OnClick="btn_close_OnClick" Style="sty_btn_d" TabOrder="7" Text="닫기" Top="510" Width="60"></Button>
		<Image Align="Left" Height="25" Id="Image1" ImageID="bul_tit" Left="10" LeftMargin="15" Style="sty_img_tit" TabOrder="8" Text="장려금&#32;확정내역" Top="264" Width="192"></Image>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" BindDataset="ds_fix" BkColor2="user32" BoldHead="true" Border="Flat" Bottom="395" Editable="TRUE" Enable="true" EndLineColor="default" FillArea="TRUE" FillAreaType="Control" HeadBorder="Flat" HeadHeight="22" Height="107" Id="grd_fix" InputPanel="FALSE" Left="8" LineColor="user33" MinWidth="100" Right="786" RowHeight="21" Style="sty_Grid" TabOrder="9" TabStop="FALSE" Top="288" UseDBuff="true" UsePopupMenu="true" UseSelColor="FALSE" Visible="true" VLineColor="user33" WheelScrollRow="1" Width="778">
			<contents>
				<format id="Default">
					<columns>
						<col width="150"/>
						<col width="150"/>
						<col width="300"/>
					</columns>
					<head>
						<cell bkcolor="user34" col="0" color="user35" display="text" text="항목"/>
						<cell bkcolor="user34" col="1" color="user35" display="text" text="확정금액"/>
						<cell bkcolor="user34" col="2" color="user35" display="text" text="비고"/>
					</head>
					<body>
						<cell col="0" display="text" text="장려금&#32;공급가"/>
						<cell col="0" display="text" row="1" text="장려금&#32;부가세"/>
						<cell col="0" display="text" row="2" text="T기본약정&#32;보조금"/>
						<cell col="0" display="text" row="3" text="장려금&#32;확정금액"/>
						<cell align="right" bkcolor="user32" col="1" colid="fix_sply_prc" display="number" edit="number"/>
						<cell align="left" col="2" colid="rmks_fix_sply_prc" display="normal" edit="normal"/>
						<cell align="right" bkcolor="user32" col="1" colid="fix_vat" display="number" row="1"/>
						<cell align="left" col="2" colid="rmks_fix_vat" display="normal" edit="normal" row="1"/>
						<cell bkcolor="user32" col="1" colid="agrmt_astamt" display="number" row="2"/>
						<cell align="left" col="2" colid="rmks_fix_amt" display="normal" edit="normal" row="2"/>
						<cell bkcolor="user32" col="1" colid="fix_amt" display="number" row="3"/>
						<cell align="left" col="2" colid="rmks" display="normal" edit="normal" row="3"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Button Cursor="HAND" Height="21" Id="btn_excel" ImageID="btn_i_exceldown_w" Left="765" OnClick="btn_excel_OnClick" TabOrder="1" Text="Button1" ToolTipText="Excel&#32;Download" Top="57" Width="19"></Button>
		<Button Cursor="HAND" Height="21" Id="btn_excel2" ImageID="btn_i_exceldown_w" Left="765" OnClick="btn_excel2_OnClick" TabOrder="3" Text="Button1" ToolTipText="Excel&#32;Download" Top="264" Width="19"></Button>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" AutoScrollBar="None" BindDataset="ds_ukey" BkColor2="user32" BoldHead="true" Border="Flat" Bottom="254" Editable="TRUE" Enable="true" EndLineColor="default" FillArea="TRUE" FillAreaType="Control" HeadBorder="Flat" HeadHeight="22" Height="172" Id="grd_ukey" InputPanel="FALSE" Left="294" LineColor="user33" MinWidth="100" OnChar="grd_ukey_OnChar" Right="788" RowHeight="21" Style="sty_Grid" TabOrder="2" TabStop="FALSE" Top="82" UseDBuff="true" UsePopupMenu="true" UseSelColor="FALSE" Visible="true" VLineColor="user33" WheelScrollRow="1" Width="494">
			<contents>
				<format id="Default">
					<columns>
						<col width="110"/>
						<col width="110"/>
						<col width="110"/>
						<col width="110"/>
						<col width="49"/>
					</columns>
					<head>
						<cell bkcolor="user34" col="0" color="user35" display="text" text="U.Key금액"/>
						<cell bkcolor="user34" col="1" color="user35" display="text" text="정산금액"/>
						<cell bkcolor="user34" col="2" color="user35" display="text" text="매입채무상계"/>
						<cell bkcolor="user34" col="3" color="user35" display="text" text="확정금액"/>
						<cell bkcolor="user34" col="4" color="user35" display="text" text="비고"/>
					</head>
					<body>
						<cell align="right" bkcolor="user32" col="0" colid="new_pay_amt" display="number"/>
						<cell align="right" col="1" colid="new_pay_acc_amt" display="number" edit="number"/>
						<cell align="right" bkcolor="user32" col="2" colid="new_pay_prchs_amt" display="number" edit="number"/>
						<cell align="right" bkcolor="user32" col="3" colid="new_pay_fix_amt" display="number"/>
						<cell align="left" col="4" display="text"/>
						<cell align="right" bkcolor="user32" col="0" colid="old_pay_amt" display="number" row="1"/>
						<cell align="right" col="1" colid="old_pay_acc_amt" display="number" edit="number" row="1"/>
						<cell col="2" colid="old_pay_prchs_amt" display="number" edit="number" row="1"/>
						<cell align="right" bkcolor="user32" col="3" colid="old_pay_fix_amt" display="number" row="1"/>
						<cell align="left" col="4" display="text" row="1"/>
						<cell align="right" bkcolor="user32" col="0" colid="etc_pay_amt" display="number" row="2"/>
						<cell align="right" col="1" colid="etc_pay_acc_amt" display="number" edit="number" row="2"/>
						<cell col="2" colid="etc_pay_prchs_amt" display="number" edit="number" row="2"/>
						<cell align="right" bkcolor="user32" col="3" colid="etc_pay_fix_amt" display="number" row="2"/>
						<cell col="4" display="text" row="2"/>
						<cell align="right" bkcolor="user32" col="0" colid="rtn_pay_amt" display="number" row="3"/>
						<cell align="right" col="1" colid="rtn_pay_acc_amt" display="number" edit="number" row="3"/>
						<cell col="2" colid="rtn_pay_prchs_amt" display="number" edit="number" row="3"/>
						<cell align="right" bkcolor="user32" col="3" colid="rtn_pay_fix_amt" display="number" row="3"/>
						<cell col="4" display="text" row="3"/>
						<cell align="right" bkcolor="user32" col="0" colid="data_mkt_pay_amt" display="number" row="4"/>
						<cell align="right" col="1" colid="data_mkt_pay_acc_amt" display="number" edit="number" row="4"/>
						<cell col="2" colid="data_mkt_pay_prchs_amt" display="number" edit="number" row="4"/>
						<cell align="right" bkcolor="user32" col="3" colid="data_mkt_pay_fix_amt" display="number" row="4"/>
						<cell col="4" display="text" row="4"/>
						<cell align="right" bkcolor="user32" col="0" colid="agree" display="number" row="5"/>
						<cell align="right" col="1" colid="agree_acc" display="number" edit="number" row="5"/>
						<cell col="2" colid="agree_prchs" display="number" edit="number" row="5"/>
						<cell align="right" bkcolor="user32" col="3" colid="agree_fix" display="number" row="5"/>
						<cell col="4" display="text" row="5"/>
					</body>
					<summary>
						<cell align="right" bkcolor="user37" col="0" color="user38" display="number" expr='sum(&quot;new_pay_amt+old_pay_amt+etc_pay_amt+rtn_pay_amt+data_mkt_pay_amt+AGREE&quot;)' font="돋움,9,Bold"/>
						<cell align="right" bkcolor="user37" col="1" color="user38" display="number" expr='sum(&quot;new_pay_acc_amt+old_pay_acc_amt+etc_pay_acc_amt+rtn_pay_acc_amt+data_mkt_pay_acc_amt+agree_acc&quot;)' font="돋움,9,Bold"/>
						<cell align="right" bkcolor="user37" col="2" color="user38" display="number" expr='sum(&quot;new_pay_prchs_amt+old_pay_prchs_amt+etc_pay_prchs_amt+rtn_pay_prchs_amt+data_mkt_pay_prchs_amt+agree_prchs&quot;)' font="돋움,9,Bold"/>
						<cell align="right" bkcolor="user37" col="3" color="user38" display="number" expr='sum(&quot;new_pay_fix_amt+old_pay_fix_amt+etc_pay_fix_amt+rtn_pay_fix_amt+data_mkt_pay_fix_amt+agree_fix&quot;)' font="돋움,9,Bold"/>
						<cell align="right" bkcolor="user37" col="4" color="user38" display="number" font="돋움,9,Bold"/>
					</summary>
				</format>
			</contents>
		</Grid>
		<Image Align="Left" Height="25" Id="Image2" ImageID="bul_tit" Left="11" LeftMargin="15" Style="sty_img_tit" TabOrder="11" Text="비고" Top="407" Width="192"></Image>
		<Div Border="Raised" Height="66" Id="Div1" Left="9" Style="sty_div_input" TabOrder="12" Text="Div1" Top="435" Width="780">
			<Contents>
				<TextArea BindDataset="ds_fix" Border="Flat" Column="RMKS" Height="46" Id="TextArea0" Left="8" Style="sty_ipt_form" TabOrder="1" Top="7" VScroll="TRUE" Width="760"></TextArea>
			</Contents>
		</Div>
	</Form>
	<Script><![CDATA[/*******************************************************************************
* 프로그램ID  : ACCSSS00210
* 업무명      : 정산 - 용역매출정산 
* 프로그램명  : 장려금정산등록
--------------------------------------------------------------------------------
* 작성자      : 심연정 
* 작성일      : 2009.02.04
--------------------------------------------------------------------------------
* 1. 변경이력
수정자    : 조민지
수정일    :2009.07.10
수정 내역 :요구사항 변경에 따른 재개발
*******************************************************************************/

//==============================================================================
// 공통 스크립트 로딩
//==============================================================================
#include "lib::lib_commF.js"
#include "lib::lib_commPopup.js"
#include "lib::lib_util.js"
#include "lib::lib_commMsg.js"

//==============================================================================
// 전역변수선언
//==============================================================================

var FV_LOGIN_ID 	= gds_session.GetColumn(0, "loginId");	//사용자계정
var FV_USER_NM		= gds_session.GetColumn(0, "userNm");	//사용자명 
var FV_ORG_ID 		= gds_session.GetColumn(0, "orgId");	//조직코드
var FV_ORG_CL 		= gds_session.GetColumn(0, "orgCl");	//조직구분
var FV_SUP_ORG_ID 	= gds_session.GetColumn(0, "supOrgId");	//상위조직코드
var FV_USER_GRP 	= gds_session.GetColumn(0, "userGrp");	//사용자그룹
var FV_ORG_AREA 	= gds_session.GetColumn(0, "orgAreaId");//근무지코드
var FV_POS_AGENCY_ID =gds_session.GetColumn(0,"posAgencyId");         // 소속 대리점ID
var FV_POS_AGENCY_NM = "" ;       // 소속 대리점명

var FV_POS_AGENCY_UKEY_ID =gds_session.GetColumn(0,"posAgencyUkeyId");  // 소속 대리점UKEY ID
var FV_ACC_MTH = "";
var FV_LAST_ACC_MTH = "";
var FV_UEKY_TRANS_DT = "";
/*******************************************************************************
 * @description    : 최초 폼 로드시 발생 - 이벤트
*******************************************************************************/
function ACCSSS00210_OnLoadCompleted(obj)
{
    // 권한 설정
    cf_setAuth(pFrmNum);
    
    div_search.cal_accMth.Value = payDtm;
    div_search.edt_agencyNm.Text = posAgencyNm;
    div_search.edt_polOper.Text = polOperNm;
    
    cf_setParam(ds_condition, "acc_mth", payDtm); 
    cf_setParam(ds_condition, "pos_agency", posAgency);
    cf_setParam(ds_condition, "pol_oper", polOper);
    
    //Dataset0.AddRow();
    // ds_save_ukey.AddRow();
    // ds_save_cnfm.AddRow();
    ds_ukey.AddRow();
    ds_fix.AddRow();
    f_search();

}
/*******************************************************************************
 * @description    : 입금 미확정 수납대행 리스트 조회
*******************************************************************************/
function f_search()
{
    var sSvcID  = "svcChag";
    var sInDs   = "nc_input_fieldDs=ds_condition";
    var sOutDs  = "ds_amt=ds_amt ds_ukey=ds_ukey";
    var sArg    = "sktst.acc.SSS#getPrDtl";
    
    cf_Transaction(sSvcID, sInDs, sOutDs, sArg,null,true,true);
}

/*******************************************************************************
 * @description    :  콜백
*******************************************************************************/
function f_callBack(sSvcID)
{   
	ds_ukey_tmp.Copy(ds_ukey);
	
      if(sSvcID == "svcChag"){

			var varC = ds_ukey.GetColumn(0,"new_pay_fix_amt")
						+ds_ukey.GetColumn(0,"old_pay_fix_amt")
						+ds_ukey.GetColumn(0,"etc_pay_fix_amt")
						+ds_ukey.GetColumn(0,"rtn_pay_fix_amt")
						+ds_ukey.GetColumn(0,"data_mkt_pay_fix_amt");
						
			var varCA = varC/1.1;
			
			if ( (    ds_ukey.GetColumn(0,"new_pay_acc_amt")
					+ ds_ukey.GetColumn(0,"old_pay_acc_amt")
					+ ds_ukey.GetColumn(0,"etc_pay_acc_amt")
					+ ds_ukey.GetColumn(0,"rtn_pay_acc_amt")
					+ ds_ukey.GetColumn(0,"data_mkt_pay_acc_amt")
					+ ds_ukey.GetColumn(0,"agree_acc")
					+ ds_ukey.GetColumn(0,"new_pay_prchs_amt")
					+ ds_ukey.GetColumn(0,"old_pay_prchs_amt")
					+ ds_ukey.GetColumn(0,"etc_pay_prchs_amt")
					+ ds_ukey.GetColumn(0,"rtn_pay_prchs_amt")
					+ ds_ukey.GetColumn(0,"data_mkt_pay_prchs_amt")
					+ ds_ukey.GetColumn(0,"agree_prchs") ) > 0 ) {
						/*장려금 공급가 확정금액*/
						ds_fix.SetColumn(0,"fix_sply_prc",round(varCA,0));
						/*장려금 부가세 확정금액*/
						ds_fix.SetColumn(0,"fix_vat",round(varC-varCA,0));
            } else {
						/*장려금 공급가 확정금액*/
						ds_fix.SetColumn(0,"fix_sply_prc",round(ds_ukey.GetColumn(0,"aply_prc_amt"),0));
						/*장려금 부가세 확정금액*/
						ds_fix.SetColumn(0,"fix_vat",round(ds_ukey.GetColumn(0,"vat_amt"),0));
            }
			/*T기본약정 보조금  확정금액*/
			ds_fix.SetColumn(0,"agrmt_astamt",ds_ukey.GetColumn(0,"agree_fix"));
			var varFix = varC + ds_ukey.GetColumn(0,"agree_fix");
			/*장려금 확정금액*/
			ds_fix.SetColumn(0,"fix_amt",varFix);

			f_set_color();
			if(ds_fix.GetRowCount() == 0){
				ds_fix.AddRow();
			}
			if(!uf_IsNull(erpFixYn)){
				alert("ERP 전송이 완료되었습니다.");
				grd_ukey.Editable = false;
				grd_fix.Editable = false;
				btn_save.Visible= false;
			}
     }
     if(sSvcID == "svcSaveMST"){
		f_save_dtl();
     }
     if(sSvcID == "svcSaveDtl"){
		alert(cf_getMessage(MSG_00006, "장려금 정산이"));
		
		parent.btn_search_OnClick();
		this.Close();
		
		//this.close();
     }
    
}
/*******************************************************************************
 * @description    :  컬럼셋팅
*******************************************************************************/

function grd_ukey_OnChar(obj,strPreText,nChar,strPostText,nLLParam,nHLParam,nRow,nCell,nPivotIndex)
{		
	 if(strPreText != strPostText){
	 	
		if(nCell == "1"){
			ds_ukey.SetColumn(0,"new_pay_fix_amt",toNumber(strPostText)-toNumber(strPreText)+toNumber(ds_ukey.GetColumn(0,"new_pay_fix_amt")));
		}
				
		else if(nCell == "6"){
			
			ds_ukey.SetColumn(0,"old_pay_fix_amt",toNumber(strPostText)-toNumber(strPreText)+toNumber(ds_ukey.GetColumn(0,"old_pay_fix_amt")));
		}
		
		else if(nCell == "11"){
			
			ds_ukey.SetColumn(0,"etc_pay_fix_amt",toNumber(strPostText)-toNumber(strPreText)+toNumber(ds_ukey.GetColumn(0,"etc_pay_fix_amt")));
		}
				
		else if(nCell == "16"){		
			
			ds_ukey.SetColumn(0,"rtn_pay_fix_amt",toNumber(strPostText)-toNumber(strPreText)+toNumber(ds_ukey.GetColumn(0,"rtn_pay_fix_amt")));
		}
				
		else if(nCell == "21"){
			
			ds_ukey.SetColumn(0,"data_mkt_pay_fix_amt",toNumber(strPostText)-toNumber(strPreText)+toNumber(ds_ukey.GetColumn(0,"data_mkt_pay_fix_amt")));
		}
		
		else if(nCell == "26"){
			
			ds_ukey.SetColumn(0,"agree_fix",toNumber(strPostText)-toNumber(strPreText)+toNumber(ds_ukey.GetColumn(0,"agree_fix")));
		}
				
		var varC = ds_ukey.GetColumn(0,"new_pay_fix_amt")
					+ds_ukey.GetColumn(0,"old_pay_fix_amt")
					+ds_ukey.GetColumn(0,"etc_pay_fix_amt")
					+ds_ukey.GetColumn(0,"rtn_pay_fix_amt")
					+ds_ukey.GetColumn(0,"data_mkt_pay_fix_amt");
					
		varCA = varC/1.1;
		ds_fix.SetColumn(0,"fix_sply_prc",round(varCA,0));
		ds_fix.SetColumn(0,"fix_vat",round(varC-varCA,0));
		ds_fix.SetColumn(0,"agrmt_astamt",ds_ukey.GetColumn(0,"agree_fix"));
		varFix = varC + ds_ukey.GetColumn(0,"agree_fix");
		ds_fix.SetColumn(0,"fix_amt",varFix);
		}
}


/*******************************************************************************
 * @description    : 매입채무 상계 금액 입력 OnCulumnChanged Event
*******************************************************************************/
function ds_ukey_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
	var sNewFixAmt = toNumber(ds_ukey.GetColumn(0, "new_pay_fix_amt")) ;
    var sOldFixAmt = toNumber(ds_ukey.GetColumn(0, "old_pay_fix_amt")) ;
    var sEtcFixAmt = toNumber(ds_ukey.GetColumn(0, "etc_pay_fix_amt")) ;
    var sRtnFixAmt = toNumber(ds_ukey.GetColumn(0, "rtn_pay_fix_amt")) ;
    var sDataFixAmt = toNumber(ds_ukey.GetColumn(0, "data_mkt_pay_fix_amt")) ;
    var sAgreeFix = toNumber(ds_ukey.GetColumn(0, "agree_fix")) ;
	 
	if(strColumnID == "NEW_PAY_PRCHS_AMT"){
		if(toNumber(varNewValue)-toNumber(varOldValue) <= toNumber(ds_ukey.GetColumn(0,"new_pay_fix_amt"))){
			ds_ukey.SetColumn(0,"new_pay_fix_amt",toNumber(ds_ukey.GetColumn(0,"new_pay_fix_amt"))-(toNumber(varNewValue)-toNumber(varOldValue)));
		}else{
			alert("매입채무 상계금액이 확정금액보다 큽니다");
			ds_ukey.SetColumn(0,"new_pay_prchs_amt",0);
			ds_ukey.SetColumn(0,"new_pay_fix_amt",sNewFixAmt);
			return false;
		}
	}
		
	if(strColumnID =="OLD_PAY_PRCHS_AMT"){
		if(toNumber(varNewValue)-toNumber(varOldValue) <= toNumber(ds_ukey.GetColumn(0,"old_pay_fix_amt"))){
			ds_ukey.SetColumn(0,"old_pay_fix_amt",toNumber(ds_ukey.GetColumn(0,"old_pay_fix_amt"))-(toNumber(varNewValue)-toNumber(varOldValue)));
		}else{
			alert("매입채무 상계금액이 확정금액보다 큽니다");
			ds_ukey.SetColumn(0,"old_pay_prchs_amt",0);
			ds_ukey.SetColumn(0,"old_pay_fix_amt",sOldFixAmt);
			return false;
		}
	}
	
	if(strColumnID =="ETC_PAY_PRCHS_AMT"){
		if(toNumber(varNewValue)-toNumber(varOldValue) <= toNumber(ds_ukey.GetColumn(0,"etc_pay_fix_amt"))){
			ds_ukey.SetColumn(0,"etc_pay_fix_amt",toNumber(ds_ukey.GetColumn(0,"etc_pay_fix_amt"))-(toNumber(varNewValue)-toNumber(varOldValue)));
		}else{
			alert("매입채무 상계금액이 확정금액보다 큽니다");
			ds_ukey.SetColumn(0,"etc_pay_prchs_amt",0);
			ds_ukey.SetColumn(0,"etc_pay_fix_amt",sEtcFixAmt);
			return false;
		}
	}
	
	if(strColumnID =="RTN_PAY_PRCHS_AMT"){
		if(toNumber(varNewValue)-toNumber(varOldValue) <= toNumber(ds_ukey.GetColumn(0,"rtn_pay_fix_amt"))){
			ds_ukey.SetColumn(0,"rtn_pay_fix_amt",toNumber(ds_ukey.GetColumn(0,"rtn_pay_fix_amt"))-(toNumber(varNewValue)-toNumber(varOldValue)));
		}else{
			alert("매입채무 상계금액이 확정금액보다 큽니다");
			ds_ukey.SetColumn(0,"rtn_pay_prchs_amt",0);
			ds_ukey.SetColumn(0,"rtn_pay_fix_amt",sRtnFixAmt);
			return false;
		}
	}
	
	if(strColumnID =="DATA_MKT_PAY_PRCHS_AMT"){
		if(toNumber(varNewValue)-toNumber(varOldValue) <= toNumber(ds_ukey.GetColumn(0,"data_mkt_pay_fix_amt"))){
			ds_ukey.SetColumn(0,"data_mkt_pay_fix_amt",toNumber(ds_ukey.GetColumn(0,"data_mkt_pay_fix_amt"))-(toNumber(varNewValue)-toNumber(varOldValue)));
		}else{
			alert("매입채무 상계금액이 확정금액보다 큽니다");
			ds_ukey.SetColumn(0,"data_mkt_pay_prchs_amt",0);
			ds_ukey.SetColumn(0,"data_mkt_pay_fix_amt",sDataFixAmt);
			return false;
		}
	}
	
	if(strColumnID =="AGREE_PRCHS"){
		if(toNumber(varNewValue)-toNumber(varOldValue) <= toNumber(ds_ukey.GetColumn(0,"agree_fix"))){
			ds_ukey.SetColumn(0,"agree_fix",toNumber(ds_ukey.GetColumn(0,"agree_fix"))-(toNumber(varNewValue)-toNumber(varOldValue)));
		}else{
			alert("매입채무 상계금액이 확정금액보다 큽니다");
			ds_ukey.SetColumn(0,"agree_prchs",0);
			ds_ukey.SetColumn(0,"agree_fix",sAgreeFix);
			return false;
		}
	}
	
	var varC = ds_ukey.GetColumn(0,"new_pay_fix_amt")
					+ds_ukey.GetColumn(0,"old_pay_fix_amt")
					+ds_ukey.GetColumn(0,"etc_pay_fix_amt")
					+ds_ukey.GetColumn(0,"rtn_pay_fix_amt")
					+ds_ukey.GetColumn(0,"data_mkt_pay_fix_amt");
					
		varCA = varC/1.1;
		ds_fix.SetColumn(0,"fix_sply_prc",round(varCA,0));
		ds_fix.SetColumn(0,"fix_vat",round(varC-varCA,0));
		ds_fix.SetColumn(0,"agrmt_astamt",ds_ukey.GetColumn(0,"agree_fix"));
		varFix = varC + toNumber(ds_ukey.GetColumn(0,"agree_fix"));
		ds_fix.SetColumn(0,"fix_amt",varFix);
		}
}



/*******************************************************************************
 * @description    : 닫기- 이벤트
*******************************************************************************/

function btn_close_OnClick(obj)
{
	this.Close();
}
/*******************************************************************************
 * @description    : excel export
*******************************************************************************/
function btn_excel_OnClick(obj)
{
	cf_setExcelInfo("grd_amt", "장려금정산내역" );
    cf_setExcelInfo("grd_ukey", "장려금정산내역" , "c1");
    cf_exportDinamicExcel();    
}

function btn_excel2_OnClick(obj)
{
	cf_exportExcel(grd_fix);
}
/*******************************************************************************
 * @description    : 저장버튼 이벤트
*******************************************************************************/
function btn_save_OnClick(obj)
{
	 cf_CheckCloseMnth('03',div_search.cal_accMth.value,"정산월");  // 03: 정산 	
     if(FV_BOOLEAN_CLOSE) return; // 입력한 일자가 마감 되었을 경우 '1'(true) 리턴.
   
     cf_CheckCloseDay('04',Left(cf_getDate(), 8),"저장일"); 
	 if(FV_BOOLEAN_CLOSE) return; // 입력한 일자가 마감 되었을 경우 '1'(true) 리턴.
	
	f_set_dtl();
	f_set_mst();
	// 마감월 체크
	//cf_CheckCloseMnth('03',div_search.cal_accMth.value,"정산월"); // 03: 정산
	//if(FV_BOOLEAN_CLOSE) return; // 입력한 일자가 마감 되었을 경우 '1'(true) 리턴.
	f_save_mst();
}

/*******************************************************************************
 * @description    : 글자색 변경
*******************************************************************************/
function f_set_color(){

        if(grd_amt.GetCellText("body",0,6) != grd_ukey.GetCellText("body",0,0)){
            grd_amt.SetCellProp("body",6,"color", "red");
        }
        if(grd_amt.GetCellText("body",0,7) != grd_ukey.GetCellText("body",0,5)){
            grd_amt.SetCellProp("body",7,"color", "red");
        }
        if(grd_amt.GetCellText("body",0,8) != grd_ukey.GetCellText("body",0,10)){
            grd_amt.SetCellProp("body",8,"color", "red");
        }
        if(grd_amt.GetCellText("body",0,9) != grd_ukey.GetCellText("body",0,15)){
            grd_amt.SetCellProp("body",9,"color", "red");
        }
        if(grd_amt.GetCellText("body",0,10) != grd_ukey.GetCellText("body",0,20)){
            grd_amt.SetCellProp("body",10,"color", "red");
        }
        if(grd_amt.GetCellText("body",0,11) != grd_ukey.GetCellText("body",0,25)){
            grd_amt.SetCellProp("body",11,"color", "red");
        }
}
/*******************************************************************************
 * @description    : 장려금정산내역 셋팅
*******************************************************************************/

function f_set_dtl(){
	for(var i=0; i<=5; i++){
		ds_save_dtl.AddRow();
		ds_save_dtl.SetColumn(i,"deal_co_cd",posAgency);
		ds_save_dtl.SetColumn(i,"acc_mth",payDtm);
		ds_save_dtl.SetColumn(i,"acc_plc",polOper);
	}
	
	//신규개통정책지급총액
	ds_save_dtl.SetColumn(0,"pr_mny_typ_cd","01");
	ds_save_dtl.SetColumn(0,"asmpt_amt",ds_amt.GetColumn(0,"new_pay_amt"));
	ds_save_dtl.SetColumn(0,"u_key_amt",ds_ukey.GetColumn(0,"new_pay_amt"));
	ds_save_dtl.SetColumn(0,"acc_amt",ds_ukey.GetColumn(0,"new_pay_acc_amt"));
	ds_save_dtl.SetColumn(0,"prchs_debt_mtch",ds_ukey.GetColumn(0,"new_pay_prchs_amt"));
	ds_save_dtl.SetColumn(0,"fix_amt",ds_ukey.GetColumn(0,"new_pay_fix_amt"));
	
	//보상기변정책지급총액
	ds_save_dtl.SetColumn(1,"pr_mny_typ_cd","02");
	ds_save_dtl.SetColumn(1,"asmpt_amt",ds_amt.GetColumn(0,"old_pay_amt"));
	ds_save_dtl.SetColumn(1,"u_key_amt",ds_ukey.GetColumn(0,"old_pay_amt"));
	ds_save_dtl.SetColumn(1,"acc_amt",ds_ukey.GetColumn(0,"old_pay_acc_amt"));
	ds_save_dtl.SetColumn(1,"prchs_debt_mtch",ds_ukey.GetColumn(0,"old_pay_prchs_amt"));
	ds_save_dtl.SetColumn(1,"fix_amt",ds_ukey.GetColumn(0,"old_pay_fix_amt"));
	
	//기타정책지급총액
	ds_save_dtl.SetColumn(2,"pr_mny_typ_cd","03");
	ds_save_dtl.SetColumn(2,"asmpt_amt",ds_amt.GetColumn(0,"etc_pay_amt"));
	ds_save_dtl.SetColumn(2,"u_key_amt",ds_ukey.GetColumn(0,"etc_pay_amt"));
	ds_save_dtl.SetColumn(2,"acc_amt",ds_ukey.GetColumn(0,"etc_pay_acc_amt"));
	ds_save_dtl.SetColumn(2,"prchs_debt_mtch",ds_ukey.GetColumn(0,"etc_pay_prchs_amt"));
	ds_save_dtl.SetColumn(2,"fix_amt",ds_ukey.GetColumn(0,"etc_pay_fix_amt"));
	
	//환수정책지급총액
	ds_save_dtl.SetColumn(3,"pr_mny_typ_cd","04");
	ds_save_dtl.SetColumn(3,"asmpt_amt",ds_amt.GetColumn(0,"rtn_pay_amt"));
	ds_save_dtl.SetColumn(3,"u_key_amt",ds_ukey.GetColumn(0,"rtn_pay_amt"));
	ds_save_dtl.SetColumn(3,"acc_amt",ds_ukey.GetColumn(0,"rtn_pay_acc_amt"));
	ds_save_dtl.SetColumn(3,"prchs_debt_mtch",ds_ukey.GetColumn(0,"rtn_pay_prchs_amt"));
	ds_save_dtl.SetColumn(3,"fix_amt",ds_ukey.GetColumn(0,"rtn_pay_fix_amt"));
	
	//데이터마케팅지급총액
	ds_save_dtl.SetColumn(4,"pr_mny_typ_cd","05");
	ds_save_dtl.SetColumn(4,"asmpt_amt",ds_amt.GetColumn(0,"data_mkt_pay_amt"));
	ds_save_dtl.SetColumn(4,"u_key_amt",ds_ukey.GetColumn(0,"data_mkt_pay_amt"));
	ds_save_dtl.SetColumn(4,"acc_amt",ds_ukey.GetColumn(0,"data_mkt_pay_acc_amt"));
	ds_save_dtl.SetColumn(4,"prchs_debt_mtch",ds_ukey.GetColumn(0,"data_mkt_pay_prchs_amt"));
	ds_save_dtl.SetColumn(4,"fix_amt",ds_ukey.GetColumn(0,"data_mkt_pay_fix_amt"));
	
	//T기본약정지급총액
	ds_save_dtl.SetColumn(5,"pr_mny_typ_cd","06");
	ds_save_dtl.SetColumn(5,"asmpt_amt",ds_amt.GetColumn(0,"AGREE"));
	ds_save_dtl.SetColumn(5,"u_key_amt",ds_ukey.GetColumn(0,"agree"));
	ds_save_dtl.SetColumn(5,"acc_amt",ds_ukey.GetColumn(0,"agree_acc"));
	ds_save_dtl.SetColumn(5,"prchs_debt_mtch",ds_ukey.GetColumn(0,"agree_prchs"));
	ds_save_dtl.SetColumn(5,"fix_amt",ds_ukey.GetColumn(0,"agree_fix"));
}

/*******************************************************************************
 * @description    : 장려금확정금액 셋팅
*******************************************************************************/
function f_set_mst(){
	ds_fix.SetColumn(0,"deal_co_cd",posAgency);
	ds_fix.SetColumn(0,"acc_mth",payDtm);
	ds_fix.SetColumn(0,"acc_plc",polOper);
	ds_fix.SetColumn(0,"u_key_trms_dtm",ukeyDtm);
	
	var asmptAmt = ds_amt.GetColumn(0,"new_pay_amt")
				+ds_amt.GetColumn(0,"old_pay_amt")
				+ds_amt.GetColumn(0,"etc_pay_amt")
				+ds_amt.GetColumn(0,"rtn_pay_amt")
				+ds_amt.GetColumn(0,"data_mkt_pay_amt")
				+ds_amt.GetColumn(0,"AGREE");
				
	ds_fix.SetColumn(0,"asmpt_amt",asmptAmt);
}

function f_save_mst(){
    var sSvcID  = "svcSaveMST";
    var sInDs   = "ds_fix=ds_fix";
    var sOutDs  = "";
    var sArg    = "sktst.acc.SSS#savePrMnyAccM";

    // 공통 트랜잭션 호출
    cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}

function f_save_dtl(){
	var sSvcID  = "svcSaveDtl";
    var sInDs   = "ds_save_dtl=ds_save_dtl";
    var sOutDs  = "";
    var sArg    = "sktst.acc.SSS#savePrMnyAccD";

    // 공통 트랜잭션 호출
    cf_Transaction(sSvcID, sInDs, sOutDs, sArg);

}




function ds_fix_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
	if(strColumnID =="fix_sply_prc"){
				
		var varC = ds_ukey.GetColumn(0,"new_pay_fix_amt")
						+ds_ukey.GetColumn(0,"old_pay_fix_amt")
						+ds_ukey.GetColumn(0,"etc_pay_fix_amt")
						+ds_ukey.GetColumn(0,"rtn_pay_fix_amt")
						+ds_ukey.GetColumn(0,"data_mkt_pay_fix_amt");
			
		ds_fix.SetColumn(0,"fix_vat",round(varC-toNumber(varNewValue),0));
	}
}
]]></Script>
</Window>