<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="600" Id="ACCPDS00200" Left="8" OnLoadCompleted="ACCPDS00200_OnLoadCompleted" PidAttrib="7" Title="재고보상등록" Top="8" Ver="1.0" Width="1024" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_condition">
				<Contents>
					<colinfo id="ORG_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DIS_CMP_MTH" size="256" summ="default" type="STRING"/>
					<colinfo id="STRD_DT" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_PLC" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cmp_mgmt">
				<Contents>
					<colinfo id="prchs_plc" size="256" summ="default" type="STRING"/>
					<colinfo id="acc_dt" size="256" summ="default" type="STRING"/>
					<colinfo id="deal_co_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="sum_dis_qty" size="256" summ="default" type="STRING"/>
					<colinfo id="sum_dis_cmp_qty" size="256" summ="default" type="STRING"/>
					<colinfo id="sum_dis_cmp_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="sum_un_cmp_qty" size="256" summ="default" type="STRING"/>
					<colinfo id="sum_un_cmp_amt" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cmp_condition">
				<Contents>
					<colinfo id="acc_dt" size="256" summ="default" type="STRING"/>
					<record>
						<acc_dt>&#32;</acc_dt>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_prchs_plc">
				<Contents>
					<colinfo id="deal_co_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="deal_co_nm" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_outFixRegList" OnColumnChanged="ds_outFixRegList_OnColumnChanged">
				<Contents>
					<colinfo id="edt_flag" size="256" summ="default" type="STRING"/>
					<colinfo id="add_flag" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="mdl_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="mfact_id" size="256" summ="default" type="STRING"/>
					<colinfo id="mfact_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_cl" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_cl_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="dis_obj" size="256" summ="default" type="STRING"/>
					<colinfo id="down_unit_prc" size="256" summ="default" type="STRING"/>
					<colinfo id="add_qty" size="256" summ="default" type="STRING"/>
					<colinfo id="aply_qty" size="256" summ="default" type="STRING"/>
					<colinfo id="aply_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="exc_qty" size="256" summ="default" type="STRING"/>
					<colinfo id="loss_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="rmks" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_outFixRegOrgList"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_copyList"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_strd_dt">
				<Contents>
					<colinfo id="APLY_STA_DTM" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_condition_tmp">
				<Contents>
					<colinfo id="ORG_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DIS_CMP_MTH" size="256" summ="default" type="STRING"/>
					<colinfo id="STRD_DT" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_PLC" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_childPop"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_outFixRegList_tmp">
				<Contents>
					<colinfo id="edt_flag" size="256" summ="default" type="STRING"/>
					<colinfo id="add_flag" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="mdl_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="mfact_id" size="256" summ="default" type="STRING"/>
					<colinfo id="mfact_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_cl" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_cl_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="dis_obj" size="256" summ="default" type="STRING"/>
					<colinfo id="down_unit_prc" size="256" summ="default" type="STRING"/>
					<colinfo id="add_qty" size="256" summ="default" type="STRING"/>
					<colinfo id="aply_qty" size="256" summ="default" type="STRING"/>
					<colinfo id="aply_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="exc_qty" size="256" summ="default" type="STRING"/>
					<colinfo id="loss_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="rmks" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cntList">
				<Contents>
					<colinfo id="CNT" size="256" summ="default" type="STRING"/>
					<record>
						<CNT>&#32;</CNT>
					</record>
				</Contents>
			</Dataset>
		</Datasets>
		<Div Border="Raised" Height="41" Id="div_search" Left="10" Style="sty_div_dataview" TabOrder="1" Text="Div0" Top="10" Width="1004">
			<Contents>
				<Static Align="Right" Border="None" Height="20" Id="Static4" Left="1" Style="sty_lb_dataview" TabOrder="2" Text="대리점" Top="7" VAlign="Middle" Width="70"></Static>
				<Static Align="Right" Border="None" Height="20" Id="Static1" Left="676" Style="sty_lb_dataview" TabOrder="2" Text="재고보상기준일" Top="7" VAlign="Middle" Width="100"></Static>
				<Static Align="Right" Height="20" Id="Static0" Left="326" Style="sty_lb_dataview" TabOrder="3" Text="매입처" Top="7" VAlign="Middle" Width="76"></Static>
				<Edit Border="Flat" Enable="FALSE" Height="20" Id="edt_prchsPlcId" Left="525" LeftMargin="2" RightMargin="2" Style="sty_ipt_form" TabOrder="4" Top="7" Width="117"></Edit>
				<Button Cursor="HAND" Height="21" Id="btn_prchs" ImageID="btn_i_detail" Left="506" OnClick="div_search_btn_prchs_OnClick" TabOrder="5" Text="Button0" Top="7" Width="19"></Button>
				<Edit Border="Flat" Height="20" Id="edt_prchsPlcNm" Left="406" LeftMargin="2" OnCharChanged="div_search_edt_prchsPlcNm_OnCharChanged" OnKeyDown="div_search_edt_prchsPlcNm_OnKeyDown" RightMargin="2" Style="sty_ipt_form" TabOrder="6" Top="7" Width="102"></Edit>
				<Button Align="Left" ButtonStyle="TRUE" Height="21" Id="btn_confirm" ImageID="btn_a_2" Left="918" LeftMargin="5" OnClick="btn_search_onClick" Style="sty_btn_a" TabOrder="7" Text="조회" Top="9" Width="60"></Button>
				<Image Height="21" Id="Image0" ImageID="bul_mand" Left="668" TabOrder="8" Top="7" Transparent="TRUE" Width="20"></Image>
				<Image Height="21" Id="Image2" ImageID="bul_mand" Left="16" TabOrder="9" Top="6" Transparent="TRUE" Width="20"></Image>
				<Image Height="21" Id="Image3" ImageID="bul_mand" Left="348" TabOrder="10" Top="7" Transparent="TRUE" Width="20"></Image>
				<Edit BindDataset="ds_condition" Border="Flat" Height="20" Id="edt_agencyNm" Left="75" LeftMargin="2" OnCharChanged="div_search_edt_agencyNm_OnCharChanged" OnKeyDown="div_search_edt_agencyNm_OnKeyDown" RightMargin="2" Style="sty_ipt_form" TabOrder="12" Top="7" UserData="대리점" Width="102"></Edit>
				<Button Cursor="HAND" Height="21" Id="btn_agency" ImageID="btn_i_detail" Left="176" OnClick="btn_agency_OnClick" TabOrder="11" Text="Button0" Top="7" Width="19"></Button>
				<Edit Border="Flat" Enable="FALSE" Height="20" Id="edt_agencyUkeyCd" Left="195" MaxLength="10" Readonly="TRUE" Style="sty_ipt_form" TabOrder="13" TabStop="FALSE" Top="7" UpperOnly="TRUE" Width="117"></Edit>
				<Edit Border="Flat" Height="20" Id="edt_agencyCd" Left="318" MaxLength="10" Style="sty_ipt_form" TabOrder="14" TabStop="FALSE" Top="7" UpperOnly="TRUE" Visible="FALSE" Width="8"></Edit>
				<Edit Border="Flat" Height="20" Id="edt_strdDt" Left="781" LeftMargin="2" OnCharChanged="div_search_edt_strdDt_OnCharChanged" Readonly="TRUE" RightMargin="2" Style="sty_ipt_form" TabOrder="15" Top="8" UserData="재고보상&#32;기준일" Width="90"></Edit>
				<Button Height="21" Id="btn_eqpMdlSearch" ImageID="btn_i_detail" Left="870" OnClick="div_search_btn_search_OnClick" TabOrder="16" Text="Button0" Top="8" Width="19"></Button>
			</Contents>
		</Div>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" BindDataset="ds_outFixRegList" BkColor2="user32" BoldHead="true" Border="Flat" Bottom="557" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" FillArea="TRUE" HeadBorder="Flat" HeadHeight="22" Height="468" Id="grd_cmp" InputPanel="FALSE" Left="10" LineColor="user33" MinWidth="100" OnChar="grd_cmp_OnChar" OnExpandUp="grd_cmp_OnExpandUp" Right="1014" RowHeight="21" Style="sty_Grid" TabOrder="1" TabStop="true" Top="89" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="user33" WheelScrollRow="1" Width="1004">
			<contents>
				<format id="Default">
					<columns>
						<col width="34"/>
						<col width="84"/>
						<col width="88"/>
						<col width="80"/>
						<col width="70"/>
						<col width="70"/>
						<col width="70"/>
						<col width="70"/>
						<col width="70"/>
						<col width="90"/>
						<col width="90"/>
						<col width="134"/>
					</columns>
					<head>
						<cell align="center" bkcolor="user34" col="0" color="user35" display="text" font="돋움,9,Bold" text="No" Valign="Center"/>
						<cell align="center" bkcolor="user34" col="1" color="user35" display="text" font="돋움,9,Bold" text="구분" Valign="Center"/>
						<cell align="center" bkcolor="user34" col="2" color="user35" display="text" font="돋움,9,Bold" text="제조사" Valign="Center"/>
						<cell align="center" bkcolor="user34" col="3" color="user35" display="text" font="돋움,9,Bold" text="모델" Valign="Center"/>
						<cell bkcolor="user34" col="4" color="user35" display="text" font="돋움,9,Bold" text="인하단가" Valign="Center"/>
						<cell bkcolor="user34" col="5" color="user35" display="text" font="돋움,9,Bold" text="대상수량" Valign="Center"/>
						<cell bkcolor="user34" col="6" color="user35" display="text" font="돋움,9,Bold" text="추가수량" Valign="Center"/>
						<cell bkcolor="user34" col="7" color="user35" display="text" font="돋움,9,Bold" text="적용수량" Valign="Center"/>
						<cell bkcolor="user34" col="8" color="user35" display="text" font="돋움,9,Bold" text="제외수량" Valign="Center"/>
						<cell bkcolor="user34" col="9" color="user35" display="text" font="돋움,9,Bold" text="재고보상금액" Valign="Center"/>
						<cell bkcolor="user34" col="10" color="user35" display="text" font="돋움,9,Bold" text="손실금액" Valign="Center"/>
						<cell bkcolor="user34" col="11" color="user35" display="text" font="돋움,9,Bold" text="비고" Valign="Center"/>
					</head>
					<body>
						<cell align="center" col="0" colid="edt_flag" display="number" expr="currow+1"/>
						<cell align="center" col="1" colid="edt_flag" display="text" expr='Iif(edt_flag==&apos;N&apos;&#32;||&#32;(add_qty&#32;&gt;0),&#32;&quot;사용자추가&quot;,&quot;자동산출&quot;)'/>
						<cell bkcolor2="user36" col="2" colid="mfact_nm" display="text" expandimage="btn_i_detail_b" expandshow='expr:Iif(edt_flag==&apos;N&apos;,&#32;&quot;true&quot;,&#32;&quot;false&quot;)'/>
						<cell bkcolor2="user36" col="3" colid="mdl_nm" display="text" expandimage="btn_i_detail_b" expandshow='expr:Iif(edt_flag==&apos;N&apos;,&#32;&quot;true&quot;,&#32;&quot;false&quot;)'/>
						<cell align="right" bkcolor2="user36" col="4" colid="down_unit_prc" display="number" edit='expr:Iif((EDT_FLAG==&apos;N&apos;&#32;||&#32;(DIS_OBJ==0&#32;&amp;&amp;&#32;ADD_QTY&#32;&gt;0))&#32;&amp;&amp;&#32;FV_DIS_DEBT_FLAG&#32;==0,&#32;&quot;number&quot;,&#32;&quot;none&quot;)'/>
						<cell align="right" bkcolor2="user36" col="5" colid="dis_obj" combodisplayrowcnt="0" display="number" expandimage="btn_i_detail_b" expandshow='expr:Iif(edt_flag==&apos;N&apos;,&#32;&quot;false&quot;,&#32;&quot;true&quot;)'/>
						<cell align="right" bkcolor2="user36" col="6" colid="add_qty" combodisplayrowcnt="0" display="number" expandimage="btn_i_detail_b" expandshow="true"/>
						<cell align="right" bkcolor2="user36" col="7" colid="aply_qty" display="number"/>
						<cell align="right" bkcolor2="user32" col="8" colid="exc_qty" combodisplayrowcnt="0" display="number" expandimage="btn_i_detail_b" expandshow="true"/>
						<cell align="right" bkcolor2="user32" col="9" colid="aply_amt" combodisplayrowcnt="0" display="number"/>
						<cell align="right" bkcolor2="user32" col="10" colid="loss_amt" combodisplayrowcnt="0" display="number"/>
						<cell col="11" colid="rmks" display="text" edit='expr:Iif(FV_DIS_DEBT_FLAG&#32;==0,&#32;&quot;normal&quot;,&#32;&quot;none&quot;)'/>
					</body>
					<summary>
						<cell align="right" bkcolor="user37" col="0" color="user38" display="text" font="돋움,9,Bold"/>
						<cell align="right" bkcolor="user37" col="1" color="user38" colspan="2" display="text" font="돋움,9,Bold" text="계"/>
						<cell align="right" bkcolor="user37" col="3" color="user38" display="text"/>
						<cell align="right" bkcolor="user37" col="4" color="user38" display="number" expr='decode(sum(&quot;down_unit_prc&quot;),0,&apos;&apos;,sum(&quot;down_unit_prc&quot;))' font="굴림,9"/>
						<cell align="right" bkcolor="user37" col="5" color="user38" display="number" expr='decode(sum(&quot;dis_obj&quot;),0,&apos;&apos;,sum(&quot;dis_obj&quot;))' font="굴림,9"/>
						<cell align="right" bkcolor="user37" col="6" color="user38" display="number" expr='decode(sum(&quot;add_qty&quot;),0,&apos;&apos;,sum(&quot;add_qty&quot;))' font="굴림,9"/>
						<cell align="right" bkcolor="user37" col="7" color="user38" display="number" expr='decode(sum(&quot;aply_qty&quot;),0,&apos;&apos;,sum(&quot;aply_qty&quot;))' font="굴림,9"/>
						<cell align="right" bkcolor="user37" col="8" color="user38" display="number" expr='decode(sum(&quot;exc_qty&quot;),0,&apos;&apos;,sum(&quot;exc_qty&quot;))' font="굴림,9"/>
						<cell align="right" bkcolor="user37" col="9" color="user38" display="number" expr='decode(sum(&quot;aply_amt&quot;),0,&apos;&apos;,sum(&quot;aply_amt&quot;))' font="굴림,9"/>
						<cell align="right" bkcolor="user37" col="10" color="user38" display="number" expr='decode(sum(&quot;loss_amt&quot;),0,&apos;&apos;,sum(&quot;loss_amt&quot;))' font="굴림,9"/>
						<cell align="right" bkcolor="user37" col="11" color="user38" display="number" font="굴림,9"/>
					</summary>
				</format>
			</contents>
		</Grid>
		<Button Cursor="HAND" Height="21" Id="Button56" ImageID="btn_i_exceldown_w" Left="968" OnClick="btn_excel_OnClick" TabOrder="2" Text="Button1" ToolTipText="Excel&#32;Download" Top="59" Width="19"></Button>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="25" Id="btn_save" ImageID="btn_c_2" Left="952" LeftMargin="5" OnClick="btn_save_onClick" Style="sty_btn_c" TabOrder="3" Text="저장" Top="565" Visible="FALSE" Width="60"></Button>
		<Button Cursor="HAND" Height="21" Id="btn_addRow" ImageID="btn_i_add_w" Left="-160" OnClick="div_excel_btn_addRow_OnClick" TabOrder="5" Text="Button1" ToolTipText="행추가" Width="19"></Button>
		<Button Cursor="HAND" Height="21" Id="btn_delRow" ImageID="btn_i_subtract_w" Left="-137" OnClick="div_excel_btn_delRow_OnClick" TabOrder="6" Text="Button1" ToolTipText="추가된&#32;행삭제" Width="19"></Button>
		<Button Cursor="HAND" Height="21" Id="btn_add" ImageID="btn_i_add_w" Left="923" OnClick="btn_addRow_OnClick" TabOrder="7" Text="Button1" ToolTipText="행추가" Top="59" Width="19"></Button>
		<Button Cursor="HAND" Height="21" Id="btn_del" ImageID="btn_i_subtract_w" Left="946" OnClick="btn_delRow_OnClick" TabOrder="8" Text="Button1" ToolTipText="추가된&#32;행삭제" Top="59" Width="19"></Button>
		<Button Cursor="HAND" Height="21" Id="btn_upload" ImageID="btn_i_excelup_w" Left="989" OnClick="btn_upload_OnClick" TabOrder="9" Text="Button1" ToolTipText="Excel&#32;Download" Top="58" Width="19"></Button>
	</Form>
	<Script><![CDATA[/*******************************************************************************
* 프로그램ID : ACCPDS00200
* 업무명      : 매입채무 - 재고보상등록
* 프로그램명  : 재고보상등록
--------------------------------------------------------------------------------
* 작성자      : 전현주
* 작성일      : 2009.02.02
--------------------------------------------------------------------------------
* 1. 변경이력
수정자    :
수정일    :
수정 내역 :
*******************************************************************************/

//==============================================================================
// 1. 전 처리기
//==============================================================================
#include "lib::lib_commF.js"
#include "lib::lib_commMsg.js"
#include "lib::lib_commPopup.js"
#include "lib::lib_util.js"


var FV_ORG_ID;         	//조직코드   
var FV_ORG_CD  = "";
var FV_ORG_NM = "";
var FV_ORG_UKEY_CD   = "";
var FV_ACC_MTH       = "";
var FV_STRD_DT   = "";
var FV_ACC_DT       = "";
var FV_PRCHS_PLC   = "";
var FV_PRCHS_PLC_NM   = "";
var FV_DIS_DEBT_FLAG = "";
var FV_CUD_FLAG = "";
var FV_ROW_PROD = "";
var FV_SEARCH_FLAG = "N"; //조회체크

//==============================================================================
// 3. 폼 로드
//==============================================================================
/*******************************************************************************
* 함수명 : sample_OnLoadCompleted
* 기능명 : OnLoadCompleted 이벤트
--------------------------------------------------------------------------------
* 작성자      : 전현주
* 작성일      : 2009.02.02
-------------------------------------------------------------------------------
* 1. 변경이력
수정자    :
수정일    :
수정 내역 :
*******************************************************************************/

function ACCPDS00200_OnLoadCompleted(obj)
{
	FV_ORG_ID 	= gds_session.GetColumn(0, "orgId");	
		
	cf_setGrdChecknSortEvent(grd_cmp);
	// 권한 설정
    cf_setAuth(pFrmNum);	
    
	FV_ORG_CD  = sInOrgCd;
	FV_ORG_NM = sInOrgNm;
	FV_ORG_UKEY_CD   = sInUKeyAgencyCd;
	FV_ACC_MTH       = sInAccMth;
	FV_STRD_DT   = sInStrdDt;
	FV_ACC_DT       = sInAccDt;
	FV_PRCHS_PLC   = sInPrchsPlc;
	FV_PRCHS_PLC_NM   = sInPrchsPlcNm;
	FV_DIS_DEBT_FLAG = sDisDebtFlag;
	FV_CUD_FLAG = sFlag;
	
	if (FV_CUD_FLAG == "U") {
				
		
		//div_search.cal_acc_mth.Value = FV_ACC_MTH;
		div_search.edt_agencyNm.Text = FV_ORG_NM;
		div_search.edt_agencyUkeyCd.Text = FV_ORG_UKEY_CD;
		div_search.edt_agencyCd.Text = FV_ORG_CD;
		div_search.edt_strdDt.Value = substr(FV_STRD_DT,0,4)+"-"+substr(FV_STRD_DT,4,2)+"-"+substr(FV_STRD_DT,6,2);
		div_search.edt_prchsPlcNm.Text = FV_PRCHS_PLC_NM;
		div_search.edt_prchsPlcId.Text = FV_PRCHS_PLC;
		
		//div_search.cal_acc_mth.Enable = "false";
		//div_search.btn_monthCalendar.Enable = "false";
		div_search.edt_agencyNm.Enable = "false";
		div_search.btn_agency.Enable = "false";
		div_search.edt_strdDt.Enable = "false";
		div_search.btn_eqpMdlSearch.Enable = "false";
		div_search.edt_prchsPlcNm.Enable = "false";
		div_search.btn_prchs.Enable = "false";
		div_search.btn_confirm.Enable = "false";
				
		f_getDisCmpDetail();
	}else{
		
		f_setInit();
	}
	   	
		
	//매입채무 정산 등록된 건은 수정 못하게 
	if(FV_DIS_DEBT_FLAG != "0"){  
		//grd_cmp.Editable = "false";
		grd_cmp.Editable = "true";
		btn_add.Enable = "false";
		btn_del.Enable = "false";
		btn_save.Enable= "false";
	}else{
		btn_add.Enable = "true";
		btn_del.Enable = "true";
		btn_save.Enable= "true";
	}
	
}


/*******************************************************************************
 * @description    :  재고보상 수정시 
*******************************************************************************/
function f_getCondition(sArg)
{		
	if(sArg != null){
		cf_setArg("ds_condition_tmp", sArg);		
				
		
		FV_ORG_CD  = ds_condition_tmp.GetColumn(0,"sInOrgCd");
		FV_ORG_NM = ds_condition_tmp.GetColumn(0,"sInOrgNm");
		FV_ORG_UKEY_CD   = ds_condition_tmp.GetColumn(0,"sInUKeyAgencyCd");
		FV_ACC_MTH       = ds_condition_tmp.GetColumn(0,"sInAccMth");
		FV_STRD_DT   = ds_condition_tmp.GetColumn(0,"sInStrdDt");
		FV_ACC_DT       = ds_condition_tmp.GetColumn(0,"sInAccDt");
		FV_PRCHS_PLC   = ds_condition_tmp.GetColumn(0,"sInPrchsPlc");
		FV_PRCHS_PLC_NM   = ds_condition_tmp.GetColumn(0,"sInPrchsPlcNm");
		FV_DIS_DEBT_FLAG = ds_condition_tmp.GetColumn(0,"sDisDebtFlag");
		FV_CUD_FLAG = ds_condition_tmp.GetColumn(0,"sFlag");
		
		//uf_enableAgencyByAuth("div_search", "edt_agencyNm,edt_agencyCd,btn_agency", "edt_agencyUkeyCd");
		
		//div_search.cal_acc_mth.Value = FV_ACC_MTH;
		div_search.edt_agencyNm.Text = FV_ORG_NM;
		div_search.edt_agencyUkeyCd.Text = FV_ORG_UKEY_CD;
		div_search.edt_agencyCd.Text = FV_ORG_CD;
		div_search.edt_strdDt.Value = substr(FV_STRD_DT,0,4)+"-"+substr(FV_STRD_DT,4,2)+"-"+substr(FV_STRD_DT,6,2);
		div_search.edt_prchsPlcNm.Text = FV_PRCHS_PLC_NM;
		div_search.edt_prchsPlcId.Text = FV_PRCHS_PLC;
		
		//div_search.cal_acc_mth.Enable = "false";
		//div_search.btn_monthCalendar.Enable = "false";
		div_search.edt_agencyNm.Enable = "false";
		div_search.btn_agency.Enable = "false";
		div_search.edt_strdDt.Enable = "false";
		div_search.btn_eqpMdlSearch.Enable = "false";
		div_search.edt_prchsPlcNm.Enable = "false";
		div_search.btn_prchs.Enable = "false";
		div_search.btn_confirm.Enable = "false";
		
		ds_outFixRegList.ClearData();
		ds_outFixRegOrgList.ClearData();
		ds_outFixRegList_tmp.ClearData();
		ds_cntList.ClearData();
	
	}
	
	
	//확정 'Y', 매입채무등록 된 경우 수정 못하게.
	if(FV_DIS_DEBT_FLAG = "1")
	{  
		grd_cmp.Editable = "false";
		btn_save.Enable = "false";
	} 
	
	f_getDisCmpDetail();
}


function f_setInit(){
			
	//div_search.cal_acc_mth.Value = substr(today(),0,6);
	div_search.edt_agencyNm.Text = "";
	div_search.edt_agencyUkeyCd.Text = "";
	div_search.edt_agencyCd.Text = "";
	div_search.edt_agencyNm.Enable = "true";
	div_search.btn_agency.Enable = "true";
	div_search.edt_agencyUkeyCd.Enable = "true";
	
	div_search.edt_strdDt.Value = "";
	div_search.edt_prchsPlcNm.Text = "";
	div_search.edt_prchsPlcId.Text = "";
	
	uf_enableAgencyByAuth("div_search", "edt_agencyNm,edt_agencyCd,btn_agency", "edt_agencyUkeyCd");
	
	//div_search.cal_acc_mth.Enable = "true";
	//div_search.btn_monthCalendar.Enable = "true";
	//div_search.edt_agencyNm.Enable = "true";
	//div_search.btn_agency.Enable = "true";
	div_search.edt_strdDt.Enable = "true";
	div_search.btn_eqpMdlSearch.Enable = "true";
	div_search.edt_prchsPlcNm.Enable = "true";
	div_search.btn_prchs.Enable = "true";
	div_search.btn_confirm.Enable = "true";
	btn_save.Enable= "true";
	FV_DIS_DEBT_FLAG = 0;
	
	ds_outFixRegList.ClearData();
	ds_outFixRegOrgList.ClearData();
	ds_outFixRegList_tmp.ClearData();
	ds_condition.ClearData();
	ds_condition_tmp.ClearData();
	ds_cntList.ClearData();
}


/*******************************************************************************
 * @description    : 공통 폼 재호출 함수
*******************************************************************************/
function df_reSet(sArg)
{	
	 if(cf_isNewService(sArg)) // 신규
    {	
    
		f_setInit();
    }else{
		
		f_getCondition(sArg);
    }
	
}	
/*******************************************************************************
 * @description    :  월달력 사용 - 이벤트
*******************************************************************************/
function btn_monthCalendar_OnClick(obj)
{
	cf_callMonthCalendar(div_search.cal_acc_mth);
}


/*******************************************************************************
 * @description    : 재고보상 기준일 검색
*******************************************************************************/
function div_search_btn_search_OnClick(obj)
{
	if(uf_isNull(trim(div_search.edt_agencyCd.Text))){
		alert(cf_getMessage(MSG_00047,"대리점을"));
		div_search.edt_agencyNm.SetFocus();
		return false;
	}else if(uf_isNull(trim(div_search.edt_prchsPlcId.Text))){
		alert(cf_getMessage(MSG_00047,"매입처를"));
		div_search.edt_prchsPlcNm.SetFocus();
		return false;
	}
	
	var sInOrgCd = div_search.edt_agencyCd.Text;
	var sInPrchsPlc = div_search.edt_prchsPlcId.Text;
	
	var sArg  =  "sOrgCd="+quote(sInOrgCd); 
		sArg += " sPrchsPlc="+quote(sInPrchsPlc);
		sArg += " sModFlag="+quote(FV_CUD_FLAG);
        	
	dialog("ACC::ACCPDS00600.xml", sArg, 300, 300);
	
	if(uf_CheckDate(ds_strd_dt.GetColumn(0, "APLY_STA_DTM"), "YYYYMMDD") == true){
		div_search.edt_strdDt.Text = substr(ds_strd_dt.GetColumn(0, "APLY_STA_DTM"),0,4)+"-"+substr(ds_strd_dt.GetColumn(0, "APLY_STA_DTM"),4,2)+"-"+substr(ds_strd_dt.GetColumn(0, "APLY_STA_DTM"),6,2);
	}
}

function div_search_edt_agencyNm_OnCharChanged(obj,strPreText,strPostText)
{
	div_search.edt_agencyCd.Text = "";
	div_search.edt_agencyUkeyCd.Text = "";
	ds_outFixRegOrgList.ClearData();
	ds_outFixRegList.ClearData();
	ds_copyList.ClearData();
	
	FV_SEARCH_FLAG = "N"; //재조회 요청을 위한 변수 설정
	
	//ds_list.ClearData();
}

/*******************************************************************************
 * @description    : 대리점 key down팝업
*******************************************************************************/
function div_search_edt_agencyNm_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
{
	if(nChar == "13"){
		var sArg  =  "org_id="+quote(FV_ORG_ID);  // 필수
		
		cf_callAgencyPop(sArg, div_search, "edt_agencyNm,edt_agencyCd,edt_agencyUkeyCd");	
	}
}


/*******************************************************************************
 * @description    : 매입처 팝업 호출- 이벤트
*******************************************************************************/

function div_search_btn_prchs_OnClick(obj)
{
	//var sArg  = "deal_co_cl1="+quote("30");
	var sArg  = "deal_co_cl1="+quote("30");
	//sArg += "eff_dtm="+quote(Left(cf_getDate(), 8));

	cf_callDealPop(sArg, div_search, "edt_prchsPlcNm,edt_prchsPlcId");
}

function div_search_edt_prchsPlcNm_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
{
	if(nChar == "13"){
		
		//var sArg  = "deal_co_cl1="+quote("30");
		var sArg  = "deal_co_cl1="+quote("30");
			//sArg += "eff_dtm="+quote(Left(cf_getDate(), 8));
						
		//cf_callDealPop(sArg, div_search, "edt_prchsPlcNm,edt_prchsPlc");
		cf_callDealPop(sArg, div_search, "edt_prchsPlcNm,edt_prchsPlcId");
	}
}

function div_search_edt_prchsPlcNm_OnCharChanged(obj,strPreText,strPostText)
{
	if(strPreText != strPostText){
		div_search.edt_prchsPlcId.value = "";
		ds_outFixRegOrgList.ClearData();
		ds_outFixRegList.ClearData();
		ds_copyList.ClearData();
		//ds_list.ClearData();
		
		FV_SEARCH_FLAG = "N";
	}
}


/*******************************************************************************
 * @description    :  재고보상 대상 상품코드 및 수량 조회
*******************************************************************************/

function f_getDisCmpDetail(){

	if(!f_pre_check()){
		return false;
	}
		
	if(ds_condition.GetRowCount() ==0){
		ds_condition.AddRow();
	}
	
	FV_SEARCH_FLAG = "Y";	
	
	cf_setParam(ds_condition, "ORG_CD", div_search.edt_agencyCd.Text);
	//cf_setParam(ds_condition, "DIS_CMP_MTH", div_search.cal_acc_mth.Value);
	cf_setParam(ds_condition, "DIS_CMP_MTH", substr(div_search.edt_strdDt.Value,0,4)+substr(div_search.edt_strdDt.Value,5,2));
	cf_setParam(ds_condition, "STRD_DT", substr(div_search.edt_strdDt.Value,0,4)+substr(div_search.edt_strdDt.Value,5,2)+substr(div_search.edt_strdDt.Value,8,2));
	cf_setParam(ds_condition, "PRCHS_PLC", div_search.edt_prchsPlcId.Text);
		
	var sSvcID = "svcUnCmpDetailList";
	var sInDs  = "nc_input_fieldDs=ds_condition";
	var sOutDs = "ds_outFixRegOrgList=rs_disSerNumList ds_outFixRegList=rs_disCmpList ds_cntList=rs_cntList";
	var sArg = "sktst.acc.PDS#getDisCmpProdInfo";
	
	// 공통 트랜잭션 호출
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg,null,true,true);
}



/*******************************************************************************
 * @description    : 재고 보상 목록 조회시 조건 체크
*******************************************************************************/
function f_pre_check()
{	
	
	if(uf_isNull(trim(div_search.edt_agencyCd.Text))){
		alert(cf_getMessage(MSG_00047,"대리점을"));
		div_search.edt_agencyNm.SetFocus();
		return false;
	}
	/*else if(uf_CheckDate(div_search.cal_acc_mth.Text, "YYYYMM") == false)
	{
		alert(cf_getMessage(MSG_00047,"정산월을"));
		div_search.cal_acc_mth.SetFocus();
		return false;		
	}*/
	else if(uf_CheckDate(div_search.edt_strdDt.Text, "YYYYMMDD") == false)
	{
		alert(cf_getMessage(MSG_00047,"재고보상 기준일을"));
		div_search.edt_strdDt.SetFocus();
		return false;		
	}else if(uf_isNull(trim(div_search.edt_prchsPlcId.Text))){
		alert(cf_getMessage(MSG_00047,"매입처를"));
		div_search.edt_prchsPlcNm.SetFocus();
		return false;
	}
	
	
	var nChk = true;
	var sChkMsg = "";
	
	for(var nRow=0; nRow<ds_outFixRegList.rowcount;nRow++){
		
		if(ds_outFixRegList.GetColumn(nRow, "prod_cd") ==null){
			nChk = false;
			sChkMsg = (nRow+1)+" 번째 열의 상품코드를 확인하십시오.";
			break;
		}
		
		if(ds_outFixRegList.GetColumn(nRow, "down_unit_prc") <= 0){
			nChk = false;
			sChkMsg = (nRow+1)+" 번째 열의 인하단가를 확인하십시오.";
			f_set_gridFocus(grd_cmp, nRow, 4);
			break;
		}
		
		/*
		if(ds_outFixRegList.GetColumn(nRow, "aply_qty") == 0 ){
			nChk = false;
			sChkMsg = (nRow+1)+" 번째 열의 적용수량을 확인하십시오.";
			break;
		}
		*/
    }
    
    if(!nChk){
		alert(sChkMsg);
		return false;
    }
    return true;
}

/*******************************************************************************
* 함수명 : f_callBack 
* 기능명 : 트랜잭션 콜백 
* 파라미터
1. sSvcID  : 서비스 아이디
--------------------------------------------------------------------------------
* 작성자      : 전현주
* 작성일      : 2009.02.02
--------------------------------------------------------------------------------
* 1. 변경이력
수정자    :
수정일    :
수정 내역 :
*******************************************************************************/
function f_callBack(sSvcID)
{   
    if(sSvcID == "svcUnCmpDetailList") {
    
	 if(ds_outFixRegList.GetRowCount() >0){
		FV_CUD_FLAG = ds_outFixRegList.GetColumn(0,"edt_flag");
	 }else if(ds_cntList.GetColumn(0,"cnt") !=0 && ds_outFixRegList.GetRowCount() ==0){
		FV_CUD_FLAG = "U";
	 }else{
		FV_CUD_FLAG = "I";
	 }
	 	
     if(ds_outFixRegList.getRowCount() > 0){
		 for(var nRow = 0; nRow < ds_outFixRegList.rowcount; nRow++){
			ds_outFixRegList.SetColumn(nRow,"aply_amt",(toNumber(ds_outFixRegList.GetColumn(nRow,"aply_qty"))*toNumber(ds_outFixRegList.GetColumn(nRow,"down_unit_prc"))));
		 }
     }

    }else if(sSvcID == "svcDisCmpDetailList"){
		return;
    }else if(sSvcID == "svcInsert") {
				
		alert(cf_getMessage(MSG_00006, "재고보상 저장이"));
		
		
		var sOrgCd = ds_condition.GetColumn(0,"ORG_CD");
		var sAgencyNm = div_search.edt_agencyNm.Text;
		var sAccMth = ds_condition.GetColumn(0,"DIS_CMP_MTH");
		var sPrchsPlc = ds_condition.GetColumn(0,"PRCHS_PLC");
		var sPrchsPlcNm= div_search.edt_prchsPlcNm.Text;
		
		
		
		
		var sArg = sOrgCd;
			sArg += ","+sAgencyNm;
			sArg += ","+sAccMth;
			sArg += ","+sPrchsPlc;
			sArg += ","+sPrchsPlcNm;
				
		gf_movenCall("100000103", "f_search", sArg);
	    
	    //this.Close();
    }
    
}
		


/*******************************************************************************
 * @description    : 엑셀 출력 - 이벤트
*******************************************************************************/
function btn_excel_OnClick(obj)
{
	cf_exportExcel(grd_cmp);
}



/*******************************************************************************
 * @description    :  닫기
*******************************************************************************/
function btn_close_OnClick(obj)
{
	this.Close();
}

/*******************************************************************************
 * @description    :  닫기
*******************************************************************************/
function ds_cmp_detail_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
	if(strColumnID == "APLY_QTY")
	{
		if(toNumber(varNewValue) > toNumber(ds_cmp_detail.GetColumn(nRow,"DIS_OBJ"))){
			alert("재고보상수량은 재고수량보다 작은 수로 입력하십시오.");
			ds_cmp_detail.SetColumn(nRow, "APLY_QTY",varOldValue);
		}
		ds_cmp_detail.SetColumn(nRow, "APLY_AMT", (toNumber(ds_cmp_detail.GetColumn(nRow,"DOWN_UNIT_PRC")) * toNumber(ds_cmp_detail.GetColumn(nRow,"APLY_QTY"))));
		ds_cmp_detail.SetColumn(nRow, "EXC_QTY", (toNumber(ds_cmp_detail.GetColumn(nRow,"DIS_OBJ"))-toNumber(ds_cmp_detail.GetColumn(nRow,"APLY_QTY"))));
		ds_cmp_detail.SetColumn(nRow, "LOSS_AMT", (toNumber(ds_cmp_detail.GetColumn(nRow,"DOWN_UNIT_PRC")) * (toNumber(ds_cmp_detail.GetColumn(nRow,"DIS_OBJ"))-toNumber(ds_cmp_detail.GetColumn(nRow,"APLY_QTY")))));
		
	}
}


/*******************************************************************************
 * @description    : 재고보상 등록 시 조건절 생성
*******************************************************************************/
function f_setConditionValue(){
	
	var sInStrdDt = substr(div_search.edt_strdDt.Text,0,4)+substr(div_search.edt_strdDt.Text,5,2)+substr(div_search.edt_strdDt.Text,8,2);
	
	cf_setParam(ds_condition, "DIS_CMP_MTH", substr(div_search.edt_strdDt.Text,0,4)+substr(div_search.edt_strdDt.Text,5,2));
	cf_setParam(ds_condition, "STRD_DT", sInStrdDt);
	cf_setParam(ds_condition, "FLAG", FV_CUD_FLAG);
		
	ds_outFixRegList.AddColumn("ORG_CD");
	ds_outFixRegList.AddColumn("DIS_CMP_MTH");
	ds_outFixRegList.AddColumn("STRD_DT");
	ds_outFixRegList.AddColumn("PRCHS_PLC");
		
	 for( var idx=0 ; idx<ds_outFixRegList.rowcount; idx++ ){
		
		ds_outFixRegList.SetColumn(idx,"ORG_CD",ds_condition.GetColumn(0,"ORG_CD"));
		ds_outFixRegList.SetColumn(idx,"DIS_CMP_MTH",ds_condition.GetColumn(0,"DIS_CMP_MTH"));
		ds_outFixRegList.SetColumn(idx,"STRD_DT",ds_condition.GetColumn(0,"STRD_DT"));
		ds_outFixRegList.SetColumn(idx,"PRCHS_PLC",ds_condition.GetColumn(0,"PRCHS_PLC"));
	 }
	 
	cf_setParam(ds_condition, "APLY_OBJ", ds_outFixRegList.sum("DIS_OBJ"));
	cf_setParam(ds_condition, "APLY_QTY", ds_outFixRegList.sum("APLY_QTY"));
	cf_setParam(ds_condition, "ADD_QTY", ds_outFixRegList.sum("ADD_QTY"));
	cf_setParam(ds_condition, "EXC_QTY",  ds_outFixRegList.sum("EXC_QTY")); 
	cf_setParam(ds_condition, "APLY_AMT", ds_outFixRegList.sum("APLY_AMT")); 
	cf_setParam(ds_condition, "LOSS_AMT", ds_outFixRegList.sum("LOSS_AMT")); 
	
}


/*******************************************************************************
 * @description    :  재고보상 세부내역 저장
*******************************************************************************/
function btn_save_onClick(obj)
{	
	// 마감월 체크
    cf_CheckCloseDay('04',Left(Today(), 8),"저장일"); 
    if(FV_BOOLEAN_CLOSE) return; // 입력한 일자가 마감 되었을 경우 '1'(true) 리턴.

	if(!f_pre_check()){
		return false;
	}
	
	if ( (ds_outFixRegList.rowcount >0 ) && !ds_outFixRegList.GetUpdate() && !ds_outFixRegOrgList.GetUpdate()) {
		alert(cf_getMessage(MSG_00071,""));
		return false;
	} else if(Confirm(cf_getMessage(MSG_00063,"")) == true) {
		
		f_setConditionValue();
		
		cf_copyDataset(ds_outFixRegList, ds_outFixRegList_tmp, null, false, true);
		
		
		var sSvcID = "svcInsert";
		var sInDs = "nc_input_fieldDs=ds_condition rs_outFixRegList=ds_outFixRegList rs_disUnitChgLst=ds_outFixRegOrgList";
		var sOutDs = "ds_cmp_mgmt=mgmtList";
		var sArg = "sktst.acc.PDS#saveDisCmpList";
		
		cf_Transaction(sSvcID, sInDs, sOutDs, sArg, null,true,true);
		
		
	}
		
}


function Button0_OnClick(obj)
{
	//cf_debug("ds_outFixRegList");
	cf_debug("ds_outFixRegOrgList");
}

function Button1_OnClick(obj)
{
	cf_debug("ds_outFixRegOrgList");
}

 
/*******************************************************************************
 * @description    : 조회 
*******************************************************************************/
function btn_search_onClick(obj)
{
	f_getDisCmpDetail();
}

/*
function div_search_cal_acc_mth_OnCharChanged(obj,strPreText,strPostText)
{
	if(strPreText != strPostText){
		ds_outFixRegOrgList.ClearData();
		ds_outFixRegList.ClearData();
	}	
}
*/

function div_search_edt_strdDt_OnCharChanged(obj,strPreText,strPostText)
{
	if(strPreText != strPostText){
		ds_outFixRegOrgList.ClearData();
		ds_outFixRegList.ClearData();
		
		FV_SEARCH_FLAG = "N";
	}	
}

/*******************************************************************************
 * @description    : 대리점 검색 팝업
*******************************************************************************/

function btn_agency_OnClick(obj)
{
	var sArg  =  "org_id="+quote(FV_ORG_ID);  // 필수
	
	cf_callAgencyPop(sArg, div_search, "edt_agencyNm,edt_agencyCd,edt_agencyUkeyCd");	
}


/*******************************************************************************
 * @description    : 사용자 구분 추가 add row
*******************************************************************************/
function btn_addRow_OnClick(obj)
{
	if(ds_outFixRegOrgList.GetColCount() ==0){
		alert("선택 대리점의 재고상태가 조회 되지 않았습니다. \n\n 재고상태를 조회하세요");
	}else{
		f_addRow();
	}
}


/*******************************************************************************
 * @description    : 행을 추가한다.
*******************************************************************************/
function f_addRow()
{
	
	var oGrdDs = object(grd_cmp.BindDataset);
	var nRow = oGrdDs.AddRow();
	
	//ds_outFixRegList.AddRow();
	ds_outFixRegList.SetColumn(nRow, "edt_flag", "N");
	ds_outFixRegList.SetColumn(nRow, "dis_obj", 0);
	ds_outFixRegList.SetColumn(nRow, "add_qty", 0);
	ds_outFixRegList.SetColumn(nRow, "aply_qty",0);
	ds_outFixRegList.SetColumn(nRow, "exc_qty", 0);
	ds_outFixRegList.SetColumn(nRow, "aply_amt", 0);
	ds_outFixRegList.SetColumn(nRow, "loss_amt",0);
	
	grd_cmp.SetFocus();
	grd_cmp.SetCellPos(2);
}


function Button2_OnClick(obj)
{
	cf_debug("ds_outFixRegList");
}


/*******************************************************************************
 * @description    : 사용자 추가 모델 등록시 제조사 선택, 모델 선택  OnExpandUp
*******************************************************************************/

function grd_cmp_OnExpandUp(obj,nRow,nCell,strVal,nPivotIndex)
{
	//제조사 선택 팝업 
	if(nCell == 2){
		var sArg  = "deal_co_cl1="+quote("20");	
		
		cf_callDealPop(sArg, ds_outFixRegList, "mfact_nm,mfact_id", nRow);
    }
    
    //모델 선택 팝업 
    if(nCell == 3){
		
		f_setProdDetailCd();
		
		http.Sync = true;
	
		if(ds_childPop.rowcount != 1 ){
		
			ds_childPop.ClearData();
						
			cf_setParam(ds_childPop, "prod_cd", ds_outFixRegList.GetColumn(nRow, "prod_nm"));
			cf_setParam(ds_childPop, "prod_nm", ds_outFixRegList.GetColumn(nRow, "mdl_nm"));
			cf_setParam(ds_childPop, "prod_cl", "1");
			cf_setParam(ds_childPop, "prod_cl_nm", null);
			cf_setParam(ds_childPop, "mfact_id", ds_outFixRegList.GetColumn(nRow, "mfact_id"));
			cf_setParam(ds_childPop, "mfact_nm", ds_outFixRegList.GetColumn(nRow, "mfact_nm"));
			cf_setParam(ds_childPop, "down_unit_prc", 0);
			cf_setParam(ds_childPop, "exc_prod", FV_ROW_PROD);
			
						
			var dsParent = "ds_childPop";
			var rowParent = 0;
			var sStrdDt = substr(div_search.edt_strdDt.Text,0,4)+substr(div_search.edt_strdDt.Text,5,2)+substr(div_search.edt_strdDt.Text,8,2);
			
			var  sArg  = "dsParent='"+dsParent+"'";
				 sArg += " rowParent='"+rowParent+"'";
				 sArg += " strdDt='"+sStrdDt+"'";
				 /*sArg += " sRowProd='"+FV_ROW_PROD+"'"; */
				 sArg += " dsFlag=true";
				 sArg += " callFunction='"+callFunction+"'";
					
				dialog("ACC::ACCPDS00220.xml", sArg , 400, 400);
		}
			
		ds_outFixRegList.SetColumn(nRow, "mfact_id", ds_childPop.GetColumn(0, "mfact_id"));
		ds_outFixRegList.SetColumn(nRow, "mfact_nm", ds_childPop.GetColumn(0, "mfact_nm"));
		ds_outFixRegList.SetColumn(nRow, "prod_cd", ds_childPop.GetColumn(0, "prod_cd"));
		ds_outFixRegList.SetColumn(nRow, "mdl_nm", ds_childPop.GetColumn(0, "prod_nm"));
		ds_outFixRegList.SetColumn(nRow, "prod_cl", ds_childPop.GetColumn(0, "prod_cl"));
		ds_outFixRegList.SetColumn(nRow, "prod_cl_nm", ds_childPop.GetColumn(0, "prod_cl_nm"));
		ds_outFixRegList.SetColumn(nRow, "down_unit_prc", ds_childPop.GetColumn(0, "down_unit_prc"));
		
		ds_childPop.ClearData();
		
		http.Sync = false;
	}
	
	//대상수량 일련번호 선택 팝업 
	if(nCell == 5){
		var sInAgencyNm = div_search.edt_agencyNm.Text;
		var sInAgencyCd = div_search.edt_agencyCd.Text;
		var sInPrchsNm = div_search.edt_prchsPlcNm.Text;
		var sInMfactNm = ds_outFixRegList.GetColumn(nRow, "mfact_nm");
		var sInMdlNm = ds_outFixRegList.GetColumn(nRow, "mdl_nm");
		var sInProdCl = ds_outFixRegList.GetColumn(nRow, "prod_cl");
		var sInMfactId = ds_outFixRegList.GetColumn(nRow, "mfact_id");
		var sInMdlCd = ds_outFixRegList.GetColumn(nRow, "prod_cd");
		var sInDebtFlag = FV_DIS_DEBT_FLAG;
		var sInRow = nRow;
				
		var sArg = "sAgencyNm=" + quote(sInAgencyNm);
		sArg += " sAgencyCd=" + quote(sInAgencyCd);
		sArg += " sPrchsNm=" + quote(sInPrchsNm);
		sArg += " sMfactNm=" + quote(sInMfactNm);
		sArg += " sMdlNm=" + quote(sInMdlNm);
		sArg += " sProdCl=" + quote(sInProdCl);
		sArg += " sMfactId=" + quote(sInMfactId);
		sArg += " sMdlCd=" + quote(sInMdlCd);
		sArg += " sNrow=" + quote(sInRow);
		sArg += " sDebtFlag=" + quote(sInDebtFlag);
		
		dialog("ACC::ACCPDS00210.xml", sArg, 600, 400 );
    }
    
    //추가수량 사용자 일련번호 입력 팝업 
    if(nCell == 6){
		
		if(ds_outFixRegList.GetColumn(nRow, "mfact_id") == null){
			alert(cf_getMessage(MSG_00047,"제조사를"));
			return false;
		}
		
		if(ds_outFixRegList.GetColumn(nRow, "prod_cd") == null){
			alert(cf_getMessage(MSG_00047,"모델을"));
			return false;
		}
		
		/*
		if(toNumber(ds_outFixRegList.GetColumn(nRow, "down_unit_prc")) == 0){
			alert(cf_getMessage(MSG_00047,"인하단가를"));
			f_set_gridFocus(grd_cmp, nRow, 4);
			return false;
		}
		*/
			
		var sInAgencyNm = div_search.edt_agencyNm.Text;
		var sInAgencyCd = div_search.edt_agencyCd.Text;
		var sInPrchsCd = div_search.edt_prchsPlcId.Text;
		var sInPrchsNm = div_search.edt_prchsPlcNm.Text;
		var sInStrdDt = substr(div_search.edt_strdDt.Text,0,4)+substr(div_search.edt_strdDt.Text,5,2)+substr(div_search.edt_strdDt.Text,8,2);
		var sInMfactId = ds_outFixRegList.GetColumn(nRow, "mfact_id");
		var sInMfactNm = ds_outFixRegList.GetColumn(nRow, "mfact_nm");
		var sInProdCd = ds_outFixRegList.GetColumn(nRow, "prod_cd");
		var sInProdCl = ds_outFixRegList.GetColumn(nRow, "prod_cl");
		var sInMdlNm = ds_outFixRegList.GetColumn(nRow, "mdl_nm");
		var sInAddQty = ds_outFixRegList.GetColumn(nRow, "add_qty");
		var sInDownUnitPrc = ds_outFixRegList.GetColumn(nRow, "down_unit_prc");
		var sInDebtFlag = FV_DIS_DEBT_FLAG;
		var sInRow = nRow;
				
		var sArg = "sAgencyNm=" + quote(sInAgencyNm);
		sArg += " sAgencyCd=" + quote(sInAgencyCd);
		sArg += " sPrchsCd=" + quote(sInPrchsCd);
		sArg += " sPrchsNm=" + quote(sInPrchsNm);
		sArg += " sMfactId=" + quote(sInMfactId);
		sArg += " sMfactNm=" + quote(sInMfactNm);
		sArg += " sProdCd=" + quote(sInProdCd);
		sArg += " sProdCl=" + quote(sInProdCl);
		sArg += " sMdlNm=" + quote(sInMdlNm);
		sArg += " sDownUnitPrc=" + quote(sInDownUnitPrc);
		sArg += " sStrdDt=" + quote(sInStrdDt);
		sArg += " sAddQty=" + quote(sInAddQty);
		sArg += " sNrow=" + quote(sInRow);
		sArg += " sDebtFlag=" + quote(sInDebtFlag);
				
		dialog("ACC::ACCPDS00230.xml", sArg, 600, 400 );
		
    }
    
    //대상수량 제외 일련번호 선택 팝업 
	if(nCell == 8){
		var sInAgencyNm = div_search.edt_agencyNm.Text;
		var sInAgencyCd = div_search.edt_agencyCd.Text;
		var sInPrchsNm = div_search.edt_prchsPlcNm.Text;
		var sInMfactNm = ds_outFixRegList.GetColumn(nRow, "mfact_nm");
		var sInMdlNm = ds_outFixRegList.GetColumn(nRow, "mdl_nm");
		var sInProdCl = ds_outFixRegList.GetColumn(nRow, "prod_cl");
		var sInMfactId = ds_outFixRegList.GetColumn(nRow, "mfact_id");
		var sInMdlCd = ds_outFixRegList.GetColumn(nRow, "prod_cd");
		var sInDebtFlag = FV_DIS_DEBT_FLAG;
		var sInRow = nRow;
				
		var sArg = "sAgencyNm=" + quote(sInAgencyNm);
		sArg += " sAgencyCd=" + quote(sInAgencyCd);
		sArg += " sPrchsNm=" + quote(sInPrchsNm);
		sArg += " sMfactNm=" + quote(sInMfactNm);
		sArg += " sMdlNm=" + quote(sInMdlNm);
		sArg += " sProdCl=" + quote(sInProdCl);
		sArg += " sMfactId=" + quote(sInMfactId);
		sArg += " sMdlCd=" + quote(sInMdlCd);
		sArg += " sNrow=" + quote(sInRow);
		sArg += " sDebtFlag=" + quote(sInDebtFlag);
		
		dialog("ACC::ACCPDS00240.xml", sArg, 600, 400 );
    }
}



/******************************************************************************
 * @description    : 재고보상 등록한 상품코드와 상품 팝업의 상품코드 중복 체크 
 *****************************************************************************/
function f_setProdDetailCd(){

	var sArrProdCd = "";
	
	if(ds_outFixRegList.rowcount() >1){
		for(var i=0;i<ds_outFixRegList.rowcount()-1; i++){
				
			if(i==0){
				sArrProdCd ="'";
			}
			sArrProdCd += ds_outFixRegList.GetColumn(i,"PROD_CD")+"','";
		}
	}
	
	if(sArrProdCd.length > 0){
		sArrProdCd = substr(sArrProdCd,0,(sArrProdCd.length()-2));
	}
	
	FV_ROW_PROD = sArrProdCd;
	
}

/*******************************************************************************
 * @description    : 사용자 추가 모델 row 삭제
*******************************************************************************/
function btn_delRow_OnClick(obj)
{
	if(toNumber(ds_outFixRegList.GetColumn(ds_outFixRegList.currow, "dis_obj")) > 0){
		alert("자동 산출 모델은 삭제할 수 없습니다.");
		return false; 
	}else{
		
		var sOrgProdCd = ds_outFixRegList.GetColumn(ds_outFixRegList.currow, "prod_cd");
		var sEdtFlag = ds_outFixRegList.GetColumn(ds_outFixRegList.currow, "edt_flag");
		
		if(Confirm("선택 상품의 재고보상 이력이 삭제됩니다. \n\n 삭제하시겠습니까?") == true) {
		
			var nRow = ds_outFixRegList.currow;
			
			if(sEdtFlag == "U"){
				ds_outFixRegList_tmp.AddRow();
				ds_outFixRegList_tmp.CopyRow(ds_outFixRegList_tmp.lastrow,ds_outFixRegList,nRow);
				ds_outFixRegList_tmp.SetColumn(ds_outFixRegList_tmp.lastrow, "EDT_FLAG", "D");
				
				cf_setParam(ds_outFixRegList_tmp, "ORG_CD", ds_condition.GetColumn(0,"ORG_CD"));
				cf_setParam(ds_outFixRegList_tmp, "DIS_CMP_MTH", ds_condition.GetColumn(0,"DIS_CMP_MTH"));
				cf_setParam(ds_outFixRegList_tmp, "PRCHS_PLC", ds_condition.GetColumn(0,"PRCHS_PLC"));
				cf_setParam(ds_outFixRegList_tmp, "STRD_DT", ds_condition.GetColumn(0,"STRD_DT"));
			}				
				
			ds_outFixRegList.DeleteRow(ds_outFixRegList.currow);
			ds_childPop.ClearData();
		
			for(var i=0; i<ds_outFixRegOrgList.rowcount; i++)
			{
				if(ds_outFixRegOrgList.GetColumn(i, "prod_cd") == sOrgProdCd 
				   && ds_outFixRegOrgList.GetColumn(i, "in_fix_yn") =="1"
				   && ds_outFixRegOrgList.GetColumn(i, "in_fix_yn_tmp") !="1")
				{
					ds_outFixRegOrgList.DeleteRow(i);
					i--;
				}else if(ds_outFixRegOrgList.GetColumn(i, "prod_cd") == sOrgProdCd 
				   && ds_outFixRegOrgList.GetColumn(i, "in_fix_yn") =="1"
				   && ds_outFixRegOrgList.GetColumn(i, "in_fix_yn_tmp") =="1"){
					
					ds_outFixRegOrgList.SetColumn(i, "in_fix_yn","0");
					ds_outFixRegOrgList.SetColumn(i, "in_fix_yn_tmp","1");
				}
			}
		}else{
			return false;
		}
	}
}


function Button3_OnClick(obj)
{
	cf_debug("ds_outFixRegOrgList");
}

/******************************************************************************
 * @description    : 재고보상 수기입력시 추가수량, 재고보상금액 변경 Event
 *****************************************************************************/
function ds_outFixRegList_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
	if(strColumnID =="ADD_QTY"){
		
		var sAplyQty = toNumber(ds_outFixRegList.GetColumn(nRow,"aply_qty"));
		
		ds_outFixRegList.SetColumn(nRow,"aply_qty", sAplyQty+(toNumber(varNewValue)-toNumber(varOldValue)));
		//ds_outFixRegList.SetColumn(nRow,"exc_qty", 0);
		ds_outFixRegList.SetColumn(nRow,"aply_amt", toNumber(ds_outFixRegList.GetColumn(nRow,"down_unit_prc"))*toNumber(ds_outFixRegList.GetColumn(nRow,"aply_qty")));
		//ds_outFixRegList.SetColumn(nRow,"loss_amt", 0);
	}

	
	if(strColumnID =="DOWN_UNIT_PRC"){
		ds_outFixRegList.SetColumn(nRow,"aply_amt", toNumber(ds_outFixRegList.GetColumn(nRow,"aply_qty"))*toNumber(varNewValue));
	
		var sRowProdCd = ds_outFixRegList.GetColumn(nRow,"prod_cd");
		
		if(ds_outFixRegOrgList.GetRowCount() > 0){
			
			for(var i=0; i<ds_outFixRegOrgList.rowcount; i++)
			{
				
				if(ds_outFixRegOrgList.GetColumn(i,"prod_cd") == sRowProdCd){
					ds_outFixRegOrgList.SetColumn(i, "down_unit_prc", toNumber(varNewValue));
				}
				
			}
		}
		
	}
}

function Button5_OnClick(obj)
{
	cf_debug("ds_condition");
}


function Button4_OnClick(obj)
{
	cf_debug("ds_outFixRegList_tmp");
}

function ds_outFixRegOrgList_OnClick(obj)
{
	cf_debug("ds_outFixRegOrgList");
}

function grd_cmp_OnChar(obj,strPreText,nChar,strPostText,nLLParam,nHLParam,nRow,nCell,nPivotIndex)
{
	if(nCell == 4){
		
		if(nChar==45){
			alert(cf_getMessage(MSG_00056, "")); 
			f_set_gridFocus(grd_cmp, nRow, 4);
			return;
		}
	}
}



/*******************************************************************************
* 함수명 : f_set_gridFocus
* 기능명 : 그리드 포커스 이동
*******************************************************************************/
function f_set_gridFocus(gridObj, nRow, nCellIdx) 
{	
	var dataSetObj = object(gridObj.bindDataset);
	dataSetObj.row = nRow;
	gridObj.SetCellPos(nCellIdx);
	gridObj.SetFocus();
}


function btn_upload_onClick(obj)
{
	
	if(FV_SEARCH_FLAG == "N"){
		alert("자동산출 재고 수량을 먼저 조회하십시오.");
	    return false;
	}
	
	if(uf_isNull(trim(div_search.edt_agencyCd.Text))){
		alert(cf_getMessage(MSG_00047,"대리점을"));
		div_search.edt_agencyNm.SetFocus();
		return false;
	}
	
	
	if(uf_isNull(trim(div_search.edt_prchsPlcId.Text))){
		alert(cf_getMessage(MSG_00047,"매입처를"));
		div_search.edt_prchsPlcNm.SetFocus();
		return false;
	}
	
	
	if(uf_isNull(trim(div_search.edt_strdDt.Text))){
		alert(cf_getMessage(MSG_00047,"재고보상기준일을"));
		div_search.edt_strdDt.SetFocus();
		return false;
	}
	
	var sInAgencyCd = div_search.edt_agencyCd.Text;
	var sInAgencyNm = div_search.edt_agencyNm.Text;
	var sInConStrdDt =  substr(div_search.edt_strdDt.Value,0,4)+substr(div_search.edt_strdDt.Value,5,2)+substr(div_search.edt_strdDt.Value,8,2);
	var sInStrdDt =  div_search.edt_strdDt.Text;
	var sInPrchsPlc =  div_search.edt_prchsPlcId.Text;
	var sInPrchsNm = div_search.edt_prchsPlcNm.Text;
	
	var sArg = "sAgencyCd=" + quote(sInAgencyCd);
		sArg += " sAgencyNm=" + quote(sInAgencyNm);
		sArg += " sStrdDt=" + quote(sInStrdDt);
		sArg += " sConStrdDt=" + quote(sInConStrdDt);
		sArg += " sPrchsPlc=" + quote(sInPrchsPlc);
		sArg += " sPrchsNm=" + quote(sInPrchsNm);
				
		dialog("ACC::ACCPDS00250.xml", sArg, 800, 600 );
	
}

]]></Script>
</Window>