<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="600" Id="ACCPDS00400" Left="8" OnLoadCompleted="ACCPDS00400_OnLoadCompleted" PidAttrib="7" Title="매입할인등록" Top="8" Ver="1.0" Width="1024" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_result">
				<Contents>
					<colinfo id="PROD_CL" size="256" summ="default" type="STRING"/>
					<colinfo id="MFACT_ID" size="256" summ="default" type="STRING"/>
					<colinfo id="PROD_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="PROD_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="skt_oper_yn" size="256" summ="default" type="STRING"/>
					<colinfo id="PROD_CHRTIC_1" size="256" summ="default" type="STRING"/>
					<colinfo id="PROD_CHRTIC_2" size="256" summ="default" type="STRING"/>
					<colinfo id="MKTG_DT" size="256" summ="default" type="STRING"/>
					<colinfo id="END_DT" size="256" summ="default" type="STRING"/>
					<colinfo id="bar_cd_typ" size="256" summ="default" type="STRING"/>
					<colinfo id="mfact_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_cl_nm" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset CanColumnChange="ds_condition_CanColumnChange" DataSetType="Dataset" Id="ds_condition" OnColumnChanged="ds_condition_OnColumnChanged">
				<Contents>
					<colinfo id="ORG_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="ORG_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="ACC_DT" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_PLC" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_PLC_NM" size="256" summ="default" type="STRING"/>
					<record>
						<ACC_DT></ACC_DT>
						<ORG_CD>&#32;</ORG_CD>
						<ORG_NM></ORG_NM>
						<PRCHS_PLC></PRCHS_PLC>
						<PRCHS_PLC_NM></PRCHS_PLC_NM>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_prchs_qty">
				<Contents>
					<colinfo id="prchs_qty" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_prod_cnt">
				<Contents>
					<colinfo id="cnt" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_prchs_detail_0">
				<Contents>
					<colinfo id="ORG_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="ACC_MTH" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_PLC" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_PRD_FROM" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_PRD_TO" size="256" summ="default" type="STRING"/>
					<colinfo id="PROD_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="PROD_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="MFACT_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DEAL_CO_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="PROD_CL" size="256" summ="default" type="STRING"/>
					<colinfo id="PROD_CL_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_QTY" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_AMT" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_DC_CL" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_DC_QTY" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_DC_AMT" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_inout"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_disProdList"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list">
				<Contents>
					<colinfo id="prod_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="mfact_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="color_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="color_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="ser_num" size="256" summ="default" type="STRING"/>
					<colinfo id="amt" size="256" summ="default" type="STRING"/>
					<colinfo id="inout_dtl_cl" size="256" summ="default" type="STRING"/>
					<colinfo id="inout_dt" size="256" summ="default" type="STRING"/>
					<colinfo id="rgst_seq" size="256" summ="default" type="STRING"/>
					<colinfo id="in_fix_yn" size="256" summ="default" type="STRING"/>
					<colinfo id="in_fix_yn_tmp" size="256" summ="default" type="STRING"/>
					<colinfo id="avg_prchs_dc_amt" size="256" summ="default" type="STRING"/>
					<colinfo id="key_data" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_prchs_detail" OnColumnChanged="ds_prchs_detail_OnColumnChanged">
				<Contents>
					<colinfo id="FLAG" size="256" summ="default" type="STRING"/>
					<colinfo id="ORG_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="ACC_MTH" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_PLC" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_PRD_FROM" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_PRD_TO" size="256" summ="default" type="STRING"/>
					<colinfo id="PROD_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="PROD_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="MFACT_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DEAL_CO_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_QTY" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_AMT" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_DC_CL" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_DC_QTY" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_DC_AMT" size="256" summ="default" type="STRING"/>
					<colinfo id="AVG_PRCHS_DC_AMT" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_list_tmp">
				<Contents>
					<colinfo id="prod_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="mfact_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="prod_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="color_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="color_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="ser_num" size="256" summ="default" type="STRING"/>
					<colinfo id="amt" size="256" summ="default" type="STRING"/>
					<colinfo id="inout_dtl_cl" size="256" summ="default" type="STRING"/>
					<colinfo id="inout_dt" size="256" summ="default" type="STRING"/>
					<colinfo id="rgst_seq" size="256" summ="default" type="STRING"/>
					<colinfo id="in_fix_yn" size="256" summ="default" type="STRING"/>
					<colinfo id="in_fix_yn_tmp" size="256" summ="default" type="STRING"/>
					<colinfo id="avg_prchs_dc_amt" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_prchs_detail_tmp">
				<Contents>
					<colinfo id="FLAG" size="256" summ="default" type="STRING"/>
					<colinfo id="ORG_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="ACC_MTH" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_PLC" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_PRD_FROM" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_PRD_TO" size="256" summ="default" type="STRING"/>
					<colinfo id="PROD_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="PROD_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="MFACT_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="DEAL_CO_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_QTY" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_AMT" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_DC_CL" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_DC_QTY" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_DC_AMT" size="256" summ="default" type="STRING"/>
					<colinfo id="AVG_PRCHS_DC_AMT" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset CanColumnChange="ds_condition_CanColumnChange" DataSetType="Dataset" Id="ds_condition_tmp">
				<Contents>
					<colinfo id="ORG_CD" size="256" summ="default" type="STRING"/>
					<colinfo id="ORG_NM" size="256" summ="default" type="STRING"/>
					<colinfo id="ACC_DT" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_PLC" size="256" summ="default" type="STRING"/>
					<colinfo id="PRCHS_PLC_NM" size="256" summ="default" type="STRING"/>
					<record>
						<ACC_DT></ACC_DT>
						<ORG_CD>&#32;</ORG_CD>
						<ORG_NM></ORG_NM>
						<PRCHS_PLC></PRCHS_PLC>
						<PRCHS_PLC_NM></PRCHS_PLC_NM>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_param"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_dedtChk">
				<Contents></Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_dedtChkTmp">
				<Contents>
					<colinfo id="CNT" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Div Border="Raised" Height="40" Id="div_search" Left="10" Style="sty_div_input" TabOrder="0" Text="Div0" Top="11" Width="1004">
			<Contents>
				<Static Align="Right" Border="None" Height="20" Id="stc_prd_gb" Left="-10" Style="sty_lb_Basic" TabOrder="1" Text="대리점" Top="7" VAlign="Middle" Width="92"></Static>
				<Static Align="Right" Height="20" Id="Static1" Left="253" Style="sty_lb_Basic" TabOrder="2" Text="매입처" Top="7" VAlign="Middle" Width="76"></Static>
				<Edit BindDataset="ds_condition" Border="Flat" Height="20" Id="edt_prchsPlcNm" Left="334" LeftMargin="2" OnCharChanged="div_search_edt_prchsPlcNm_OnCharChanged" OnKeyDown="div_search_edt_prchsPlcId_OnKeyDown" RightMargin="2" Style="sty_ipt_form" TabOrder="3" Top="7" Width="94"></Edit>
				<Button Cursor="HAND" Height="21" Id="btn_prchs" ImageID="btn_i_detail" Left="426" OnClick="div_search_btn_prchs_OnClick" TabOrder="4" Text="Button0" Top="7" Width="19"></Button>
				<Edit BindDataset="ds_condition" Border="Flat" Column="PRCHS_PLC" Enable="FALSE" Height="20" Id="edt_prchsPlcId" Left="446" LeftMargin="2" RightMargin="2" Style="sty_ipt_form" TabOrder="5" Top="7" Width="153"></Edit>
				<Button Cursor="HAND" Height="21" Id="btn_agency" ImageID="btn_i_detail" Left="-27" OnClick="btn_agency_OnClick" TabOrder="6" Text="Button0" Top="486" Width="19"></Button>
				<Edit Border="Flat" Height="20" Id="Edit0" ImeMode="none" Left="32" LeftMargin="2" RightMargin="2" Style="sty_ipt_form" TabOrder="10" Top="494" Width="101"></Edit>
				<Button Cursor="HAND" Height="21" Id="Button0" ImageID="btn_i_detail" Left="133" OnClick="btn_agency_OnClick" TabOrder="9" Text="Button0" Top="494" Width="19"></Button>
				<Edit Border="Flat" Height="20" Id="Edit1" Left="154" LeftMargin="2" Readonly="TRUE" RightMargin="2" Style="sty_ipt_form" TabOrder="11" Top="494" Width="101"></Edit>
				<Edit Border="Flat" Height="20" Id="Edit2" ImeMode="none" Left="-96" LeftMargin="2" RightMargin="2" Style="sty_ipt_form" TabOrder="12" Top="614" Width="101"></Edit>
				<Button Cursor="HAND" Height="21" Id="Button1" ImageID="btn_i_detail" Left="5" OnClick="btn_agency_OnClick" TabOrder="12" Text="Button0" Top="614" Width="19"></Button>
				<Edit Border="Flat" Height="20" Id="Edit3" Left="26" LeftMargin="2" Readonly="TRUE" RightMargin="2" Style="sty_ipt_form" TabOrder="12" Top="614" Width="101"></Edit>
				<Edit BindDataset="ds_condition" Border="Flat" Column="ORG_NM" Height="20" Id="edt_ordPlcNm" Left="87" LeftMargin="2" OnCharChanged="div_search_edt_ordPlcNm_OnCharChanged" OnKeyDown="div_search_edt_ordPlcNm_OnKeyDown" RightMargin="2" Style="sty_ipt_form" TabOrder="15" Top="7" UserData="발주처" Width="132"></Edit>
				<Button Cursor="HAND" Height="20" Id="btn_ord" ImageID="btn_i_detail" Left="212" OnClick="div_search_btn_ord_OnClick" TabOrder="14" Text="Button0" Top="7" Width="20"></Button>
				<Edit BindDataset="ds_condition" Border="Flat" Column="ORG_CD" Enable="FALSE" Height="20" Id="edt_ordPlcId" Left="231" LeftMargin="2" RightMargin="2" Style="sty_ipt_form" TabOrder="16" Top="7" Visible="FALSE" Width="10"></Edit>
				<Edit Border="Flat" Enable="FALSE" Height="20" Id="edt_ordPlcUkeyId" Left="242" LeftMargin="2" RightMargin="2" Style="sty_ipt_form" TabOrder="13" Top="7" Visible="FALSE" Width="10"></Edit>
				<Image Height="21" Id="Image1" ImageID="bul_mand" Left="26" TabOrder="17" Top="7" Transparent="TRUE" Width="20"></Image>
				<Image Height="21" Id="Image2" ImageID="bul_mand" Left="277" TabOrder="18" Top="6" Transparent="TRUE" Width="20"></Image>
				<Image Height="21" Id="Image4" ImageID="bul_mand" Left="651" TabOrder="21" Top="6" Transparent="TRUE" Width="20"></Image>
				<Static Align="Right" Height="20" Id="Static3" Left="624" Style="sty_lb_Basic" TabOrder="19" Text="정산일" Top="8" VAlign="Middle" Width="84"></Static>
				<Calendar BindDataset="ds_condition" Border="Flat" ButtonImageID="btn_i_calendar" Column="ACC_DT" DayFont="Default,-1" HeaderBorder="NONE" HeaderFont="Default,-1" HeadStyle="sty_calendar_head" Height="20" Id="cal_acc_dt" Left="711" LeftMargin="2" MonthPopupBorder="RAISED" NullValue="&#32;" RightMargin="2" SaturdayTextColor="user28" Style="sty_calendar" SundayTextColor="user27" TabOrder="20" TodayColor="user26" Top="6" WeeksFont="Default,-1" WeekStyle="sty_calendar_week" Width="120"></Calendar>
			</Contents>
		</Div>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" BindDataset="ds_prchs_detail" BkColor2="user32" BoldHead="true" Border="Flat" Bottom="555" Editable="TRUE" Enable="true" EndLineColor="default" FillArea="TRUE" HeadBorder="Flat" HeadHeight="22" Height="468" Id="grd_prchs_detail" InputPanel="FALSE" Left="12" LineColor="user33" MinWidth="100" OnCellClick="btn_prodSearch_OnCellClick" OnChar="grd_prchs_detail_OnChar" Right="1016" RowHeight="21" Style="sty_Grid" TabOrder="3" TabStop="true" Top="87" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="user33" WheelScrollRow="1" Width="1004">
			<contents>
				<format id="Default">
					<columns>
						<col width="31"/>
						<col width="107"/>
						<col width="107"/>
						<col width="95"/>
						<col width="101"/>
						<col width="96"/>
						<col width="121"/>
						<col width="108"/>
						<col width="70"/>
						<col width="98"/>
						<col width="98"/>
					</columns>
					<head>
						<cell bkcolor="user34" col="0" color="user35" display="text" rowspan="2" text="No"/>
						<cell bkcolor="user34" col="1" color="user35" colspan="2" display="text" text="매입기간"/>
						<cell bkcolor="user34" col="1" color="user35" display="text" row="1" text="시작일"/>
						<cell bkcolor="user34" col="2" color="user35" display="text" row="1" text="종료일"/>
						<cell bkcolor="user34" col="3" color="user35" display="text" rowspan="2" text="모델"/>
						<cell bkcolor="user34" col="4" color="user35" display="text" rowspan="2" text="제조사"/>
						<cell bkcolor="user34" col="5" color="user35" display="text" rowspan="2" text="매입수량"/>
						<cell bkcolor="user34" col="6" color="user35" display="text" rowspan="2" text="매입금액"/>
						<cell bkcolor="user34" col="7" color="user35" colspan="4" display="text" text="매입할인"/>
						<cell bkcolor="user34" col="7" color="user35" display="text" row="1" text="할인구분"/>
						<cell bkcolor="user34" col="8" color="user35" display="text" row="1" text="적용수량"/>
						<cell bkcolor="user34" col="9" color="user35" display="text" row="1" text="할인금액"/>
						<cell bkcolor="user34" col="10" color="user35" display="text" row="1" text="평균단가"/>
					</head>
					<body>
						<cell align="center" col="0" display="text" expr="row+1"/>
						<cell align="center" col="1" colid="PRCHS_PRD_FROM" combotext="name" display="date" expandimage="btn_i_calendar" expandshow="true" expandsize="18"/>
						<cell align="right" col="2" colid="PRCHS_PRD_TO" display="date" expandimage="btn_i_calendar" expandshow="true" expandsize="18"/>
						<cell align="center" col="3" colid="PROD_NM" display="text" expandimage="btn_i_detail_b" expandshow="true" expandsize="19"/>
						<cell align="center" col="4" colid="DEAL_CO_NM" display="text"/>
						<cell align="right" col="5" colid="prchs_qty" display="number" expandimage="btn_i_detail_b" expandshow="true" expandsize="19"/>
						<cell align="right" col="6" colid="prchs_amt" display="number"/>
						<cell align="center" col="7" colid="prchs_dc_cl" combocol="code" combodataset="ds_dis_gubun" combotext="name" display="combo" edit="combo" expandimage="btn_combo" expandshow="true" expandsize="17"/>
						<cell align="right" col="8" colid="PRCHS_DC_QTY" display="number"/>
						<cell align="right" col="9" colid="prchs_dc_amt" display="number" edit="normal"/>
						<cell align="right" col="10" colid="AVG_PRCHS_DC_AMT" display="number"/>
					</body>
					<summary>
						<cell col="-1" display="text">
							<cell align="right" col="0" color="user38" display="text"/>
							<cell align="right" col="1" color="user38" display="text"/>
							<cell align="right" col="2" color="user38" display="number" expr='decode(sum(&quot;prchs_dc_qty&quot;),0,&apos;&apos;,sum(&quot;prchs_dc_qty&quot;))'/>
							<cell align="right" col="3" color="user38" display="text" font="돋움,9,Bold" text="합계"/>
							<cell align="right" col="4" color="user38" display="text"/>
						</cell>
						<cell align="right" bkcolor="user37" col="0" color="user38" colspan="5" display="text" font="돋움,9,Bold" text="합계"/>
						<cell align="right" bkcolor="user37" col="5" color="user38" display="number" expr='sum(&quot;prchs_qty&quot;)'/>
						<cell align="right" bkcolor="user37" col="6" color="user38" display="number" expr='sum(&quot;prchs_amt&quot;)'/>
						<cell align="right" bkcolor="user37" col="7" color="user38" display="text"/>
						<cell align="right" bkcolor="user37" col="8" color="user38" display="number" expr='sum(&quot;prchs_dc_qty&quot;))'/>
						<cell align="right" bkcolor="user37" col="9" color="user38" display="number" expr='sum(&quot;prchs_dc_amt&quot;)'/>
						<cell align="right" bkcolor="user37" col="10" color="user38" display="number" expr='sum(&quot;AVG_PRCHS_DC_AMT&quot;)'/>
					</summary>
				</format>
			</contents>
		</Grid>
		<Button Cursor="HAND" Height="21" Id="btn_add" ImageID="btn_i_add_w" Left="943" OnClick="btn_addRow_OnClick" TabOrder="5" Text="Button1" ToolTipText="행추가" Top="63" Width="19"></Button>
		<Button Cursor="HAND" Height="21" Id="btn_del" ImageID="btn_i_subtract_w" Left="966" OnClick="btn_delRow_OnClick" TabOrder="6" Text="Button1" ToolTipText="추가된&#32;행삭제" Top="63" Width="19"></Button>
		<Button Cursor="HAND" Height="21" Id="Button56" ImageID="btn_i_exceldown_w" Left="993" OnClick="btn_excel_OnClick" TabOrder="4" Text="Button1" ToolTipText="Excel&#32;Download" Top="63" Width="19"></Button>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="25" Id="btn_save" ImageID="btn_c_2" Left="951" LeftMargin="5" OnClick="btn_save_onClick" Style="sty_btn_c" TabOrder="6" Text="저장" Top="562" Visible="FALSE" Width="60"></Button>
	</Form>
	<Script><![CDATA[/*******************************************************************************
* 프로그램ID  : ACCPDS00400
* 업무명      : 정산
* 프로그램명  : 매입할인 등록 및 수정
--------------------------------------------------------------------------------
* 작성자      : 전현주 
* 작성일      : 2009.02.11
--------------------------------------------------------------------------------
* 1. 변경이력
수정자    :
수정일    :
수정 내역 :
*******************************************************************************/

//==============================================================================
// 공통 스크립트 로딩
//==============================================================================
#include "lib::lib_commF.js"
#include "lib::lib_util.js"
#include "lib::lib_commPopup.js"

//==============================================================================
// 폼 변수 정의
//==============================================================================
var FV_STR_NAME; // 사용자 이름
//var sInsFlag = "";
var PROD_CNT = 0;
var F_row = "";
var FV_ROW_PROD = "";
var FV_BEFORE_PROD = "";
var FV_ORG_CD     = "";
var FV_ACC_MTH    = "";
var FV_PRCHS_PLC_ID      = "";
var FV_ACC_DT          = "";
var FV_IN_FIX_YN          = "";
var FV_PRCHS_DEBT_FLAG = "";
var FV_ORG_NM      =  "";
var FV_PRCHS_PLC_NM  = "";
var FV_CUD_FLAG  = "";


/*******************************************************************************
 * @description    : 최초 폼 로드시 발생 - 이벤트
*******************************************************************************/
function ACCPDS00400_OnLoadCompleted(obj)
{
	// 권한 설정
	cf_setAuth(pFrmNum);
			
	//매입할인 할인구분 선택 콤보
		
	FV_ORG_CD  = sOrgCd;
	FV_ACC_MTH = sAccMth;
	FV_PRCHS_PLC_ID   = sPrchsPlc;
	FV_ACC_DT       = sAccDt;
	FV_IN_FIX_YN = sInFixYn;
	FV_PRCHS_DEBT_FLAG   = sPrchsDebtFlag;
	FV_ORG_NM       = sOrdPlcNm;
	FV_PRCHS_PLC_NM = sPrchsPlcNm;
	FV_CUD_FLAG = cudFlag;
		
	if (FV_CUD_FLAG == "U") {
		
		f_getCondition();
	}else{
		
		f_setInit();
	}
	
	cf_setCommonCodeDsEnv();
	
	cf_setCommonCode("grd_prchs_detail", "ZACC_C_00060",null,7);
		
	cf_checkCommonCode();
	
}


function f_setInit(){
	div_search.edt_ordPlcNm.Enable = "true";
	div_search.edt_ordPlcNm.Text="";
	div_search.edt_ordPlcId.Text="";
	
	uf_enableAgencyByAuth("div_search", "edt_ordPlcNm,edt_ordPlcId,btn_ord", "edt_ordPlcUkeyId");
	div_search.cal_acc_dt.Text = Today();
	div_search.edt_prchsPlcId.Text="";
	div_search.edt_prchsPlcNm.Enable = "true";
	div_search.edt_prchsPlcNm.Text="";
	div_search.cal_acc_dt.Enable = "true";
	btn_add.Enable = "true";
	btn_del.Enable = "true";
	btn_save.Enable = "true";
	FV_PRCHS_DEBT_FLAG = "0";
	
	ds_prchs_detail.ClearData();
	ds_inout.ClearData();
	ds_list.ClearData();
	ds_list_tmp.ClearData();
	ds_disProdList.ClearData();
}


/*******************************************************************************
 * @description    : 매입할인 조회, 수정시 매입할인 등록된 상품 목록 리스트 가져오기
*******************************************************************************/
function f_getCondition(sArg)
{		
	if(sArg != null){
		cf_setArg("ds_condition_tmp", sArg);		
		
		FV_ORG_CD     = ds_condition_tmp.GetColumn(0,"sOrgCd");
		FV_ACC_MTH    = ds_condition_tmp.GetColumn(0,"sAccMth");
		FV_PRCHS_PLC_ID      = ds_condition_tmp.GetColumn(0,"sPrchsPlc");
		FV_ACC_DT          = ds_condition_tmp.GetColumn(0,"sAccDt");
		FV_IN_FIX_YN          = ds_condition_tmp.GetColumn(0,"sInFixYn");
		FV_PRCHS_DEBT_FLAG          = ds_condition_tmp.GetColumn(0,"sPrchsDebtFlag");
		FV_ORG_NM      = ds_condition_tmp.GetColumn(0,"sOrdPlcNm");
		FV_PRCHS_PLC_NM     = ds_condition_tmp.GetColumn(0,"sPrchsPlcNm");
	}
	
	//확정 'Y', 매입채무등록 된 경우 수정 못하게.
	if(FV_IN_FIX_YN = "1" || FV_PRCHS_DEBT_FLAG = "1")
	{  
		div_search.cal_acc_dt.Enable = "false";
		grd_prchs_detail.Editable = "false";
		btn_add.Enable = "false";
		btn_del.Enable = "false";
		btn_save.Enable = "false";
	} else{
		grd_prchs_detail.Editable = "true";
		btn_add.Enable = "true";
		btn_del.Enable = "true";
		btn_save.Enable = "true";
	}
	
	cf_setParam(ds_condition, "ORG_CD", FV_ORG_CD);
	cf_setParam(ds_condition, "ACC_MTH", FV_ACC_MTH);
	cf_setParam(ds_condition, "PRCHS_PLC", FV_PRCHS_PLC_ID); 
	cf_setParam(ds_condition, "ACC_DT", FV_ACC_DT);
	
	//div_search.edt_ordPlcUkeyId.Text = sUkeyId;
	div_search.edt_ordPlcNm.Text = FV_ORG_NM;
	div_search.edt_prchsPlcNm.Text = FV_PRCHS_PLC_NM;
	
	f_getPrchsDcInfo();
}

/*******************************************************************************
 * @description    : 공통 폼 재호출 함수
*******************************************************************************/
function df_reSet(sArg)
{	
	 if(cf_isNewService(sArg)) // 신규
    {	
		f_setInit();
    }else{
		
		f_getCondition(sArg);
    }
	
}	

/*******************************************************************************
* 함수명 : f_callBack 
* 기능명 : 트랜잭션 콜백 
* 파라미터
1. sSvcID  : 서비스 아이디
*******************************************************************************/
function f_callBack(sSvcID)
{	
	if(sSvcID == "svcDetail")
    {   
		div_search.edt_ordPlcUkeyId.Enable = false;
        div_search.edt_ordPlcNm.Enable = false;
		div_search.edt_prchsPlcId.Enable = false;
		div_search.edt_prchsPlcNm.Enable = false;
		
		//f_countPrchsProd();	
    } else if(sSvcID == "svcPrchsQty"){
		//f_countPrchsProd();
    } else if(sSvcID == "svcProdCnt"){
		
		//매입기간 설정시 설정한 매입기간안에 입고된 상품 count
		PROD_CNT = ds_prod_cnt.GetColumn(0,"CNT");
		
    } else if(sSvcID == "svcPopup"){		
		//cf_copyDataSetPop(ds_prchs_detail, F_row, ds_prchs_detail_0, 0);	
		ds_prchs_detail.SetColumn(F_row,"PROD_NM",ds_disProdList.GetColumn(0,"PROD_NM"));
		ds_prchs_detail.SetColumn(F_row,"MFACT_CD",ds_disProdList.GetColumn(0,"MFACT_CD"));
		ds_prchs_detail.SetColumn(F_row,"DEAL_CO_NM",ds_disProdList.GetColumn(0,"DEAL_CO_NM"));
		ds_prchs_detail.SetColumn(F_row,"PRCHS_QTY",toNumber(ds_disProdList.Count("SER_NUM")));
		ds_prchs_detail.SetColumn(F_row,"PRCHS_AMT",toNumber(ds_disProdList.Sum("AMT")));
		cf_copyDataSet(ds_list, ds_disProdList,null,null,true);
		
    } else if(sSvcID == "svcInsertAll"){		
		
		alert(cf_getMessage(MSG_00006, "매입할인 저장이"));
		
		var sArg = ds_condition.GetColumn(0,"ORG_CD");
			sArg += ","+div_search.edt_ordPlcNm.Text;
			sArg += ","+div_search.edt_ordPlcUkeyId.Text;
			sArg += ","+substr(ds_condition.GetColumn(0,"ACC_DT"),0,6);
				
		gf_movenCall("100000104", "f_search", sArg);
	    this.Close();
	} else if(sSvcID == "svcDedtChk"){
		if(toNumber(ds_dedtChkTmp.GetColumn(0,"CNT")) >0){
		
			alert(cf_getMessage(MSG_00030, "매입채무 정산"));
			
			grd_prchs_detail.Editable = "false";
			btn_add.Enable = "false";
			btn_del.Enable = "false";
			btn_save.Enable = "false";
		}else{
			grd_prchs_detail.Editable = "true";
			btn_add.Enable = "true";
			btn_del.Enable = "true";
			btn_save.Enable = "true";
		}
	}
}

/*******************************************************************************
 * @description    : 제조사 팝업
 ******************************************************************************/
function btn_searchDealCo_OnClick(obj)
{
	cf_commPopDealCo("div_search.edt_DealCoCd", "div_search.edt_DealCoNm", "2;", 13);
}

function dealCo_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
{
	cf_commPopDealCo("div_search.edt_DealCoCd", "div_search.edt_DealCoNm", "2;", nChar);
}

/*******************************************************************************
 * @description    : 폼 로드시 세팅 
*******************************************************************************/
function f_init()
{
	if(prodCd != '') {
		prod_cd = eval("parent."+prodCd);
		ds_condition.SetColumn(0, "PROD_CD", prod_cd.text) ;
	}
	
	if(prodNm != '') {
		prod_nm = eval("parent."+prodNm);
	}

	F_SvcID = "svc_init";
	f_parentSearch();
} 



/*******************************************************************************
 * @description    : 폼 로드시 세팅 
*******************************************************************************/
function f_countPrchsProd(){

	var sSvcID 	= "svcProdCnt";
	var sInDs 	= "nc_input_fieldDs=ds_param";
	var sOutDs 	= "ds_prod_cnt=ds_prchs_cnt";
	var sArg	= "sktst.acc.PDS#getPrchsProdCnt";
	
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);	
}


/*******************************************************************************
 * @description    : 매입할인 수정, 조회 시 매입할인 상품목록 조회
*******************************************************************************/
function f_getPrchsDcInfo()
{
	var sSvcID = "svcDetail";
	var sInDs  = "nc_input_fieldDs=ds_condition";
	var sOutDs = "ds_prchs_detail=rs_prchsDcDetail ds_list=rs_serNumList";
	var sArg   = "sktst.acc.PDS#getPrchsDcDetail";
	
	// 공통 트랜잭션 호출
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg,null,true,true);	

}


/*******************************************************************************
 * @description    : 매입처 팝업 호출- 이벤트
*******************************************************************************/

function div_search_btn_prchs_OnClick(obj)
{
	var sArg  = "deal_co_cl1="+quote("30");

	cf_callDealPop(sArg, div_search, "edt_prchsPlcNm,edt_prchsPlcId");
}

/******************************************************************************
 * @description    : 기존 매입할인 조회
*****************************************************************************/
function f_getPrchsQty()
{
	var sSvcID = "svcPrchsQty";
	var sInDs = "nc_input_fieldDs=ds_condition";
	var sOutDs = "ds_prchs_qty=ds_prchs_qty";
	var sArg = "sktst.acc.PDS#getPrchsQty";
	
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}


/******************************************************************************
 * @description    : 로우 추가 - 이벤트
*****************************************************************************/
function btn_addRow_OnClick(obj)
{
	//필수 조회 조건 check 
	if(!f_checkPrchsDcInfo()){
		return false;
	}
		
	var oGrdDs = object(grd_prchs_detail.BindDataset);
	var nRow = oGrdDs.AddRow();
	
	
	ds_prchs_detail.SetColumn(nRow, "ORG_CD", ds_condition.GetColumn(0,"ORG_CD"));
	ds_prchs_detail.SetColumn(nRow, "ACC_MTH", substr(ds_condition.GetColumn(0,"ACC_DT"),0,6));
	ds_prchs_detail.SetColumn(nRow, "PRCHS_PLC", ds_condition.GetColumn(0,"PRCHS_PLC"));
	ds_prchs_detail.SetColumn(nRow, "FLAG", "I");
	ds_prchs_detail.SetColumn(nRow, "PRCHS_DC_CL", "1");
}


function f_checkPrchsDcInfo(){
	
	if(uf_isNull(trim(div_search.edt_ordPlcId.Text))){
		alert("대리점을 선택하십시오.");
		div_search.edt_ordPlcNm.SetFocus();
		return false;
	}else if(!uf_CheckDate(ds_condition.GetColumn(0,"ACC_DT"), "YYYYMMDD")){
		alert("정산일을 선택하십시오.");
		div_search.cal_acc_dt.SetFocus();
		return false;
	}else if(uf_isNull(ds_condition.GetColumn(0,"PRCHS_PLC")) ==true){
		alert("매입처를 선택하십시오.");
		div_search.edt_prchsPlcNm.SetFocus();
		return false;
	}

	return true;
}

/******************************************************************************
 * @description    : 매입할인 등록한 상품코드와 상품 팝업의 상품코드 중복 체크 
 *****************************************************************************/
function f_setProdDetailCd(){

	var sArrProdCd = "";
	
	if(ds_prchs_detail.rowcount() >1){
		for(var i=0;i<ds_prchs_detail.rowcount()-1; i++){
				
			if(i==0){
				sArrProdCd ="'";
			}
			sArrProdCd += ds_prchs_detail.GetColumn(i,"PROD_CD")+"','";
		}
	}
	
	if(sArrProdCd.length > 0){
		sArrProdCd = substr(sArrProdCd,0,(sArrProdCd.length()-2));
	}
	
	FV_ROW_PROD = sArrProdCd;
	
}


/******************************************************************************
 * @description    : 상품 팝업 상품구분, 매입수량, 매입금액 조회
 *****************************************************************************/
function btn_prodSearch_OnCellClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{
	//if(sInFixYn != "1" && cudFlag !="U")
	
	var oGrdDs = object(obj.BindDataset); // 바인드된 데이타셋 
	
		if(nCell == 1)
		{
			if(FV_PRCHS_DEBT_FLAG != "1"){
				cf_setGrdCalendar(obj, nRow, nCell);
			}
		}
		
		if(nCell == 2)
		{
			if(FV_PRCHS_DEBT_FLAG != "1"){
				if(!uf_CheckDate(ds_prchs_detail.GetColumn(nRow,"PRCHS_PRD_FROM"), "YYYYMMDD")){
					ds_prchs_detail.SetColumn(nRow,"PRCHS_PRD_TO",null);
					alert("매입기간 시작일을 선택해주십시오.");			
					return false;
				}else{
					cf_setGrdCalendar(obj, nRow, nCell);
				}
			}
		}
	
	// 미확정 && 매입채무정산 등록되지 않은 매입할인 건만 상품 추가,수정 가능 
	if(FV_PRCHS_DEBT_FLAG != "1" )
	{ 
		if (nCell==3) {
			
			if(!f_checkPrchsDcInfo()){
				return false;
			}else{
			
				if(ds_prchs_detail.GetColumn(nRow,"PRCHS_PRD_FROM")==null){
					alert("매입기간 시작일을 선택해주십시오.");
					return false;
				}else if(ds_prchs_detail.GetColumn(nRow,"PRCHS_PRD_TO")==null){
					alert("매입기간 종료일을 선택해주십시오.");
					return false;
				}
			}
						
			if(ds_prchs_detail.GetColumn(nRow,"PROD_CD") ==null && PROD_CNT <=0){
				alert("선택한 매입기간에 입고된 상품이 없습니다.");
				return false;
			}
						
			//기존에 매입할인 등록한 상품과 팝업을 이용해
			//신규로 등록하고자 하는 상품 과의 중복 check
			f_setProdDetailCd();
			
			ds_prchs_detail.AddColumn("EXC_PROD_CD");
			ds_prchs_detail.SetColumn(nRow,"EXC_PROD_CD",FV_ROW_PROD);
			
			if(ds_prchs_detail.GetColumn(nRow,"PROD_CD") !=null && ds_prchs_detail.GetColumn(nRow,"FLAG") =="U"){
				
				return false;
			}
			
			// 매입할인 대상이 되는 상품검색 팝업
			cf_commPopPrchsDs(ds_prchs_detail,nRow);
			
					
			if(ds_prchs_detail.GetColumn(nRow,"PROD_CD") !=null){
				
				F_row = nRow;
								
				cf_copyDataset(ds_inout, ds_prchs_detail, ds_prchs_detail.currow, true);				
				
				// 팝업에서 가져온 상품코드로 해당 상품의 매입수량과 매입할인을 가져옴
				btn_prodSearch_onClick();		
			}
		}
	}
	
	if(nCell == 5){
		var sInProdCd = ds_prchs_detail.GetColumn(nRow, "PROD_CD");
	    var sInMfactCd = ds_prchs_detail.GetColumn(nRow, "MFACT_CD");
	    var sInNrow = nRow;
	    var sInDebtFlag =FV_PRCHS_DEBT_FLAG;
	
		var sArg = "sProdCd=" + quote(sInProdCd);
		sArg += " sMfactCd=" + quote(sInMfactCd);
		sArg += " sNrow=" + quote(sInNrow);
		sArg += " sDebtFlag=" + quote(sInDebtFlag);
		
		dialog("ACC::ACCPDS00410.xml", sArg, 415, 333 );
	}
}


/******************************************************************************
 * @description    : 상품 팝업
 *****************************************************************************/
function btn_prodSearch_onClick(){

	var sSvcID = "svcPopup";
	var sInDs = "nc_input_fieldDs=ds_inout";
	var sOutDs = "ds_disProdList=rs_disProdList";
	var sArg = "sktst.acc.PDS#getDisProdInoutList";
	
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}
	
/*******************************************************************************
 * @description    : 매입할인 적용수량, 할인금액 체크
*******************************************************************************/
function grd_prchs_detail_OnChar(obj,strPreText,nChar,strPostText,nLLParam,nHLParam,nRow,nCell,nPivotIndex)
{
	
     //매입할인할인금액
     if( nCell == 9 ){
        
        if(strPreText != strPostText){
			var dPrchsAmt = ds_prchs_detail.GetColumn(nRow,"PRCHS_AMT");
            var dPrchsQty = ds_prchs_detail.GetColumn(nRow,"PRCHS_DC_QTY");
            
            if(!uf_IsNull(dPrchsAmt)){
				if(toNumber(strPostText) > toNumber(dPrchsAmt)){
					alert("매입할인금액은 매입금액보다 작은 수로 입력하십시오.");
					uf_SelPos(grd_prchs_detail,nRow,9);      
					return;  
				}
            } 
                  
            if(!uf_IsNull(dPrchsQty)){			
				ds_prchs_detail.SetColumn(nRow, "AVG_PRCHS_DC_AMT", round((toNumber(strPostText)/toNumber(dPrchsQty)),0));
            } else{
                  alert("매입할인 적용수량을 입력하십시오.");
            }
        }
     }
}



/******************************************************************************
 * @description    : 매입할인 상품 팝업
 *****************************************************************************/
function cf_commPopPrchsDs(dsParent, rowParent, callFunction)
{
	
	var dsParent="ds_prchs_detail";
	 var sArg  = "dsParent='"+dsParent+"'";
		 sArg += " rowParent='"+rowParent+"'";
		 sArg += " dsFlag=true";
		 sArg += " callFunction='"+callFunction+"'";
    
    // 팝업 함수
    dialog("ACC::ACCPDS00700.xml", sArg, 400,400);
}



/*******************************************************************************
 * @description    : 매입할인 내역 저장
*******************************************************************************/

function btn_save_onClick(obj)
{
	var dRowCnt = ds_prchs_detail.rowcount;
	var sArg ="";
	/*
	if(ds_condition.GetUpdate() == 0 && ds_prchs_detail.GetUpdate() == 0){
        alert(cf_getMessage(MSG_00071,"")); 
        return;
    }
	*/
	
	// 마감월 체크
    cf_CheckCloseDay('04',Left(cf_getDate(), 8),"저장일"); 
    if(FV_BOOLEAN_CLOSE) return; // 입력한 일자가 마감 되었을 경우 '1'(true) 리턴.
    
	if(dRowCnt == 0){
		alert(cf_getMessage(MSG_00043, "상품은")); 
		return false;
	}else{
				
		for(var iCnt = 0 ; iCnt < ds_prchs_detail.GetRowCount() ; iCnt ++ ){
		
			if(uf_IsNull(ds_prchs_detail.GetColumn(iCnt,"PROD_CD")) ){
    
				alert(cf_getMessage(MSG_00083, "모델"));
				
				uf_SelPos(grd_prchs_detail,iCnt,3);          
				return;
			}
		
			if(uf_IsNull(ds_prchs_detail.GetColumn(iCnt,"PRCHS_DC_CL")) ){
		
				alert(cf_getMessage(MSG_00083, "할인구분"));
				
				uf_SelPos(grd_prchs_detail,iCnt,7);          
				return;
			}
		
			if(uf_IsNull(ds_prchs_detail.GetColumn(iCnt,"PRCHS_DC_QTY")) ){
		
				alert(cf_getMessage(MSG_00083, "적용수량"));
				
				uf_SelPos(grd_prchs_detail,iCnt,8);          
				return;
			}
			
			if(uf_IsNull(ds_prchs_detail.GetColumn(iCnt,"PRCHS_DC_AMT")) ){
		
				alert(cf_getMessage(MSG_00083, "할인금액"));
				
				uf_SelPos(grd_prchs_detail,iCnt,9);          
				return;
			}
		}
	}
	
	
	if(Confirm("저장하시겠습니까?") == true) {
				
		cf_setParam(ds_condition, "ACC_MTH", substr(ds_condition.GetColumn(0,"ACC_DT"),0,6));
		cf_setParam(ds_condition, "PRCHS_QTY", ds_prchs_detail.sum("PRCHS_QTY"));
		cf_setParam(ds_condition, "PRCHS_AMT", ds_prchs_detail.sum("PRCHS_AMT"));
		cf_setParam(ds_condition, "PRCHS_DC_QTY", ds_prchs_detail.sum("PRCHS_DC_QTY"));
		cf_setParam(ds_condition, "PRCHS_DC_AMT", ds_prchs_detail.sum("PRCHS_DC_AMT"));
		
		cf_copyDataset(ds_prchs_detail, ds_prchs_detail_tmp, null, false, true);
		
		
		for(var i=0;i<dRowCnt;i++){
								
			ds_prchs_detail.SetColumn(i,"ACC_MTH", ds_condition.GetColumn(0,"ACC_MTH"));
		}
		
		//재고단가변경이력으로 insert 되는 일련번호들에 매입할인 단가 적용 
		f_setPrchsDcAmt();
		
		
		var sSvcID = "svcInsertAll";
		var sInDs = "nc_input_fieldDs=ds_condition rs_serNumList=ds_list:u ds_prchs_detail=ds_prchs_detail:u";
		var sOutDs = "";
		
		if(cudFlag == "I"){
			sArg = "sktst.acc.PDS#addPrchsDc";
		}else{
			sArg = "sktst.acc.PDS#updatePrchsDc";
		}
		
		// 공통 트랜잭션 호출
		cf_Transaction(sSvcID, sInDs, sOutDs, sArg,null,true,true);
		
	}
	
	
}

/*******************************************************************************
 * @description    : 매입할인 등록시 설정한 평균단가를 재고단가변경이력 상품들에 적용
*******************************************************************************/
function f_setPrchsDcAmt(){
	
	if(ds_prchs_detail.rowcount>0){
		for(var i=0; i<ds_prchs_detail.GetRowCount();i++){
			var sProdCdHst = ds_prchs_detail.GetColumn(i,"PROD_CD");
			var sMfactCdHst = ds_prchs_detail.GetColumn(i,"MFACT_CD");
			var sAvgDcAmtHst = ds_prchs_detail.GetColumn(i,"AVG_PRCHS_DC_AMT");
			
			for(var j=0; j<ds_list.GetRowCount();j++){
				var sProdCdDtl = ds_list.GetColumn(j,"PROD_CD");
				var sMfactCdDtl = ds_list.GetColumn(j,"MFACT_CD");
				
				if(sMfactCdDtl == sMfactCdHst && sProdCdDtl == sProdCdHst){
					ds_list.SetColumn(j,"AVG_PRCHS_DC_AMT",sAvgDcAmtHst);				
				}
			}
		
		}
	
	}
}
/*******************************************************************************
 * @description    : 매입할인 등록시 모델명 필수 입력 체크
*******************************************************************************/
function f_prodCdValidationCheck(){

	var nRow = ds_prchs_detail.rowcount;
	var nChk = 0;
	for (var i=0; i<nRow; i++) {
			if (ds_prchs_detail.GetRowType(i) == "insert" &&
				length(trim(ds_prchs_detail.GetColumn(i, "PROD_NM"))) ==0) {
				nChk++;
			}
		}
		
	if (nChk) {
		alert("'모델명'은 필수입력항목입니다.");
		return false;
	} 
	
	return true;
}

/*******************************************************************************
 * @description    : 로우 삭제 - 이벤트
*******************************************************************************/
function btn_delRow_OnClick(obj)
{
	var oGrdDs = object(grd_prchs_detail.BindDataset);
	var nRow = oGrdDs.row;
	
	if(!f_prchsDcProdCancel(oGrdDs,nRow)){
		return false;
	}
	
	oGrdDs.DeleteRow(oGrdDs.row);	
}



/*******************************************************************************
 * @description    : 상품 삭제 및 변경 시 일련번호 관리하는 dataset 삭제
*******************************************************************************/

 function f_prchsDcProdCancel(oGrdDs,nRow){
	
	var blnCheck=false;
	
	var sChkProdCd = oGrdDs.GetColumn(nRow,"PROD_CD");
	var sChkMfactCd = oGrdDs.GetColumn(nRow,"MFACT_CD");
	var sChkflag = oGrdDs.GetColumn(nRow,"FLAG");
	
	if(sChkflag=="I"){
	
		if(ds_list.GetRowCount() >0){
						
			var nTotCnt= ds_list.GetRowCount();
			for(var i=nTotCnt; i>=0; i--){
				var sChkInProdCd = ds_list.GetColumn(i,"prod_cd");
				var sChkInMfactCd = ds_list.GetColumn(i,"mfact_cd"); 
				
				if(sChkInProdCd == sChkProdCd && sChkInMfactCd == sChkMfactCd){
					ds_list.DeleteRow(i);
				}
			}
			
			blnCheck = true;
		}else{
			blnCheck = true;
		}
	}else if(sChkflag=="U"){
		if (confirm("이전 상품의 매입할인 단가이력이 삭제됩니다. 취소하시겠습니까?") == true) {
			
			if(ds_list.GetRowCount() >0){
				
				var nTotCnt= ds_list.GetRowCount();
				for(var i=nTotCnt; i>=0; i--){
					var sChkInProdCd = ds_list.GetColumn(i,"prod_cd");
					var sChkInMfactCd = ds_list.GetColumn(i,"mfact_cd"); 
					var sChkInFixYn = ds_list.GetColumn(i,"in_fix_yn_tmp"); 
					
					if(sChkInProdCd == sChkProdCd && sChkInMfactCd == sChkMfactCd){
						if(sChkInFixYn =="1"){
							ds_list.SetColumn(i,"IN_FIX_YN","0");
						}else if(sChkInFixYn =="0"){
							ds_list.DeleteRow(i);	
						}
					}
				}
				
				blnCheck = true;
			}else{
				blnCheck = true;
			}
		}
	}
	
	return blnCheck; 
 }
 
 
 
 /*******************************************************************************
 * @description    : 상품 삭제 및 변경 시 일련번호 관리하는 dataset 삭제
*******************************************************************************/

 function f_prchsDcProdUpdate(oGrdDs,nRow){
	
	var blnCheck=false;
	
	var sChkProdCd = oGrdDs.GetColumn(nRow,"PROD_CD");
	var sChkMfactCd = oGrdDs.GetColumn(nRow,"MFACT_CD");
	var sChkflag = oGrdDs.GetColumn(nRow,"FLAG");
	
	if(sChkflag=="U"){
		if (confirm("모델 변경시 이전 모델의 매입단가변경이력은 삭제됩니다. 변경하시겠습니까?") == true) {
		
			ds_prchs_detail_tmp.AddRow();
			ds_prchs_detail_tmp.CopyRow(ds_prchs_detail_tmp.lastrow,oGrdDs,nRow);
			ds_prchs_detail_tmp.SetColumn(ds_prchs_detail_tmp.lastrow, "FLAG", "D");
			
			
			if(ds_list.GetRowCount() >0){
				
				var nTotCnt= ds_list.GetRowCount();
				for(var i=nTotCnt; i>=0; i--){
					var sChkInProdCd = ds_list.GetColumn(i,"prod_cd");
					var sChkInMfactCd = ds_list.GetColumn(i,"mfact_cd"); 
					var sChkInFixYn = ds_list.GetColumn(i,"in_fix_yn_tmp"); 
					
					if(sChkInProdCd == sChkProdCd && sChkInMfactCd == sChkMfactCd){
						if(sChkInFixYn =="1"){
							ds_list.SetColumn(i,"IN_FIX_YN","0");
						}else if(sChkInFixYn =="0"){
							ds_list.DeleteRow(i);	
						}
					}
				}
				
				oGrdDs.SetColumn(nRow,"PRCHS_QTY",null);
				oGrdDs.SetColumn(nRow,"PRCHS_AMT",null);
				oGrdDs.SetColumn(nRow,"PRCHS_DC_CL",null);
				oGrdDs.SetColumn(nRow,"PRCHS_DC_QTY",null);
				oGrdDs.SetColumn(nRow,"PRCHS_DC_AMT",null);
				oGrdDs.SetColumn(nRow,"AVG_PRCHS_DC_AMT",null);
				blnCheck = true;
			}else{
				blnCheck = true;
			}
		}
	}
	
	return blnCheck; 
 }

/*******************************************************************************
 * @description    : 대리점 검색 팝업
*******************************************************************************/
function div_search_btn_ord_OnClick(obj)
{
	
	var sArg  = "org_id="+quote(gds_session.GetColumn(0,"orgId")); // 필수
	
	cf_callAgencyPop(sArg, div_search, "edt_ordPlcNm,edt_ordPlcId,edt_ordPlcUkeyId");	
}

/*******************************************************************************
 * @description    : 대리점 key down - 이벤트
*******************************************************************************/
function div_search_edt_ordPlcNm_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
{
	if(nChar == "13"){
		var sArg  = "org_id="+quote(gds_session.GetColumn(0,"orgId")); // 필수
		//cf_callAgencyPop(sArg, div_search, "edt_ordPlcNm,edt_ordPlcId,edt_ordPlcUkeyId");	
				
		if(ds_prchs_detail.GetUpdate() > 0 ){
			
			div_search.edt_ordPlcId.SetFocus(); 

			if(ds_condition_CanColumnChange()){
				cf_callAgencyPop(sArg, div_search, "edt_ordPlcNm,edt_ordPlcId,edt_ordPlcUkeyId");	
			}	
			
		}else{
			
			cf_callAgencyPop(sArg, div_search, "edt_ordPlcNm,edt_ordPlcId,edt_ordPlcUkeyId");	
		}
	}
}

/*******************************************************************************
 * @description    : 대리점 OnChar Changed 이벤트
*******************************************************************************/
function div_search_edt_ordPlcNm_OnCharChanged(obj,strPreText,strPostText)
{
	if(strPreText != strPostText){
		
		div_search.edt_ordPlcId.value = "";
		div_search.edt_ordPlcUkeyId.value = "";	
	}
}

/*******************************************************************************
 * @description    : 매입처 OnChar Changed 이벤트
*******************************************************************************/
/*
function div_search_edt_prchsPlcId_OnCharChanged(obj,strPreText,strPostText)
{
	if(strPreText != strPostText){
		div_search.edt_prchsPlcNm.Text = "";
		div_search.edt_prchsPlcId.Text = "";
	}
}
*/
/*******************************************************************************
 * @description    : 매입처 key down - 이벤트
*******************************************************************************/
function div_search_edt_prchsPlcId_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
{
	if(nChar == "13"){
		
		var sArg  = "deal_co_cl1="+quote("30"); 						
		//cf_callDealPop(sArg, div_search, "edt_prchsPlcNm,edt_prchsPlc");
		cf_callDealPop(sArg, div_search, "edt_prchsPlcNm,edt_prchsPlcId");
	}
}

function Button0_OnClick(obj)
{
	cf_debug("ds_list");
}


/*******************************************************************************
 * @description    : 조건절 데이터셋 변경 이벤트
*******************************************************************************/
function ds_condition_CanColumnChange(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
	if(strColumnID == "ORG_NM" || strColumnID == "PRCHS_PLC_NM")
    {
    
		if(ds_prchs_detail.GetUpdate() > 0)
		{
			if(Confirm(MSG_00163))
			{
				ds_prchs_detail.ClearData();
				
				if(strColumnID == "ORG_NM"){
				
					div_search.edt_ordPlcNm.value = "";
					div_search.edt_ordPlcId.value = "";
					div_search.edt_ordPlcUkeyId.value = "";					
					div_search.edt_ordPlcNm.SetFocus();
					
				}else if(strColumnID == "PRCHS_PLC_NM"){
				
					div_search.edt_prchsPlcNm.value = "";
					div_search.edt_prchsPlcId.value = "";
					div_search.edt_prchsPlcNm.SetFocus();
					
				}
				
				return true;
			}
			else
			{
				return false;
			}
		}
    }
}


/*******************************************************************************
 * @description    : 신규 등록시 선택한 조건에 해당하는 매입채무정산 데이터 체크
*******************************************************************************/
function ds_condition_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
	if(strColumnID == "ORG_CD" || strColumnID == "PRCHS_PLC" || strColumnID == "ACC_DT")
    {
        var sDedtChkOrgCd = div_search.edt_ordPlcId.Value;
        var sDedtChkPrchsPlcCd = div_search.edt_prchsPlcId.Value;
        var sDedtChkAccDt = div_search.cal_acc_dt.Value;
        
        if(sDedtChkOrgCd !="" && sDedtChkPrchsPlcCd !="" && sDedtChkAccDt !=""){
			
			cf_setParam(ds_dedtChk,"ORG_CD",sDedtChkOrgCd);
			cf_setParam(ds_dedtChk,"PRCHS_PLC",sDedtChkPrchsPlcCd);
			cf_setParam(ds_dedtChk,"ACC_MTH",substr(sDedtChkAccDt,0,6));
			
			var sSvcID 	= "svcDedtChk";
			var sInDs 	= "nc_input_fieldDs=ds_dedtChk";
			var sOutDs 	= "ds_dedtChkTmp=rs_dedtChk";
			var sArg	= "sktst.acc.PDS#getPrchsDedtCheck";
			
			cf_Transaction(sSvcID, sInDs, sOutDs, sArg);	
        
        }
    }
}






/*******************************************************************************
 * @description    : 엑셀 출력 - 이벤트
*******************************************************************************/
function btn_excel_OnClick(obj)
{
	cf_exportExcel(grd_prchs_detail);
}

/*******************************************************************************
 * @description    : 조건절 매입처 _OnCharChanged
*******************************************************************************/
function div_search_edt_prchsPlcNm_OnCharChanged(obj,strPreText,strPostText)
{
	if(strPreText != strPostText){
		div_search.edt_prchsPlcId.value = "";
	}
}

function Button1_OnClick(obj)
{
	cf_debug("ds_list");
}

function Button2_OnClick(obj)
{
	cf_debug("ds_list_tmp");
}

function ds_prchs_detail_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
	if(strColumnID="PROD_CD"){
		ds_prchs_detail.SetColumn(nRow,"PRCHS_DC_CL",null);
		ds_prchs_detail.SetColumn(nRow,"PRCHS_DC_QTY",null);
		ds_prchs_detail.SetColumn(nRow,"PRCHS_DC_AMT",null);
		ds_prchs_detail.SetColumn(nRow,"AVG_PRCHS_DC_AMT",null);
	}
	
	if(strColumnID="PRCHS_DC_QTY"){
		ds_prchs_detail.SetColumn(nRow,"PRCHS_DC_AMT",null);
		ds_prchs_detail.SetColumn(nRow,"AVG_PRCHS_DC_AMT",null);
	}
	
	
	if(strColumnID="PRCHS_PRD_FROM"){
		
		if(ds_prchs_detail.GetColumn(nRow,"PRCHS_PRD_TO") !=""){			
			
			if (ds_param.rowcount <= 0)
			{
				ds_param.AddRow();
			}
			
			cf_setParam(ds_param, "ORG_CD", ds_prchs_detail.GetColumn(nRow,"ORG_CD"));
			cf_setParam(ds_param, "PRCHS_PLC", ds_prchs_detail.GetColumn(nRow,"PRCHS_PLC"));
			cf_setParam(ds_param, "PRCHS_PRD_FROM", ds_prchs_detail.GetColumn(nRow,"PRCHS_PRD_FROM"));
			cf_setParam(ds_param, "PRCHS_PRD_TO", ds_prchs_detail.GetColumn(nRow,"PRCHS_PRD_TO"));
			
			//선택한 매입기간 안에 입고된 재고상품이 있는지 카운트
			f_countPrchsProd();
		}	
	}
	
	
	if(strColumnID="PRCHS_PRD_TO"){
		
		if(!uf_CheckDate(ds_prchs_detail.GetColumn(nRow,"PRCHS_PRD_FROM"), "YYYYMMDD")){
			ds_prchs_detail.SetColumn(nRow,"PRCHS_PRD_TO",null);
			alert("매입기간 시작일을 선택해주십시오.");			
			return false;
		}else{
			
			if (ds_param.rowcount <= 0)
			{
				ds_param.AddRow();
			}
			
			cf_setParam(ds_param, "ORG_CD", ds_prchs_detail.GetColumn(nRow,"ORG_CD"));
			cf_setParam(ds_param, "PRCHS_PLC", ds_prchs_detail.GetColumn(nRow,"PRCHS_PLC"));
			cf_setParam(ds_param, "PRCHS_PRD_FROM", ds_prchs_detail.GetColumn(nRow,"PRCHS_PRD_FROM"));
			cf_setParam(ds_param, "PRCHS_PRD_TO", ds_prchs_detail.GetColumn(nRow,"PRCHS_PRD_TO"));
			
			//선택한 매입기간 안에 입고된 재고상품이 있는지 카운트
			f_countPrchsProd();
		}
	}
	
}

function Button3_OnClick(obj)
{
	cf_debug("ds_prchs_detail_tmp");
}

function Button4_OnClick(obj)
{
	cf_debug("ds_param");
}
]]></Script>
</Window>