<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="592" Id="ADMADR00200" Left="8" OnLoadCompleted="ADMADR00200_OnLoadCompleted" OnUnloadCompleted="ADMADR00200_OnUnloadCompleted" PidAttrib="7" Title="나의공지대상주소록" Top="8" Ver="1.0" Width="830" WorkArea="true">
		<Datasets>
			<Dataset DataSetType="Dataset" Id="ds_group">
				<Contents>
					<colinfo id="code" size="256" summ="default" type="STRING"/>
					<colinfo id="text" size="256" summ="default" type="STRING"/>
					<record>
						<code></code>
						<text>선택</text>
					</record>
					<record>
						<code>ZBAS_C_00250</code>
						<text>사용자그룹</text>
					</record>
					<record>
						<code>ZBAS_C_00130</code>
						<text>영업별그룹</text>
					</record>
					<record>
						<code>ZBAS_C_00380</code>
						<text>소속구분별</text>
					</record>
					<record>
						<code>ZBAS_C_00240</code>
						<text>거래처구분별</text>
					</record>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_groupList">
				<Contents>
					<colinfo id="comm_cd_id" size="256" summ="default" type="STRING"/>
					<colinfo id="comm_cd_val" size="256" summ="default" type="STRING"/>
					<colinfo id="comm_cd_val_nm" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_myAddrList">
				<Contents>
					<colinfo id="USER_ID" size="255" summ="default" type="STRING"/>
					<colinfo id="USER_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="USER_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="NOTICE_GROUP" size="255" summ="default" type="STRING"/>
					<colinfo id="SEQ" size="15" summ="default" type="DECIMAL"/>
					<colinfo id="NOTICE_USER_ID" size="255" summ="default" type="STRING"/>
					<colinfo id="POS_AGENCY" size="255" summ="default" type="STRING"/>
					<colinfo id="POS_AGENCY_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="ORG_AREA" size="255" summ="default" type="STRING"/>
					<colinfo id="ORG_AREA_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="PHON_NUM" size="256" summ="default" type="STRING"/>
					<colinfo id="ORG_ID" size="255" summ="default" type="STRING"/>
					<colinfo id="ORG_NM" size="255" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset CanColumnChange="ds_myGroupList_CanColumnChange" CanRowPosChange="ds_myGroupList_CanRowPosChange" DataSetType="Dataset" Id="ds_myGroupList" OnRowPosChanged="ds_myGroupList_OnRowPosChanged">
				<Contents>
					<colinfo id="CHK" size="255" summ="default" type="STRING"/>
					<colinfo id="USER_ID" size="255" summ="default" type="STRING"/>
					<colinfo id="NOTICE_GROUP" size="255" summ="default" type="STRING"/>
					<colinfo id="REMARK" size="255" summ="default" type="STRING"/>
					<colinfo id="REG_DT" size="255" summ="default" type="STRING"/>
					<colinfo id="org_notice_group" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_input"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_userInfoList">
				<Contents>
					<colinfo id="notice_user_id" size="255" summ="default" type="STRING"/>
					<colinfo id="USER_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="USER_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="POS_AGENCY" size="255" summ="default" type="STRING"/>
					<colinfo id="POS_AGENCY_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="ORG_AREA" size="255" summ="default" type="STRING"/>
					<colinfo id="PHON_NUM" size="255" summ="default" type="STRING"/>
					<colinfo id="ORG_AREA_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="ORG_ID" size="255" summ="default" type="STRING"/>
					<colinfo id="ORG_NM" size="255" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_inMyAddrList">
				<Contents>
					<colinfo id="USER_ID" size="255" summ="default" type="STRING"/>
					<colinfo id="USER_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="USER_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="NOTICE_GROUP" size="255" summ="default" type="STRING"/>
					<colinfo id="SEQ" size="15" summ="default" type="DECIMAL"/>
					<colinfo id="NOTICE_USER_ID" size="255" summ="default" type="STRING"/>
					<colinfo id="POS_AGENCY" size="255" summ="default" type="STRING"/>
					<colinfo id="POS_AGENCY_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="ORG_AREA" size="255" summ="default" type="STRING"/>
					<colinfo id="ORG_AREA_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="PHON_NUM" size="256" summ="default" type="STRING"/>
					<colinfo id="ORG_ID" size="255" summ="default" type="STRING"/>
					<colinfo id="ORG_NM" size="255" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_vwMyAddrList">
				<Contents>
					<colinfo id="USER_ID" size="255" summ="default" type="STRING"/>
					<colinfo id="USER_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="USER_CD" size="255" summ="default" type="STRING"/>
					<colinfo id="NOTICE_GROUP" size="255" summ="default" type="STRING"/>
					<colinfo id="SEQ" size="15" summ="default" type="DECIMAL"/>
					<colinfo id="NOTICE_USER_ID" size="255" summ="default" type="STRING"/>
					<colinfo id="POS_AGENCY" size="255" summ="default" type="STRING"/>
					<colinfo id="POS_AGENCY_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="ORG_AREA" size="255" summ="default" type="STRING"/>
					<colinfo id="ORG_AREA_NM" size="255" summ="default" type="STRING"/>
					<colinfo id="PHON_NUM" size="256" summ="default" type="STRING"/>
					<colinfo id="ORG_ID" size="255" summ="default" type="STRING"/>
					<colinfo id="ORG_NM" size="255" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Div Border="Raised" Height="304" Id="div_group" Left="12" Style="sty_div_input" TabOrder="1" Text="Div0" Top="8" Width="196">
			<Contents>
				<List Border="Flat" CodeColumn="COMM_CD_VAL" DataColumn="COMM_CD_VAL_NM" Height="264" Id="lst_groupList" InnerDataset="ds_groupList" Left="4" OnChanged="div_group_lst_groupList_OnChanged" Style="sty_ipt_form" TabOrder="1" Top="30" Width="182"></List>
				<Combo Border="Flat" CodeColumn="code" DataColumn="text" Height="20" Id="cmb_group" ImeMode="none" InnerDataset="ds_group" Left="4" OnChanged="div_group_cmb_group_OnChanged" Style="sty_ipt_form" TabOrder="2" Top="4" Width="182"></Combo>
			</Contents>
		</Div>
		<Image Align="Left" Height="25" Id="Image1" ImageID="bul_tit" Left="13" LeftMargin="15" Style="sty_img_tit" TabOrder="2" Text="그룹" Top="317" Width="67"></Image>
		<Grid AutoFit="TRUE" BindDataset="ds_userInfoList" BkColor2="user32" BoldHead="true" Border="Flat" Bottom="312" ColSizing="TRUE" Enable="true" EndLineColor="default" FillArea="TRUE" FillAreaType="Control" HeadBorder="Flat" HeadHeight="22" Height="256" Id="grd_userInfoList" InputPanel="FALSE" Left="216" LineColor="user33" MinWidth="100" MultiSelect="TRUE" Right="816" RowHeight="21" Style="sty_Grid" TabOrder="3" TabStop="true" Top="56" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="user33" WheelScrollRow="1" Width="600">
			<contents>
				<format id="Default">
					<columns>
						<col width="150"/>
						<col width="150"/>
						<col width="140"/>
						<col width="140"/>
						<col width="140"/>
					</columns>
					<head>
						<cell bkcolor="user34" col="0" color="user35" display="text" text="소속대리점"/>
						<cell bkcolor="user34" col="1" color="user35" display="text" text="근무지"/>
						<cell bkcolor="user34" col="2" color="user35" display="text" text="사원번호"/>
						<cell bkcolor="user34" col="3" color="user35" display="text" text="사원명"/>
						<cell bkcolor="user34" col="4" color="user35" display="text" text="전화번호"/>
					</head>
					<body>
						<cell col="0" colid="POS_AGENCY_NM" display="text"/>
						<cell col="1" colid="ORG_AREA_NM" display="text"/>
						<cell col="2" colid="USER_CD" display="text"/>
						<cell col="3" colid="USER_NM" display="text"/>
						<cell col="4" colid="PHON_NUM" display="text" Mask="expr:iif(length(PHON_NUM)==10,&apos;###-###-####&apos;,&apos;###-####-####&apos;)"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Div Border="Raised" Height="40" Id="div_search" Left="216" Style="sty_div_search" TabOrder="4" Text="Div0" Top="8" Width="600">
			<Contents>
				<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="21" Id="btn_search" ImageID="btn_a_2" Left="215" LeftMargin="5" OnClick="div_search_btn_search_OnClick" Style="sty_btn_a" TabOrder="1" Text="조회" Top="6" Width="60"></Button>
				<Edit Border="Flat" Height="20" Id="edt_userNm" Left="84" LeftMargin="2" OnKeyDown="div_search_common_OnKeyDown" RightMargin="2" Style="sty_ipt_form" TabOrder="2" Top="7" Width="122"></Edit>
				<Static Align="Right" Height="20" Id="Static0" Left="5" Style="sty_lb_Search" TabOrder="3" Text="성명" Top="7" VAlign="Middle" Width="76"></Static>
			</Contents>
		</Div>
		<Button Cursor="HAND" Height="21" Id="btn_addGrp" ImageID="btn_i_add_w" Left="164" OnClick="btn_addGrp_OnClick" TabOrder="6" Text="Button1" ToolTipText="행추가" Top="320" Width="19"></Button>
		<Button Cursor="HAND" Height="21" Id="btn_subtractGrp" ImageID="btn_i_subtract_w" Left="188" OnClick="btn_subtractGrp_OnClick" TabOrder="5" Text="Button1" ToolTipText="추가된&#32;행삭제" Top="320" Width="19"></Button>
		<Grid AutoFit="TRUE" BindDataset="ds_vwMyAddrList" BkColor2="user32" BoldHead="true" Border="Flat" Bottom="557" ColSizing="TRUE" Enable="true" EndLineColor="default" FillArea="TRUE" FillAreaType="Control" HeadBorder="Flat" HeadHeight="22" Height="213" Id="grd_myAddrList" InputPanel="FALSE" Left="216" LineColor="user33" MinWidth="100" MultiSelect="TRUE" Right="816" RowHeight="21" Style="sty_Grid" TabOrder="7" TabStop="true" Top="344" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="user33" WheelScrollRow="1" Width="600">
			<contents>
				<format id="Default">
					<columns>
						<col width="101"/>
						<col width="108"/>
						<col width="190"/>
						<col width="190"/>
					</columns>
					<head>
						<cell bkcolor="user34" col="0" color="user35" display="text" text="성명"/>
						<cell bkcolor="user34" col="1" color="user35" display="text" text="전화번호"/>
						<cell bkcolor="user34" col="2" color="user35" display="text" text="근무지"/>
						<cell bkcolor="user34" col="3" color="user35" display="text" text="소속조직"/>
					</head>
					<body>
						<cell col="0" colid="USER_NM" display="text"/>
						<cell col="1" colid="PHON_NUM" display="text" Mask="expr:iif(length(PHON_NUM)==10,&apos;###-###-####&apos;,&apos;###-####-####&apos;)"/>
						<cell col="2" colid="ORG_AREA_NM" display="text"/>
						<cell col="3" colid="ORG_NM" display="text"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Grid AutoEnter="TRUE" AutoFit="TRUE" BindDataset="ds_myGroupList" BkColor2="user32" BoldHead="true" Border="Flat" Bottom="557" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" FillArea="TRUE" FillAreaType="Control" HeadBorder="Flat" HeadHeight="22" Height="213" Id="grd_myGroupList" InputPanel="FALSE" Left="8" LineColor="user33" MinWidth="100" MultiSelect="TRUE" OnCellClick="grd_myGroupList_OnCellClick" Right="208" RowHeight="21" Style="sty_Grid" TabOrder="8" TabStop="true" Top="344" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="user33" WheelScrollRow="1" Width="200">
			<contents>
				<format id="Default">
					<columns>
						<col width="101"/>
						<col width="180"/>
					</columns>
					<head>
						<cell bkcolor="user34" col="0" color="user35" display="text" text="그룹"/>
						<cell bkcolor="user34" col="1" color="user35" display="text" text="비고"/>
					</head>
					<body>
						<cell checklength="Byte" col="0" colid="NOTICE_GROUP" display="text" edit="normal" limit="30"/>
						<cell col="1" colid="REMARK" display="text" edit="normal" limit="100"/>
					</body>
				</format>
			</contents>
		</Grid>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="25" Id="btn_save" ImageID="btn_c_2" Left="752" LeftMargin="5" OnClick="btn_saveMulti_OnClick" Style="sty_btn_c" TabOrder="9" Text="저장" Top="560" Visible="FALSE" Width="64"></Button>
		<Button Cursor="HAND" Height="21" Id="btn_downAll" ImageID="btn_i_downall_b" Left="445" OnClick="btn_downAll_OnClick" TabOrder="10" Text="Button1" ToolTipText="모두아래쪽이동" Top="319" Width="19"></Button>
		<Button Cursor="HAND" Height="21" Id="btn_down" ImageID="btn_i_down_b" Left="470" OnClick="btn_down_OnClick" TabOrder="12" Text="Button1" ToolTipText="선택아래쪽이동" Top="319" Width="19"></Button>
		<Button Cursor="HAND" Height="21" Id="btn_upAll" ImageID="btn_i_upall_b" Left="560" OnClick="btn_upAll_OnClick" TabOrder="11" Text="Button1" ToolTipText="모두위쪽이동" Top="319" Width="19"></Button>
		<Button Cursor="HAND" Height="21" Id="btn_up" ImageID="btn_i_up_b" Left="535" OnClick="btn_up_OnClick" TabOrder="13" Text="Button1" ToolTipText="선택위쪽이동" Top="319" Width="19"></Button>
		<Image Align="Left" Height="25" Id="Image0" ImageID="bul_tit" Left="213" LeftMargin="15" Style="sty_img_tit" TabOrder="14" Text="주소록" Top="317" Width="67"></Image>
	</Form>
	<Script><![CDATA[/*******************************************************************************
* 프로그램ID 	: ADMADR00200
* 업무명      	: 커뮤니티- 나의 공지사항 수신자 관리
* 프로그램명  	: 공지사항 주소록 관리
--------------------------------------------------------------------------------
* 작성자      	: 전현주(junhyunjoo)
* 작성일      	: 2010.04.02
*******************************************************************************/

//==============================================================================
// 공통 스크립트 로딩
//==============================================================================
#include "lib::lib_commF.js"
#include "lib::lib_commMsg.js"
#include "lib::lib_commPopup.js"
#include "lib::lib_SAL.js"
#include "lib::lib_util.js"

/*******************************************************************************
 * @description    : 최초 폼 로드시 발생 - 이벤트
*******************************************************************************/
function ADMADR00200_OnLoadCompleted(obj)
{
	cf_setAuth(pFrmNum);	// 권한 공통
	f_init();
	
}


function f_init()
{
	http.Sync = true;
	
	cf_setGrdChecknSortEvent(grd_userInfoList); 
	
	f_setCombo();
	div_group_cmb_group_OnChanged();
	f_transMyGroupList();
	f_transMyAddrList();
	ds_myGroupList_OnRowPosChanged();
	http.Sync = false;
}

/*******************************************************************************
 * @description    : 콤보 설정
*******************************************************************************/
function f_setCombo()
{
	div_group.cmb_group.Index = 0;
	f_transGroup();

}



/*******************************************************************************
 * @description    : 콜백
 * @param sSvcID   : 서비스 아이디
*******************************************************************************/
function f_callBack(sSvcID)
{	
	
	switch(sSvcID)
	{
	case "svcSearch":
		//trace(ds_userInfoList.SaveXML());
		f_filterExistUserid();
		break;		

	
	case "svcUserInfoList":
		//trace(ds_userInfoList.SaveXML());
		f_filterExistUserid();
		break;		

	case "svcMyGroup":
		//trace(ds_myGroupList.SaveXML());
		break;	

	case "svcMyAddrList":
		//trace(ds_myAddrList.SaveXML());
		break;	
		
	case "svcSave":
		f_transMyGroupList();
		f_transMyAddrList();
		break;			
	default:
		break;
	}
}


/*******************************************************************************
 * @description    : 그룹콤보 설정
*******************************************************************************/
function f_transGroup()
{
	// 트랜잭션 설정
	var sSvcID = "svcGroupList";
	var sInDs  = "nc_input_fieldDs=ds_input";
	var sOutDs = "ds_groupList=List";
	var sArg   = "sktst.adm.ADR#getNoticeGroupList";
	
	// 공통 트랜잭션 호출
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}

/*******************************************************************************
 * @description    : 그룹콤보 설정
*******************************************************************************/
function f_transMyGroupList()
{
	// 트랜잭션 설정
	var sSvcID = "svcMyGroup";
	var sInDs  = "nc_input_fieldDs=ds_input";
	var sOutDs = "ds_myGroupList=List";
	var sArg   = "sktst.adm.ADR#getMyNoticeGroupList";
	
	// 공통 트랜잭션 호출
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}

/*******************************************************************************
 * @description    : 그룹콤보 설정
*******************************************************************************/
function f_transMyAddrList()
{
	ds_input.Clear();
	
	cf_setParam(ds_input, "user_nm", div_search.edt_userNm.Text); 
	
	// 트랜잭션 설정
	var sSvcID = "svcMyAddrList";
	var sInDs  = "nc_input_fieldDs=ds_input";
	var sOutDs = "ds_myAddrList=List";
	var sArg   = "sktst.adm.ADR#getMyNoticeList";
	
	// 공통 트랜잭션 호출
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}



/*******************************************************************************
 * @description    : 그룹 삭제 설정
*******************************************************************************/
function f_transDeleteGroup()
{
	ds_input.Clear();	
	var nRow = ds_myGroupList.currow;
	var sMyGroupList = ds_myGroupList.GetColumn(nRow, "notice_group");
	ds_myGroupList.DeleteRow(nRow);
	
	cf_setParam(ds_input, "notice_group", sMyGroupList); 

	// 트랜잭션 설정
	var sSvcID = "svcDeleteGroup";
	var sInDs  = "nc_input_fieldDs=ds_input";
	var sOutDs = "";
	var sArg   = "sktst.adm.ADR#deleteMyNoticeGroup";
	
	// 공통 트랜잭션 호출
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}

/*******************************************************************************
 * @description    : 데이터셋이동
*******************************************************************************/
function f_moveDataSet(oSrcDataset, oTargetDataset, bAll)
{
	var nRows = oSrcDataset.GetRowCount();
	
	if(nRows <= 0) return;
	
	if(bAll == true)
	{
		cf_copyDataSet(oTargetDataset, oSrcDataset, null, null, true);		
		oSrcDataset.DeleteAll();
	}
	else
	{
		for(var i=0; i < nRows ; i++)
		{
			if(oSrcDataset.GetSelect(i) == false) continue;
			cf_copyDataSet(oTargetDataset, oSrcDataset, i, null, true);	
		}
		oSrcDataset.DeleteSelected();
	}
}


/*******************************************************************************
 * @description    : 그룹변경 - 이벤트
*******************************************************************************/
function div_group_cmb_group_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
	var sGroupId = div_group.cmb_group.Value;
	ds_userInfoList.ClearData();
	if(sGroupId == "")
	{
		ds_groupList.Filter("comm_cd_id='X'");
	}
	else
	{
		ds_groupList.Filter("comm_cd_id=" + quote(sGroupId));
		div_group_lst_groupList_OnChanged();
	}	
}


/*******************************************************************************
 * @description    : 검색버튼 - 이벤트
*******************************************************************************/
function f_validSearch()
{
	if(uf_isNull(div_search.edt_userNm.Text) == true)
	{
		alert('성명을 입력하세요.');
		div_search.edt_userNm.SetFocus();
		return false;
	}
	return true;
}

/*******************************************************************************
 * @description    : 검색버튼 - 이벤트
*******************************************************************************/
function div_search_btn_search_OnClick(obj)
{
	if(f_validSearch() == false) return;
	
	// 트랜잭션 설정
	ds_input.Clear();
	cf_setParam(ds_input, "user_nm", div_search.edt_userNm.Text); 
	cf_setParam(ds_input, "org_id" , gds_session.GetColumn(0, "ORGID")); 
	
	var sSvcID = "svcSearch";
	var sInDs  = "nc_input_fieldDs=ds_input";
	var sOutDs = "ds_userInfoList=List";
	var sArg   = "sktst.adm.ADR#getNoticeUserList";
	
	// 공통 트랜잭션 호출
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}


/*******************************************************************************
 * @description    : 그룹추가 - 이벤트
*******************************************************************************/
function btn_addGrp_OnClick(obj)
{
	var nRow = ds_myGroupList.currow;
	
	if(nRow == -1) ds_myGroupList.addRow();
	if(uf_isNull(ds_myGroupList.GetColumn(nRow,"NOTICE_GROUP")) == true) return;
	
	if(ds_myGroupList.GetUpdate() == true)
	{
		if(Confirm("변경된 데이터가 존재합니다. \r\n 저장하시겠습니까?") == true)
		{
			btn_saveMulti_OnClick();			
		}
		else
		{
			return;
		}
	}
	var nRow = ds_myGroupList.addRow();	
	ds_myGroupList.row = nRow;
	grd_myGroupList.SetFocus();
	grd_myGroupList.SetCellPos(0);	
} 

/*******************************************************************************
 * @description    : 그룹삭제 - 이벤트
*******************************************************************************/
function btn_subtractGrp_OnClick(obj)
{
	var nRow   = ds_myGroupList.currow;
	
	if(nRow == -1) return;
	
	var sGrpNm = ds_myGroupList.GetColumn(nRow, "NOTICE_GROUP");
	
	if(ds_myGroupList.GetRowType(nRow) == "insert")
	{
		ds_myGroupList.DeleteRow(nRow);
	}
	else
	{
		if(Confirm("그룹 삭제시 해당그룹에 속한 데이터까지 삭제됩니다.\r\n삭제하시겠습니까?") == false) return;
		
		f_transDeleteGroup();
	}
}


/*******************************************************************************
 * @description    : 전체 아래로 이동 - 이벤트
*******************************************************************************/
function btn_downAll_OnClick(obj)
{
	var nRow = ds_myGroupList.currow;
	if(nRow== -1)
	{
		alert('선택된 그룹이 없습니다.');
		return;
	}
	
	f_moveDataSet(ds_userInfoList, ds_vwMyAddrList, true);
}

/*******************************************************************************
 * @description    :  선택항목 아래로 이동 - 이벤트
*******************************************************************************/
function btn_down_OnClick(obj)
{
	var nRow = ds_myGroupList.currow;
	if(nRow== -1)
	{
		alert('선택된 그룹이 없습니다.');
		return;
	}

	f_moveDataSet(ds_userInfoList, ds_vwMyAddrList);
}

/*******************************************************************************
 * @description    :  선택항목 위로 이동 - 이벤트
*******************************************************************************/
function btn_up_OnClick(obj)
{
	f_moveDataSet(ds_vwMyAddrList, ds_userInfoList);
}

/*******************************************************************************
 * @description    : 전체 위로 이동 - 이벤트
*******************************************************************************/
function btn_upAll_OnClick(obj)
{
	f_moveDataSet(ds_vwMyAddrList, ds_userInfoList, true);
}




/*******************************************************************************
 * @description    : 나의 그룹 항목 변경- 이벤트
*******************************************************************************/
function grd_myGroupList_OnCellClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{
	
	if(ds_vwMyAddrList.GetUpdate() == true)
	{
		if(Confirm("변경된 데이터가 존재합니다. \r\n 저장하시겠습니까?") == true)
		{
			btn_saveMulti_OnClick();			
		}
	}	
	
}


/*******************************************************************************
 * @description    : 그룹 항목 변경- 이벤트
*******************************************************************************/
function div_group_lst_groupList_OnChanged(obj,strCode,strText,nOldIndex,nNewIndex)
{
// 트랜잭션 설정
	ds_input.Clear();
	
	var sGrpCd = div_group.cmb_group.Value;

	switch(sGrpCd)
	{
	case "ZBAS_C_00250":	// 사용자그룹
		cf_setParam(ds_input, "user_grp", strCode); 
		break;
		
	case "ZBAS_C_00130":	// 영업별그룹
		cf_setParam(ds_input, "sale_grp", strCode); 
		break;
		
	case "ZBAS_C_00380":	// 소속구분별
		cf_setParam(ds_input, "attc_cat", strCode); 		
		break;
		
	case "ZBAS_C_00240":	// 거래처구분별
		cf_setParam(ds_input, "deal_co_cl1", strCode); 
		break;		
	
	default:
		break;
	}
	
	cf_setParam(ds_input, "org_id", gds_session.GetColumn(0, "ORGID")); 
	
	var sSvcID = "svcUserInfoList";
	var sInDs  = "nc_input_fieldDs=ds_input";
	var sOutDs = "ds_userInfoList=List";
	var sArg   = "sktst.adm.ADR#getNoticeUserList";
	
	// 공통 트랜잭션 호출
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg, null, true,true);	
}



/*******************************************************************************
 * @description    : 자장- 이벤트
*******************************************************************************/
function f_validSave()
{
	var nRow = ds_myGroupList.currow;
	if(nRow == -1)
	{
		alert('선택된 그룹이 없습니다.');
		return false;
	}
	if(uf_isNull(ds_myGroupList.GetColumn(nRow, "NOTICE_GROUP")) == true)
	{
		alert(cf_getMessage(MSG_00083, "그룹명"));
		
		ds_myGroupList.row = nRow;
		grd_myGroupList.SetFocus();
		grd_myGroupList.SetCellPos(0);
		return false;
	}
	
	return true;
}


/*******************************************************************************
 * @description    : 자장- 이벤트
*******************************************************************************/
function btn_saveMulti_OnClick(obj)
{

	if(ds_myGroupList.GetUpdate() == false && ds_vwMyAddrList.GetUpdate() == false)
	{
		alert(cf_getMessage(MSG_00071,""));
		return;	
	}
	
	if(f_validSave() == false) return;
	
	if(Confirm( "저장하시겠습니까?" ) == false) return;
	
	var nRow = ds_myGroupList.currow;

	ds_input.Clear();
	cf_setParam(ds_input, "FLAG"          , ds_myGroupList.GetRowType(nRow)); 
	cf_setParam(ds_input, "notice_group"    , ds_myGroupList.GetColumn(nRow, "notice_group")); 
	cf_setParam(ds_input, "remark"        , ds_myGroupList.GetColumn(nRow, "remark")); 
	cf_setParam(ds_input, "org_notice_group", ds_myGroupList.GetOrgColumn(nRow, "notice_group")); 
		
	var sSvcID = "svcSave";
	var sInDs  = "nc_input_fieldDs=ds_input ds_myAddrList=ds_vwMyAddrList";
	var sOutDs = "";
	var sArg   = "sktst.adm.ADR#saveNoticeAddr";

	// 공통 트랜잭션 호출
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);		
}


/*******************************************************************************
 * @description    :  등록된 UserId 걸러내기
*******************************************************************************/
function f_filterExistUserid()
{
	ds_userInfoList.Reset();
	
	var nCntUserInfo = ds_userInfoList.GetRowCount();
	var nCntMyAddr   = ds_vwMyAddrList.GetRowCount();
	
	for(var i=0; i < nCntMyAddr; i++)
	{
		var sAddrUserId = ds_vwMyAddrList.GetColumn(i, "NOTICE_USER_ID");
		
		for(var j=nCntUserInfo; j >= 0; j--)
		{
			var sUserId = ds_userInfoList.GetColumn(j, "NOTICE_USER_ID");
//			trace(sAddrUserId +"[" + i + "] / " + sUserId + "[" + j + "]");
			if(sAddrUserId == sUserId)
			{
				ds_userInfoList.DeleteRow(j);
				break;
			}
		}
	}
}


/*******************************************************************************
 * @description    :  나의 그룹 로우 변경 - 이벤트
*******************************************************************************/
function ds_myGroupList_CanRowPosChange(obj,nOldRow,nRow)
{
	if(ds_myGroupList.GetRowType(nOldRow) != "normal")
	{
		ds_myGroupList.row = nOldRow;
		grd_myGroupList.SetFocus();
		grd_myGroupList.SetCellPos(0);	
		if(Confirm("변경된 데이터가 존재합니다. \r\n 저장하시겠습니까?") == true)
		{
			btn_saveMulti_OnClick();			
		}			
		return false;
	}
	return true;
}


/*******************************************************************************
 * @description    :  나의 그룹 컬럼 변경 - 이벤트
*******************************************************************************/
function ds_myGroupList_CanColumnChange(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
	if(strColumnID != "NOTICE_GROUP") return true;
	var nRows = ds_myGroupList.GetRowCount();
	
	for(var i=0; i < nRows; i++)
	{
		if(nRow == i) continue;
		
		//trace("varNewValue:"+ varNewValue + "/" + ds_myGroupList.GetColumn(i, "ADDR_GROUP"));
		if(varNewValue == ds_myGroupList.GetColumn(i, "NOTICE_GROUP"))
		{
			alert("동일한 그룹명이 존재합니다.");
			ds_myGroupList.row = nRow;
			grd_myGroupList.SetFocus();
			grd_myGroupList.SetCellPos(0);			
			return false;
		}
	}	
	return true;			
}


/*******************************************************************************
 * @description    :  나의 그룹 로우 변경 - 이벤트
*******************************************************************************/
function ds_myGroupList_OnRowPosChanged(obj,nOldRow,nRow)
{	
	var sAddrGroup = ds_myGroupList.GetColumn(nRow, "NOTICE_GROUP");

	if(sAddrGroup == "")
	{
		ds_myAddrList.Filter("NOTICE_GROUP='X'");
	}
	else
	{
		ds_myAddrList.Filter("NOTICE_GROUP=" + quote(sAddrGroup));
	}
	
	ds_vwMyAddrList.ClearData();
	
	cf_copyDataSet(ds_vwMyAddrList, ds_myAddrList);	
	ds_vwMyAddrList.ApplyChange();
	
	f_filterExistUserid();
}


function ADMADR00200_OnUnloadCompleted(obj)
{
	if(ds_myGroupList.GetUpdate() == true || ds_vwMyAddrList.GetUpdate() == true)
	{
		if(confirm("변경된 데이타가 미반영 상태입니다. 이대로 종료 하시겠습니까?") == true)
		{
			return true;
		}
		return false;	
	}
}

function div_search_common_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
{
	if(nChar == "13"){
		div_search_btn_search_OnClick();
	}
}
]]></Script>
</Window>