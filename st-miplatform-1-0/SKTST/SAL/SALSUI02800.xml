<?xml version="1.0" encoding="utf-8"?>
<Window>
	<Form Height="600" Id="SALSUI02800" Left="8" OnLoadCompleted="SALSUI02800_OnLoadCompleted" PidAttrib="7" Title="OPMD&#32;인터페이스&#32;제외해제" Top="8" Ver="1.0" Width="1024" WorkArea="true">
		<Datasets>
			<Dataset CanRowPosChange="ds_list_CanRowPosChange" DataSetType="Dataset" Id="ds_generalSaleIfList" OnColumnChanged="ds_generalSaleIfList_OnColumnChanged">
				<Contents>
					<colinfo id="op_dt" size="256" summ="default" type="STRING"/>
					<colinfo id="op_tm" size="256" summ="default" type="STRING"/>
					<colinfo id="seq" size="256" summ="default" type="STRING"/>
					<colinfo id="if_rec_typ" size="256" summ="default" type="STRING"/>
					<colinfo id="ukey_agency_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="ukey_sub_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="ukey_channel_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="ukey_channel_sub_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="hld_agency" size="256" summ="default" type="STRING"/>
					<colinfo id="hld_agency_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="dis_hld_plc" size="256" summ="default" type="STRING"/>
					<colinfo id="dis_hld_plc_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="svc_plc" size="256" summ="default" type="STRING"/>
					<colinfo id="sale_plc" size="256" summ="default" type="STRING"/>
					<colinfo id="sale_plc_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="proc_cl" size="256" summ="default" type="STRING"/>
					<colinfo id="proc_cl_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="svc_mgmt_num1" size="256" summ="default" type="STRING"/>
					<colinfo id="svc_mgmt_num2" size="256" summ="default" type="STRING"/>
					<colinfo id="proc_dt" size="256" summ="default" type="STRING"/>
					<colinfo id="proc_tm" size="256" summ="default" type="STRING"/>
					<colinfo id="proc_user_id" size="256" summ="default" type="STRING"/>
					<colinfo id="proc_chgrg_id" size="256" summ="default" type="STRING"/>
					<colinfo id="proc_chgrg_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="cust_nm" size="256" summ="default" type="STRING"/>
					<colinfo id="svc_num" size="256" summ="default" type="STRING"/>
					<colinfo id="usim_mdl_cd" size="256" summ="default" type="STRING"/>
					<colinfo id="usim_ser_num" size="256" summ="default" type="STRING"/>
					<colinfo id="usim_allot_cl" size="256" summ="default" type="STRING"/>
					<colinfo id="usim_allot_prc" size="256" summ="default" type="STRING"/>
					<colinfo id="sale_chg_hst_cl" size="256" summ="default" type="STRING"/>
					<colinfo id="ps_apnd_yn" size="256" summ="default" type="STRING"/>
					<colinfo id="error_cl" size="256" summ="default" type="STRING"/>
					<colinfo id="rmks" size="256" summ="default" type="STRING"/>
					<colinfo id="sl_cl" size="256" summ="default" type="STRING"/>
					<colinfo id="chk" size="256" summ="default" type="STRING"/>
					<colinfo id="upd_cnt" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_input"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_generalSaleIfStatus">
				<Contents>
					<colinfo id="op_dt" size="256" summ="default" type="STRING"/>
					<colinfo id="op_tm" size="256" summ="default" type="STRING"/>
					<colinfo id="seq" size="256" summ="default" type="STRING"/>
					<colinfo id="ps_apnd_yn" size="256" summ="default" type="STRING"/>
					<colinfo id="bf_cnt" size="256" summ="default" type="STRING"/>
					<colinfo id="bf_ps_cnt" size="256" summ="default" type="STRING"/>
					<colinfo id="ps_apnd_cnt" size="256" summ="default" type="STRING"/>
					<colinfo id="ps_sl_cl" size="256" summ="default" type="STRING"/>
					<colinfo id="gnrl_sale_no" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cmbSaleChgHstCl">
				<Contents>
					<colinfo id="comm_cd_val" size="256" summ="default" type="STRING"/>
					<colinfo id="comm_cd_val_nm" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cmbCustCl">
				<Contents>
					<colinfo id="comm_cd_val" size="256" summ="default" type="STRING"/>
					<colinfo id="comm_cd_val_nm" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cmbUsimAllotCl">
				<Contents>
					<colinfo id="comm_cd_val" size="256" summ="default" type="STRING"/>
					<colinfo id="comm_cd_val_nm" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cmbEqpSettlCond">
				<Contents>
					<colinfo id="comm_cd_val" size="256" summ="default" type="STRING"/>
					<colinfo id="comm_cd_val_nm" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cmbFrgGrtInsuCl">
				<Contents>
					<colinfo id="comm_cd_val" size="256" summ="default" type="STRING"/>
					<colinfo id="comm_cd_val_nm" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cmbMnpCmmsCl">
				<Contents>
					<colinfo id="comm_cd_val" size="256" summ="default" type="STRING"/>
					<colinfo id="comm_cd_val_nm" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cmbScrbFeeCl">
				<Contents>
					<colinfo id="comm_cd_val" size="256" summ="default" type="STRING"/>
					<colinfo id="comm_cd_val_m" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cmbDsNetCd">
				<Contents>
					<colinfo id="comm_cd_val" size="256" summ="default" type="STRING"/>
					<colinfo id="comm_cd_val_nm" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cmbTAgrmtPrdCd">
				<Contents>
					<colinfo id="comm_cd_val" size="256" summ="default" type="STRING"/>
					<colinfo id="comm_cd_val_nm" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cmbAllotPrdCd">
				<Contents>
					<colinfo id="comm_cd_val" size="256" summ="default" type="STRING"/>
					<colinfo id="comm_cd_val_nm" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cmbSaleDtlTyp">
				<Contents>
					<colinfo id="comm_cd_val" size="256" summ="default" type="STRING"/>
					<colinfo id="comm_cd_val_nm" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_cmbIfRecTyp">
				<Contents>
					<colinfo id="comm_cd_val" size="256" summ="default" type="STRING"/>
					<colinfo id="comm_cd_val_nm" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_output"></Dataset>
			<Dataset DataSetType="Dataset" Id="ds_exceptHst">
				<Contents>
					<colinfo id="OP_DT" size="256" summ="default" type="STRING"/>
					<colinfo id="OP_TM" size="256" summ="default" type="STRING"/>
					<colinfo id="SEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="IF_REC_TYP" size="256" summ="default" type="STRING"/>
					<colinfo id="HST_SEQ" size="256" summ="default" type="STRING"/>
					<colinfo id="BF_STATUS" size="256" summ="default" type="STRING"/>
					<colinfo id="AF_STATUS" size="256" summ="default" type="STRING"/>
					<colinfo id="RMKS" size="256" summ="default" type="STRING"/>
					<colinfo id="SVC_MGMT_NUM" size="256" summ="default" type="STRING"/>
					<colinfo id="SVC_NUM" size="256" summ="default" type="STRING"/>
					<colinfo id="SALE_PLC" size="256" summ="default" type="STRING"/>
					<colinfo id="SL_CL" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
			<Dataset DataSetType="Dataset" Id="ds_saleChgrgId">
				<Contents>
					<colinfo id="user_id" size="256" summ="default" type="STRING"/>
					<colinfo id="user_nm" size="256" summ="default" type="STRING"/>
				</Contents>
			</Dataset>
		</Datasets>
		<Div Height="21" Id="Div0" Left="814" TabOrder="1" TabStop="FALSE" Text="Div2" Top="76" Width="208">
			<Contents>
				<Button Cursor="HAND" Height="21" Id="btn_ExcelExport" ImageID="btn_i_exceldown_w" Left="181" OnClick="Div0_btn_ExcelExport_OnClick" TabOrder="8" TabStop="FALSE" Text="Button1" ToolTipText="Excel&#32;Download" Width="19"></Button>
			</Contents>
		</Div>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="25" Id="btn_save" ImageID="btn_c_2" Left="888" LeftMargin="5" OnClick="btn_save_OnClick" Style="sty_btn_c" TabOrder="2" Text="저장" Top="568" Visible="FALSE" Width="60"></Button>
		<Button Align="Left" ButtonStyle="TRUE" Cursor="HAND" Height="25" Id="btn_cancel" ImageID="btn_d_2" Left="952" LeftMargin="5" OnClick="btn_close_OnClick" Style="sty_btn_d" TabOrder="3" Text="취소" Top="568" Width="60"></Button>
		<Div Border="Raised" Height="62" Id="div_condition" Left="10" Style="sty_div_search" TabOrder="4" TabStop="FALSE" Text="Div0" Top="10" Width="1004">
			<Contents>
				<Button Align="Left" ButtonStyle="TRUE" Height="21" Id="btn_search" ImageID="btn_a_2" Left="772" LeftMargin="5" OnClick="Div_Condition_btn_search_OnClick" Style="sty_btn_a" TabOrder="13" TabStop="FALSE" Text="조회" Top="30" Width="60"></Button>
				<Static Align="Right" Height="20" Id="Static9" Left="19" Style="sty_lb_Search" TabOrder="14" Text="처리기간" Top="7" VAlign="Middle" Width="60"></Static>
				<Calendar Border="Flat" ButtonImageID="btn_i_calendar" DayFont="Default,-1" HeaderBorder="NONE" HeaderFont="Default,-1" HeadStyle="sty_calendar_head" Height="20" Id="cal_procDtFr" Left="83" LeftMargin="2" MonthPopupBorder="RAISED" NullValue="&#32;" RightMargin="2" SaturdayTextColor="user28" Style="sty_calendar" SundayTextColor="user27" TabOrder="7" TodayColor="user26" Top="7" WeeksFont="Default,-1" WeekStyle="sty_calendar_week" Width="95"></Calendar>
				<Calendar Border="Flat" ButtonImageID="btn_i_calendar" DayFont="Default,-1" HeaderBorder="NONE" HeaderFont="Default,-1" HeadStyle="sty_calendar_head" Height="20" Id="cal_procDtTo" Left="199" LeftMargin="2" MonthPopupBorder="RAISED" NullValue="&#32;" RightMargin="2" SaturdayTextColor="user28" Style="sty_calendar" SundayTextColor="user27" TabOrder="8" TodayColor="user26" Top="7" WeeksFont="Default,-1" WeekStyle="sty_calendar_week" Width="95"></Calendar>
				<Static Align="Right" Height="20" Id="Static0" Left="180" Style="sty_lb_info" TabOrder="15" Text="~" Top="7" VAlign="Middle" Width="12"></Static>
				<Static Align="Right" Height="20" Id="Static1" Left="307" Style="sty_lb_Search" TabOrder="17" Text="대리점" Top="7" VAlign="Middle" Width="60"></Static>
				<Edit Border="Flat" Height="20" Id="edt_agencyCdNm" Left="371" MaxLength="10" OnCharChanged="div_condition_edt_agencyCdNm_OnCharChanged" OnKeyDown="Div_Condition_edt_agencyCdNm_OnKeyDown" Style="sty_ipt_form" TabOrder="9" Top="7" UpperOnly="TRUE" Width="116"></Edit>
				<Button Cursor="HAND" Height="20" Id="btn_agency" ImageID="btn_i_detail_b" Left="487" OnClick="div_condition_btn_agency_OnClick" OnKeyDown="Div_Condition_btn_agency_OnKeyDown" TabOrder="10" Text="Button0" Top="7" Width="20"></Button>
				<Edit Border="Flat" Enable="FALSE" Height="20" Id="edt_agencyUkeyCd" ImeMode="none" Left="507" MaxLength="10" Style="sty_ipt_form" TabOrder="5" Top="7" UpperOnly="TRUE" Width="57"></Edit>
				<Edit Border="Flat" Height="20" Id="edt_agencyCd" Left="563" MaxLength="10" Style="sty_ipt_form" TabOrder="4" Top="7" UpperOnly="TRUE" Visible="FALSE" Width="8"></Edit>
				<Edit Border="Flat" Height="20" Id="edt_salePlc" Left="915" LeftMargin="2" RightMargin="2" Style="sty_ipt_form" TabOrder="0" Top="7" Visible="FALSE" Width="11"></Edit>
				<Edit BindDataset="ds_input" Border="Flat" Enable="FALSE" Height="20" Id="edt_salePlcChannelCd" Left="869" LeftMargin="2" RightMargin="2" Style="sty_ipt_form" TabOrder="1" Top="7" Width="56"></Edit>
				<Edit BindDataset="ds_input" Border="Flat" Enable="FALSE" Height="20" Id="edt_salePlcSubCd" Left="828" LeftMargin="2" RightMargin="2" Style="sty_ipt_form" TabOrder="2" Top="7" Width="40"></Edit>
				<Edit BindDataset="ds_input" Border="Flat" Enable="FALSE" Height="20" Id="edt_salePlcUkeyCd" Left="771" LeftMargin="2" RightMargin="2" Style="sty_ipt_form" TabOrder="3" Top="7" Width="56"></Edit>
				<Button Height="21" Id="btn_payPlc" ImageID="btn_i_detail" Left="751" OnClick="div_condition_btn_payPlc_OnClick" OnKeyDown="Div_Condition_btn_payPlc_OnKeyDown" TabOrder="12" Text="Button0" Top="7" Width="19"></Button>
				<Edit Border="Flat" Height="20" Id="edt_salePlcNm" Left="636" LeftMargin="2" OnCharChanged="div_condition_edt_salePlcNm_OnCharChanged" OnKeyDown="div_condition_edt_slaePlcNm_OnKeyDown" RightMargin="2" Style="sty_ipt_form" TabOrder="11" Top="7" Width="120"></Edit>
				<Static Align="Right" Height="20" Id="Static3" Left="574" Style="sty_lb_Search" TabOrder="16" Text="판매처" Top="7" VAlign="Middle" Width="60"></Static>
				<Image Height="20" Id="Image0" ImageID="bul_mand" Left="16" TabOrder="18" TabStop="FALSE" Top="8" Transparent="TRUE" Width="20"></Image>
				<Image Height="20" Id="Image1" ImageID="bul_mand" Left="316" TabOrder="19" TabStop="FALSE" Top="8" Transparent="TRUE" Width="20"></Image>
				<Static Align="Right" Height="20" Id="Static4" Left="565" Style="sty_lb_Search" TabOrder="21" Text="담당자" Top="31" VAlign="Middle" Width="68"></Static>
				<Combo Border="Flat" CodeColumn="user_id" DataColumn="user_nm" Editable="TRUE" Height="20" Id="cmb_chgrg" InnerDataset="ds_saleChgrgId" Left="635" Search="FILTERED" Style="sty_ipt_form" TabOrder="20" Top="30" Width="137"></Combo>
				<Static Align="Right" Height="20" Id="Static2" Left="309" Style="sty_lb_Search" TabOrder="23" Text="영업구분" Top="30" VAlign="Middle" Width="60"></Static>
				<Combo Border="Flat" Height="20" Id="cmb_slCl" Left="370" Style="sty_ipt_form" TabOrder="22" Top="30" Width="110"></Combo>
			</Contents>
		</Div>
		<Grid AutoEnter="TRUE" BindDataset="ds_generalSaleIfList" BkColor2="user32" BoldHead="true" Border="Flat" Bottom="565" ColSizing="TRUE" Editable="TRUE" Enable="true" EndLineColor="default" FillArea="TRUE" FillAreaType="Control" FixedColSizing="TRUE" HeadBorder="Flat" HeadHeight="21" Height="464" Id="grd_generalSaleList" InputPanel="FALSE" Left="9" LineColor="user33" OnHeadClick="grd_generalSaleList_OnHeadClick" Right="1013" RowHeight="21" Style="sty_Grid" TabOrder="5" TabStop="FALSE" Top="101" UseDBuff="true" UsePopupMenu="true" UseSelColor="true" Visible="true" VLineColor="user33" WheelScrollRow="1" Width="1004">
			<contents>
				<format id="Default">
					<columns>
						<col fix="left" width="33"/>
						<col fix="left" width="34"/>
						<col fix="left" width="122"/>
						<col fix="left" width="67"/>
						<col fix="left" width="71"/>
						<col fix="left" width="71"/>
						<col width="80"/>
						<col width="80"/>
						<col width="146"/>
						<col width="134"/>
						<col width="140"/>
						<col width="74"/>
						<col width="80"/>
						<col width="62"/>
						<col width="80"/>
						<col width="80"/>
						<col width="66"/>
					</columns>
					<head>
						<cell bkcolor="user34" col="0" color="user35" display="text" text="선택"/>
						<cell bkcolor="user34" col="1" color="user35" display="text" text="번호"/>
						<cell bkcolor="user34" col="2" color="user35" display="text" text="U.Key처리일시"/>
						<cell bkcolor="user34" col="3" color="user35" display="text" text="처리구분"/>
						<cell bkcolor="user34" col="4" color="user35" display="text" text="전문유형"/>
						<cell bkcolor="user34" col="5" color="user35" display="text" text="처리자"/>
						<cell bkcolor="user34" col="6" color="user35" display="text" text="가입구분"/>
						<cell bkcolor="user34" col="7" color="user35" display="text" text="대리점"/>
						<cell bkcolor="user34" col="8" color="user35" display="text" text="판매점"/>
						<cell bkcolor="user34" col="9" color="user35" display="text" text="UKEY재고보유대리점"/>
						<cell bkcolor="user34" col="10" color="user35" display="text" text="재고보유처"/>
						<cell bkcolor="user34" col="11" color="user35" display="text" text="고객명"/>
						<cell bkcolor="user34" col="12" color="user35" display="text" text="개통번호"/>
						<cell bkcolor="user34" col="13" color="user35" display="text" text="결제조건"/>
						<cell bkcolor="user34" col="14" color="user35" display="text" text="모델코드"/>
						<cell bkcolor="user34" col="15" color="user35" display="text" text="일련번호"/>
						<cell bkcolor="user34" col="16" color="user35" display="text" text="비고"/>
					</head>
					<body>
						<cell align="center" bkcolor="expr:iif(rmks&#32;==&#32;null,&#32;&apos;default&apos;,&#32;&apos;User25&apos;)" col="0" colid="chk" display="checkbox" edit="checkbox"/>
						<cell align="center" bkcolor="expr:iif(rmks&#32;==&#32;null,&#32;&apos;default&apos;,&#32;&apos;User25&apos;)" col="1" display="text" expr="Row+1"/>
						<cell align="center" bkcolor="expr:iif(rmks&#32;==&#32;null,&#32;&apos;default&apos;,&#32;&apos;User25&apos;)" col="2" colid="proc_dtm" display="text"/>
						<cell align="center" bkcolor="expr:iif(rmks&#32;==&#32;null,&#32;&apos;default&apos;,&#32;&apos;User25&apos;)" col="3" colid="sale_chg_hst_cl" combocol="comm_cd_val" combodataset="ds_cmbSaleChgHstCl" combotext="comm_cd_val_nm" display="combo"/>
						<cell bkcolor="expr:iif(rmks&#32;==&#32;null,&#32;&apos;default&apos;,&#32;&apos;User25&apos;)" col="4" colid="if_rec_typ" combocol="comm_cd_val" combodataset="ds_cmbIfRecTyp" combotext="comm_cd_val_nm" display="combo"/>
						<cell align="left" bkcolor="expr:iif(rmks&#32;==&#32;null,&#32;&apos;default&apos;,&#32;&apos;User25&apos;)" col="5" colid="proc_user_chgrg" display="text"/>
						<cell align="left" bkcolor="expr:iif(rmks&#32;==&#32;null,&#32;&apos;default&apos;,&#32;&apos;User25&apos;)" col="6" colid="proc_cl_nm" display="text"/>
						<cell align="left" bkcolor="expr:iif(rmks&#32;==&#32;null,&#32;&apos;default&apos;,&#32;&apos;User25&apos;)" col="7" colid="ukey_agency_cd" display="text"/>
						<cell align="left" bkcolor="expr:iif(rmks&#32;==&#32;null,&#32;&apos;default&apos;,&#32;&apos;User25&apos;)" col="8" colid="sale_plc_nm" display="text"/>
						<cell align="left" bkcolor="expr:iif(rmks&#32;==&#32;null,&#32;&apos;default&apos;,&#32;&apos;User25&apos;)" col="9" colid="hld_agency_nm" display="text"/>
						<cell align="left" bkcolor="expr:iif(rmks&#32;==&#32;null,&#32;&apos;default&apos;,&#32;&apos;User25&apos;)" col="10" colid="dis_hld_plc_nm" display="text"/>
						<cell align="center" bkcolor="expr:iif(rmks&#32;==&#32;null,&#32;&apos;default&apos;,&#32;&apos;User25&apos;)" col="11" colid="cust_nm" display="text" expr='sf_formatString(cust_nm,&quot;#*##########&quot;)'/>
						<cell align="center" bkcolor="expr:iif(rmks&#32;==&#32;null,&#32;&apos;default&apos;,&#32;&apos;User25&apos;)" col="12" colid="svc_num" display="text" expr='sf_formatString(SVC_NUM,&#32;&quot;###-##**-#*******&quot;)'/>
						<cell align="left" bkcolor="expr:iif(rmks&#32;==&#32;null,&#32;&apos;default&apos;,&#32;&apos;User25&apos;)" col="13" colid="usim_allot_cl" display="text"/>
						<cell align="center" bkcolor="expr:iif(rmks&#32;==&#32;null,&#32;&apos;default&apos;,&#32;&apos;User25&apos;)" col="14" colid="usim_mdl_cd" display="text"/>
						<cell align="center" bkcolor="expr:iif(rmks&#32;==&#32;null,&#32;&apos;default&apos;,&#32;&apos;User25&apos;)" col="15" colid="usim_ser_num" display="text"/>
						<cell align="left" bkcolor="expr:iif(rmks&#32;==&#32;null,&#32;&apos;default&apos;,&#32;&apos;User25&apos;)" checklength="Byte" col="16" colid="rmks" display="text" edit="expr:iif(chk&#32;=&#32;1,&#32;&apos;normal&apos;,&#32;&apos;none&apos;)" limit="998"/>
					</body>
				</format>
			</contents>
		</Grid>
	</Form>
	<Script><![CDATA[/*******************************************************************************
* 프로그램ID : SALSUI02800
* 업무명      : OPMD전문관리
* 프로그램명  :
--------------------------------------------------------------------------------
* 작성자      : 이문규
* 작성일      : 2009.03.19
--------------------------------------------------------------------------------
* 1. 변경이력
수정자    :
수정일    :
수정 내역 :
*******************************************************************************/

//==============================================================================
// 공통 스크립트 로딩
//==============================================================================
#include "lib::lib_commF.js"
#include "lib::lib_commPopup.js"
#include "lib::lib_commMsg.js"
#include "lib::lib_SAL.js"
#include "lib::lib_util.js"

//==============================================================================
// 폼 변수 정의
//==============================================================================
var	FV_ORG_ID;				// 소속
var	FV_ORG_NM;				// 소속명
var	FV_ORG_CL;				// 소소구분

var FV_UKEY_IF_YN;          //이전화면 Ukey If 현황여부
var	FV_OP_DT_FR;            //조회일시 FROM
var	FV_OP_DT_TO;            //조횡리시 썌
var	FV_POS_AGENCY_NM;       //대리점명
var	FV_POS_AGENCY_UKEY;     //대리점 Ukey 코드
var	FV_POS_AGENCY_PS;       //대리점 Ps 코드
var	FV_SALE_PLC_NM;         //판매처명
var	FV_UKEY_AGENCY_CD;      //판매처 Ukey 코드
var	FV_UKEY_SUB_CD;         //판매처 sub 코드
var	FV_UKEY_CHANNEL_CD;     //판매처 channel 코드
var	FV_SALE_PLC;            //판매처 Pszhem

var FV_USER_GRP;
var FV_DEAL_CO_CL1;

var FV_VAL;
/*
var OP_DT_FR;
var OP_DT_TO;
var POS_AGENCY_NM;
var POS_AGENCY_UKEY;
var POS_AGENCY_PS;
var SALE_PLC_NM;
var UKEY_AGENCY_CD;
var UKEY_SUB_CD;
var UKEY_CHANNEL_CD;
var SALE_PLC;
*/

var FV_T_OP_DT_FR;
var FV_T_OP_DT_TO;
var FV_T_POS_AGENCY_NM;
var FV_T_POS_AGENCY_UKEY;
var FV_T_POS_AGENCY_PS;
var FV_T_SALE_PLC_NM;
var FV_T_UKEY_AGENCY_CD;
var FV_T_UKEY_SUB_CD;
var FV_T_UKEY_CHANNEL_CD;
var FV_T_SALE_PLC;

var FV_PS_SL_CL;     //ps 영업구분
var FV_GNRL_SALE_NO; //ps OPMD번호

var FV_ALREADY;
/*******************************************************************************
 * @description    : 최초 폼 로드시 발생 - 이벤트
*******************************************************************************/
function SALSUI02800_OnLoadCompleted(obj)
{
	cf_setAuth(pFrmNum);	// 권한 공통
	cf_setGrdChecknSortEvent(grd_generalSaleList);	// 그리드 정렬


	http.Sync = true;

    lf_getParam();
    lf_getSession();
    lf_combomInit();
	lf_formInit();

	sf_enableSlCLByAuth(div_condition.cmb_slCl);

	if(uf_getAuthCode() == 2)
	{
		f_getSaleChgrgId();
		//uf_enableChgrgByAuth(div_condition.cmb_chgrg);
	}
	http.Sync = false;
}

function lf_reload()
{
    lf_getParam();
	lf_formInit();
}

function df_reSet(sArg)
{

	if(uf_isNull(sArg) == true)
	{

	}
	else
	{
		cf_setArg("ds_ref", sArg);

		cf_init(div_condition);
		ds_generalSaleIfList.DeleteAll();

		OP_DT_FR        = ds_ref.GetColumn(0,"OP_DT_FR");
		OP_DT_TO        = ds_ref.GetColumn(0,"OP_DT_TO");
		POS_AGENCY_NM   = ds_ref.GetColumn(0,"POS_AGENCY_NM");
		POS_AGENCY_UKEY = ds_ref.GetColumn(0,"POS_AGENCY_UKEY");
		POS_AGENCY_PS   = ds_ref.GetColumn(0,"POS_AGENCY_PS");
		SALE_PLC_NM     = ds_ref.GetColumn(0,"SALE_PLC_NM");
		UKEY_AGENCY_CD  = ds_ref.GetColumn(0,"UKEY_AGENCY_CD");
		UKEY_SUB_CD     = ds_ref.GetColumn(0,"UKEY_SUB_CD");
		UKEY_CHANNEL_CD = ds_ref.GetColumn(0,"UKEY_CHANNEL_CD");
		SALE_PLC        = ds_ref.GetColumn(0,"SALE_PLC");

		FV_ORD_MGMT_NO    = ds_ref.GetColumn(0,"sOrdMgmtNo");
		FV_PARENT_PAGE_NO = ds_ref.GetColumn(0,"sParentPageNo");
		//SALSUI02800_OnLoadCompleted();

		FV_VAL = "Y";

		FV_T_OP_DT_FR        = ds_ref.GetColumn(0,"OP_DT_FR");
		FV_T_OP_DT_TO        = ds_ref.GetColumn(0,"OP_DT_TO");
		FV_T_POS_AGENCY_NM   = ds_ref.GetColumn(0,"POS_AGENCY_NM");
		FV_T_POS_AGENCY_UKEY = ds_ref.GetColumn(0,"POS_AGENCY_UKEY");
		FV_T_POS_AGENCY_PS   = ds_ref.GetColumn(0,"POS_AGENCY_PS");
		FV_T_SALE_PLC_NM     = ds_ref.GetColumn(0,"SALE_PLC_NM");
		FV_T_UKEY_AGENCY_CD  = ds_ref.GetColumn(0,"UKEY_AGENCY_CD");
		FV_T_UKEY_SUB_CD     = ds_ref.GetColumn(0,"UKEY_SUB_CD");
		FV_T_UKEY_CHANNEL_CD = ds_ref.GetColumn(0,"UKEY_CHANNEL_CD");
		FV_T_SALE_PLC        = ds_ref.GetColumn(0,"SALE_PLC");

		FV_ORD_MGMT_NO    = ds_ref.GetColumn(0,"sOrdMgmtNo");
		FV_PARENT_PAGE_NO = ds_ref.GetColumn(0,"sParentPageNo");
		lf_reload();
	}
}



/*******************************************************************************
 * @description    : 글로벌 섹션 정보
*******************************************************************************/
function lf_getSession()
{
	FV_ORG_ID   = gds_session.GetColumn(0, "orgid");	// 소속
	FV_ORG_NM   = gds_session.GetColumn(0, "orgnm");	// 소속명
	FV_ORG_CL   = gds_session.GetColumn(0, "orgcl");	// 소속구분
	FV_USER_GRP = gds_session.GetColumn(0, "userGrp");  //사용자 그룹
}

/*******************************************************************************
 * @description    : 글로벌 섹션 정보
*******************************************************************************/
function lf_getParam()
{

    if ( IsExistVar("OP_DT_FR",true) )
    {

        FV_UKEY_IF_YN      = "Y";
		FV_OP_DT_FR        = OP_DT_FR;
		FV_OP_DT_TO        = OP_DT_TO;
		FV_POS_AGENCY_NM   = POS_AGENCY_NM;
		FV_POS_AGENCY_UKEY = POS_AGENCY_UKEY;
		FV_POS_AGENCY_PS   = POS_AGENCY_PS;
		FV_SALE_PLC_NM     = SALE_PLC_NM;
		FV_UKEY_AGENCY_CD  = UKEY_AGENCY_CD;
		FV_UKEY_SUB_CD     = UKEY_SUB_CD;
		FV_UKEY_CHANNEL_CD = UKEY_CHANNEL_CD;
		FV_SALE_PLC        = SALE_PLC;


    }
    else
    {

        if ( FV_VAL == "Y" )
        {

            FV_UKEY_IF_YN      = "Y";
			FV_OP_DT_FR        = FV_T_OP_DT_FR;
			FV_OP_DT_TO        = FV_T_OP_DT_TO;
			FV_POS_AGENCY_NM   = FV_T_POS_AGENCY_NM;
			FV_POS_AGENCY_UKEY = FV_T_POS_AGENCY_UKEY;
			FV_POS_AGENCY_PS   = FV_T_POS_AGENCY_PS;
			FV_SALE_PLC_NM     = FV_T_SALE_PLC_NM;
			FV_UKEY_AGENCY_CD  = FV_T_UKEY_AGENCY_CD;
			FV_UKEY_SUB_CD     = FV_T_UKEY_SUB_CD;
			FV_UKEY_CHANNEL_CD = FV_T_UKEY_CHANNEL_CD;
			FV_SALE_PLC        = FV_T_SALE_PLC;
    	}
		else
		{
            FV_UKEY_IF_YN      = "N";
			FV_POS_AGENCY_NM   = gds_session.GetColumn(0,"posAgencyNm");
			FV_POS_AGENCY_PS   = gds_session.GetColumn(0,"posAgencyId");
			FV_POS_AGENCY_UKEY = gds_session.GetColumn(0,"posAgencyUkeyId");

			FV_SALE_PLC_NM     = gds_session.GetColumn(0,"orgAreaNm");
			FV_UKEY_AGENCY_CD  = gds_session.GetColumn(0,"orgAreaAgencyCd");
			FV_UKEY_SUB_CD     = gds_session.GetColumn(0,"orgAreaUkeySubCd");
			FV_UKEY_CHANNEL_CD = gds_session.GetColumn(0,"orgAreaUkeyChannelCd");
			FV_SALE_PLC        = gds_session.GetColumn(0,"orgAreaId");
		}
    }
   // alert("FV_UKEY_IF_YN : " + FV_UKEY_IF_YN);
}

/*******************************************************************************
 * @description         : 콤보DataSet 초기화
*******************************************************************************/
function lf_combomInit()
{
    http.Sync = true;
	// 공통 코드를 위한 데이타셋 설정
	cf_setCommonCodeDsEnv();

	cf_setCommonCode("ds_cmbSaleChgHstCl"   , "ZSAL_C_00110");	 //변경구분
	cf_setCommonCode("ds_cmbCustCl"         , "ZSAL_C_00220");   //고객구분
	cf_setCommonCode("ds_cmbUsimAllotCl"    , "ZSAL_C_00020");	 //USIM 결제조건
	cf_setCommonCode("ds_cmbEqpSettlCond"   , "ZSAL_C_00030");	 //단말기 결제조건
	cf_setCommonCode("ds_cmbScrbFeeCl"      , "ZSAL_C_00130");   //SKT예수금 - 가입비
	cf_setCommonCode("ds_cmbMnpCmmsCl"      , "ZSAL_C_00150");   //SKT예수금 - 번호이동수수류
	cf_setCommonCode("ds_cmbFrgGrtInsuCl"   , "ZSAL_C_00210");   //SKT예수금 - 외국인보증보험료
	cf_setCommonCode("ds_cmbSaleDtlTyp"     , "ZPOL_C_00040");    //판매세부유형

	cf_setCommonCode("ds_cmbDsNetCd"        , "ZPOL_C_00110");	 //판매정보 - 유통망
	cf_setCommonCode("ds_cmbTAgrmtPrdCd"    , "ZPOL_C_00230");	 //판매정보 - 약정기간
	cf_setCommonCode("ds_cmbAllotPrdCd"     , "ZPOL_C_00230");   //판매정보 - 결제조건 - 결제기간코드

	cf_setCommonCode("ds_cmbIfRecTyp"     , "ZBAS_C_00350");   //전문유형
	cf_setCommonCode("div_condition.cmb_slCl" , "ZSAL_C_00260", "전체");   //영업구분
	cf_checkCommonCode();
}

/*******************************************************************************
 * @description         : 폼 초기화
*******************************************************************************/
function lf_formInit(oDsArgs)
{
    //FV_DEAL_CO_CL1 = sf_getDealCoCl1();  //사용자그룹에 따른 거래처조회구분(센터이상일 경우 A2,A3,B1,B2 거래처구분)


    if ( sf_getArguments("sale_dtm_from",oDsArgs ) != "" )
    {

        div_condition.cal_procDtFr.Value        = sf_getArguments("sale_dtm_from",oDsArgs );
        div_condition.cal_procDtTo.Value        = sf_getArguments("sale_dtm_to",oDsArgs );

        //대리점
		div_condition.edt_agencyCdNm.Text       = sf_getArguments("agency_nm",oDsArgs );
		div_condition.edt_agencyUkeyCd.Text     = sf_getArguments("agency_ukey",oDsArgs );
		div_condition.edt_agencyCd.Text         = sf_getArguments("agency_cd",oDsArgs );

		//판매처
		div_condition.edt_salePlcNm.Text        = sf_getArguments("sale_plc_nm",oDsArgs );
		div_condition.edt_salePlcUkeyCd.Text    = sf_getArguments("sale_plc_ukey",oDsArgs );
		div_condition.edt_salePlcSubCd.Text     = sf_getArguments("sale_plc_sub",oDsArgs );
		div_condition.edt_salePlcChannelCd.Text = sf_getArguments("sale_plc_channel",oDsArgs );
		div_condition.edt_salePlc.Text          = sf_getArguments("sale_plc",oDsArgs );
		div_condition.cmb_slCl.Value            = sf_getArguments("sl_cl",oDsArgs );

		f_getSaleChgrgId();
		div_condition.cmb_chgrg.Value           = sf_getArguments("chgrg",oDsArgs );

		div_condition.btn_search.Click();
    }
    else
    {
        //조회 기간
        var sToDay = toDay();

        div_condition.cal_procDtFr.Value = sToDay;
        div_condition.cal_procDtTo.Value = sToDay;
    }
	uf_enableAgencyByAuth("div_condition" ,"edt_agencyCdNm,edt_agencyCd,btn_agency","edt_agencyUkeyCd");
	uf_enableDealByAuth("div_condition" ,"edt_salePlcNm,edt_salePlc,btn_payPlc","edt_agencyUkeyCd,edt_salePlcSubCd,edt_salePlcChannelCd");


}
/*******************************************************************************
 * @description         : 판매정보 Ukey Interface 조회
*******************************************************************************/
function lf_getGeneralSaleIf()
{
    var sAgencyCd  = "";
    var sSubCd     = "";
    var sChannelCd = "";
    var sSalePlc   = "";
    var sSlCl = "";
    var sParamSlCl = "";

    //조회조건 check

    sSalePlc = div_condition.edt_salePlc.Text;

    if ( uf_IsNull(div_condition.edt_salePlc.Text) )
    {
        //판매처 입력이 없을때
        if ( !uf_IsNull(div_condition.edt_agencyCd.Text ) )
        {
            sAgencyCd  = div_condition.edt_agencyUkeyCd.Text;
        }
    }
    else
    {
        //판매처 입력이 있을대
        sAgencyCd  = div_condition.edt_salePlcUkeyCd.Text;
        sSubCd     = div_condition.edt_salePlcSubCd.Text;
        sChannelCd = div_condition.edt_salePlcChannelCd.Text;
    }

    //var sUserGrp = gds_session.GetColumn(0,"userGrp");
/*
	if(parent.pFrmNum == "100000236" && FV_UKEY_IF_YN = 'N')
	{	// 소매메뉴
		sSlCl = "01";
	}
	else if(parent.pFrmNum == "100000366")
	{	// 도매메뉴
		sSlCl = "02";
	}
	else if(parent.pFrmNum == "100000360")
	{	// 온라인소매메뉴
		sSlCl = "03";
	}
	else if(parent.pFrmNum == "100000365")
	{	// 온라인도매메뉴
		sSlCl = "04";
	}
	else
	{
		if ( FV_USER_GRP == "30")      //소매
		{
			sSlCl = "01";
		}
		else if (FV_USER_GRP == "40")  //도매
		{
			sSlCl = "02";
		}
		else if (FV_USER_GRP == "50")  //온라인 소매
		{
			sSlCl = "03";
		}
		else if (FV_USER_GRP == "60")  //온라인 도매
		{
			sSlCl = "04";
		}
		else
		{
			//센터 기타...... ??????
			sSlCl = "";
		}
	}
*/
    //if (FV_UKEY_IF_YN != "Y")
    //{
//        sParamSlCl = sSlCl;
    //}
     //   alert(sSlCl);
    //조회 조건
    //ds_input
    cf_setParam(ds_input, "proc_dt_fr"     , div_condition.cal_procDtFr.Value );  //조회일자-FROM
    cf_setParam(ds_input, "proc_dt_to"     , div_condition.cal_procDtTo.Value );  //조회일자-TO
    cf_setParam(ds_input, "agency_cd"      , sAgencyCd );   //대리점
    cf_setParam(ds_input, "sub_cd"         , sSubCd );      //판매처
    cf_setParam(ds_input, "channel_cd"     , sChannelCd );  //판매처
    cf_setParam(ds_input, "sale_plc"       , sSalePlc );    //판매처 PS
    cf_setParam(ds_input, "sl_cl"          , div_condition.cmb_slCl.Value );  //영업망
    cf_setParam(ds_input, "ps_apnd_yn"     , "Z"); 	// 미적용만 보이기
    cf_setParam(ds_input, "chgrg"          , div_condition.cmb_chgrg.Value);

 	var sSvcID = "getGeneralSaleIfList";
	var sInDs  = "nc_input_fieldDs=ds_input";
	var sOutDs = "ds_generalSaleIfList=ds_generalSaleIfList";
	var sArg   = "sktst.sal.SUI#getOPMDSaleIfList";

	cf_Transaction(sSvcID, sInDs, sOutDs, sArg, "", true, true);
}


/*******************************************************************************
 * @description    : 콜백
 * @param sSvcID   : 서비스 아이디
*******************************************************************************/
function f_callBack(sSvcID)
{
    if (sSvcID = "getGeneralSaleIfList")
    {
		cf_setOrgDs(ds_generalSaleIfList);
        //cf_debug("ds_generalSaleIfList");
        //trace(ds_generalSaleIfList.SaveXML());
    }
    else if (sSvcID = "getGeneralSaleIfPsApndStatus")
    {
        var sSaleChgHstCl = ds_generalSaleIfList.GetColumn(ds_generalSaleIfList.currow,"sale_chg_hst_cl" );
        var sDummyCl      = "N";
        FV_PS_SL_CL = "";
        FV_GNRL_SALE_NO = "";

        if (ds_generalSaleIfStatus.rowcount > 0)
        {

            //이전 Data가 있는지 비교
            if ( ds_generalSaleIfStatus.GetColumn(0,"bf_cnt") > 0 )
            {
                //이전 Data가 있음.
                //PS에 반영 안된 Data가 있는지
                if ( ds_generalSaleIfStatus.GetColumn(0,"bf_ps_cnt") > 0 )
                {
                    alert("처리되지 않은 이전 DATA가 존재합니다.");
                    return;
                }
                else
                {
                    //변경 구분이 01 : 오류,  기타 : 판매변경등록
                    if ( sSaleChgHstCl == "01" )
                    {
                        alert("판매변경 구분 오류입니다.");
                        return;
                    }
                    else
                    {
                        FV_PS_SL_CL = ds_generalSaleIfStatus.GetColumn(0,"ps_sl_cl");
                        FV_GNRL_SALE_NO = ds_generalSaleIfStatus.GetColumn(0,"gnrl_sale_no");
                        //OPMD변경 등록
                        lf_openPopup(sDummyCl);
                    }
                }
            }
            else
            {

                //이전 Data가 없음.
                //ps반영여부
                if ( ds_generalSaleIfStatus.GetColumn(0,"ps_apnd_yn") == "Y" )
                {
                    alert("재조회 후 처리해주십시요.");
                    return;
                }
                else
                {
                    if ( sSaleChgHstCl == "01" )
                    {
                        //OPMD 등록
                        lf_openPopup(sDummyCl);
                    }
                    else
                    {
                        //기타
                        if ( ds_generalSaleIfStatus.GetColumn(0,"ps_apnd_cnt") > 0 )
                        {
                            FV_PS_SL_CL = ds_generalSaleIfStatus.GetColumn(0,"ps_sl_cl");
                            FV_GNRL_SALE_NO = ds_generalSaleIfStatus.GetColumn(0,"gnrl_sale_no");
                            //Ps에 등록된 Data가 있으면
                            //OPMD변경 등록
                            lf_openPopup(sDummyCl);

                        }
                        else
                        {
                            //Ps에 등록된 Data가 없으면
                            //Dummy 등록
                            sDummyCl = "Y";
                            lf_openPopup(sDummyCl);
                        }
                    }
                }
            }
        }
        else
        {
            alert("재조회 후 처리해주십시요.");
        }

    }
    else if (sSvcID = "svcSave")
    {
		Div_Condition_btn_search_OnClick();
    }
    else if (sSvcID = "svcAlreay")
    {
		var nCnt = ds_output.GetColumn(0, "cnt");

		if(nCnt > 0)
		{
			FV_ALREADY = true;
		}
		else
		{
			FV_ALREADY = false;
		}
    }
	else if(sSvcID = "svcSaleChgrgId")
	{
		cf_setInitDataForCmb(div_condition.cmb_chgrg, "전체");
	}
}

/*******************************************************************************
 * @description         : 조회 조건 Validation Check
 * @return              : 정상   - true
  *                       비정상 - false
*******************************************************************************/
function lf_validationCheckSearch()
{
    //조회기간 check
    if ( uf_IsNull(div_condition.cal_procDtFr.Value) )
    {
        alert("조회기간을 입력 입력해주십시요.");
        div_condition.cal_procDtFr.SetFocus();
        return false;
    }

    if (  uf_IsNull(div_condition.cal_procDtTo.value) )
    {
        alert("조회기간을 입력 입력해주십시요.");
        div_condition.cal_procDtTo.SetFocus();
        return false;
    }

    if ( div_condition.cal_procDtFr.value > div_condition.cal_procDtTo )
    {
        alert("조회기간 입력이 잘못되었습니다.");
        return false;
    }

	if (substr(div_condition.cal_procDtFr.value, 0, 6) <> substr(div_condition.cal_procDtTo.Value, 0, 6))
	{
		alert("동일한 월에 대해서만 조회가 가능합니다.");
		return false;
	}

    if ( uf_IsNull(div_Condition.edt_agencyCd) )
    {
        alert("대리점을 선택해 주십시요.");
        return false;
    }

    return true;
}


/*******************************************************************************
 * @description         : 대리점명을 입력받아 대리점코드를 가져온다.
*******************************************************************************/
function lf_getAgencyCd()
{
	sf_clearControls("div_condition.edt_agencyCd,div_condition.edt_agencyUkeyCd");
	sf_clearControls("div_condition.edt_salePlcNm,div_condition.edt_salePlc,div_condition.edt_salePlcUkeyCd,div_condition.edt_salePlcSubCd,div_condition.edt_salePlcChannelCd");

//	if(nChar == 13)
//	{
		var sArg  = "org_id="+quote(FV_ORG_ID);
			sArg += " org_cl="+quote(FV_ORG_CL);

		cf_callAgencyPop(sArg, div_condition, "edt_agencyCdNm,edt_agencyCd,edt_agencyUkeyCd");

		if(uf_isNull(FV_STR_POP_RESULT) == true) return;
		f_getSaleChgrgId();
//	}
}

/*******************************************************************************
 * @description         : 판매처명을 입력받아 판매처코드를 가져온다.
*******************************************************************************/
function lf_getSalePlcInfo()
{
	sf_clearControls("div_condition.edt_salePlcUkeyCd,div_condition.edt_salePlcSubCd,div_condition.edt_salePlcChannelCd,div_condition.edt_salePlc");

	var sArg  = "deal_co_cl1="+quote(sf_convertSlClToDealCoCl(div_condition.cmb_slCl.Value));//
		//sArg += " deal_status="+quote("3"); 	//옵션 (거래처 상태) - 1: 수납정지 N  , 2: 출고정지 N , 3: 판매정지 N
		sArg += " pos_agency="+quote(div_condition.edt_agencyCd.Text ); // 옵션
		//sArg += " eff_dtm="+quote(div_condition.cal_procDtFr.Value);

	cf_callDealPop(sArg, div_condition, "edt_salePlcNm,edt_salePlc,edt_salePlcUkeyCd,edt_salePlcSubCd,edt_salePlcChannelCd");

    //Right(FV_STR_POP_RESULT,2);
	/*
		var sPosAgency = div_input.edt_agencyCd.Text;

		if(uf_isNull(sPosAgency) == true)
		{
			alert(cf_getMessage(MSG_00083, "대리점"));
			div_input.edt_agencyCdNm.SetFocus();
			return;
		}

		var sArg  = "deal_co_cl1="+quote("A2");	// 소매
			sArg += " pos_agency="+quote(sPosAgency); // 옵션
		cf_callDealPop(sArg, div_input, "edt_salePlcNm,edt_salePlc,edt_salePlcUkeyCd,edt_salePlcSubCd,edt_salePlcChannelCd");

		//결과값이 있는지 없는지 이후 처리.....
		//if(uf_isNull(FV_STR_POP_RESULT) == true) return;
	*/
}

/*******************************************************************************
 * @description         : 일반판매,일반판매변경 팝업 open.
*******************************************************************************/
function lf_openPopup(sDummyCl)
{
    var sCurrRow      = ds_generalSaleIfList.currow;
    var sSlCl         = ds_generalSaleIfList.GetColumn(sCurrRow , "sl_cl" );
    var sSaleChgHstCl = ds_generalSaleIfList.GetColumn(sCurrRow , "sale_chg_hst_cl" );

            if (ds_generalSaleIfStatus.GetColumn(0,"ps_apnd_yn") == "N" )
            {
		        var sArg  = "p_if_proc_cl="    + quote( "1" );
		            sArg += " p_op_dt="        + quote( ds_generalSaleIfList.GetColumn(sCurrRow,"op_dt" ) );
		            sArg += " p_op_tm="        + quote( ds_generalSaleIfList.GetColumn(sCurrRow,"op_tm" ) );
		            sArg += " p_seq="          + quote( ds_generalSaleIfList.GetColumn(sCurrRow,"seq" ) );
		            sArg += " p_upd_cnt="      + quote( ds_generalSaleIfList.GetColumn(sCurrRow,"upd_cnt" ) );
		            sArg += " p_svc_mgmt_num=" + quote( ds_generalSaleIfList.GetColumn(sCurrRow,"svc_mgmt_num1" ) );
                var sScreenId = "";
                var sMenuNo   = "";
                var sProdCl   = "";
                var sMdlCd    = "";
                var sSerNum   = "";

		        //USIM 변경이면
		        var sIfRecTyp = ds_generalSaleIfList.GetColumn(sCurrRow,"if_rec_typ");
                if ( sIfRecTyp == "91" || sIfRecTyp == "92" )  //판매,판매취소
                {
                    sProdCl = "2";
                    sMdlCd  = ds_generalSaleIfList.GetColumn(sCurrRow,"usim_mdl_cd" );
                    sSerNum = ds_generalSaleIfList.GetColumn(sCurrRow,"usim_ser_num" );
                }
                else if ( sIfRecTyp == "93" || sIfRecTyp == "94" )  //기기교환
                {
                    sProdCl = "2";
                    sMdlCd  = ds_generalSaleIfList.GetColumn(sCurrRow,"bf_usim_mdl_cd" );
                    sSerNum = ds_generalSaleIfList.GetColumn(sCurrRow,"bf_usim_ser_num" );
                }
                else
                {
                    sProdCl = "1";

                    if ( sSaleChgHstCl == "02" )
                    {
                        //기기교환이면 이전 단말기 정보로 조회
                        sMdlCd  = ds_generalSaleIfList.GetColumn(sCurrRow,"bf_eqp_mdl_cd" );
                        sSerNum = ds_generalSaleIfList.GetColumn(sCurrRow,"bf_eqp_ser_num" );
                    }
                    else
                    {
                        sMdlCd  = ds_generalSaleIfList.GetColumn(sCurrRow,"eqp_mdl_cd" );
                        sSerNum = ds_generalSaleIfList.GetColumn(sCurrRow,"eqp_ser_num" );
                    }
                }

	            sArg += " p_prod_cl="    + quote( sProdCl );
	            sArg += " p_mdl_cd="     + quote( sMdlCd );
	            sArg += " p_ser_num="    + quote( sSerNum );
                sArg += " excuteMethod=" + quote("lf_dialogClose");

                //var sUserGrp = gds_session.GetColumn(0,"userGrp");   //40:도매, 30:소매
                //var sSlCl = ds_generalSaleIfList.GetColumn(ds_generalSaleIfList.currow , "sl_cl");

                //판매취소는 소매에서만 하므로 발생하는 문제.!! 도매 판매취소도 소매로 넘어온다.
                //판매변경 구분이 판매취소 일때는 소매라도 PS의 영업구분이 소매이면 소매일반판매변경으로 이동한다.
                //FV_PS_SL_CL != "" 이고
                //sSlCl != FV_PS_SL_CL 면   --> sSlCl = FV_PS_SL_CL

                if ( sSalechgHstCl == "07" && !uf_IsNull(FV_PS_SL_CL) )
                {
                    if ( sSlCl != FV_PS_SL_CL)
                    {
                        sSlCl = FV_PS_SL_CL;
                    }
                }

                if ( sDummyCl = "Y" )
                {
                    var sConfirm = Confirm(" 이전 판매정보가 없습니다.\n 판매정보 수작업 입력 화면으로 이동하시겠습니까?");

                    if ( sConfirm == "1" )
                    {
                        sScreenId = "SAL::SALDGS00100.xml";  //Dummy 등록
						sMenuNo = "";
						dialog(sScreenId, sArg, 1024,600);
						return;
                    }
                    else
                    {
                        return;
                    }
                }
                else
                {
					if ( sSlCl == "02" )
					{
						//도매
						if ( sSalechgHstCl == "01" )
						{
							sScreenId = "SAL::SALAGS00100.xml";  //일반판매  100000175
							sMenuNo = "100000175";
						}
						else
						{
							sScreenId = "SAL::SALAGS00300.xml";  //일반판매변경  100000155
							sMenuNo = "100000155";
						}
					}
					else if ( sSlCl == "01" )
					{
						//소매
						if ( sSalechgHstCl == "01" )
						{
							sScreenId = "SAL::SALRGS00100.xml";  //일반판매 100000176
							sMenuNo = "100000176";
						}
						else
						{
							sScreenId = "SAL::SALRGS00300.xml";  //일반판매변경 100000147
							sMenuNo = "100000147";
						}

					}
					else if ( sSlCl == "03" )
					{
						//온라인 소매
						if ( sSalechgHstCl == "01" )
						{
							sScreenId = "SAL::SALORG00100.xml";  //일반판매   100000373
							sMenuNo = "100000373";
						}
						else
						{
							sScreenId = "SAL::SALORG00300.xml";  //일반판매변경   100000374
							sMenuNo = "100000374";
						}

					}
					else if ( sSlCl == "04" )
					{
						//온라인 도매
						if ( sSalechgHstCl == "01" )
						{
							sScreenId = "SAL::SALOAG00100.xml";  //일반판매  100000375
							sMenuNo = "100000375";
						}
						else
						{
							sScreenId = "SAL::SALOAG00300.xml";  //일반판매변경
							sMenuNo = "";
							dialog(sScreenId, sArg, 1024,600);
							return;
						}

					}
					else
					{
						alert("권한이 없습니다.");
						return;
					}
		        }

                //
                //dialog(sScreenId, sArg, 1024,600);
                cf_openAuthPop(sMenuNo, sArg, 1024,600);
            }

    return;
}

/*******************************************************************************
 * @description         : 조회버튼
*******************************************************************************/
function div_condition_btn_search_OnClick(obj)
{
    // 조회 조건 validation check
    // 정상 : true, 비정상 : false
    if (!lf_validationCheckSearch())
    {
        return;
    }

	lf_getGeneralSaleIf();
}

/*******************************************************************************
 * @description         : 대리점명을 입력받아 대리점 코드를 가져온다.
*******************************************************************************/
function div_condition_edt_agencyCdNm_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
{
	if(nChar == 13)
	{
        lf_getAgencyCd();
	}
}

function div_condition_edt_agencyCdNm_OnCharChanged(obj,strPreText,strPostText)
{
	sf_clearControls("div_condition.edt_agencyUkeyCd,div_condition.edt_agencyCd");
	sf_clearControls("div_condition.edt_salePlcUkeyCd,div_condition.edt_salePlcSubCd,div_condition.edt_salePlcChannelCd,div_condition.edt_salePlc,div_condition.edt_salePlcNm");
}

function div_condition_btn_agency_OnClick(obj)
{
	sf_clearControls("div_condition.edt_agencyUkeyCd,div_condition.edt_agencyCd");
	sf_clearControls("div_condition.edt_salePlcUkeyCd,div_condition.edt_salePlcSubCd,div_condition.edt_salePlcChannelCd,div_condition.edt_salePlc,div_condition.edt_salePlcNm");

    lf_getAgencyCd();
}

function div_condition_btn_agency_OnKeyDown(obj,nChar,bShift,bCtrl,bAlt,nLLParam,nHLParam)
{
	if(nChar == 13)
	{
        lf_getAgencyCd();
	}
}

/*******************************************************************************
 * @description         : 판매처명을 입력받아 판매처 코드를 가져온다.
*******************************************************************************/
function div_condition_edt_slaePlcNm_OnKeyDown(obj,nChar,bShift,bCtrl, bAlt,LLParam,HLParam)
{
	if(nChar == 13)
	{
        lf_getSalePlcInfo();
	}
}

function div_condition_edt_salePlcNm_OnCharChanged(obj,strPreText,strPostText)
{
	sf_clearControls("div_condition.edt_salePlcUkeyCd,div_condition.edt_salePlcSubCd,div_condition.edt_salePlcChannelCd,div_condition.edt_salePlc");
}


function div_condition_btn_payPlc_OnClick(obj)
{
    lf_getSalePlcInfo();
}

function div_condition_btn_payPlc_OnKeyDown(obj,nChar,bShift,bCtrl,bAlt,nLLParam,nHLParam)
{
	if(nChar == 13)
	{
        lf_getSalePlcInfo();
	}
}



/*******************************************************************************
 * @description         : 일반판매,일반판매변경 창에서 저장시 화면 재조회.
*******************************************************************************/
function lf_dialogClose()
{
    div_condition.btn_search.Click();
}



function Div0_btn_ExcelExport_OnClick(obj)
{
    cf_exportExcel(grd_generalSaleList);
}


function f_validChgDealInfo()
{
	var nCntRow = ds_generalSaleIfList.GetRowCount();
	var sMsg = "";
	var bErr = false;

	http.Sync = true;

	for(var i=0; i < nCntRow; i++)
	{
		if(ds_generalSaleIfList.GetColumn(i, "CHK") == "1")
		{
			var sProcDt        = ds_generalSaleIfList.GetColumn(i, "proc_dt");
			var sProcTm        = ds_generalSaleIfList.GetColumn(i, "proc_tm");
			var sUkeyAgencyCd  = ds_generalSaleIfList.GetColumn(i, "ukey_agency_cd");
			var sUkeySubCd     = ds_generalSaleIfList.GetColumn(i, "ukey_sub_cd");
			var sUkeyChannelCd = ds_generalSaleIfList.GetColumn(i, "ukey_channel_cd");
			var sSalePlc       = ds_generalSaleIfList.GetColumn(i, "sale_plc");
			var sSalePlcNm     = ds_generalSaleIfList.GetColumn(i, "sale_plc_nm");

			if(uf_IsNull(sSalePlc) == true)
			{
				sSalePlc = sf_getDealCoCdByUkey("ds_input", "ds_output"
							, sProcDt, sProcTm, sUkeyAgencyCd, sUkeySubCd, sUkeyChannelCd);
				if(uf_IsNull(sSalePlc) == true)
				{
					bErr = true;
					sMsg += sUkeyAgencyCd +"/"+sUkeySubCd +"/"+ sUkeyChannelCd + " 거래처 오류입니다. \r\n";
					continue;
				}
			}

			if(sf_isChgDealInfo("ds_input", "ds_output", sSalePlc, (sProcDt + sProcTm) ) == false)
			{
				bErr = true;
				sMsg += sProcDt + " 판매일이후 " + sSalePlcNm + " 거래처 정보가 변경되었습니다. \r\n";
			}
		}
	}

	http.Sync = false;
	if(bErr == true)
	{
		alert(sMsg);
		return false;
	}
	return true;
}

/*******************************************************************************
 * @description    : 저장
*******************************************************************************/
function btn_save_OnClick(obj)
{
	if(ds_generalSaleIfList.GetUpdate() == false)
	{
		alert(cf_getMessage(MSG_00071,""));
		return;
	}

	if(f_validRmks(ds_generalSaleIfList.currow) == false) return;

	if(f_validChgDealInfo() == false) return;

	if(Confirm("저장하시겠습니까?") == false) return;

	createExceptHst();

	ds_input.Clear();
	cf_setParam(ds_input, "ps_apnd_ynz" , "N");  // 제외 해제상태로 설정
	cf_setParam(ds_input, "table_nm" , "TSAL_OPMD_SALE_IF");

	var sSvcID = "svcSave";
	var sInDs  = "nc_input_fieldDs=ds_input List=ds_generalSaleIfList:u ExceptList=ds_exceptHst";
	var sOutDs = "";
	var sArg   = "sktst.sal.SCO#updatePsApndYnList";

	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}

function btn_close_OnClick(obj)
{
	Close();
}




function ds_generalSaleIfList_OnColumnChanged(obj,nRow,strColumnID,varOldValue,varNewValue,nPivotIndex)
{
	if(ds_generalSaleIfList.GetColumn(nRow,"chk") == 1)
	{
		if(f_isAlreadyProc() == true)
		{
			alert("선택된 항목 처리일자 이후에 처리된 항목이 존재합니다.");
			ds_generalSaleIfList.SetColumn(nRow,"chk", "0");
			grd_generalSaleList.SetCellProp("body",0, "edit", "none");
			return;
		}
	}
}


function f_isAlreadyProc()
{
	var nRow        = ds_generalSaleIfList.currow;
	var sOpDt       = ds_generalSaleIfList.GetColumn( nRow, "op_dt");
	var sOpTm       = ds_generalSaleIfList.GetColumn( nRow, "op_tm");
	var sEqpMdlCd   = ds_generalSaleIfList.GetColumn( nRow, "eqp_mdl_cd");
	var sEqpSerNum  = ds_generalSaleIfList.GetColumn( nRow, "eqp_ser_num");
	var sUsimMdlCd  = ds_generalSaleIfList.GetColumn( nRow, "usim_mdl_cd");
	var sUsimSerNum = ds_generalSaleIfList.GetColumn( nRow, "usim_ser_num");


	ds_input.Clear();
	cf_setParam(ds_input, "op_dt"        , sOpDt      );
	cf_setParam(ds_input, "op_tm"        , sOpTm      );
	cf_setParam(ds_input, "eqp_mdl_cd"   , sEqpMdlCd  );
	cf_setParam(ds_input, "eqp_ser_num"  , sEqpSerNum );
	cf_setParam(ds_input, "usim_mdl_cd"  , sUsimMdlCd );
	cf_setParam(ds_input, "usim_ser_num" , sUsimSerNum);


	http.Sync = true;
	var sSvcID = "svcAlreay";
	var sInDs  = "nc_input_fieldDs=ds_input";
	var sOutDs = "ds_output=ds_output";
	var sArg   = "sktst.sal.SUI#getCntAleadyProcIF";

	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);

	http.Sync = false;

	return FV_ALREADY;
}


/*******************************************************************************
 * @description    :  로우 위치 변경시 비고 입력여부 확인
*******************************************************************************/
function ds_list_CanRowPosChange(obj,nOldRow,nRow)
{
	return f_validRmks(nOldRow);
}

/*******************************************************************************
 * @description    :  비고 입력여부 확인
*******************************************************************************/
function f_validRmks(nRow)
{
	if(ds_generalSaleIfList.GetColumn(nRow, "CHK") == "1")
	{
		if( uf_IsNull( ds_generalSaleIfList.GetColumn(nRow, "RMKS") ) == true)
		{
			alert(cf_getMessage(MSG_00083, "비고"));
			ds_generalSaleIfList.row = nRow;
			grd_generalSaleList.SetCellPos(sf_getIndexByGridColId(grd_generalSaleList,"RMKS"));
			return false;
		}
	}
	return true;
}


/*******************************************************************************
 * @description    :  미반영 제외 히스토리 데이터 생성
*******************************************************************************/
function createExceptHst()
{
	ds_exceptHst.DeleteAll();
	var nRows = ds_generalSaleIfList.GetRowCount();
	for(var i = 0 ; i < nRows ; i++)
	{
		if(ds_generalSaleIfList.GetColumn(i,"CHK") == "1")
		{
			var nRow = ds_exceptHst.AddRow();
			ds_exceptHst.SetColumn(nRow, "OP_DT"     , ds_generalSaleIfList.GetColumn(i, "OP_DT"));
			ds_exceptHst.SetColumn(nRow, "OP_TM"     , ds_generalSaleIfList.GetColumn(i, "OP_TM"));
			ds_exceptHst.SetColumn(nRow, "SEQ"       , ds_generalSaleIfList.GetColumn(i, "SEQ"));
			ds_exceptHst.SetColumn(nRow, "IF_REC_TYP", ds_generalSaleIfList.GetColumn(i, "IF_REC_TYP"));
			ds_exceptHst.SetColumn(nRow, "BF_STATUS" , ds_generalSaleIfList.GetColumn(i, "PS_APND_YN"));
			ds_exceptHst.SetColumn(nRow, "AF_STATUS" , "N");
			ds_exceptHst.SetColumn(nRow, "RMKS"      , ds_generalSaleIfList.GetColumn(i, "RMKS"));

			ds_exceptHst.SetColumn(nRow, "SVC_MGMT_NUM" , ds_generalSaleIfList.GetColumn(i, "SVC_MGMT_NUM1"));
			ds_exceptHst.SetColumn(nRow, "SVC_NUM"      , ds_generalSaleIfList.GetColumn(i, "SVC_NUM"));
			ds_exceptHst.SetColumn(nRow, "SALE_PLC"     , ds_generalSaleIfList.GetColumn(i, "SALE_PLC"));
			ds_exceptHst.SetColumn(nRow, "SL_CL"        , ds_generalSaleIfList.GetColumn(i, "SL_CL"));

		}
	}
}

/*******************************************************************************
 * @description    :  체크박스를 선택했을 경우
*******************************************************************************/
function grd_generalsalelist_OnCellClick(obj,nRow,nCell,nX,nY,nPivotIndex)
{
	if(nCell == 0)
	{
		if(uf_isNull(ds_generalSaleIfList.GetColumn(nRow,"CHK")) == true || ds_generalSaleIfList.GetColumn(nRow,"CHK") == 0)
		{	// 선택했을 경우

			ds_generalSaleIfList.SetColumn(nRow, "RMKS", null);
		}
		else
		{	// 해제했을 경우 기존 비고내용 원복
			ds_generalSaleIfList.SetColumn(nRow, "RMKS", ds_generalSaleIfList.GetOrgBuffColumn(nRow, "RMKS"));
		}
	}
}

/*******************************************************************************
 * @description    : 판매담당자 리스트 조회
*******************************************************************************/
function f_getSaleChgrgId()
{

	var sAgency = div_condition.edt_agencyCd.Text;

	//if( uf_isNull(sAgency) == true) return;

	ds_input.Clear();

	// 넘길 파라메터 설정
	cf_setParam(ds_input, "agency_cd", sAgency);

	// 트랜잭션 설정
	var sSvcID = "svcSaleChgrgId";
	var sInDs  = "nc_input_fieldDs=ds_input";
	var sOutDs = "ds_saleChgrgId=ds_ReqUser";
	var sArg   = "sktst.sal.SCO#getUserList";

	// 공통 트랜잭션 호출
	cf_Transaction(sSvcID, sInDs, sOutDs, sArg);
}
function grd_generalSaleList_OnHeadClick(obj,nCell,nX,nY,nPivotIndex)
{
	cf_markGridSort(obj,nCell,nX,nY,nPivotIndex);
}
]]></Script>
</Window>